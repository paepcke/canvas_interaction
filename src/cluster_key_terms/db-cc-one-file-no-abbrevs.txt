WelcometothecourseIntroductiontoDatabases.|I'mJenniferWidomfromStanfordUniversity.|Inthiscoursewe'llbelearningaboutdatabasesandtheuseofdatabasemanagementsystems,primarilyfromtheviewpointofthedesigner,useranddeveloperofdatabaseapplications.|I'mgoingtostartbydescribinginoneverylongsentencewhatadatabasemanagementsystemprovidesforapplications.|Itprovidesameansofhandlinglargeamountsofdataprimarily,butlet'slooksatalittlemoredetail.|Whatitprovides,inalongsentence,isefficient,reliable,convenientandsafemulti-userstorageofandaccesstomassiveamountsofpersistentdata.|So,I'mgoingtogointoeachoneofthoseadjectivesinalittlebinary digitmoredetailinamoment.|ButIdidwanttomentionthatdatabasesystemsareextremelyprevalentintheworldtoday.|Theysitbehindmanywebsitesthatwillrunyourbankingsystems,yourtelecommunications,deploymentsofsensors,scientificexperimentsandmuch,muchmore.|Highlyprevalent.|Solet'stalkalittlebinary digitaboutwhydatabasesystemsaresopopularsoandprevalentbylookingatthesesevenadjectives.|Thefirstaspectofdatabasesystemsisthattheyhandledataatamassivescale.|Soifyouthinkabouttheamountofdatathatisbeingproducedtoday,databasesystemsarehandlingterabytesofdata,sometimeseventerabytesofdataeveryday.|Andoneofthecriticalaspectsisthatthedatathat'shandledbydatabasemanagementsystemssystemsismuchlargerthancanfitinthememoryofatypicalcomputingsystem.|Somemoriesareindeedgrowingvery,veryfast,buttheamountofdataintheworldanddatatobehandledbydatabasesystemsisgrowingmuchfaster.|Sodatabasesystemsaredesignedtohandledatathattoresidingoutsideofmemory.|Secondly,thedatathat'shandledbydatabasemanagementsystemsistypicallypersistent.|AndwhatImeanbythatisthatthedatainthedatabaseoutlivestheprogramsthatexecuteonthatdata.|Soifyourunatypicalcomputerprogramtheprogramwillstartthevariableswecreated.|Therewillbedatathat'soperatedontheprogram,theprogramwillfinishandthedatawillgoaway.|It'ssortoftheotherwaywithdatabases.|Thedataiswhatsitsthereandthenprogramwillstartup,itwilloperateonthedata,theprogramwillstopandthedatawillstillbethere.|Veryoftenactuallymultipleprogramswillbeoperatingonthesamedata.|Next,safety.|Sodatabasesystems,sincetheyruncriticalapplicationssuchastelecommunicationsandbankingsystems,havetohaveguaranteesthatthedatamanagedbythesystemwillstayinaconsistentstate,itwon'tbelostoroverwrittenwhentherearefailures,andtherecanbehardwarefailures.|Therecanbesoftwarefailures.|Evensimplepoweroutages.|Youdon'twantyourbankbalancetochangebecausethepowerwentoutatyourbankbranch.|Andofcoursetherearetheproblemofmalicioususersthatmaytrytocorruptdata.|Sodatabasesystemshaveanumberofbuiltinmechanismsthatensurethatthedataremainsconsistent,regardlessofwhathappens.|Nextmulti-user.|SoImentionedthatmultipleprogramsmayoperateonthesamedatabase.|Andevenwithoneprogramoperatingonadatabase,thatprogrammayallowmanydifferentusersorapplicationstoaccessthedataconcurrently.|Sowhenyouhavemultipleapplicationsworkingonthesamedata,thesystemhastohavesomemechanisms,again,toensurethatthedatastaysconsistent.|Thatyoudon'thave,forexample,halfofadataitemoverwrittenbyonepersonandtheotherhalfoverwrittenbyanother.|Sothere'smechanismsindatabasesystemscalledconcurrencycontrol.|Andtheideathereisthatwecontrolthewaymultipleusersaccessthedatabase.|Nowwedon'tcontrolitbyonlyhavingoneuserhaveexclusiveaccesstothedatabaseortheperformancewouldslowdownconsiderably.|Sothecontrolactuallyoccursatthelevelofthedataitemsinthedatabase.|Somanyusersmightbeoperatingonthesamedatabasebutbeoperatingondifferentindividualdataitems.|It'salittlebinary digitsimilarto,say,filesystemconcurrencyorevenvariableconcurrencyinprograms,exceptit'smorecenteredaroundthedataitself.|Thenextadjectiveisconvenience,andconvenienceisactuallyoneofthecriticalfeaturesofdatabasesystems.|Theyreallyaredesignedtomakeiteasytoworkwithlargeamountsofdataandtodoverypowerfulandinterestingprocessingonthatdata.|Sothere'sacouplelevelsatwhichthathappens.|There'sanotionindatabasescalledPhysicalDataIndependence.|It'skindofamouthful,butwhatthat'ssayingisthatthewaythatdataisactuallystoredandlaidoutondiskisindependentofthewaythatprogramsthinkaboutthestructureofthedata.|Soyoucouldhaveaprogramthatoperatesonadatabaseandunderneaththerecouldbeacompletechangeinthewaythedataisstored,yettheprogramitselfwouldnothavetobechanged.|Sotheoperationsonthedataareindependentfromthewaythedataislaidout.|Andsomewhatrelatedtothatisthenotionofhighlevelquerylanguages.|So,thedatabasesareusuallyqueriedbylanguagesthatarerelativelycompacttodescribe,reallyataveryhighlevelwhatinformationyouwantfromthedatabase.|Specifically,theyobeyanotionthat'scalleddeclarative,andwhatdeclarativeissayingisthatinthequery,youdescribewhatyouwantoutofthedatabasebutyoudon'tneedtodescribethealgorithmtogetthedataout,andthat'sareallynicefeature.|Itallowsyoutowritequeriesinaverysimpleway,andthenthesystemitselfwillfindthealgorithmtogetthatdataoutefficiently.|Andspeakingofefficiency,that'snumbersix,butcertainlynotsixthimportance.|There'sinrealestateasalittleasidehere,aoldsayingthatwhenyouhaveapieceofproperty,themostimportantthreeaspectsofthepropertyarethelocationoftheproperty,thelocationandthelocation.|Andpeoplesaythesamethingaboutdatabases,asimilarparalleljoke,whichisthatthethreemostimportantthingsinadatabasesystemisfirstperformance,secondperformanceandagainperformance.|Sodatabasesystemshavetodoreallythousandsofqueriesorupdatespersecond.|Thesearenotsimplequeriesnecessarily.|Thesemaybeverycomplexoperations.|So,constructingadatabasesystem,thatcanexecutequeries,complexqueries,atthatrate,overgiganticamountsofdata,terabytesofdataisnosimpletask,andthatisoneofthemajorfeaturesalso,providedbyadatabasemanagementsystem.|Andlastly,butagainnotlastinimportanceisreliability.|Again,lookingbackatsayyourbankingsystemoryourtelecommunicationssystem,it'scriticallyimportantthatthoseareupallthetime.|So99.99999%uptimeisthetypeofguaranteethatdatabasemanagementsystemsaremakingfortheirapplications.|Sothatgivesusanideaofalltheterrificthingsthatadatabasesystemprovides.|Ihopeyou'reallreadyconvincedthatifyouhaveaapplicationyouwanttobuildthatinvolvesdata,itwouldbegreattohaveallofthesefeaturesprovidedforyouinadatabasesystem.|Nowletmementionafewoftheaspectssurroundingdatabasesystemsandscopealittlebinary digitwhatwe'regoingtobecoveringinthiscourse.|Whenpeoplebuilddatabaseapplications,sometimestheyprogramthemwithwhat'sknownasaframework.|Currentlyatthetimeofthisvideo,someofthepopularframeworksareDjangoorRubyonRails,andtheseareenvironmentsthathelpyoudevelopyourprograms,andhelpyougenerate,saythecallstothedatabasesystem.|We'renot,inthissetofvideos,goingtobetalkingabouttheframeworks,butratherwe'regoingtobetalkingaboutthedatabasesystemitselfandhowitisusedandwhatitprovides.|Secondofall,databasesystemsareoftenusedinconjunctionwithwhat'sknownasmiddle-ware.|Again,atthetimeofthisvideo,typicalmiddle-waremightbeapplicationservers,webservers,sothismiddle-warehelpsapplicationsinteractwithdatabasesystemsincertaintypesofways.|Again,that'ssortofoutsidethescopeofthecourse.|Wewon'tbetalkingaboutmiddlewareinthecourse.|Finally,it'snotthecasethateveryapplicationthatinvolvesdatanecessarilyusesthedatabasesystem,sohistorically,alotofdatahasbeenstoredinfiles,Ithinkthat'salittlebinary digitlesssothesedays.|Still,there'salotofdataouttherethat'ssimplysittinginfiles.|Excelspreadsheetsisanotherdomainwherethere'salotofdatasittingoutthere,andit'susefulincertainways,andtheprocessingofdataisnotalwaysdonethroughquerylanguagesassociatedwithdatabasesystems.|Forexample,Hadoopisaprocessingframeworkforrunningoperationsondatathat'sstoredinfiles.|Again,inthissetofvideoswe'regoingtofocusonthedatabasemanagementsystemitselfandonstoringandoperatingondatathroughadatabasemanagementsystem.|Sotherearefourkeyconceptsthatwe'regoingtocoverfornow.|Thefirstoneisthedatamodel.|Thedatamodelisadescriptionof,ingeneral,howthedataisstructured.|Oneofthemostcommondatamodelsistherelationaldotdatamodel,we'llspendquiteabinary digitoftimeonthat.|Intherelationaldatamodelthedataandthedatabaseisthoughtofasasetofrecords.|Nowanotherpopularwaytostoredataisforexample,ineXtensible Markup Languagedocuments,so,aneXtensible Markup Languagedocumentcapturesdata,insteadofasetofrecords,asahierarchicalstructure,oflabeledvalues.|Anotherpossibledatamodelwouldbeagraphdatamodeloralldatainthedatabaseisintheformofnodesandedges.|Soagain,adatamodelistellingyouthegeneralformofdatathat'sgoingtobestoredinthedatabase.|Nextistheconceptofschemaversusdata.|Onecanthinkofthiskindofliketypesandvariablesinaprogramminglanguage.|Theschemasetsupthestructureofthedatabase.|MaybeI'mgoingtohaveinformationaboutstudentswithIDsandGPAs,oraboutcolleges,andit'sjustgoingtotellmethestructureofthedatabasewherethedataistheactualdatastoredwithintheschema.|Again,inaprogram,yousetuptypesandthenyouhavevariablesofthosetypes,we'llsetupaschema,andthenwewillhaveawholebunchofdatathatadherestothatschema.|Typicallytheschemaissetupatthebeginning,anddoesn'tchangeverymuchwherethedatachangesrapidly.|Nowtosetuptheschema,onenormallyuseswhat'sknownasadatadefinitionlanguage.|Sometimespeopleusehigherleveldesigntoolsthathelpthemthinkaboutthedesignandthenfromtheregotothedatadefinitionlanguage.|Butit'susedingeneraltosetupaschemeorstructureforaparticulardatabase.|Oncetheschemahasbeensetupanddatahasbeenloaded,thenit'spossibletostartqueryingandmodifyingthedataandthat'stypicallydonewithwhat'sknownasthedatamanipulationlanguage,soforqueryingandmodifyingthedatabase.|Okay,sothosearesomekeyconceptscertainlywe'regoingtogetintomuchmoredetailinlatervideosabouteachoftheseconcepts.|Nowlet'stalkaboutthepeoplethatareinvolvedinadatabasesystem.|Sothefirstpersonwe'llmentionisthepersonwhoimplementsthedatabasesystemitself,thedatabaseimplementer.|That'sthepersonwhobuildsthesystem,that'snotgoingtobethefocusofthiscourse.|We'regoingtobefocusingmoreonthetypesofthingsthataredonebytheotherthreepeoplethatI'mgoingtodescribe.|Thenextoneisthedatabasedesigner.|Sothedatabasedesigneristhepersonwhoestablishestheschemaforadatabase.|So,let'ssupposewehaveanapplication.|Weknowthere'sgoingtobealotofdatainvolvedintheapplicationandwewanttofigureouthowwearegonnastructurethatdatabeforewebuildtheapplication.|That'sthejobofthedatabasedesigner.|It'sasurprisinglydifficultjobwhenyouhaveaverycomplexdatainvolvedinanapplication.|Onceyou'veestablishedthestructureofthedatabasethenit'stimetobuildtheapplicationsorprogramsthataregoingtorunonthedatabase,ofteninterfacingbetweentheeventualuserandthedataitself,andthat'sthejoboftheapplicationdeveloper,sothosearetheprogramsthatoperateonthedatabase.|AndagainI'vementionedalreadythatyoucanhaveadatabasewithmanydifferentprogramsthatoperateonit,beverycommon.|Youmight,forexample,haveasalesdatabasewheresomeapplicationsareactuallyinsertingthesalesastheyhappen,whileothersareanalyzingthesales.|Soit'snotnecessarytohaveaone-to-onecouplingbetweenprogramsanddatabases.|Andthelastpersonisthedatabaseadministrator.|Sothedatabaseadministratoristhepersonwholoadsthedata,sortofgetsthewholethingrunningandkeepsitrunningsmoothly.|So,thisactuallyturnsouttobeaveryimportantjobforlargedatabaseapplications.|Forbetterorworse,databasesystemsdotendtohaveanumberoftuningparametersassociatedwiththem,andgettingthosetuningparametersrightcanmakeasignificantdifferenceintheallimportantperformanceofthedatabasesystem.|Sodatabaseadministratorsareactually,highlyvalued,veryimportant,highlypaidasamatteroffact,andare,forlargedeployments,animportantpersonintheentireprocess.|Sothosearethepeoplethatareinvolved,again,inthisclasswe'llbefocusingmostlyondesigninganddevelopingapplications,alittlebinary digitonadministration,butingeneralthinkingaboutdatabasesandtheuseofdatabasemanagementsystemsfromtheperspectiveoftheapplicationbuilderanduser.|Toconclude,we'regoingtobelearningaboutdatabasesandwhetheryouknowitornotnotyou'realreadyusingadatabaseeveryday.|Infact,morelikelythannotyou'reusingadatabaseeveryhour.|Inthisvideo,we'lllearnabouttheRelationalModel.|TheRelationalModelismorethan35yearsold,andit'sreallythefoundationofdatabasemanagementsystems.|It'sspawnedamanybilliondollarindustry.|Therelationalmodelunderliesallcommercialdatabasesystemsatthispointintime.|It'sactuallyanextremelysimplemodelandthat'soneofitsbenefits.|Furthermore,itcanbequeried.|BythatImeanwecanaskquestionsofdatabasesinthemodelusingHighLevelLanguages.|HighLevelLanguagesaresimple,yetextremelyexpressiveforaskingquestionsoverthedatabase.|Andfinally,veryimportantlythereareextremelyefficientimplementationsoftherelationalmodelandofthequerylanguagesonthatmodel.|Solet'smoveaheadandunderstandthebasicconstructsintherelationalmodel.|So,theprimaryconstructisinfact,therelation.|Adatabaseconsistsofasetofrelationsorsometimesreferredtoas"tables",eachofwhichhasaname.|So,we'regonnausetworelationsinourexample.|Ourexampleisgonnabeafictitiousdatabaseaboutstudentsapplyingtocolleges.|Fornowwe'rejustgonnalookatthestudentsandcollegesthemselves.|Sowe'regonnahavetwotables,andlet'scallthosetablestheStudenttableandtheCollegetable.|Now,asanaside,there'sahealthydebateinthedatabaseworldaboutwhethertablesrelationsoughttobenamedusingthesingularortheplural.|Ipersonallydon'thaveastakeinthatdebate.|I'mgoingtousethesingular.|Next,wehavetheconceptofattributes.|Soeveryrelationandrelationaldatabasehasapredefinedsetofcolumnsorattributeseachofwhichhasaname.|So,forourstudenttable,let'ssaythateachstudentisgonnahaveanID,aname,aGPAandaphoto.|Andforourcollegetable,let'ssaythateverycollegeisgoingtohaveaname,astate,andanenrollment.|We'lljustabbreviatethatENR.|Sothosearethelabeledcolumns.|Nowtheactualdataitselfisstoredinwhatarecalledthetuples(ortherows)inthetables.|Solet'sputacoupleofthedatatables,datatuplesinourtables.|Solet'sstartwiththestudentsandletssaythatourfirststudenthasID123.|NameisAmy-GPA3.9,andshe'shappywiththat.|Soshehasasmileyphoto.|Andoursecondstudentis234,Bob-hisGPAis3.4.|He'snotquiteashappy.|Andtypicallyofcourseatablewillhavethousands,maybemillions,evensometimesbillionsofrows,eachrowcontainingavalueforeachattribute.|Inourcollegetable,let'ssupposewehave....wellofcoursewe'regoingtostartwithStanfordinthestateofCaliforniaandStanford'senrollmentis15,000.|We'llincludeourcross-bayrivalBerkeleyagain,inthestateofCalifornia.|Berkeley'senrollmentisawhopping36,000.|Andlastofall,wearegoingtonotbeWestCoastbiased.|We'llincludeMassachusetts Institute of TechnologyinthestateofMassachusettswithanenrollmentof10,000.|Nowofcoursethere'sgonnabeagainmanymoretuplesinthecollegetable,andmanymoretuplesinthestudenttable.|Okay,next,letmementionthatinarelationaldatabase,typicallyeachattributeorcolumnhasatypesometimesreferredtoasadomain.|Forexample,theIDmightbeaninteger,thenamemightbeastring,GPAmightbeafloat,photomightbeajpegfile.|Wedoalsoinmostrelationaldatabaseshaveaconceptofenumerateddomain.|Soforexample,thestatemightbeanenumerateddomainforthe50abbreviationsforstates.|Now,it'stypicalforrelationaldatabasestohavejustatomictypesintheirattributesaswehavehere,butmanydatabasesystemsdoalsosupportstructuredtypesinsideattributes.|Okay,alittlebinary digitmoreterminology.|Theschemaofadatabaseisthestructureoftherelation.|Sotheschemaincludesthenameoftherelationandtheattributesoftherelationandthetypesofthoseattributes.|Wheretheinstanceistheactualcontentsofthetableatagivenpointintime.|So,typicallyyousetupaschemainadvance,thentheinstancesofthedatawillchangeovertime.|Now,Imentionedthatmostcolumnshavetypes.|But,there'salsoaspecialvaluethat'sinanytypeofanycolumnandthat'saspecialvalueknownasnull,andnullsareactuallyquiteimportantinrelationaldatabases.|Nullvaluesareusedtodenotethataparticularvalueismaybeunknownorundefined.|And,solet'ssuppose,let'saddanothertupletoourdatabase.|Let'ssay345,anotherstudentnamedCraig,andfor,whateverreasonCraigdoesn'thaveaGPA.|MaybeCraigishomeschooled,maybeCraigdoesn'twanttorevealhisGPA.|SothenthedatabasewouldcontainanullvalueforCraigandwe'lljustputaneutralfacethere.|Or,forexample,maybeBobdoesn'twanttohavehisphotointhedatabase,sothenBobwouldhaveanullvalueforhisphoto,againnullscangoanywhere.|Nownullvaluesareusefulbutonehastobeverycarefulinadatabasesystemwhenyourunqueriesoverrelationsthathavenullvalues.|Inalatervideowe'llgointothisinmoredetail,butIjustwantedtogiveajustsortofexampleofwhatcanhappen.|So,let'ssupposewe'reaskingaqueryoverourstudenttableofallstudentswhoseGPAisgreaterthan3.5.|Sowhenwerunthatqueryonourdatabaseobviouslywe'llgetAmyout,obviouslywewon'tgetBobout,butshouldwegetCraig?|TheanswerisNo.|Wedon'tknowforafactthatCraig'sGPAisgreaterthan3.5,sowe'llonlygetonestudentoutfromthatquery.|Nowlet'ssupposewehadanotherquery,whereweweregonnaaskfortheGPAlessthanorequalto3.5.|So,similarlywherewewouldnothaveAmyinresultandwewouldcertainlyhaveBobintheresultandsimilarlywouldnothaveCraigintheresultbecausewedon'tknowthathisGPAislessthanorequalto3.5.|Sofarsogood,butitgetsalittleweirdiswhenweaddanorhereinourquery,wesayIwanteveryonewho'sGPAisgreaterthan3.5orwho'sGPAislessthanorequalto3.5.|Andeventhoughitlookslikeeverytupleshouldsatisfythiscondition,thatit'salwaystrue,that'snotthecasewhenwehavenullvalues.|So,that'swhyonehastobecarefulwhenoneusesnullvaluesinrelationaldatabases.|Letmeerasethisnowandlet'smoveontoournextconceptwhichistheconceptofKey.|Keyisagainanotherimportantconceptinrelationaldatabases.|And,akeyisanattributeinofarelationwhereeveryvalueforthatattributeisunique.|Soifwelookatthestudentrelation,wecanfeelprettyconfidentthattheIDisgoingtobeakey.|Inotherwords,everytupleisgoingtohaveauniqueforID.|Thinkingaboutthecollegerelation,it'salittlelessclear.|WemightbetemptedtosaythatthenameofthecollegeisanID,thatactuallycollegenamesprobablyarenotuniqueacrossthecountry.|There'sprobablyalotoforseveralcollegesnamedWashingtoncollegeforexample.|Youknowwhat,we'reallowedtohavesetsofattributesthatareuniqueandthatmakessenseinthecollegerelation.|Mostlikelythecombinationofthenameandstateofacollegeisunique,andthat'swhatwewouldidentifyasthekeyforthecollegerelation.|Now,youmightwonderwhyit'sevenimportanttohaveattributesthatareidentifiedaskeys.|There'sactuallyseveralusesforthem.|Oneofthemisjusttoidentifyspecifictuples.|Soifyouwanttorunaquerytogetaspecifictupleoutofthedatabaseyouwoulddothatbyaskingforthattuplebyitskey.|Andrelatedtothatdatabasesystemsforefficiencytendtobuildspecialindexstructuresorstorethedatabaseinaparticularway.|Soit'sveryfasttofindatuplebasedonitskey.|Andlastly,ifonerelationinarelationaldatabasewantstorefertotuplesofanother,there'snoconceptofpointerinrelationaldatabases.|Therefore,thefirstrelationwilltypicallyrefertoatupleinthesecondrelationbyitsuniquekey.|Asourvideosdevelopwe'llseetheimportanceofkeys.|Okay,justtowrapup,I'llmentionhowonecreatesrelationsortablesintheStructured Query Languagelanguage.|It'sverysimple,youjustsay"createtable,"givethenameoftherelationandalistoftheattributes.|Andifyouwanttogivetypesfortheattributes.|It'ssimilarexceptyoufolloweachattributenamewithitstype.|Sotowrapup,therelationalmodelhasbeenaroundalongtime.|Hasstartedahugeindustry.|It'susedbyalldatabasesystems.|Asyou'veseenit'saverysimplemodelandwillshortlyseethatitcanbequeriedwithverynicelanguages.|And,finally,it'sbeenimplementedveryefficiently.|Inthisvideo,we'regoingtolearnaboutqueryingrelationaldatabases.|We'renotgoingtofocusonaspecificquerylanguage,we'lldothatlater.|We'rejustgoingtotalkaboutqueryingrelationaldatabasesingeneral.|Let'sstartbytalkingaboutthebasicstepsincreatingandusingarelationaldatabase.|So,bytheway,Ishouldmentionthatdatabasepeoplehavethishabitofdrawingdatabasesanddatabasesystemsasgiganticdisks.|So,I'llbeusingthatsamehabit.|So,thefirststepistodesigntheschemaofthedatabaseandthencreatetheschemausingadatadefinitionlanguage.|Soaswediscussedinpreviousvideosinarelationaldatabasetheschemaconsistsofthestructureoftherelationsandtheattributesofthoserelations.|Sowesetthoseupinsideourbigdisk.|Oncethat'sready,thenextstepistoloadupthedatabasewiththeinitialdata.|Soit'sfairlycommonforthedatabasetobeinitiallyloadedfromdatathatcomesfromanoutsidesource.|Maybethedataisjuststoredinfilesofsometype,andthenthatdatacouldbeloadedintothedatabase.|Oncethedataisloaded,thenwehaveabunchoftuplesinourrelation.|Now,we'rereadyforthefunpartwhichistoqueryandmodifythedata.|Andsothathappenscontinuouslyovertimeaslongasthedatabaseisinexistence.|Solet'sjustsayfornowthatwe'regoingtohavehumanusersthataredirectlyqueryingthedatabase.|Inreality,thattypicallyhappensthroughsayanapplicationorawebsite.|So,auserwillcomealongandwe'llaskaquestionofthedatabaseandwewillgetananswer.|HemightcomealongandaskanotherquestionQ2andhe'dgetanotheranswerback.|Thesamehumanormaybeadifferenthumanmightasktomodifythedatabase.|So,theymightwanttoinsertnewdataorupdatesomeofthedataandthedatabasewillcomebackandsay,"Okay,Imadethatchangeforyou."|Sothat'sthebasicparadigmofqueryingandupdatingrelationaldatabases.|Relationaldatabasessupportadhocqueriesandhigh-levellanguages.|Byadhoc,Imeanthatyoucanposequeriesthatyoudidn'tthinkofinadvance.|Soit'snotnecessarytowritelongprogramsforspecificqueries.|Ratherthelanguagecanbeusedtoposeaqueryasyouthinkaboutwhatyouwanttoask.|Andasmentionedinpreviousvideosthelanguagessupportedbyrelationalsystemsarehighlevel,meaningyoucanwriteinafairlycompactfashionrathercomplicatedqueriesandyoudon'thavetowritethealgorithmsthatgetthedataoutofthedatabase.|So,let'slookatanexampleofafewqueries.|Let'sgotoagaintoourimaginarydatabaseofstudentswhoareapplyingtocolleges.|Andhere'sjustthreeexamplesofthetypesofthingsthatyoumightaskofarelationaldatabase.|YoumightwanttogetallstudentswhoseGPAisgreaterthan3.7whoareapplyingtoStanfordandMassachusetts Institute of Technologyonly.|YoumightwanttogetallengineeringdepartmentsinCaliforniawithfewerthan500applicantsoryoumightaskforthecollegewiththehighestaverageacceptrateoverthelastfiveyears.|NowthesemightseemlikeafairlycomplicatedqueriesbutallofthesecanbewritteninafewlinesinsaytheStructured Query Languagelanguageoraprettysimpleexpressioninrelationalalgebra.|So,somequeriesareeasiertoposethanothers,that'scertainlytrue.|Thoughthe3queriesyouseehereareasIsaidprettyeasytopose.|Nowsomequeriesareeasierforthedatabasesystemtoexecuteefficientlythanothers.|Andinterestinglyit'snotnecessarily.|Thesetwothingsaren'tnecessarilycorrelated.|Therearesomequeriesthatareeasytopostbuthardtoexecuteefficientlyandsomethatarevice-versa.|Now,justabinary digitaboutterminology.|Frequently,peopletalkaboutthequerylanguageofthedatabasesystem.|That'susuallyusedsortofsynonymouslywiththeDefinitive Media LibraryorDataManipulationLanguagewhichusuallyincludesnotonlyqueryingbutalsodatamodifications.|Inallrelationalquerylanguages,whenyouaskaqueryoverasetofrelations,yougetarelationasaresult.|Solet'srunaquerycuesayoverthesethreerelationsshownhereandwhatwe'llgetbackisanotherrelation.|Whenyougetbackthesametypeofobjectthatyouquery,that'sknownasclosureofthelanguage.|Anditreallyisanicefeature.|Forexample,whenIwanttorunanotherquery,sayQ2,thatquerycouldbeposedovertheanswerofmyfirstqueryandcouldevencombinethatanswerwithsomeoftheexistingrelationsinthedatabase.|That'sknownascompositionality,theabilitytorunaqueryovertheresultofourpreviousquery.|Now,letmetalkbrieflyabouttwoquerylanguages.|We'llbelearningtheselanguagesindetaillater,butI'mjustgoingtogivethebasicflavorofthelanguageshere.|Relationalalgebraisaformallanguage.|Well,it'sanalgebraasyoucantellbyitsname.|Soit'sverytheoreticallywell-grounded.|Structured Query LanguagebycontrastiswhatI'llcallanactuallanguageoranimplementedlanguage.|That'stheoneyou'regoingtorunonanactualdeployeddatabaseapplication.|ButtheStructured Query Languagelanguagedoeshaveasitsfoundationrelationalalgebra.|That'showthesemanticsoftheStructured Query Languagelanguagearedefined.|NowletmejustgiveyouaflavorofthesetwolanguagesandI'mgoingtowriteonequeryineachofthetwolanguages.|So,letmegetridofthislittlelinehere.|Let'sstartinrelationalalgebra.|Sowe'relookingfortheID'sofstudentswhoseGPAisgreaterthan3.7andthey'veappliedtoStanford.|Inrelationalalgebra,thebasicoperatorslanguageareGreeksymbols.|Again,we'lllearnthedetailslater,butthisparticularexpressionwillbewrittenbyaPhifollowedbyaSigma.|ThePhisayswe'regoingtogettheID,theSigmasayswewantstudentswhoseGPAisgreaterthan3.7andthecollegethatthestudentshaveappliedtoisStanford.|Andthenthatwilloperateonwhat'scalledthenaturaljoinofthestudentrelationwiththeapplyrelation.|Again,we'lllearnthedetailsofthatinalatervideo.|Now,here'sthesamequeryinStructured Query Language.|Andthisissomethingthatyouwouldactuallyrunonadeployeddatabasesystem,andtheStructured Query Languagequeryis,infact,directlyequivalenttotherelationalalgebraquery.|Now,pedagogically,IwouldhighlyrecommendthatyoulearntherelationalalgebrabywatchingtherelationalalgebravideosbeforeyoumoveontotheStructured Query Languagevideos,butI'mnotgoingtoabsolutelyrequirethat.|So,ifyou'reinabighurrytolearnStructured Query LanguagerightawayyoumaymoveaheadtotheStructured Query Languagevideos.|Ifyou'reinterestedintheformalfoundationsandadeeperunderstanding,Irecommendmovingnexttotherelationalalgebravideo.|ThisvideointroducesthebasicsofeXtensible Markup Language.|eXtensible Markup Languagecanbethoughtofasadatamodel,analternativetotherelationalmodel,forstructuringdata.|InadditiontointroducingeXtensible Markup Language,wewillcompareittotherelationalmodel,althoughitisnotcriticaltohavewatchedtherelationalmodelvideosinordertogetsomethingoutofthisone.|ThefullnameofeXtensible Markup Languageistheextensiblemarkuplanguage.|eXtensible Markup Languageisastandardfordatarepresentationandexchange,anditwasdesignedinitiallyforexchanginginformationontheInternet.|Nowdon'tworryifyoucan'treadthelittlesnippetinthecornerofthevideohere.|You'renotexpectedtoatthispoint.|eXtensible Markup LanguagecanbethoughtofasadocumentformatsimilartoHypertext Markup Language,ifyou'refamiliarwithHypertext Markup Language.|Mostpeopleare.|ThebigdifferenceisthatthetagsinanHypertext Markup Languagedocumentdescribethecontentofthedataratherthanhowtoformatthedata,whichiswhatthetagsinHypertext Markup Languagetendtorepresent.|eXtensible Markup Languagealsohasastreamingformatorastreamingstandard,andthat'stypicallyfortheuseofeXtensible Markup Languageinprograms,foradmittingeXtensible Markup LanguageandconsumingeXtensible Markup Language.|Sonowlet'stakealookattheeXtensible Markup Languagedataitself.|YouseeontheleftsideofthevideoaportionofaneXtensible Markup Languagedocument.|Theentiredocumentisavailablefromthewebsiteforthecourse.|eXtensible Markup Languagehasthreebasiccomponents.|Again,fairlysimilartoHypertext Markup Language.|Thefirstistaggedelement.|So,forexamplelet'stakealookatthiselementhere.|Thisisanelementsaying,thatthedatahereisafirstname.|Sowehaveaopeningtagandwehaveamatchingclosingtag.|Wealsohavenestingdevelopment.|Soforexampleherewehaveanelementthat'sauthored.|Wehavetheopeningtaghere,theclosingtaghere,andwehaveanestingofthefirstnameandlastnameelements.|Evenlargerwehaveabookelementherewithopeningandclosingtagswithanestingofnumerouselementsinsideandtheentiredocumentactuallyisoneelementwhoseopeningtagisbookstoreandtheclosingtagisn'tvisibleonthevideohere.|Sothat'swhatelementsconsistof,anopeningtag,textorothersub-elementsandaclosingtag.|Inadditionwehavehaveattributessoeachelementmayhavewithinitsopeningtagandlet'stakealookatthebookelementhere.|Asetofattributesandanattributeconsistsofanattributename,theequalsignandthenanattributevalue.|So,ourbookelementrightherehasthreeattributes.|OnecalledISPN,onecalledPriceandonecalledEdition.|Andanyelementcanhaveanynumberofattributesaslongastheattributenamesareunique.|Andfinally,thethirdcomponentofeXtensible Markup Languageisthetextitselfwhichisdepictedhereinblack.|So,withinelements,wecanhavestrengths.|Wehaveastrengthallrighthere,wehaveatitlehere,herewehavearemark.|Andso,that'sgenerallysortof,thinkofeXtensible Markup Languageasatree,thestringsform,orthetextform,theleafelementofthetree.|So,again,thosearethethreemajorcomponentsofxml.|Look'salotlikeHypertext Markup Language,exceptthetagsaredescribingthecontentofthedata,andnothowtoformatit.|Nowlet'sspendsometimecomparingtherelationalmodelagainsteXtensible Markup Language.|Again,it'snotcritical,thatyoulearnabouttherelationalmodelandyoucanskipthismaterialifyou'renotinterested,butinmanycaseswhendesigninganapplicationthat'sdealingwithdatayoumighthavetomakeadecisionwhetheryouwanttousearelationaldatabaseorwhetheryouwanttostorethedataineXtensible Markup Language.|Solet'slookatafewdifferentaspectsofthedataandhowit'susedandhowitcomparesbetweenrelationalandeXtensible Markup Language.|Let'sstartwiththestructureofthedataitself.|Soaswelearn,thestructureinarelationalmodelisbasicallyasetoftables.|Sowedefinethesetofcolumnsandwehaveasetofrows.|eXtensible Markup Languageisgenerally,againit'susuallyinadocumentorastringformat,butifyouthinkaboutthestructureitself,thestructureishierarchical.|Thenestedelementsinduceahierarchyoratree.|Thereareconstructsthatactuallyallowustohavelinkswithindocumentsandso,youcanalsohaveeXtensible Markup Languagerepresentingagraphthough,ingeneral,it'smostlythoughtofasatreestructure.|Next,let'stalkaboutschemas.|Intherelationalmodeltheschemaisveryimportant.|Youfixyourschemainadvance,whenyoudesignyourdatabase,andthemyouaddthedatatoconformtotheschema.|Now,ineXtensible Markup Language,youhavealotmoreflexibility.|Sotheschemaisflexible.|Infact,alotofpeoplerefertoeXtensible Markup Languageasself-describing.|Inotherwords,theschemaandthedatakindofmixedtogether.|Thetagsonelementsaretellingyouthekindofdatayou'llhave,andyoucanhavealotofirregularity.|NowIwillsaythattheiraremanymechanismsforintroducingschemasintoeXtensible Markup Languagebutthey'renotrequired.|Intherelationalmodelschemasareabsolutelyrequired.|IneXtensible Markup Languagethey'remoreoptional.|Inparticular,let'sgobackandtakealookatourexample,andwe'llseethatwehavesortofsomestructureinourexample,butnoteverythingisperfectlystructured,asitwouldbeinthemodel.|So,comingbackhereandtakingalook,firstofall,wehavethesituationwhereinthisfirstbook,wehaveanattributecallededition,thethirdedition.|Whereasinthesecondbookweonlyhavetwoattributes,sothere'snoadditioninthisbook.|Nowintherelationalmodel,wewouldhavetohaveacolumnforaddition,andwehaveoneforeverybook.|Althoughofcoursewecouldhavenulleditionsforsomebooks.|IneXtensible Markup Language,it'sperfectlyacceptabletohavesomeattributesforsomeelementsandthoseattributesdon'tappearinotherelements.|Here'sanotherexamplewherewehaveacomponentinonebookthat'snotinanotherandit'sthisremarkcomponent.|Soherewehaveabookwherewehappentohavearemarkandincidentally,youcanseethatthisbooksuggests,thisremarksuggeststhatwebuythecompletebooktogetherwiththefirstcourse.|Thefirstcourseisasubset,soit'snotaverygoodsuggestion,althoughAmazonactuallydidmakethatone.|Anyway,enoughoftheasides.|Wedoseethatwehaveremarkforthefirstbookandwehavenoremarkforthesecondbookandthat'snotaproblemwhatsoeverineXtensible Markup Language.|Intherelationalmodel,wewouldagainhavetousenullvaluesforthatcase.|AndthethirdexampleIjustwantedtogiveisthenumberofauthors.|Sothisfirstbookhastwoauthors.|Thesecondbook-youcan'tseethemall,butithasthreeauthors.|NotaproblemineXtensible Markup Language.|Havingdifferentnumbersofthingsisperfectlystandard.|Sothemainpointbeingthatthere'salotofflexibilityineXtensible Markup Languageintermsoftheschema.|Youcancreateyourdatabasewithcertaintypesofelements,lateraddmoreelements,removeelements,introduceinconsistenciesinthestructure,andit'snotaproblem.|Andagain,I'llmentiononemoretimethattherearemechanismsforaddingschema-likeelementstoeXtensible Markup Languageorschema-likespecificationstoeXtensible Markup Language.|Wewillbecoveringthoseinthenexttwovideosactually.|Next,let'stalkabouthowthisdataisqueried.|Sofortherelationalmodel,wehaverelationalalgebra.|WehaveStructured Query Language.|Theseareprettysimple,nicelanguages,Iwouldsay.|It'salittlebinary digitofamatterofopinion,butI'mgoingtogivethemasmileyface.|eXtensible Markup Languagequeryingisalittletrickier.|Now,oneofthefactorshereisthateXtensible Markup LanguageisalotnewerthantherelationalmodelandqueryingeXtensible Markup Languageisstillsettlingdowntosomeextent.|ButI'mjustgonnasay,it'salittleless,soI'mgonnagiveitaneutralfacehere,intermsofhowsimpleandnicethelanguagesareforqueryingeXtensible Markup Languageandwe'llbespendingsometimeinlatervideoslearningsomeofthoselanguages.|Next,inourchartistheaspectofordering.|Sotherelationalmodelisfundamentallyanunorderedmodelandthatcanactuallybeconsideredabadthingtosomeextent.|Sometimesindataapplicationsit'snicetohaveordering.|WelearnedtheorderbyclauseinStructured Query Languageandthat'sawaytogetorderinqueryresults.|Butfundamentally,thedatainourtable,inourrelationshipdatabase,isasetofdata,withoutanorderingwithinthatset.|Now,ineXtensible Markup Languagewedohave,Iwouldsay,animpliedordering.|SoeXtensible Markup Language,asIsaid,canbethoughtofaseitheradocumentmodelorastreammodel.|Andeithercase,justthenatureoftheeXtensible Markup Languagebeinglaidoutinadocumentaswehavehereorbeinginastreaminducesanorder.|Veryspecifically,let'stakealookattheauthorshere.|Soherewehavetwoauthors,andtheseauthorsareinanorderinthedocument.|Ifweputthoseauthorsinarelationaldatabase,therewouldbenoorder.|Theycouldcomeoutineitherorderunlesswedidaorder-byclauseinourquery,whereasineXtensible Markup Language,impliedbythedocumentstructureisanorder.|Andthere'sanorderbetweenthesetwobooksaswell.|Sometimesthatorderismeaningful;sometimesit'snot.|Butitisavailabletobeusedinanapplication.|Lastly,let'stalkaboutimplementation.|AsImentionedinearliervideos,therelationalmodelhasbeenaroundforasleast35years,andthesystemsthatimplementithavebeenaroundalmostaslong.|They'reverymaturesystems.|Theyimplementtherelationalmodelasthenativemodelofthesystemsandthey'rewidelyused.|ThingswitheXtensible Markup Languagearealittlebinary digitdifferent,partlyagainbecauseeXtensible Markup Languagehasn'tbeenaroundaslong.|Butwhat'shappeningrightnowintermsofeXtensible Markup LanguageandconventionaldatabasesystemsiseXtensible Markup Languageistypicallyanadd-on.|Soinmostsystems,eXtensible Markup Languagewillbealayerovertherelationaldatabasesystem.|YoucanenterdataineXtensible Markup Language;youcanquerydataineXtensible Markup Language.|Itwillbetranslatedtoarelationalimplementation.|That'snotnecessarilyabadthing.|AnditdoesallowyoutocombinerelationaldataandeXtensible Markup Languageinasinglesystem,sometimeseveninasinglequery,butit'snotthenativemodelofthesystemitself.|Nowyoumighthavenoticedthatthenameofthisvideois"Well-formed-XML".|Sowell-formedeXtensible Markup LanguageisactuallythemostflexibleeXtensible Markup Language.|AneXtensible Markup LanguagedocumentoraneXtensible Markup LanguagestreamisconsideredwellformedifitadherestothebasicstructuralrequirementsofeXtensible Markup Language.|Andtherearen'tmany.|Justthatwehaveasinglerootelement,aswediscussedbefore,asinglebookstoreinthiscase;thatallofourtagsarematching,wedon'thaveopentagswithoutclosedtags;andourtagsareproperlynested,sowedon'thaveinterweavingofelements.|Andfinally,withineachelementifwehaveattributenames,they'reunique.|Andthat'saboutit.|That'sallwerequireforaeXtensible Markup Languagedocument,orasetofeXtensible Markup Languagedatatobeconsideredwell-formed.|Andformanyapplications,that'sallwe'reconcernedabout.|Inordertotestwhetheradocumentiswell-formed,andspecificallytoaccessthecomponentsofthedocumentinaprogram,wehavewhat'scalledaneXtensible Markup Languageparser.|So,we'lltakeaneXtensible Markup Languagedocumenthere,andwe'llfeedittoaneXtensible Markup Languageparser,andtheparserwillcheckthebasicstructureofthedocument,justtomakesurethateverythingisokay.|Ifthedocumentdoesn'tappeartothesethreerequirementsuphere,theparserwilljustsendanerrorsayingit'snotwell-formed.|Ifthedocumentdoesadheretothestructure,thenwhatcomesoutisparsedeXtensible Markup Language.|And,there'svariousstandardsforhowweshowparsedeXtensible Markup Language.|Oneiscalledthedocumentobjectmodel,orDocument Object Model;it'saprogrammaticinterfaceforsortoftraversingthetreethat'simpliedbyeXtensible Markup Language.|AnotherpopularoneisSimple API for XML.|That'samoreofastreammodelforeXtensible Markup Language.|SothesearethewaysinwhichaprogramwouldaccesstheparsedeXtensible Markup Languagewhenitcomesoutoftheparser.|Sooneissuethatcomesup,becausetheeXtensible Markup Languagedataisusedfrequentlyontheinternet,ishowwedisplayeXtensible Markup Language.|SoonewaytodisplayeXtensible Markup Languageisjustasweseeithere,butveryoftenwewanttoformatthedatathat'sinaneXtensible Markup LanguagedocumentoraneXtensible Markup Languagestringinamoreintuitiveway.|Andactuallythere'sanicesetupfordoingthat.|Whatwecandoisusearule-basedlanguagetotaketheeXtensible Markup LanguageandtranslateitautomaticallytoHypertext Markup Language,whichwecanthenrenderinabrowser.|AcoupleofpopularlanguagesarecascadingstylesheetsknownasCross-Site ScriptingortheextensiblestylesheetlanguageknownaseXtensible Stylesheet Language.|We'regoingtolookalittlebinary digitwitheXtensible Stylesheet LanguageonalatervideointhecontextofqueryineXtensible Markup Language.|Wewon'tbecoveringCross-Site Scriptinginthiscourse.|Butlet'sjustunderstandhowtheselanguagesareused,whatthebasicstructureis.|SotheideaisthatwehaveaneXtensible Markup LanguagedocumentandthenwesendittoaninterpreterofCross-Site ScriptingoreXtensible Stylesheet Language,butwealsohavetohavetherulesthatwe'regoingtouseonthatparticulardocument.|AndtherulesaregoingtodothingslikematchpatternsoraddextracommandsandoncewesendaneXtensible Markup Languagedocumentthorughtheinterpreterwe'llgetanHypertext Markup Languagedocumentoutandthenwecanrenderthatdocumentinthebrowser.|Now,onethingIshouldmentionisthatwe'llalsocheckwiththeparsertomakesurethatthedocumentiswellformedaswellbeforewetranslateittoHypertext Markup Language.|Toconclude,eXtensible Markup Languageisastandardfordatarepresentationandexchange.|Itcanalsobethoughtofasadatamodel.|Sortofacompetitortotherelationalmodelforstructuringthedatainone'sapplication.|Itgenerallyhasalotmoreflexibilitythantherelationalmodel,whichcanbeaplusandaminus,actually.|InthisvideowecoveredthewellformedeXtensible Markup Language,so,eXtensible Markup Languagethatadherestobasicstructuralrequirements,inthenextvideowewillcovervalideXtensible Markup Language,whereweactuallydointroduceakindofschemaforeXtensible Markup Language.|ThelastthingIwanttomention,isthattheformalspecificationforeXtensible Markup Languageisquiteenormous.|Therearealotofbellsandwhistles.|We'regoingtocover,inthesevideos,themostimportantcomponentsforunderstandinganythingeXtensible Markup Language.|Inthepreviousvideo,welearnedthebasicsofeXtensible Markup Language.|Inthisvideo,we'regoingtolearnaboutDocumentTypeDescriptors,alsoknownasDTDs,andalsoIDandIDrefattributes.|Welearnedthatwell-formedeXtensible Markup LanguageiseXtensible Markup Languagethatadherestobasicstructuralrequirements:asinglerootelement,matchedtagswithpropernesting,anduniqueattributeswithineachelement.|Nowwe'regoingtolearnaboutwhat'sknownasvalideXtensible Markup Language.|ValideXtensible Markup Languagehastoadheretothesamebasicstructuralrequirementsaswell-formedeXtensible Markup Language,butitalsoadherestocontentspecificspecifications.|Andwe'regoingtolearntwolanguagesforthosespecifications.|OneofthemisDocumentTypeDescriptorsorDTDs,andtheother,amorepowerfullanguage,iseXtensible Markup Languageschema.|SpecificationsineXtensible Markup LanguageschemaareknownasXSDs,foreXtensible Markup LanguageSchemaDescriptions.|Soasareminder,here'showthingsworkedwithwell-formedeXtensible Markup Languagedocuments.|Wesentthedocumenttoaparserandtheparserwouldeitherreturnthatthedocumentwasnotwell-formedoritwouldreturnparsedeXtensible Markup Language.|Nowlet'sconsiderwhathappenswithvalideXtensible Markup Language.|NowweuseavalidatingeXtensible Markup Languageparser,andwehaveanadditionalinputtotheprocess,whichisaspecification,eitheraDocument Type DefinitionoranXML Schema Definition.|Sothat'salsofedtotheparser,alongwiththedocument.|Theparsercanagainsaythedocumentisnotwellformedifitdoesn'tmeetthebasicstructuralrequirements.|Itcouldalsosaythatthedocumentisnotvalid,meaningthestructureofthedocumentdoesn'tmatchthecontentspecificspecification.|Ifeverythingisgood,thenonceagain"parsedeXtensible Markup Language"isreturned.|Nowlet'stalkaboutthedocument-typedescriptors,orDTDs.|WeseeaDocument Type Definitioninthelower-leftcornerofthevideo,butwewon'tlookatitinanydetail,becausewe'llbedoingdemosofDTDsalittlelateron.|ADocument Type Definitionisalanguagethat'skindoflikeagrammar,andwhatyoucanspecifyinthatlanguageisforaparticulardocumentwhatelementsyouwantthatdocumenttocontain,thetagsoftheelements,whatattributescanbeintheelements,howthedifferenttypesofelementscanbenested.|Sometimestheorderingoftheelementsmightwanttobespecified,andsometimesthenumberofoccurrencesofdifferentelements.|DTDsalsoallowtheintroductionofspecialtypesofattributes,calledidandidrefs.|And,effectively,whattheseallowyoutodoisspecifypointerswithinadocument,althoughthesepointersareuntyped.|Beforemovingtothedemo,let'stalkalittlebinary digitaboutthepositivesandnegativesaboutchoosingtouseaDocument Type DefinitionorandXML Schema Definitionforone'seXtensible Markup Languagedata.|Afterall,ifyou'rebuildinganapplicationthatencodesitsdataineXtensible Markup Language,you'llhavetodecidewhetheryouwanttheeXtensible Markup LanguagetojustbewellformedorwhetheryouwanttohavespecificationsandrequiretheeXtensible Markup Languagetobevalidtosatisfythosespecifications.|So,let'sputafewpositivesofchoosingalaterofrequiringaDocument Type DefinitionoranXML Schema Definition.|Firstofall,oneofthemisthatwhenyouwriteyourprogram,youcanassumethatthedataadherestoaspecificstructure.|Soprogramscanassumeastructureandsotheprogramsthemselvesaresimplerbecausetheydon'thavetobedoingalotoferrorcheckingonthedata.|They'llknowthatbeforethedatareachestheprogram,it'sbeenrunthroughavalidatoranditdoessatisfyaparticularstructure.|Secondofall,wetalkedatsometimeagoaboutthecascadingstylesheetlanguageandtheextensiblestylesheetlanguages.|ThesearelanguagesthattakeeXtensible Markup Languageandtheyrunrulesonittoprocessitintoadifferentform,oftenHypertext Markup Language.|Whenyouwritethoserules,ifyounotethatthedatahasacertainstructure,thenthoserulescanbesimpler,soliketheprogramstheyalsocanassumeparticularstructureanditmakesthemsimpler.|Now,anotheruseforDTDsorXSDsisasaspecificationlanguageforconveyingwhateXtensible Markup Languagemightneedtolooklike.|So,asanexampleifyou'reperformingdataexchangeusingeXtensible Markup Language,maybeacompanyisgoingtoreceivepurchaseordersineXtensible Markup Language,thecompanycanactuallyusetheDocument Type DefinitionasaspecificationforwhattheeXtensible Markup Languageneedstolooklikewhenitarrivesattheprogramit'sgoingtooperateonit.|Alsodocumentation,itcanbeusefultouseoneofthespecificationstojustdocumentwhatthedataitselflookslike.|Ingeneral,reallywhatwehavehereisthebenefitsoftyping.|We'retalkingaboutstronglytypeddataversusloosely-typeddata,ifyouwanttothinkofitthatway.|Nowlet'slookatwhenwemightprefernottouseaDocument Type Definition.|SowhatI'mgoingdescribedownhereisthebenefitsofnotusingaDocument Type Definition.|Sothebiggestbenefitisflexibility.|SoaDocument Type DefinitionmakesyoureXtensible Markup Languagedatahavetoconformtoaspecification.|Ifyouwantmoreflexibilityoryouwanteaseofchangeinthewaythatthedataisformattedwithoutrunningintoalotoferrors,then,ifthat'swhatyouwant,thentheDocument Type Definitioncanbeconstraining.|AnotherfactisthatDTDscanbefairlymessyandthisisnotgoingtobeobvioustoyouyetuntilwegetintothedemo,butifthedataisirregular,veryirregular,thenspecifyingitsstructurecanbehard,especiallyforirregulardocuments.|Actually,whenweseetheschemalanguage,we'lldiscoverthatXSDscanbe,Iwouldsay,reallymessy,sotheycanactuallygetverylarge.|It'spossibletohaveadocumentwherethespecificationofthestructureofthedocumentismuch,muchlargerthanthedocumentitself,whichseemsnotentirelyintuitive,butwhenwegettolearnaboutXSDs,Ithinkyou'llseehowthatcanhappen.|So,overall,thisisthebenefitsofniltyping.|It'sreallyquitesimilartotheanalogyinprogramminglanguages.|TheremainderofthisvideowillteachabouttheDTDsthemselvesthroughasetofexamples.|We'llhaveaseparatevideoforlearningabouteXtensible Markup LanguageschemaandXSDs.|So,herewearewithourfirstdocumentthatwe'regoingtolookatwithadocumenttypedescriptor.|Wehaveontheleftthedocumentitself.|Wehaveontherightthedocument-typedescriptor,andthenwehaveinthelowerrightacommandlineshellthatwe'regoingtousetovalidatethedocument.|Sothisissimilardatatowhatwesawonthelastvideo,butlet'sgothroughitjusttoseewhatwehave.|Wehaveanoutermostelementcalledbookstore,andwehavetwobooksinourbookstore.|ThefirstbookhasanISBNnumber,priceandeditions.|Asattributesandthenithasasub-elementcalledtitle,anothersub-elementcalledauthorswithtwoauthorsunderneath;firstnamesandlastnames.|Thesecondbookelementissimilar,exceptitdoesn'thaveaedition.|Italsohas,aswesee,aremark.|Nowlet'stakealookattheDocument Type DefinitionandI'mjustgoingtowalkthroughDocument Type Definition,nottooslowly,nottoofast,andexplainexactlywhatit'sdoing.|SothestartoftheDocument Type DefinitionsaysthisaDocument Type Definitionnamedbookstoreandtherootelementiscalledbookstore,andnowwehavethefirstgrammar-likeconstruct.|Sotheseconstructs,infact,arealittlebinary digitlikeregularexpressionsifyouknowthem.|Whatthissaysisthatabookstoreelementhasasitssub-elementanynumberofelementsthatarecalledbookormagazine.|Wehavebookormagazine.|Wedon'thaveanymagazinesyetbutwe'lladdone.|Andthenthisstarsays,zeroormoreinstances.|It'stheKleeneforthoseofyoufamiliarwithregularexpression.|Nowlet'stalkaboutwhatthebookelementhas,sothat'sournextspecification.|Thebookelementhasatitlefollowedbyauthors,followedbyanoptionalremark.|Sonowwedon'thavean"or",wehaveacomma,andthatsaysthatthesearegoingtobeinthatorder-title,authors,andremarkandthequestionmarksaysthattheremarkisoptional.|Nextwehavetheattributesofourbookelements.|Sothisbangattributelistsayswe'regoingtodescribetheattributesandwe'regoingtohavethreeofthem:theISBN,theprice,andtheedition.|Cdataisthetypeoftheattribute.|It'sjustastring.|Andthenrequiredsaysthattheattributemustbepresent,whereasimpliedsaysitdoesn'thavetobepresent.|Asyoumayremember,wehaveonebookthatdoesn'thaveanedition.|Ourmagazinesaresimplygoingtohavetitlesandthey'regoingtohaveattributesthataremonthandyear.|Again,wedon'thaveanymagazinesyet.|Atitleisgoingtoconsistofstringdata.|Sohereweseeourtitleoffirstcourseanddatabasesystem.|YoucanthinkofthatastheleafdataintheeXtensible Markup Languagetree.|Andwhenyouhavealeafthatconsistsoftextdata,thisiswhatyouputintheDocument Type Definition-justtakemywordforit:hashPersonal Computerdatainparentheses.|Nowourauthorsareanelementthatstillhasstructure.|Ourauthorshaveasub-element,authorsub-elementsorelements,andwe'regoingtospecifyherethattheauthor'selementmusthaveoneormoreauthorsubelements.|Sothat'swhattheplusissayinghere,againtakenfromregularexpressions.|"Plus"meansoneormoreinstances.|Wehavetheremark,whichisjustgoingtobepcdataorstringdata.|Wehaveourauthorswhichconsistofafirstnamesub-elementandalast-namesub-element,andinthatorder.|Andthenfinally,ourfirstnamesandlastnamesarealsostrengths.|So,thisistheentireDocument Type Definitionanditdescribesindetailthestructureofourdocument.|Nowwehaveacommand,we'reusingsomethingcalledxmllint,thatwillchecktoseeifthedocumentmeetsthestructure.|We'lljustrunthatcommandherewithacoupleofoptions,anditdoesn'tgiveusanyoutputwhichactuallymeansthatourdocumentiscorrect.|Wellbemakingsomeeditsandseeingwhenourdocumentisnotcorrectwhathappenswhenwerunthecommand.|Solet'smakeourfirstedit,let'ssaythatwedecidethatwewanttheadditionalattributeofourbookstobe"required"ratherthan"applied".|Sowe'llchangetheDocument Type Definition.|We'llsavethefileandnowwhenwerunourcommand.|Soasexpectedwegotanerror,andtheerrorsaidthatoneofourbookelementsdoesnothaveattributeaddition.|Nowthatadditionisrequired,everybookelementoughttohaveit.|Solet'saddanadditiontooursecondbook.|Let'ssaythatit'sthesecondedition,savethefile,we'llvalidateourdocumentagain,andnoweverythingisgood.|Let'sdoanedittothedocumentthistimetoseewhathappenswhenwechangetheorderofthefirstnameandthelastname.|Sowe'veswappedJeffreyUllmantobeUllmanJeffery.|Wevalidateourdocument,andnowweseewegotanerrorbecausetheelementsarenotinthecorrectorder.|Inthiscase,let'sundothatchange,ratherthanchangeourDocument Type Definition.|Let'stryanotheredittoourdocument.|Let'saddaremarktoourfirstbook.|Butwhatwe'lldoiswe'llleavetheremarkempty,sowe'lladdaopeningandthendirectlyaclosingtag,andlet'sseeifthatvalidates.|So,itdidvalidate.|AndinfactwhenwehavePersonal Computerdataasthetypeofanelementit'sperfectlyacceptabletohaveaemptyelement.|Asafinalchange,let'saddamagazinetoourdatabase.|You'llhavetobearwithmeasItype.|I'malwaysalittlebinary digitslow.|Soweseeoverherethatwhenwehaveamagazinetherearetworequiredattributes,themonthandtheyear.|So,let'ssaythemonthisJanuaryandtheyear,let'smakethat2011,andthenwehaveatitleforourmagazine.|Here.|We'llgodownhere.|Ourtitle,let'smakeitNationalGeographic.|We'llclosethetag,titletag.|Andthen,sorryagainaboutmytyping.|Let'sgoaheadandvalidatethedocument.|wesawprematureendofsomethingorother.|Weforgotourclosingtagformagazine,let'sputthatin.|Myterribletyping,andherewego.|Let'svalidate,andwe'redone.|Nowwe'regonnalearnaboutandidrepattributes.|Thedocumentontheleftsidecontainsthesamedataasourpreviousdocumentbutcompletelyrestructured.|Insteadofhavingauthorsassubelementsofbookelements,we'regoingtohaveourauthorslistedseparately,andtheneffectivelypointfromthebookstotheauthorsofthebook.|We'lltakealookatthedatafirst,andthenwe'lllookattheDocument Type Definitionthatdescribesthedata.|Let'sactuallystartwiththeauthor,soourbookstoreelementherehastwosubelementsthatarebooksandthreethatareauthors.|So,lookingattheauthors,wehavethefirstnameandlastnameassub-elementsasusual,butwe'veaddedwhatwecalltheidentattribute.|That'snotakeyword;we'vejustcalledtheattributeident,andthenforeachofthethreeauthors,we'vegivenastringvaluetothatattributethatwe'regoingtouseeffectivelyforthepointersinthebook.|Sowehaveourthreeauthors,nowlet'stakealookatthebooks.|OurbookhastheISBNnumberandprice.|I'vetakentheadditionoutfornow.|specialattributecalledauthors.|AuthorsisanIDrepsattribute,andit'svaluecanrefertooneormorestringsthatareIDattributes.|attributesinanotherelement.|Sothat'swhatwe'redoinghere.|We'rereferringtothetwoauthorelementshere.|Andinoursecondbookwe'rereferringtothethreeauthorelements.|Westillhavethetitlesubelementandwestillhavetheremarkssubelement.|Andfurthermore,wehaveoneothercutethinghere,whichis,insteadofreferringtothebookbynamewithintheremarkwhenwe'retalkingabouttheotherbook,wehaveanothertypeofpointer.|Sowe'llspecifythattheISBNisanIDforbooksandthenthisisanidrepsattributethat'sreferringtotheidoftheotherbook.|TheDocument Type Definitionontherightthatdescribesthestructureofthisdocument.|Thistimeourbookstoreisgoingtocontainzeroormorebooksfollowedbyzeroormoreauthors.|Ourbookscontainatitleandanoptionalremarkissubelementsandnowtheycontainthreeattributes,theIDBNwhichisnowaspecialtypeofattributecalledandID,theprice,whichisthestringvalueasusualandtheauthorswhichisthespecialtypecalledidreps.Let'skeepgoing,ourtitleisjuststringValueasusual.|Aremark,herethisisaactuallyinterestingconstruct.|AremarkconsistofthePersonal Computerdatawhichisstring,orabookreferenceandthenzeromoreinstancesofthose.|Thisisthetypeofconstructthatcanbeusedtomixstringsandsubelementswithinanelement.|Soanytimeyouwantanelementthatmighthavesomestringsandthenanotherelementandthenmorestringvalue.|That'showit'sdone.|Personal Computerdataortheelementtypezeroormore.|Thenwehaveourbookreferencewhichisactuallyanemptyelementit'sonlyinterestingbecauseishasanattributesolet'sgobackhereweseeourbookwraphereitactuallydoesn'thaveanydataorsubelements,butithasanattributecalledbookandthatisanIDref.|ThatmeansitreferstoanIDattributeofanother,anotherelement.|NowwehaveourauthorsthefirstnameandthelastnameandourauthorattributeshaveagainanIDandwe'recallingittheident.|Andfinallythefirstnameandlastnamearestringvalues.|ThismayseemoverwhelmingbutthekeypointsinthisDocument Type DefinitionaretheIDtheattributes.|SotheIDattributes,theISBNattributesinthebook,andtheident,whereveritwent,identattributeintheauthorarespecialattributes,andbytheway,theydoneedtobeuniquevaluesforthoseattributes,andthey'respecialinthatIDrefsattributescanrefertothem,andthatwillbecheckedaswell.|Now,IdidwanttopointoutthatthebookreferenceheresaysIDrefsingular.|WhenyouhaveasingularIDrefthenthestringhastobeexactlyoneIDvalue.|WhenyouhavethepluralIDrefs.|ThenthestringoftheattributeisoneormoreIDrefvalue,I'msorryoneormoreIDvaluesseparatedbyspaces.|Soit'salittlebinary digitclunky,butitdoesseemtowork.|Nowlet'sgotoourcommandline,andlet'svalidatethedocument.|Sothedocumentisinfactvalid.|That'swhatitmeanswhenwegetnothingback,andlet'smakesomechanges,aswedidbefore,toexplorewhatstructureisimposedandwhat'scheckedwiththisDocument Type Definitioninthepresence.|IDsandIDrefs.|Asafirstchange,let'schangethisID,thisidentifierHGtoJU.|Thatshouldactuallycauseacoupleofproblemswhenwedothatlet'svalidatethedocumentandseewhathappens.|Andwedoinfactgettwodifferenterrors.|Thefirsterrorsaysthatwehavetwoinstancesof"JU".|Asyoucanseehere,wenowhaveJUtwicewhereIDvaluesdohavetobeunique.|Theyhavetobegloballyuniquethroughoutthedocument.|TheseconderrorthatoccurredwhenwechangedHGtoJUisweeffectivelyhaveadanglingpointer.|WerefertoHGhereinthisIDrefsattributebutthere'snolongeranelementwhosevalueisHG.|Sothat'sanerroraswell.|Solet'schangeitbacktoHGjustsoourdocumentisvalidagain.|Nowlet'smakeanotherchange,let'stakeourbookreference.|Wecanseethatourbookreferenceisreferringtotheotherbook.|We'reinthecompletebookhereandthecomment,theremarkisreferringtothefirstcoursethroughtheISBNnumber,butlet'schangethisstringinsteadtorefertoHG.|Sonowwe'reactuallyreferringtoanauthorratherthananotherbook.|Let'scheckifthedocumentvalidates.|Infactitdoes.|AndthatshowsthatthepointerswhenyouhaveaDocument Type Definitionareuntyped.|Soitdoeschecktomakesurethatthisisanidofanotherelement,butweweren'tabletospecifythatitshouldbeabookelementinourDocument Type Definition,andsincewe'renotabletospecifyit,ofcourseit'snotpossibletocheckit.|WewillseethatineXtensible Markup Languageschema,wecanhavetypedpointersbutit'snotpossibletohavetheminDTDs.|ThelastchangeI'mgoingtoshowistoaddasecondbookreferencewithinourremark.|SoasIpointedoutoverhere,whenwewritePersonal ComputerdataorinanelementtypeKleene,thezeroormorestar,thatmeanswecanfreelymixtextandsub-elements.|Sojustrightinthemiddlehere,let'sputabookreference.|andwecanput,let'ssaybookequalsJU,andthatwillbetheendofourreferencethereandnowweseethatwehavetextfollowedbyasubelementfollowedbymoretextthensoon.|Thatshouldvalidatefine,andinfactitdoes.|ThatcompletesourdemonstrationofeXtensible Markup LanguagedocumentswithDTDs.|Inthisvideowe'llbelearningabouteXtensible Markup Languageschema.|Likedocumenttypedescriptors,eXtensible Markup LanguageschemaallowsusawaytogivecontentspecificspecificationsforoureXtensible Markup Languagedata.|Asyoumayremember,wesendtoavalidatingeXtensible Markup LanguageparseroreXtensible Markup Languagedocumentaswellasadescription.|WetalkedaboutDTDsinthelastvideo.|We'lltalkaboutXSDsinthisone.|ThevalidatingeXtensible Markup Languageparserwillcheckthatthedocumentiswellformed,anditwillalsocheckthatitmatchesit'sspecification.|Ifitdoes,eXtensible Markup Languagecomesout.|Ifitdoesn'twegetanerrorthatthedocumentisnotvalid.|eXtensible Markup Languageschemaisanextensivelanguage,verypowerful.|LikedocumenttypedescriptorswecanspecifytheelementswewantinoureXtensible Markup Languagedata,theattributes,thenestingoftheelements,howelementsneedtobeordered,andandnumberofoccurrencesofelements.|Inadditionwecanspecifydatatypeswecanspecifykeys,thepointersthatwecanspecifyarenowtypedlikeinDTDsandmuch,muchmore.|Now,onedifferencebetweeneXtensible Markup LanguageschemaandDTDsisthatthespecificationlocationsineXtensible Markup LanguageschemascalledXSD'sareactuallywritteninthexmllanguageitself.|ThatcanbeusefulforexampleifwehaveabrowserthatnicelyrenderstheeXtensible Markup Language.|ThelanguagesIsaidisvast.|Inthisvideo,we'regoingtoshowonesortofquoteeasyexample.|ButthatexamplewillgiveverymuchtheflavorofeXtensible Markup Languageschema.|Andwe'lltrytohighlightthedifferencesbetweeneXtensible Markup Languageschemaandusingdocumenttypedescriptors.|Ok,herewerearewithoureXtensible Markup Languagedocumentontheleft.|OntherightwehaveoureXtensible Markup LanguageschemadescriptororXML Schema Definitionandwehavealittlecommandlinethatwe'regonnauseforourvalidationcommand.|Nowletmejustsayupfrontthatwe'renotgoingtobegoingthroughtheXML Schema DefinitionlinebylineindetailthewaywedidwithDTDs.|Asyoucanseeit'sratherlongandthatwouldtakeusfartoolongandberatherboring.|SowhatIhighlysuggestisthatyoudownloadthefilefortheXML Schema DefinitionsoyoucanlookatityourselfandlookattheentirefileaswellastheeXtensible Markup Languageandgiveitatrywithvalidating.|WhatI'mgonnadointhisdemoprimarilyisfocusonthoseaspectsoftheXML Schema Definitionthataredifferent,aremorepowerfulthanwehadindocumenttypedescriptors.|First,let'stakealookatthedataitself.|Sowehaveourbookstoredataasusualwithtwobooksandthreeauthors.|Itsslightlyrestructuredfromanyoftheversionswe'veusedbefore.|Itlooksclosesttothelastoneweusedbecausethebooksandauthorsareseparateandtheauthorsareactuallyexactlythesame.|Thehaveanidentifierandafirstname-lastnamesubelement.|Buttheprimarydifferenceisinthebooks,insteadofusingIDrefsattributestoreferfrombookstoauthors,westill,wenowbackourbackhavinganauthor'ssub-elementwiththetwoauthorsunderneathandthenthoseauthorsthemselveshavewhatareeffectivelythepointerstotheidentifiersfortheauthors.|Andwe'llseehowthat'sgoingtomeshwiththeeXtensible Markup Languageschemadescriptorthatwe'reusingforthisfile.|So,theotherthingIwanttomentionisthatrightnowwehavetheeXtensible Markup LanguageschemadescriptorinonefileandtheeXtensible Markup Languageinanother.|YoumightrememberfortheDocument Type Definition,wesimplyplacedtheDTDsspecificationatthetopofthefilewiththeeXtensible Markup Language.|ForDTDsyoucandoiteitherwayinthesamefileorinaseparatefile.|ForXSDs,wealwaysputthoseinaseparatefile.|AlsonoticethattheXML Schema DefinitionitselfisineXtensible Markup Language.|Itisusingspecialtags.|ThesearetagsthatarepartoftheXML Schema Definitionlanguage,butwearestillexpressingitineXtensible Markup Language.|SowehavetwoeXtensible Markup Languagefiles,thedatafileandtheschemafile.|Tovalidatethedatafileagainsttheschemafile,wecanuseagaintheeXtensible Markup Languagelinkfeature.|Wespecifytheschemafile,thedatafileandwhenweexecutethecommandwecanseethatthefilevalidatescorrectly.|SoI'mnowgoingtohighlightfourfeaturesofeXtensible Markup Languageschemathataren'tpresentinDTD's.|Oneofthemistypedvalues.|Oneofthemiskeydeclarations.|SimilartoIDsbutalittlebinary digitmorepowerful.|OneisreferenceswhichareagainsimilartopointersButalittlemorepowerfulandfinallyacurrentsconstraints.|Solet'sstartwithtights.|InourdataweseethatthepriceattributeisdenotedwithastringandwhenwehadDTDs,allattributevalueswereinfactstringed.|Inexcessfeeswecansaythatwewanttocheckthatthevalueswhicharestilllooklikestringsactuallyconfirmtospecifictypes.|Forexamplewecansaythatthepricemustbeininteger.|AgainI'mnotgoingtobelaborthesyntacticdetailsbutratherI'mjustgoingtohighlighttheplacesintheXML Schema Definitionwherewe'redeclaringthingsofinterest.|Sospecificallyhere'swherewedeclaretheattributepriceandwesaythatthetypeofpricemustbeaninteger.|Soourdocumentvalidatedcorrectly,whatifwechangethisonehundredtobefooinstead.|OfcoursewithaDocument Type Definitionthiswouldbefinebecauseallattributesaretreatedasstrings.|Butifwetrytovalidatenowweseeanerror,specificallyfooisnotavalueofthecorrecttype.|Solet'schangethatfoobacktoahundredsothatwevalidatecorrectly.|Next,let'stalkaboutkeys.|InDTD's,wewereabletospecifyID's.|ID'sweregloballyuniquevaluesthatcouldbeusedtoidentifyspecificelements.|Forexample,whenwewantedtopointtothoseelementsusingIDrefs.|Keysarealittlebinary digitmorepowerfulormorespecificIshouldsay.|Ifyouthinkabouttherelationalmodelakeyintherelationalmodelisanattributeorsetofattributesthatmustbeuniqueforeachtupleinatable.|So,wedon'thavetablesortuplesrightnowbut,wedohaveelementsandweoftenhaverepeatedelements.|Sosimilarlywecanspecifythataparticularattributeorcomponentmustbeuniquewithineveryelementofthesametype.|Andwehavetwokeysinourspecification,onekeywhichwecanseehereforbooksandoneforauthors.|SpecificallywesayforbooksthattheISBNattributemustbeakey.|Andwesayforauthorsthattheidentattributemustbeakey.|Solet'sgoovertoourdataandlet'sstartbylookingattheauthors.|Soifwechange,forexample,UtoHGthenweshouldgetakeyviolationbecausewe'llhavetwoauthorsthathavethesameidentattribute.|Let'strytovalidate.|Infact,wedocorrectlygetakeyvalidationwealsogetacoupleofothererrorsandthosehavetodowiththefactthatweareusingtheseitemsasthedestinationofwhatareaffectdoublypointersorreferences.|Solet'schangethatbacktoJU,makesureeverythingnowvalidatesfine,anditdoes.|Nowletsmakeanotherchange.|SowehavetheidentkeyhereandwehavetheISBNnumber,beingthenumberforbooks,whatifchangedtheISBNnumbertooneofthevaluesweusedasakeyfortheauthor,say2HG.|WhenwedidsomethingsimilarwithDTDswegotanerrorbecauseinDTDs,IDshavebegloballyunique.|Hereweshouldnotgetanerror.|HGshouldbeaperfectlyreasonablekeyforbooksbecausewedon'thaveanothervaluethat'sthesame.|Andinfactitdoesvalidate.|Nowlet'sundothatchange.|Next,let'stalkaboutreferences.|So,referencesallowustohavewhatarePossiblytypedpointers,usingthedtd.|So,theyarecalledkeyrefs,andherewehaveanexample-letmejustchangethistothemiddleofthedocument.|So,oneofthereferencetypesthatwe'vedefinedinourDocument Type Definitionisapointertoauthorsthatwe'reusinginourbooks.|Specifically,wewanttospecifythatthisattributehere,theauthident,hasavaluethatisakeyfortheauthorelements.|Andwewanttomakesureit'sauthorelementsthatitspointingtoandnotothertypesofelements.|NowthesyntaxfordoingthisineXtensible Markup Languageschemaisratherdetailed.|Itsalrighthereandjusttogiveyouaflavor,thismiddleselectorhereisactuallyusingtheXPathlanguagewhichwe'llbeusing,whichwe'llbelearninglaterbutwhatitsaysisthatwhenwenavigateinthedocumentdowntooneoftheseauthelements.|Withinthatauthelement,theauthidentattributeisareferencetowhatwehavealreadydefinedasauthorkeys.|We'vedonesomethingsimilarwithbooks.|Wehaveourbook/remark/bookrefthatbringsusdowntothiselementhere.|Andtherewespecifiedthatthebookattributemustbeareferencetoabookkey,andthebookkeywasearlierdefinedtobetheISBNnumber.|Again,Iknowthisisallcomplicated,andthesyntaxisveryclunky,soIurgeyoutodownloadthespecificationandspendtimelookingatitonyourown.|Nowlet'smakeacoupleofchangestoourdocumenttodemonstratehowthecheckingofthesetypedpointersworks.|Forexampleletschangeourfirstreferenceheretofood.|Let'svalidatethedocumentandweshouldgetanerrorandindeedwedo,theauthorkeyrepisincorrect.|NowletschangethatFUtoJW,sooriginallyitwasJUButnowwe'regoingtohavetwoauthors,bothofwhomrefertoJW.|Nowthisshouldnotbeaproblem.|It'ssimplytwopointerstothesameauthor,andwedidnotprohibitthatinourXMLsschemaspecificationandindeedourdocumentvalidates.|We'llchangethatoneback.|Andthelast,asalastchange,we'llchangeourbookreferenceheretorefertoJW.|Thisshouldnotvalidatebecausethistime,unlikewithDTDs,we're,we'veactuallyspecifiedtypedpointers.|Inotherwords,we'vespecifiedthatthispointerorthisreferencemustbetoabookelementandnottoanauthorelement.|Sowe'llvalidateandindeeditfails.|I'veundonethatchangeandnowlet'smovetothelastfeaturethatwe'regonnalookatinthisdemonstrationwhichisacurrentsconstraint.|Soin,letmejustbringupthefirstinstanceofit,ineXtensible Markup Languageschema,wecanspecifyhowmanytimesanelementtypeisallowedtooccur.|Specificallywecanspecifytheminimumnumberofoccurrencesandthemaximumnumberofoccurrences.|Asadefaultifwedon'tspecifyforanelementtheminOccursormaxiOccursthedefaultforbothofthemisone.|Sohereforbookswe'vesaidthatwecanhavezeroBooksandwecanhaveanynumber.|Sothisisthemaximumflexibility,anynumberofelements.|Forauthorswe'vealsosaidwecanhaveanynumberofauthorsthat'sintheactualdatabaseitself.|Rememberthatourbookstoreconsistsofasetofbooksandasetofauthors.|Butwearegoingtospecifysomethingalittledifferentforhowmanyauthorswehavewithinaspecificbook.|Solet'scontinuetolookatothercaseswherewe'vespecifiedoccurrenceconstraints.|Hereisthecasewherewe'respecifyinghowmanyauthorswehavewithinabookandagainfewboythisisalotofeXtensible Markup Languageheresotakeyourtimewhenlookingatit;orfornowjusttakemywordforit.|Whatwe'respecifyinghereishowmanysubelements,howmanyauthsubelementswehavewithineachauthor'selement.|AndherewehavenominOccursspecificationonlyamaxOccurs.|ThatmeansbydefaultminOccursisone.|Sowhatthisissayingspecifically,isthateverybookhasinit'sauthorssubelement,atleastoneoff,butwecanhave.|anynumberofthem,that'sthestringunbounded.|Lookingattheremainingoccurrenceconstraints,forremarks,wehavetheminimumnumberofoccurrencesiszero.|Inotherwords,wedon'thavetohavearemark.|Andwehaven'tspecifiedmaxoccurssothedefaultmaxoccursisone.|Sowhatwe'resayinghereisthateverybookmayhaveeithernoremarkorexactlyoneremarkbutitmaynothavemorethanthat.|Andthere'safewmoreoccurrenceconstraintsthatyoucantakealookatagainasyoubrowsetheeXtensible Markup Languageschemadescriptiononyourown.|Nowlet'smakesomechangesinthedocumenttotesttheseoccurrenceconstraints.|Sofirstlet'sremovetheauthorsfromourfirstbook.|Wewon'tremovethewholeauthorsubelementbutjustthetwooffsubelementsofauthors.|Weattempttovalidateandweseethatitdoesn'tvalidate.|We'remissingsomechildelements,specificallytheoff-childelementsbecauseweexpectedtheretobeatleastoneofthem.|Incidentally,ifwetooktheentireauthorsub-elementout,we'llalsogetanerrorsincewe'vespecifiedthebooksmusthaveauthorsubelement.|Sonowwe'remissingtheentireauthorstructureinthatbookandagainwedon'tvalidate.|Let'sputauthorsback;andnowlet'slookattheremarkoccurrenceconstraintsowesaidthateverybookcanhavezerooroneremarks,solet'sjustaddanotherremarktothisbook.|Oh,hi,actuallyremarksareallowedtobeempty.|Inanycase,wehaveaddedasmallremark.|Wevalidateandweseethatwehavetoomanyremarksagainbecausewespecifiedthateverybookcanhaveatmostoneremark.|SothatconcludesourdemonstrationofeXtensible Markup Languageschemaagain,it'sbeenrathercursorywe'veonlycoveredafewoftheconstructsbutIdidfocusontheconstructsthatwehaveineXtensible Markup LanguageschemathatarenotspecifiableinDTDs.|FinallyonemoretimeIurgeyoudownloadtheaccessfeeandthedocumentandplayaroundwithityourself|ThisvideointroducesJavaScript Object Notation.|Let'sstartbytalkingaboutitspronunciation.|SomepeoplecallitJason,andsomecallitJ-sahn.|I'lldoalittlebinary digitofinvestigationanddiscoveredthattheoriginaldeveloperofJavaScript Object NotationcallsitJavaScript Object Notationso,I'lldothattoo.|LikeeXtensible Markup Language,JavaScript Object Notationcanbethoughtofasadatamodel.|Analternativetotherelationaldatamodelthatismoreappropriateforsemi-structureddata.|InthisvideoI'llintroducethebasicsofJavaScript Object NotationandI'llactuallycompareJavaScript Object NotationtotherelationaldatamodelandI'llcompareittoeXtensible Markup Language.|Butit'snotcrucialtohavewatchedthosevideostogetsomethingoutofthisone.|Nowamongthethreemodels-therelationalmodel,eXtensible Markup Language,andJavaScript Object Notation-JavaScript Object Notationisbyalargemarginthenewest,anditdoesshowtherearen'tasmanytoolsforJavaScript Object NotationaswehaveforeXtensible Markup Languageandcertainlynotaswehaveforrelational.|JavaScript Object NotationstandsforJavascriptobjectnotation.|Althoughit'sevolvedtobecomeprettymuchindependentofJavascriptatthispoint.|ThelittlesnippetofJavaScript Object Notationinthecornerrightnowmostlyfordecoration.|We'lltalkaboutthedetailsinjustaminute.|NowJavaScript Object Notationwasdesignedoriginallyforwhat'scalledserializingdataobjects.|Thatistakingtheobjectsthatareinaprogramandsortofwritingthemdowninaserialfashion,typicallyinfiles.|onethingaboutJavaScript Object Notationisthatitishumanreadable,similartothewayxmlishumanreadableandisoftenusefordatainterchange.|So,forwritingout,saytheobjectsprogramsothattheycanbeexchangedwithanotherprogramandreadintothatone.|Also,justmoregenerally,becauseJavaScript Object Notationisnotasrigidastherelationalmodel,it'sgenerallyusefulforrepresentingandforstoringdatathatdoesn'thaverigidstructurethatwe'vebeencallingsemi-structureddata.|AsImentionedJavaScript Object NotationisnolongercloselytiedtoManydifferentprogramminglanguagesdohaveparsersforreadingJavaScript Object NotationdataintotheprogramandforwritingoutJavaScript Object Notationdataaswell.|Now,let'stalkaboutthebasicconstructsinJavaScript Object Notation,andaswewillseethisconstructsarerecursivelydefined.|We'llusetheexampleJavaScript Object Notationdatashownonthescreenandthatdataisalsoavailableinafilefordownloadfromthewebsite.|ThebasicatomicvaluesinJavaScript Object Notationarefairlytypical.|Wehavenumbers,wehavestrings.|WealsohaveBooleanValuesalthoughtherearenoneofthoseinthisexample,that'strueandfalse,andnovalues.|TherearetwotypesofcompositevaluesinJavaScript Object Notation:objectsandarrays.|Objectsareenclosedincurlybracesandtheyconsistofsetsoflabel-valuepairs.|Forexample,wehaveanobjectherethathasafirstnameandalastname.|Wehaveamore-bigger,let'ssay,objectherethathasISBN,price,edition,andsoon.|WhenwedoourJavaScript Object Notationdemo,we'llgointotheseconstructsinmoredetail.|Atthispoint,we'rejustintroducingthem.|thesecondtypeofcompositevalueinJavaScript Object Notationisarrays,andarraysareenclosedinsquarebracketswithcommasbetweenthearrayelements.|Actuallywehavecommasintheobjectsasandarraysarelistofvalues.|Forexample,wecanseeherethatauthorsisalistofauthorobjects.|NowImentionedthattheconstructsarerecursive,specificallythevaluesinsidearrayscanbeanything,theycanbeotherarraysorobjects,spacevaluesandthevaluesaremakingupthelabelvaluepairsandobjectscanalsobeanycompositevalueorabasevalue.|AndIdidwanttomention,bytheway,thatsometimethiswordlabelhereforlabelvaluepairsiscalleda"property".|So,justlikeeXtensible Markup Language,JavaScript Object Notationhassomebasicstructuralrequirementsinitsformatbutitdoesn'thavealotofrequirementsintermsofuniformity.|Wehaveacoupleofexamplesofheterogeneityinhere,forexample,thisbookhasaneditionandtheotheronedoesn'tthisbookhasaremarkandtheotheronedoesn't.|Butwe'llseemanymoreexamplesofheterogeneitywhenwedothedemoandlookintoJavaScript Object Notationdatainmoredetail.|Nowlet'scompareJavaScript Object Notationandtherelationalmodel.|WewillseethatmanyofthecomparisonsarefairlysimilartowhenwecomparedeXtensible Markup Languagetotherelationalmodel.|Let'sstartwiththebasicstructuresunderlingthedatamodel.|So,therelationalmodelisbasedontables.|Wesetupstructureoftable,asetofcolumns,andthenthedatabecomesrowsinthosetables.|JavaScript Object Notationisbasedinsteadonsets,thesetsoflabelpairsandarraysandaswesaw,theycanbenested.|Oneofthebigdifferencesbetweenthetwomodels,ofcourse,isthescheme.|SotheRelationalmodelhasaSchemafixedinadvance,yousetitupbeforeyouhaveanydataloadedandthenalldataneedstoconfirmtothatSchema.|JavaScript Object Notationontheotherotherhandtypicallydoesnotrequireaschemainadvance.|Infact,theschemaandthedataarekindamixtogetherjustlikeanxml,andthisisoftenreferredtoasself-describingdata,wheretheschemaelementsarewithinthedataitself.|Andthisisofcoursetypicallymoreflexiblethanthetoamodel.|Butthereareadvantagestohavingschema[sp?]|aswell,definitely.|Asfarasqueriesgo,oneofthenicefeaturesoftherelationalmodelisthattherearesimple,expressivelanguagesforclearingthedatabase.|IntermsofJavaScript Object Notation,althoughafewNewthingshavebeenproposed;atthispointthere'snothingwidelyusedforqueryingJavaScript Object Notationdata.|TypicallyJavaScript Object Notationdataisreadintoaprogramandit'smanipulatedprogramatically.|NowletmeinterjectthatthisvideoisbeingmadeinFebruary2012.|SoitispossiblethatsomeJavaScript Object Notationquerylanguageswillemergeandbecomewidelyusedthereisjustnothingusedatthispoint.|Therearesomeproposals.|There'saJavaScript Object Notationpathlanguage,JavaScript Object NotationQuery,alanguagecalledjaql.|ItmaybethatjustlikeeXtensible Markup Language,thequerylanguagearegonnafollowtheprevalentuseofthedataformatorthedatamodel.|Butthatdoesnothappenedyet,asofFebruary2012.|Howaboutordering?|Oneaspectoftherelationalmodelisthatit'sanunorderedmodel.|It'sbasedonsetsandifwewanttoseerelationaldatainsortedorderthenweputthatinsideaquery.|InJavaScript Object Notation,wehavearraysasoneofthebasicdatastructures,andarraysareordered.|Ofcourse,there'salsothefactlikeeXtensible Markup LanguagethatJavaScript Object Notationdataisoftenisusuallywrittenfilesandfilesthemselvesarenaturallyordered,buttheorderingofthedatainfilesusuallyisn'trelevant,sometimesitis,buttypicallynotfinallyintermsofimplementation,fortherelationalmodel,therearesystemsthatimplementtherelationalmodelnatively.|They'reverygenerallyquiteefficientandpowerfulsystems.|ForJavaScript Object Notation,wehaven'tyetseenstandalonedatabasesystemsthatuseJavaScript Object NotationtheirdatamodelinsteadJavaScript Object Notationismoretypicallycoupledwithprogramminglanguages.|OnethingIshouldaddhoweverJavaScript Object NotationisusedinNoSQLsystems.|WedohavevideosaboutNoSQLsystemsyoumayormaynothave,havewatchedthoseyet.|There'sacoupleofdifferentwaysthatJavaScript Object Notationisusedusedinthosesystems.|Oneofthemisjustasaformatforreadingdataintothesystemsandwritingdataoutfromthesystems.|Theotherwaythatitisusedisthatsomeofthenotesystemsarewhatarecalled"DocumentManagementSystems"wherethedocumentsthemselvesmaycontainJavaScript Object NotationdataandthenthesystemswillhavespecialfeaturesformanipulatingtheJavaScript Object Notationinthedocumentisbetterstoredbythesystem.|Nowlet'scomparedJavaScript Object NotationandeXtensible Markup Language.|Thisisactuallyahotlydebatedcomparisonrightnow.|TherearesignificationoverlapintheusageofJavaScript Object NotationandeXtensible Markup Language.|Bothofthemareverygoodforputtingsemi-structureddataintoafileformatandusingitfordatainterchange.|Andsobecausethere'ssomuchoverlapinwhatthey'reusedfor,it'snotsurprisingthatthere'ssignificantdebate.|I'mnotgonnatakesides.|I'mjustgoingtotrytogiveyouacomparison.|Let'sstartbylookingattheverbosityofexpressingdatainthetwolanguages.|SoitisthecasethateXtensible Markup Languageisingeneral,alittlemoreverbosethanJavaScript Object Notation.|Sothesamedataexpressedinthe2formatswilltendtohavemorecharactersineXtensible Markup LanguagethanJavaScript Object NotationandyoucanseethatinourexamplesbecauseourbigJsonexamplewasactuallyprettymuchthesamedatathatweusedwhenweshowedeXtensible Markup Language.|AndthereasonforeXtensible Markup Languagebeingabinary digitmoreverboselargelyhastodoactuallywithclosingtags,andsomeotherfeatures.|ButI'llletyoujudgeforyourselfwhetherthesomewhatlongerexpressionofeXtensible Markup Languageisaproblem.|Secondiscomplexity,andhere,too,mostpeoplewouldsaythateXtensible Markup Languageisabinary digitmorecomplexthanJavaScript Object Notation.|I'mnotsureIentirelyagreewiththatcomparison.|IfyoulookatthesubsetofeXtensible Markup Languagethatpeoplereallyuse,you'vegotattributes,subelementsandtext,andthat'smoreorlessit.|IfyoulookatJson,yougotyourbasicvaluesandyou'vegotyourobjectsandyourarrays.|IthinktheissueisthateXtensible Markup Languagehasalotofextrastuffthatgoesalongwithit.|SoifyoureadtheentireeXtensible Markup Languagespecification.|Itwilltakeyoualongtime.|JavaScript Object Notation,youcangrasptheentirespecificationalittlebinary digitmorequickly.|Nowlet'sturntovalidity.|Andbyvalidity,Imeantheabilitytospecifyconstraintsorrestrictionorschemaonthestructureofdatainoneofthesemodels,andhaveitenforcedbytoolsorbyasystem.|SpecificallyineXtensible Markup Languagewehavethenotionofdocumenttypedescriptors,orDTDs,wealsohaveeXtensible Markup LanguageSchemawhichgivesusXSD's,eXtensible Markup LanguageSchemaDescriptors.|Andtheseareschemalikethingsthatwecanspecify,andwecanhaveourdatacheckedtomakesureitconformstotheschema,andtheseare,Iwouldsay,fairlywidelyusedatthispointforeXtensible Markup Language.|ForJavaScript Object Notation,there'ssomethingcalledJavaScript Object NotationSchema.|And,youknow,similartoeXtensible Markup LanguageSchema,it'sawaytospecifythestructureandthenwecancheckthatJavaScript Object Notationconformsthatandwewillseesomeofthatinourdemo.|Thecurrentstatus,February2012isthatthisisnotwidelyusedthispoint.|Butagain,itcouldreallyjustbeevolution.|IfwelookbackateXtensible Markup Language,asitwasoriginallyproposed,probablywedidn'tseeawholeoflotofuseofDTDs,andinfactnotasXSDsforsureuntillateron.|Sowe'lljusthavetoseewhetherJavaScript Object Notationevolvesinasimilarway.|NowtheprogramminginterfaceiswhereJavaScript Object Notationreallyshines.|TheprogramminginterfaceforeXtensible Markup Languagecanbefairlyclunky.|TheeXtensible Markup Languagemodel,theattributesandsub-elementsandsoon,don'ttypicallymatchthemodelofdatainsideaprogramminglanguage.|Infact,that'ssomethingcalledtheimpedancemismatch.|Theimpedancemissmatchhasbeendiscussedindatabasesystemsactually,fordecadesbecauseoneoftheoriginalcriticismsofrelationaldatabasesystemsisthatthedatastructuresusedinthedatabase,specificallytables,didn'tmatchdirectlywiththedatastructuresandprogramminglanguages.|Sotherehadtobesomemanipulationattheinterfacebetweenprogramminglanguagesandthedatabasesystemandthat'sthemismatch.|SothatsameimpedancemismatchisprettymuchpresentineXtensible Markup LanguagewhereinJavaScript Object NotationisreallyamoredirectmappingbetweenmanyprogramminglanguagesandthestructuresofJavaScript Object Notation.|Finally,let'stalkaboutquerying.|I'vealreadytouchedonthisabinary digit,butJavaScript Object Notationdoesnothaveanymature,widelyusedquerylanguagesatthispoint.|foreXtensible Markup LanguagewedohaveXPath,wehaveXQuery,wehaveeXtensible Stylesheet Language Transformations.|Maybenotallofthemarewidelyusedbutthere'snoquestionthatXPathatleastandeXtensible Stylesheet Languageareusedquietabinary digit.|AsfarasJsongoesthereisaproposalcalledJsonpath.|ItlooksactuallyquietalotlikeXPathmaybehe'llcatchon.|There'ssomethingcalledJavaScript Object NotationQuery.|Doesn'tlooksomuchlikeeXtensible Markup LanguageQuery,Imean,XQuery.|andfinally,therehasbeenaproposalcalledJAQLfortheJavaScript Object Notationquerylanguage,butagainasofFebruary2012allofthesearestillveryearly,sowejustdon'tknowwhat'sgoingtocatchon.|Sonowlet'stalkaboutthevalidityofJavaScript Object Notationdata.|SodoJavaScript Object Notationdatathat'ssyntacticallyvalid,simplyneedstoadheretothebasicstructuralrequirements.|Asareminder,thatwouldbethatwehavesetsoflabelvaluepairs,wehavearraysofvaluesandourvaluesarefrompredefinedtypes.|Andagain,thesevaluesherearedefinedrecursively.|SowestartwithaJavaScript Object Notationfileandwesendittoatheparsermaydeterminethatthefilehassyntacticerrorsorifthefileissyntacticallycorrectthenitcanparsedintoobjectsinaprogramminglanguage.|Nowifwe'reinterestedinsemanticallyvalidJavaScript Object Notation;thatisJavaScript Object Notationthatconformstosomeconstraintsoraschema,theninadditiontocheckingthebasicsstructuralrequirements,wecheckwhetherJavaScript Object Notationconformstothespecifiedschema.|IfweusealanguagelikeJavaScript Object Notationschemaforexample,weputaspecificationinasaseparatefile,andinfactJavaScript Object NotationschemaisexpressedinJavaScript Object Notationitself,aswe'llseeinourdemo,wesendittoavalidatorandthatvalidatormightfindthattherearesomesyntacticerrorsoritmayfindthattherearesomesymanticerrorssothedatacouldtobecorrectsyntacticallybutnotconformtotheschema.|Ifit'sbothsyntacticallyandsemanticallycorrectthenitcanmoveontotheparserwherewillbeparsedagainintoobjectsinaprogramminglanguage.|Sotosummarize,JavaScript Object NotationstandsforJavaScriptObjectNotation.|It'sastandardfortakingdataobjectsandserializingthemintoaformatthat'shumanreadable.|It'salsoveryusefulforexchangingdatabetweenprograms,andforrepresentingandstoringsemi-structureddatainaflexiblefashion.|Inthenextvideowe'llgolivewithademonstrationofJavaScript Object Notation.|We'lluseacoupleofJavaScript Object Notationeditors,we'lltakealookatthestructureofJavaScript Object Notationdata,whenit'ssyntacticallycorrect.|We'lldemonstratehowit'sveryflexiblewhenourdatamightirregular,andwe'llalsodemonstrateschemacheckingusinganexampleofJSON'sschema.|Inthisvideo,we'llseeademonstrationofJavaScript Object Notationdata.|Asareminder,JavaScript Object NotationstandsforJavaScriptObjectNotation,andit'sastandardforwritingdataobjectsintohumanreadableformat,typicallyinafile.|It'susefulforexchangingdatabetweenprograms,andgenerallybecauseit'squiteflexible,it'susefulforrepresentingandforstoringdatathat'ssemi-structured.|AreminderofthebasicconstructsinJavaScript Object Notation,wehavetheatomicvalue,suchasintegersandstringsandsoon.|Andthenwehavetwotypesofcompositethings;wehaveobjectsthataresetsoflabel-valuepairsandthenwehavearraysthatarelistsofvalues.|Inthedemonstration,we'llgothroughinmoredetailthebasicconstructsofJavaScript Object Notationandwe'lllookatsometacticcorrectness,we'lldemonstratetheflexibilityofthedatamodelandthenwe'lllookbrieflyatJSON'sschema,notwidelyusedyetbutstillfairlyinterestingtolookatandwe'lllookatsomevalidationofJavaScript Object Notationdataagainstaparticularschema.|So,here'stheJavaScript Object Notationdatathatwe'regonnabeworkingwithduringthisdemo.|It'sthesamedatathatappearedintheslides,intheintroductiontoJavaScript Object Notation,butnowwe'regoingtolookintothecomponentsofthedata.|It'salsobytheway,thesameexampleprettymuchthatweusedforeXtensible Markup Language,it'sreformattedofcoursetomeettheJavaScript Object Notationdatamodel,butyoucancomparethetwodirectly.|Lastly,wedohavethefileforthedataonthewebsite,andIdosuggestthatyoudownloadthefilesothatyoucantakealookatitcloselyonyourowncomputer.|Allright.|So,let'sseewhatwehave,rightnowwe'reinaneditorforJavaScript Object Notationdata.|IthappenstobetheEclipseeditorandwe'regoingtomakemakesomeeditstothefileafterwelookthroughtheconstructsofthefile.|So,thisisJavaScript Object Notationdatarepresentingbooksandmagazines,andwehavealittlemoreinformationaboutourbooksandourmagazines.|So,attheoutermost,thecurlybraceindicatesthatthisisaJavaScript Object Notationobject.|Andasareminder,anobjectisasetoflabel-valuepairs,separatedbycommas.|So,ourfirstvalueisthelabel"books".|Andthenourfirstelementintheobjectisthelabelbooksandthisbigvalueandthesecond,sothere'sonlytwolabel-valuepairshere,isthelabelmagazinesandthisbigvaluehere.|Andlet'stakealookfirstatmagazines.|Somagazines,again,isthelabelandthevaluewecanseewiththesquarebracketshereisanarray.|Anarrayisalistofvaluesandherewehavetwovaluesinourarray.|They'restillcompositevalues.|So,wehavetwovalues,eachofwhichisanobject,asetoflabel-valuepairs.|Letmemention,sometimespeoplecalltheselabels'properties',bytheway.|Okay.|So,nowweareinsideour2objectsthatarethe2elementsinthearraythat'sthevalueofmagazines.|Andeachoneofthosehas3labelsand3values.|Andnowwe'refinallydowntothebasevalues.|So,wehavethetitlebeing"NationalGeographic",astring,themonthbeingJanuary,astringandtheyear2009,where2009isaninteger.|Andagain,wehaveanotherobjectherethat'sadifferentmagazinewithadifferentname,monthandhappenstobethesameyear.|Now,thesetwohaveexactlythesamestructurebuttheydon'thavetoandwewillseethataswestarteditingthefile.|Butbeforeweeditthefile,let'sgoandlookatourbookshere.|Thevalueofourotherlabel-valuepairinsidetheoutermostobject,"books"isalsoanarray,andthearrayinthiscasealsohasjusttwoelements,sowe'verepresentedtwobookshere.|It'salittlemorecomplicatedthanthemagazines,butthoseelementsarestillobjectsthatarelabel-valuepairs.|So,wehavenowtheISBN,theprice,theaddition,thetitle,alleitherintegersorstrings,andthenwehaveonenestedcompositeobjectwhichistheauthorsandthat'sanarrayagain.|So,thearrayagain,isindicatedbythesquarebrackets.|Andinsidethisarray,wehavetwoauthorsandeachoftheauthorshasafirstnameandalastname,butagain,thatuniformityisnotrequiredbythemodelitself,aswe'llsee.|So,asImentioned,thisisactuallyaneditorforJavaScript Object Notationdataandwe'regoingtocomebacktothiseditorinamoment.|ButwhatIwantedtodoisshowthesamedatainabrowserbecausebrowsersactuallyoffersomenicefeaturesfornavigatinginJavaScript Object Notation.|SohereweareintheChromebrowser,whichhasnicefeaturesfornavigatingJavaScript Object Notation,andotherbrowsersdoaswell.|WecanseehereagainthatwehaveanobjectinourJavaScript Object Notationdata,thatconsistsoftwolabel-valuepairs;booksandmagazines,whicharecurrentlyclosedandandthenthisplusallowsustoopenthemup,andseethestructure.|Forexample,weopenmagazinesandweseethatmagazinesisanarraycontainingtwoobjects.|Wecanopenoneofthoseobjects,andseethatthethreelabel-valuepairs.|Nowwe'reatthelowestlevelsandsimilarlyfortheotherobject.|WecanseeherethatBooksisalsoanarray,andwegoaheadandopenitup.|It'sanarrayoftwoobjects.|Weopenoneofthoseobjectsandweseeagainthesetoflabel-valuepairs,whereoneofthevaluesisafurthernesting.|It'sanarrayandweopenthatarray,andweseetwoobjects,andweopenthemandfinallyseethedataatthelowestlevels.|Soagain,thebrowserheregivesusanicewaytonavigatetheJavaScript Object Notationdataandseeitsstructure.|Sonowwe'rebacktoourJavaScript Object Notationeditor.|Bytheway,thiseditor,Eclipse,doesalsohavesomefeaturesforopeningandclosingthestructureofthedata,butit'snotquiteasniceasthebrowserthatweuse.|Sowedecidedtousethebrowserinstead.|WhatwearegoingtousetheeditorforistomakesomechangestotheJavaScript Object Notationdataandseewhichchangesarelegalandwhicharen't.|So,let'stakealookatthefirstchange,averysimpleone.|Whatifweforgotacomma.|Well,whenwetrytosavethatfile,wegetalittlenoticethatwehaveanerror,weexpectedanNvalue,sothat'saprettystraightforwardmistake,let'sputthatcommaback.|Let'ssayinsertanextrabracesomewherehere,forwhateverreason.|Weaccidentallyputinanextrabrace.|Againweseethatthat'smarkedasanerror.|Soanerrorthatcanbefairlycommontomakeistoforgettoputquotesaroundstrings.|So,forexample,thisISBNnumberhere,ifwedon'tquoteit,we'regonnagetanerror.|Aswe'llseetheonlythingsthatcanbeunquotedarenumbersandthevaluesnull,trueandfalse.|So,let'sputourquotesbackthere.|Now,actually,evenmorecommonistoforgettoputquotesaroundthelabelsinlabel-valuepairs.|Butifweforgettoquotethat,that'sgoingtobeanerroraswell.|Youmighthavenoticed,bytheway,whenweusethebrowserthatthebrowserdidn'tevenshowusthequotesinthelabels.|ButyoudowhenyoumaketherawJavaScript Object Notationdata,youdoneedtoincludethosequotes.|Speakingofquotes,whatifwequotedourpricehere.|Wellthat'sactuallynotanerror,becausenowwe'vesimplyturnedpriceintoastring,andstringvaluesareperfectlywellallowedanywhere.|Nowwe'llseewhenweuseJSON'sschemathatwecanmakerestrictionsthatdon'tallowstringsincertainplaces,butjustforsyntacticcorrectnessofJavaScript Object Notationdataanyofourvaluescanbestrings.|Now,asImentioned,thereareafewvaluesthataresortofreservedwordsinJavaScript Object Notation.|Forexample,trueisareservedwordforabullionvalue.|Thatmeanswedon'tneedtoquoteitbecauseit'sactuallyitsownspecialtypeofvalue.|Andsoisfalse.|Andthethirdoneisnull,sothere'sabuilt-inconceptofnull.|Now,ifwewantedtousenilforwhateverreasoninsteadofnull,well,nowwe'regoingtogetanerrorbecausenilisnotareservedword,andifwereallywantednilthenwewouldneedtoactuallymakeitaquotedstring.|Now,let'stakealookinsideourauthorlist.|AndI'mgoingtoshowyouthatarraysdonothavetohavethesametypeofvalueforeveryelementinthearray.|Soherewehaveahomogeneouslistofauthors.|Bothofthemareobjectswithafirstnameandalastnameasseparatelabel-valuepairs,butifIchangethatfirstone,theentirevaluetobe,insteadofacompositeone,simplythestring,JeffereyUllman.|Oops,sorryaboutmytypingthere,andthatisnotanerror,itisallowedtohaveastring,andthenacompositeobject.|Andwecouldevenhaveanarray,andanythingwewant.|Inanarray,whenyouhavealistofvalues,allyouneedisforeachonetobesyntacticallyacorrectvalueinJavaScript Object Notation.|Nowlet'sgovisitourmagazinesforamomenthereandletmeshowthatemptyobjectsareokay.|Soalistoflabelvaluepairs,comprisinganobject,canbetheemptylist.|AndsonowI'veturnedthismagazineintohavingnoinformationaboutit,butthatislegalinJavaScript Object Notation.|Andsimilarly,arraysareallowedtobeofzerolength.|SoIcantaketheseauthorshereandIcanjusttakeoutalloftheauthors,andmakethatanemptylist,butthat'sstillvalidJavaScript Object Notation.|Now,whatifItookthisarrayoutaltogether?|Inthatcase,nowwehaveanerrorbecausethisisanobjectwherewehavelabel-valuepairsandeverylabel-valuepairhastohavebothalabelandavalue.|Solet'sputourarraybackandwecanhaveanythingintheresolet'sjustmakeit"fu"andthatcorrectstheerror.|Whatifwedidn'twantanarrayhereinsteadandwetriedtomakeit,say,anobject,?|Well,we'regoingtoseeanerrorthere,becauseanobjectasareminderandthisisaneasymistaketomake.|Objectsarealwayslabel-valuepairs.|Soifyouwantjustavalue,thatshouldbeanarrayifyouwantanobject,thenwe'retalkingaboutalabel-valuepair,sowecanjustadd"fu"asourvalue,andthenwe'reallset.|Sowhatwe'veseensofarissyntacticcorrectness.|Again,there'snorequireduniformityacrossvaluesinarraysorinthelabel-valuepairsinobjectswejustneedtoensurethatallofourvalues,ourbasicvalues,areoftherighttypes,andthingslikeourcommasandcurlybracesareallinplace.|Whatwe'regonnadonextislookatJSON'sschemawherewehaveamechanismforenforcingcertainconstraintsbeyondsimplesyntacticcorrectness.|Ifyou'vebeenveryobservant,youmightevenhavenoticedthatwehaveasecondtabuphereinoureditorforasecondJavaScript Object Notationfile,andthisfileisgoingtobetheschemaforourbookstoredata.|We'reusingJavaScript Object Notationschema,andJavaScript Object Notationschema,like,eXtensible Markup Languageschemaisexpressedinthedatamodelitself.|So,ourschemadescriptionforthisJavaScript Object NotationdataisitselfJavaScript Object Notationdata,andhereitis.|Andit'sgoingtotakeabinary digitoftimetoexplain.|Nowthefirstthingthatyoumightnoticeiswow,theschemalooksmorecomplicatedandinfactlongerthanthedataitself.|Well,thatistrue,butthat'smostlybecauseourdatafileistiny.|So,ifwehadthousands,youknow,tensofthousandsofbooksandmagazines,ourschemafilewouldn'tchange,butourdatafilewouldbemuchlongerandthat'sthetypicalcase,inreality.|Now,thisvideoisnotacompletetutorialaboutJSON'sschema.|There'smanyconstructsinJSON'sschemathatweren'tneededtodescribethebookstoredata,forexample.|Andeventhisfilehere,I'mnotgonnagothrougheverydetailofitrighthere.|Youcandownloadthefileandtakealook,readalittlemoreaboutJavaScript Object Notationschema.|I'mjustgoingtogivetheflavoroftheschemaspecificationandthenwe'regoingtoworkwithvalidatingthedataitselftoseehowtheschemaanddataworktogether.|Buttogiveyoutheflavorhere,let'sgothroughatleastsomeportionsoftheschema.|So,insomesense,thestructureoftheschemafilereflectsthestructureofthedatafilethatit'sdescribing.|So,theoutermostconstructsintheschemafilearetheoutermostinthedatafileandaswenestitparallelsthenesting.|Letmejustshowalittlebinary digithere,we'llprobablylookatmostofitinthecontextofvalidation.|So,weseeherethatouroutermostconstructinourdatafileisanobject.|Andthat'stoldtous,becausewehave"type"asoneofourbuilt-inlabelsfortheschema.|Sowewehaveanobjectwithtwoproperties,aswecanseehere,thebook'spropertyandthemagazine'sproperty.|AndIusetheword"labels"frequentlyforlabel-valuepairs,that'ssynonymouswithpropertyvaluepairs.|Theninsidethebookspropertyforexample,weseethatthetypeofthatisarray,sowe'vegotalabel-valuepairwherethevalueisanarray.|Andthenwefollowthenestingandseethatit'sanarrayofobjects.|Andwegofurtherdownandweseethedifferentlabel-valuepairsoftheobjectthatmakeupthebooksandnestingfurtherintotheauthorsandsoon.|Weseesimilarlyformagazinesthatthevalueofthealabel-valuepairformagazinesisanarray,andthatarrayconsistsofobjectswithfurthernesting.|Sowhatwe'relookingathereisanonlineJavaScript Object Notationschemavalidator.|Wehavetwowindows.|Ontheleftwehaveourschemaandontherightwehaveourdata,andthisisexactlythesamedatafileandschemafilethatwewerelookingatearlier.|Ifwehitthevalidatebutton,hopefullyeverythingshouldworkanditdoes.|ThistellsusthattheJavaScript Object Notationdataisvalidwithrespecttotheschema.|Now,thissystemwillofcoursefindbasicsyntacticerrorssoIcantakeawayacommajustlikeIdidbeforeandwhenIvalidateI'llgetaparsingerrorthatreallyhasnothingtodowiththeschema.|WhatI'mgoingtofocusonnowisactuallyvalidatingsemanticcorrectnessoftheJavaScript Object Notationwithrespectbacktotheconstructsthatwe'vespecifiedinthisschema.|Letmefirstputthatcommabacksowestartwithavalidfile.|So,thefirstthingI'llshowistheabilitytoconstrainbasictypes,andthentheabilitytoconstraintherangeofvaluesofthosebasictypes.|Andlet'sfocusonprice.|Soherewe'retalkingaboutthepricepropertyinsidebooksandwespecifyinourschemathatthetypeofthepricemustbeaninteger.|So,forexample,ifourpricewereinsteadastringandwewentaheadandtrytovalidatethatwewouldgetanerror.|Let'smakeitbackintoanintegerbutlet'smakeitintotheinteger300nowinsteadof100.|AndwhyamIdoingthat?|BecausetheJavaScript Object Notationschemaalsoletsmeconstraintherangeofvaluesthatareallowedifwehaveanumericvalue.|So,notonlyinpricedidIsaythatit'sanintegerbutIalsosaidthatithasaminimumandmaximumvalue,theintegerofpricesmustbebetween0and200.|So,ifItrytomakethepriceof300,andIvalidate,I'magaingettinganerror.|Nowit'snotatypeerror,butit'sanerrorthatmyintegerwasoutsideoftheallowedrange.|I'veputthepricebacktoahundred,andnowlet'slookatconstraintsonstringvalues.|JavaScript Object Notationschemaactuallyhasalittlepatternmatchinglanguagethatcanbeusedtoconstraintheallowablestringsforaspecifictypeofvalue.|We'lllookatISBNnumberhereasanexampleofthat.|We'vesaidthatISBNisoftypestring,andthenwe'vefurtherconstrainedintheschemathatthestringvaluesforISBNmustsatisfyacertainpattern.|I'mnotgonnagointothedetailsofthispattern-matchinglanguage.|I'mjustgonnagiveanexample.|Andinfact,thisentiredemoisreallyjustanexamplelotsofthingsinJSON'sschemathatwe'renotseeing.|WhatthispatternheresaysisthatthestringvalueforISBNmuststartwiththefourcharactersISBNandthencanbefollowedbyanythingelse.|So,ifwegoovertoourdataandwelookattheISBNnumberhereandsaywehaveatypo,weforgotthe"I"andwetrytovalidate.|Thenwe'llseethatourdatanolongermatchesourschemaspecification.|Nowlet'slookatsomeotherconstraintswecanspecifyinJSON'sschema.|Wecanconstrainthenumberofelementsinanarray.|Wecangiveaminimumormaximumorboth.|AndI'vedonethathereinthecontextoftheauthorsarray.|Remembertheauthorsareanarraythat'salistofobjectsandhereI'vesaidthatwehaveaminimumnumberofitemsof1andamaximumnumberitemsof10.|Inotherwords,everybookhastohavebetweenoneandtenauthors.|Solet'stry,forexample,takingoutallofourauthorshereinourfirstbook.|Weactuallylookedatthisbeforeintermsofsyntacticvalidity,anditwasperfectlyvalidtohaveanemptyarray.|Butwhenwetrytovalidatenowwedogetanerror,andthereasonisthatwesaidthatweneededbetweenoneandtenarrayelementsinthecaseofauthors.|Nowlet'sfixthat,notbyputtingourauthorsbackbutlet'ssayweactuallydecidewewouldliketobeabletohavebooksthathavenoauthors.|So,wecansimplyfixthatbychangingthatminimumitemtozeroandthatmakesourdatavalidagainandinfact,wecouldactuallytakethatminimumconstraintoutalltogether,andifwedothatourdataisstillgoingtobevalid.|Nowlet'sseewhathappenswhenweaddsomethingtoourdatathatisn'tmentionedintheschema.|Ifyoulookcarefullyyou'llseethateverythingthatwehaveinthedatasofarhasbeenspecifiedintheschema.|Let'ssaywecomealonganddecideweregonnaalsohaveratingsforourbooks.|Solet'saddherearatinglabelpropertywiththevalue5.|Wegoaheadandvalidate,youprobalythinkit'snotgoingtovalidateproperlybutactuallyitdid.|ThedefinitionofJavaScript Object Notationschemathatitcanconstrainthingsbydescribingthembutyoucanalsohavecomponentsinthedatathataren'tpresentinthisschema.|Ifwewanttoinsistthateverypropertythatispresentinthedataisalsodescribedinthisschema,thenwecanactuallyaddaconstrainttotheschemathattellsusthat.|Specifically,undertheobjecthere,wecanputinaspecialflagwhichitselfisspecifiedasalabelcalledadditionalproperties.|AndthisflagifwesetittofalseandrememberfalsecanisactuallyakeywordinJSON'sschema,tellsusthatinourdatawe'renotallowedtohaveanypropertiesbeyondthosethatarespecifiedintheschema.|Sonowwevalidateandwegetanerror,becausethepropertyratinghasn'tbeendefinedintheschema.|Ifadditionalpropertiesismissing,orhavethedefaultvalueof"true",thenthevalidationgoesthrough.|Nowletstakealookatourauthorsthatarestillhere.|Let'ssupposethatwedon'thaveafirstnameforourmiddleauthorhere.|Ifwetakethatawayandwetrytovalidate,wedogetanerror,becausewespecifiedinourschemaandit'srightdownhere--thatauthor-objectsmusthavebothafirstnameandalastname.|Itturnsoutthatwecanspecifyforeverypropertythatthepropertyisoptional.|So,wecanaddtothedescriptionofthefirstname,notonlythatthetypeisastringbutthatthatpropertyisoptionalsowesayoptional,true.|Nowlet'svalidate,andnowwe'reingoodshape.|Now,let'stakealookatwhathappenswhenwehaveobjectthathasmorethanoneinstanceofthesamelabelorsameproperty.|Solet'ssuppose,forexample,inourmagazine,themagazinehastwodifferentyears,2009and2011.|Thisissyntacticallyvalid,JavaScript Object Notation,itmeetsthestructureofhavingalistoflabel-valuepairs.|Whenwevalidateit,weseethatwecan'taddasecondproperty,year.|Sothisvalidatordoesn'tpermittwocopiesofthesameproperty,andit'sactuallykindofaparsingthingandnotsomuchrelatedtoJSON'sschema.|Manyparsersactuallydoenforcethatlabelsorpropertiesneedtobeuniquewithinobjects,eventhoughtechnicallysyntacticallycorrectJavaScript Object Notationdoesallowmultiplecopies.|Sothat'sjustsomethingtoremember,thetypicaluseofobjectsistohaveuniquelabels,sometimesareevencalledkeysofwhichevokesaconceptofthemunique.|Sotypicallytheyareunique.|Theydon'thavetobeforsyntacticvalidity.|Usuallywhenyouwannahaverepeatedvalues,itactuallymakesmoresensetocreateanarray.|I'vetakenawaythesecondyearinordertomaketheJavaScript Object Notationvalidagain.|Nowlet'stakealookatmonths.|I'veusedmonthstoillustratetheenumerationconstraintsowesawthatwecouldconstrainthevaluesofintegers,andwesawthatwecanconstrainstringsusingapattern,butwecanalsoconstrainanytypebyenumeratingthevaluesthatareallowed.|So,forthemonth,we'vesetitastringtypewhichitisbutwe'vefurtherconstraineditbysayingthatstringmustbeeitherJanuaryorFebruary.|So,ifwetrytosayputinthestringMarch,wevalidateandwegettheobviouserrorhere.|Wecanfixthatbychangingthemonthback,butmaybeitmakesmoresensethatMarchwouldbepartofourenumerationtype,sowe'lladdMarchtothepossiblevaluesformonths,andnowwe'regood.|Asanextexample,let'stakealookatsomethingthatwesawwassyntacticallycorrectbutisn'tgoingtobesemanticallycorrect,whichiswhenwehavetheauthorlistbeamixtureofobjectsandstrings.|So,let'sputJeffreyUllmanherejustasastring.|WesawthatthatwasstillvalidJavaScript Object Notation,butwhenwetrytovalidatenow,we'regonnagetanerrorbecauseweexpectedtoseeanobject,wehavespecifiedthattheauthorsareobjects,andinsteadwegotastring.|NowJavaScript Object Notationschemadoesallowustospecifythatwecanhavedifferenttypesofdatainthesamecontext,andI'mgoingtoshowthatwithalittlebinary digitofasimplerexamplehere.|So,let'sfirsttakeawayourauthortheresothatwe'rebackwithavalidfile.|AndwhatIamgoingtolookatissimplytheyearvalues.|So,letsupposeforwhateverreasonthatinourmagazines,oneoftheyearswasastringandtheotheryearwasaninteger.|Sothat'snotgonnaworkoutrightnowbecausewehavespecifiedclearlythattheyearmustbeaninteger.|InJavaScript Object Notationschemaspecifications,whenwewanttoallowmultipletypesforvaluesthatareusedinthesamecontext,weactuallymakethetypebeanarray.|Soinsteadofjustsayinginteger,ifweputanarrayherethathasbothintegerandstringthat'stellingusthatouryearvaluecanbeeitheranintegerorastringandnowwhenwevalidate,wegetacorrectJavaScript Object Notationfile.|ThatconcludesourdemoofJavaScript Object Notationschemavalidation.|Again,we'vejustseenoneexamplewithanumberoftheconstructsthatareavailableinJavaScript Object Notationschema,butit'snotnearlyexhaustive,therearemanyothers,andIencourageyoutoreadabinary digitmoreaboutit.|Youcandownloadthisdataandthisschemaasastartingpoint,andstartaddingthingsplayingaroundandIthinkyou'llgetagoodfeelforhowJavaScript Object NotationschemacanbeusedtoconstraintheallowabledatainaJavaScript Object Notationfile.|Thisisthefirstoftwovideoswherewelearnaboutrelationalalgebra.|RelationalAlgebraisaformallanguage.|It'sanalgebrathatformstheunderpinningsofimplementedlanguageslikeStructured Query Language.|Inthisvideowe'regoingtolearnthebasicsoftheRelationalAlgebraQueryLanguageandafewofthemostpopularoperators.|Inthesecondvideowe'lllearnsomeadditionaloperatorsandsomealternatenotationsforrelationalalgebra.|Now,let'sjustreviewfirstfromourpreviousvideoonrelationalqueryingthatqueriesoverrelationaldatabasesoperateonrelationsandtheyalsoproducerelationsasaresult.|Soifwewriteaquerythatoperatessayonthethreerelationsdepictedhere,theresultofthatqueryisgoingtobeanewrelation.|And,infact,wecanpostqueriesonthatnewrelationorcombinethatnewrelationwithourpreviousrelations.|Solet'sstartoutwithRelationalAlgebra.|Fortheexamplesinthisvideowe'regoingtobeusingasimplecollegeadmissionrelationsdatabasewiththreerelations.|Thefirstrelation,thecollegerelation,containsinformationaboutthecollegename,state,andenrollmentofthecollege.|Thesecondrelation,thestudentrelation,containsanIDforeachstudent,thestudent'sname,GPAandthesizeofthehighschooltheyattended.|And,finally,thethirdrelationcontainsinformationaboutstudentsapplyingtocolleges.|Specifically,thestudent'sID,thecollegenamewherethey'reapplying,themajorthey'reapplyingforandthedecisionofthatapplication.|I'veunderlinedthekeysforthesethreerelations.|Asareminder,akeyisanattributeorasetofattributeswhosevalueisguaranteedtobeunique.|So,forexample,we'regoingtoassumethecollegenamesareunique,studentIDsareuniqueandthatstudentswillonlyapplytoeachcollegeforaparticularmajoronetime.|So,we'regoingtohaveapictureofthesethreerelationsatthebottomoftheslidesthroughoutthevideo.|Thesimplestqueryinrelationalalgebraisaquerythatissimplythenameofarelation.|So,forexample,wecanwriteaquery,"student"andthat'savalidexpressioninrelationalalgebra.|Ifwerunthatqueryonourdatabasewe'llgetasaresultacopyofthestudentrelation.|Prettystraightforward.|Nowwhathappensnextisthatwe'regoingtouseoperatorsoftherelationalalgebratofilterrelations,slicerelations,andcombinerelations.|So,let'sthroughthoseoperators.|Thefirstoperatoristheselectoperator.|So,theselectoperatorisusedtopickcertainrowsoutofarelation.|TheselectoperatorisdenotedbyaSigmawithasubscript--that'stheconditionthat'susedtofiltertherowsthatweextractfromtherelations.|So,we'rejustgoingthroughthreeexampleshere.|ThefirstexamplesaysthatwewanttofindthestudentswhoseGPAisgreaterthan3.7.|Sotowritethatexpressioninrelationalalgebra,wewritethesigmawhichistheselectionoperatorasasubscripttheconditionthatwe'refilteringfor--GPAgreaterthan3.7--andtherelationoverwhichwe'refindingthatselectionpredicate.|So,thisexpressionwillreturnasubsetofthestudenttablecontainingthoserowswheretheGPAisgreater3.7.|Ifwewanttofilterfortwoconditions,wejustdoan"and"oftheconditionsinthesubscriptofthesigma.|Soifwewant,say,studentswhoseGPAisgreaterthan3.7andwhosehighschoolsizeislessthanathousand,we'llwriteselectGPAgreaterthan3.7.|Weusedalogicalandoperator--acaret,highschoolsizeislessthanathousand,andagainwe'llapplythattothestudentrelation.|Andonceagain,theresultofthatwillbeasubsetofthestudentrelationcontainingtherowsthatsatisfythecondition.|IfwewanttofindtheapplicationstoStanfordforaComputer Sciencemajor,thenwe'llbeapplyingaselectionconditiontotheapplyrelation.|Again,wewritethesigmaandnowthesubscriptisgoingtosaythatthecollegenameisStanfordandthemajorisComputer Science.|Again,theandoperator,andthatwillbeappliedtotheapplyrelationanditwillreturnasaresult,asubsetoftheapplyrelation.|Sothegeneralcaseoftheselectoperatoristhatwehavethesigma.|Wehaveaconditionasasubscriptandthenwehavearelationname.|Andwereturnasaresultthesubsetoftherelation.|OurnextoperatoristheProjectOperator.|Sotheselectoperatorpickscertainrows,andtheprojectoperatorpickscertaincolumns.|Solet'ssaywe'reinterestedintheapplications,butallwewantedtoknowwasthelistofID'sandthedecisionsforthoseapplications.|TheprojectoperatoriswrittenusingtheGreekpisymbol,andnowthesubscriptisalistofthecolumnnamesthatwewouldliketoextract.|SowewriteID,sorry,studentIDanddecision,andweapplythattotheapplyrelationagain.|Andnowwhatwe'llgetbackisarelationthathasjusttworows.|It'sgoingtohaveallthetuplesofapply,butit'sonlygoingtohavethestudentIDandthedecisioncolumns.|Sothegeneralcaseofaprojectoperatoristheprojection,andthenalistofattributes,canbeanynumber,andthenarelationname.|Now,whatifwe'reinterestedinpickingbothrowsandcolumnsatthesametime.|Sowewantonlysomeoftherows,andwewantonlysomeofthecolumns.|Nowwe'regoingtocomposeoperators.|Rememberthatrelationalqueriesproducerelations.|Sowecanwriteaquery,say,withtheselectoperatorofthestudentswhoseGPAisgreaterthan3.7.|Andthisishowwedothat.|Andnow,wecantakethatwholeexpressionwhichproducesarelation,andwecanapplytheprojectoperatortothat,andwecangetoutthestudentIDandthestudentname.|Okay.|So,whatweactuallyseenowisthatthegeneralcaseoftheselectionandprojectionoperatorsweren'tquitewhatItoldyouatfirst.|Iwasdeceivingyouslightly.|Whenwewritetheselectoperator,it'saselectwiththeconditiononanyexpressionoftherelationalalgebra,andifit'sabigonewemightwanttoputparenthesisonit,andsimilarlytheprojectoperatorisalistofattributesfromanyexpressionoftherelationalalgebra.|Andwecancomposetheseasmuchaswewant.|Wecanhaveselectoverproject,overselect,select,project,andsoon.|Nowlet'stalkaboutduplicatevaluesintheresultsofrelationalalgebraqueries.|Let'ssupposeweaskforalistofthemajorsthatpeoplehaveappliedforandthedecisionforthosemajors.|Sowewritethatastheprojectofthemajorandthedecisionontheappliedrelation.|Youmightthinkthatwhenwegettheresultsofthisquery,we'regoingtohavealotofduplicatevalues.|Sowe'llhaveComputer Scienceyes,Computer Scienceyes,Computer Scienceno,EEyes,EEno,andsoon.|Youcanimagineinalargerealisticdatabaseofapplications,there'sgoingtobehundredsofpeopleapplyingformajorsandhavingayesoranodecision.|Thesemanticsofrelationalalgebrasaysthatduplicatesarealwayseliminated.|Soifyourunaquerythatwouldlogicallyhavealotofduplicatevalues,youjustgetonevalueforeachresult.|That'sactuallyabinary digitofadifferencewiththeStructured Query Languagelanguage.|So,Structured Query Languageisbasedonwhat'sknownasmulti-setsorbagsandthatmeansthatwedon'teliminateduplicates,whereasrelationalalgebraisbasedonsetsthemselvesandduplicatesareeliminated.|Thereisamulti-setorbadrelationalalgebradefinedaswellbutwe'llbefinebyjustconsideringthesetrelationalalgebrainthesevideos.|Ourfirstoperatorthatcombinestworelationsisthecross-productoperator,alsoknownastheCartesianproduct.|Whatthisoperatordoes,isittakestworelationsandkindagluesthemtogethersothattheirschemaoftheresultistheunionoftheschemasofthetworelationsandthecontentsoftheresultareeverycombinationoftuplesfromthoserelations.|Thisisinfactthenormalsetcrossproductthatyoumighthavelearnedwaybackintheelementaryschool.|Solet'stalkabout,say,doingthecrossproductsofstudentsandapply.|Soifwedothiscrossproducts,justtosavedrawing,I'mjustgonnagluethesetworelationstogetherhere.|Soifwedothecrossproductwe'llgetattheresultabigrelation,here,whichisgoingtohaveeightattributes.|Theeightattributesacrossthestudentandapplynowtheonlysmalllittletrickisthatwhenwegluetworelationstogethersometimesthey'llhavethesameattributeandwecanseewehaveSIDonbothsides.|Sojustasanotationalconvention,whencross-productisdoneandthere'stwoattributesthatarenamed,they'reprefacedwiththenameoftherelationtheycamefrom.|Sothisonewouldbereferredtointhecross-productasthestudentdotSIDwherethisoneoverherewouldbereferredtoastheapplydotSID.|So,again,wegluetogetherintheCartesianproductthetworelationswithfourattributeseach,wegetaresultwitheightattributes.|Nowlet'stalkaboutthecontentsofthese.|Solet'ssupposethatthestudentrelationhads-tuplesinitandthat'showmanytuples,whiletheapplyhad8tuplesinit,theresultoftheCartesianproductsisgonnahaveStimesAtuples,isgoingtohaveonetupleforeverycombinationoftuplesfromthestudentrelationandtheapplyrelation.|Now,thecross-productseemslikeitmightnotbethathelpful,butwhatisinterestingiswhenweusethecross-producttogetherwithotheroperators.|Andlet'sseeabigexampleofthat.|Let'ssupposethatwewanttogetthenamesandGPAsofstudentswithahighschoolsizegreaterthanathousandwhoappliedtoComputer Scienceandwererejected.|Okay,solet'stakealook.|We'regoingtohavetoaccessthestudentsandtheapplyrecordsinordertorunthisquery.|Sowhatwe'lldoiswe'lltakestudentcrossapplyasourstartingpoint.|Sonowwehaveabigrelationthatcontainseightattributesandallofthosetuplesthatwedescribedpreviously.|Butnowwe'regoingtostartmakingthingsmoreinteresting,becausewhatwe'regoingtodoisabigselectionoverthisrelation.|Andthatselectionisfirstofallgoingtomakesurethatitonlycombinesstudentandapplytuplesthatarereferringtothesamestudent.|Sotodothat,wewritestudentdotSIDequalsapplydotSID.|Sonowwe'vefilteredtheresultofthatcross-producttoonlyincludecombinationsofstudentandapplybycouplesthatmakesets.|Nowwehavetodoalittlebinary digitofadditionalfiltering.|Wesaidthatwewantthehighschoolsizetobegreaterthanathousand,sowedoan"and"operatorinthehighschool.|WewantthemtohaveappliedtoComputer Sciencesothat'sandmajorequalsComputer Science.|We'regettinganicebigqueryhere.|Andfinallywewantthemtohavebeenrejected,so"anddecision"equals,we'lljustbeusingRforreject.|Sonow,we'vegotthatgiganticquery.|Butthatgetsusexactlywhatwewantexceptforonemorething,whichis,asIsaid,allwewantistheirnamesandGPAs.|Sofinallywetakeabigparenthesesaroundhereandweapplytothattheprojectionoperator,gettingthestudentnameandtheGPA.|AndthatistherelationalalgebraexpressionthatproducesthequerythatwehavewritteninEnglish.|Nowwehaveseenhowthecrossproductallowsustocombinetuplesandthenapplyselectionconditionstogetmeaningfulcombinationsoftuples.|Itturnsoutthatrelationalalgebraincludesanoperatorcalledthenaturaljointhatisusedprettymuchfortheexactpurpose.|Whatthenaturaljoindoesisitperformsacross-productbutthenitenforcesequalityonalloftheattributeswiththesamename.|Soifwesetupourschemaproperly,forexample,wehavestudentIDandstudentIDhere,meaningthesamething,andwhenthecrossproductiscreated,it'sonlygoingtocombinetupleswherethestudentIDisthesame.|Andfurthermore,ifweaddcollegein,wecanseethatwehavethecollegenamehereandthecollegenamehere.|Ifwecombinecollegeandapplytuples,we'llonlycombinetuplesthataretalkingaboutthesamecollege.|Nowinaddition,onemorethingthatitdoesisitgetsridofthesepeskyattributesthathavethesamenames.|Sosincewhenwecombine,forexample,studentandapplywiththenaturaljoin,we'reonlycombiningtupleswherethestudentSIDisthesameastheapplySID.|Thenwedon'tneedtokeeptwocopiesofthatcolumnbecausethevaluesarealwaysgoingtobeequal.|Sothenaturaljoinoperatoriswrittenusingabowtie,that'sjusttheconvention.|Youwillfindthatinyourtexteditingprogramsifyoulookcarefully.|Solet'sdosomeexamplesnow.|Let'sgobacktooursamequerywherewewerefindingthenamesandGPAsofstudentsfromlargehighschoolswhoappliedtoComputer Scienceandwererejected.|Sonow,insteadofusingthecross-productwe'regonnausethenaturaljoin,which,asIsaid,waswrittenwithabowtie.|Whatthatallowsustodo,oncewedothatnaturaljoin,iswedon'thavetowritethatcondition,thatenforcedequalityonthosetwoattributes,becauseit'sgoingtodoititself.|Andoncewehavedonethatthenallweneedtodoisapplytherestofourconditions,whichwerethatthehighschoolisgreaterthanathousandandthemajorisComputer Scienceandthedecisionisreject,againwe'llcallthatR.Andthen,sincewe'reonlygettingthenamesandGPAs,wewritethestudentnameandtheGPA.|Okay.|Andthat'stheresultofthequeryusinganaturaljoin.|So,asyoucanseethat'salittlebinary digitsimplerthantheoriginalwiththecross-productandbysettingupschemascorrectly,naturaljoincanbeveryuseful.|Nowlet'saddonemorecomplicationtoourquery.|Let'ssupposethatwe'reonlyinterestedinapplicationstocollegeswheretheenrollmentisgreaterthan20,000.|So,sofarinourexpressionwerefertothestudentrelationandtheapplyrelation,butwehaven'tusedthecollegerelation.|Butifwewanttohaveafilteronenrollment,we'regoingtohavetobringthecollegerelationintothepicture.|Thisturnsouttoperhapsbeeasierthanyouthink.|Let'sjusteraseacoupleofourparentheseshere,andwhatwe'regoingtodoiswe'regoingtojoininthecollegerelation,withthetworelationswehavealready.|Now,technically,thenaturaljoinisthebinaryoperator,peopleoftenuseitwithoutparenthesesbecauseit'sassociative,butifwegetpedanticaboutitwecouldaddthatandthenwe'reingoodshape.|Nowwe'vejoinedallthreerelationstogether.|Andremember,automaticallythenaturaljoinenforcesequalityonthesharedattributes.|Veryspecifically,thecollegenamehereisgoingtobesetequaltotheapplycollegenameaswell.|Nowoncewe'vedonethat,we'vegotalltheinformationweneed.|Wejustneedtoaddonemorefilteringcondition,whichisthatthecollegeenrollmentisgreaterthan20,000.|Andwiththat,we'vesolvedourquery.|Sotosummarizethenaturaljoin,thenaturaljoincombinesrelations.|Itautomaticallysetsvaluesequalwhenattributenamesarethesameandthenitremovestheduplicatecolumns.|Thenaturaljoinactuallydoesnotaddanyexpressivepowertorelationalalgebra.|Wecanrewritethenaturaljoinwithoutitusingthecross-product.|Soletmejustshowthatrewritehere.|Ifwehave,andnowI'mgoingtousethegeneralcaseoftwoexpressions.|Oneexpression,naturaljoinwithanotherexpression,thatisactuallyequivalenttodoingaprojectionontheschemaofthefirstexpression-I'lljustcallitE1now-uniontheschemaofthesecondexpression.|That'sarealunion,sothatmeansifwehavetwocopieswejustkeeponeofthem.|Overtheselectionof.|Nowwe'regoingtosetallthesharedattributesofthefirstexpressiontobeequaltothesharedattributesofthesecond.|SoI'lljustwriteE1,A1equalsE2,A1andE1,A2equalsE2dotA2.|Nowthesearethecaseswhere,again,theattributeshavethesamenames,andsoon.|Sowe'resettingallthoseequal,andthatisappliedoverexpressiononecross-productexpressiontwo.|Soagain,thenaturaljoinisnotgivingusadditionalexpressivepower,butitisveryconvenientnotationally.|ThelastoperatorthatI'mgoingtocoverinthisvideoisthethetajoinoperator.|Likenaturaljoin,thetajoinisactuallyanabbreviationthatdoesn'taddexpressivepowertothelanguage.|Letmejustwriteit.|Thethetajoinoperatortakestwoexpressionsandcombinesthemwiththebowtielookingoperator,butwithasubscripttheta.|Thatthetaisacondition.|It'saconditioninthestyleoftheconditionintheselectionoperator.|Andwhatthisactuallysays-it'sprettysimple-isit'sequivalenttoapplyingthethetaconditiontothecross-productofthetwoexpressions.|SoyoumightwonderwhyIevenmentionthethetajoinoperator,andthereasonImentionitisthatmostdatabasemanagementsystemsimplementthethetajoinastheirbasicoperationforcombiningrelations.|Sothebasicoperationistaketworelations,combinealltuples,butthenonlykeepthecombinationsthatpassthethetacondition.|Oftenwhenyoutalktopeoplewhobuilddatabasesystemsorusedatabases,whentheyusethewordjoin,theyreallymeanthethetajoin.|So,inconclusion,relationalalgebraisaformallanguage.|Itoperatesonsetsofrelationsandproducesrelationsasaresult.|Thesimplestqueryisjustthenameofarelationandthenoperatorsareusedtofilterrelations,slicethem,andcombinethem.|Sofar,we'velearnedtheselectoperatorforselectingrows;theprojectoperatorforselectingcolumns;thecross-productoperatorforcombiningeverypossiblepairoftuplesfromtworelations;andthentwoabbreviations,thenaturaljoin,whichaveryusefulwaytocombinerelationsbyenforcingaequalityoncertaincolumns;andthethetajoinoperator.|Inthenextvideo,we'lllearnsomeadditionaloperatorsofrelationalalgebraandalsosomealternativenotationsforrelationalalgebraexpressions.|Thisisthesecondoftwovideosabouttherelationalalgebra.|Inthefirstvideo,welearnedabouttheselectandprojectoperatorsinvarioustypesofjoins.|Thisvideowillcoversetoperators,uniondifferenceandintersection,therenamingoperator,anddifferentnotationsforexpressionsofrelationalalgebra.|Justasareminder,weapplyarelationalalgebraqueryorexpressiontoasetofrelationsandwegetasaresultofthatexpressionarelationasouranswer.|Forourexamples,we'reusinganimaginarydatabaseaboutcollegeadmissions.|Wehavearelationofcolleges,arelationofstudents,andarelationwithinformationaboutstudentsapplyingtocolleges.|We'llkeepatthebottomofthevideothesethreedepictionsofthoserelationswithafewabbreviationsusedsothatnamesaren'ttoolong.|Let'smoveaheadtoourfirstoperator.|Thefirstofthreesetoperatorsistheunionoperator,andit'sastandardsetunionthatyoulearnedaboutinelementaryschool.|Let'ssuppose,forexample,thatwewantalistofthecollegeandstudentnamesinourdatabase.|Sowejustwantthoseaslist.|Forexample,wemightwantStanfordandSusanandCornellandMaryandJohnandsoon.|Nowyoumightthinkwecangeneratethislistbyusingoneoftheoperatorswe'vealreadylearnedforcombininginformationfrommultiplerelations,suchasthecross-productoperatororthenaturaljoinoperator.|Theproblemwiththoseoperatorsisthattheykindofcombineinformationfrommultiplerelationshorizontally.|TheymighttakeatupleT1fromonerelationandtupleT2fromtheotherandkindofmatchthem.|Butthat'snotwhatwewanttodohere.|Wewanttocombinetheinformationverticallytocreateourlist.|Andtodothatwe'regoingtouseistheunionoperator.|Soinordertogetalistofthecollegenamesandthestudentnames,we'llprojectthecollegenamefromthecollegerelation.|Thatgivesusalistofcollegenames.|We'llsimilarlyprojectthestudentnamefromthestudentrelation,andwe'vegotthosetwolistsandwe'lljustapplytheunionoperatorbetweenthemandthatwillgiveusourresult.|Now,technically,inrelationalalgebrainordertouniontwoliststheyhavetohavethesameschema,thatmeansthatsameattributenameandthesedon't,butwe'llcorrectthatlater.|Fornow,yougetthebasicideaoftheunionoperator.|Ournextsetoperatoristhedifferenceoperator,andthisonecanbeextremelyuseful.|Asanexample,let'ssupposewewanttofindtheIDsofstudentswhodidn'tapplytoanycolleges.|Itsoundslikeacomplicatedquery,butwe'llactuallywriteitinaverysimplefashion.|We'llstartbyprojectingthestudentIDfromthestudentrelationitselfandthatwillgiveusallofthisstudentIDs.|ThenletsprojectthestudentIDfromtheapplyrelationandthatgivesustheIDsofallstudentswhohaveappliedsomewhere.|Allweneedtodoistakethedifferenceoperator,writtenwiththeminussign,andthatgivesustheresultofourquery.|ItwilltakeallIDsofthestudentsandthensubtracttheoneswhohaveappliedsomewhere.|Supposeinsteadthatwewantedthenamesofthestudentswhodidn'tapplyanywhere,notjusttheirIDs.|Sothat'salittlebinary digitmorecomplicated.|Youmightthink,"Oh,justaddstudentnametotheprojectionlisthere,"butifwedothat,thenwe'retryingtosubtractasetthathasjustIDsfromasetthathasthepairofIDnames.|Andwecan'thavethestudentnameherebecausethestudentnameisn'tpartoftheapplyrelation.|Sothereisanicetrick,however,that'sgoingtodowhatwewant.|Letmeerasethesehere.|Whatwe'regoingtodoiswe'regoingtotakethiswholeexpressionherewhichgivesusthestudentIDswhodidn'tapplyanywhereandwatchthis.|Prettyclever.|We'regonnadoanaturaljoinwiththestudentrelation.|Andnow,that'scalledajoinback.|Sowe'vetakentheIDs,acertainselectsetofIDsandwe'vejoinedthembacktothestudentrelation.|That'sgoingtogiveusaschemathat'sthestudentrelationitself,andthenwe'rejustgoingtoaddtothataprojectionofthestudentname.|Andthatwillgiveusourdesiredanswer.|Thelastofthethreesetoperatorsistheintersectionoperator.|Solet'ssupposewewanttofindnamesthatarebothacollegenameandastudentname.|Soperhaps,Washingtonisthenameofastudentandacollege.|Tofindthose,we'regoingtodosomethingsimilartowhatwe'vedoneinthepreviousexamples.|Let'sstartbygettingthecollegenames.|Thenlet'sgetthestudentnames,andthenwhatwe'regoingtodoisjustperformanintersectionofthosetwoexpressionsandthatwillgiveustheresultthatwewant.|Nowlikeourpreviousexample,technicallyspeaking,thetwoexpressionsonthetwosidesoftheintersectionoughttohavethesameschemaandagain,I'llshowyoujustalittlebinary digitlater,howwetakecareofthat.|Now,itturnsoutthatintersectionactuallydoesn'taddanyexpressivepowertoourlanguageandI'mgoingtoshowthatactuallyintwodifferentways.|Thefirstwayisthatifwehavetwoexpressions,let'ssayE1andE2andweperformtheirintersection,thatisexactlyequivalenttowritingE1minus,usingthedifferenceoperator,E1minusE2.|Nowifyou'renotconvincedofthatimmediately,let'sgobacktoVenndiagrams,againaconceptyouprobablylearnedearlyinyourschooling.|Solet'smakeapictureoftwocircles.|Andlet'ssaythatthefirstcircleCirclerepresentstheresultofexpressionE1andthesecondrearcirclerepresentstheresultofexpressionE2.|NowifwetaketheentirecircleE1.|Let'sshadethatinpurple.|Andthenwetaketheresult,sothat'sE1here,andthenwetakeE1,theresultoftheexpressionE1minusE2here,we'llwritethatingreen,sothat'severythinginE1that'snotinE2,that'sthis.|Okay?|Andifwetakethepurpleminusthegreenyouwillseethatweactuallydogettheintersectionhere.|Sothat'sasimplepropertyofsetOperationsbutwhatthat'stellingusisthatthisintersectionoperatorhereisn'tgivingusmoreexpressivepowerbecauseanyexpressionthatwecanwriteinthisfashion,wecanequivalentlyrightwiththedifferenceoperatorinthisfashion.|Letmeshowyouacompletelydifferentwayinwhichintersectiondoesn'taddanyexpressivepower.|So,let'sgobacktoE1intersectE2andasareminderforthistobecompletelycorrectthesehavetohavethesameschemaasequalbetweenthetwo.|E1intersectE2turnsouttobeexactlythesameasE1naturaljoinE2inthisparticularcasebecausetheschemaisthesame.|Rememberwhatnaturaljoindoes.|Naturaljoinsaysthatyoumatchupallcolumnsthatareequalandyoueliminateduplicatevaluesofcolumns.|SoI'lljustletyouworkoutforyourselfthatthisisindeedanequivalenceandasecondreasonthattheintersectiondoesn'taddanyexpressivepower.|Nevertheless,theintersectioncanbeveryusefultouseinqueries.|Ourlastoperatoristherenameoperator.|Therenameoperatorisnecessarytoexpresscertainqueriesinrelationalalgebra.|Letmefirstshowtheformoftheoperatorandthenwe'llseeitinuse.|TherenameoperatorusestheGreeksymbolrho.|Andlikeallofourotheroperators,itappliestotheresultofanyexpressionofrelationalalgebra.|AndwhattherenameoperatordoesisitreassignstheschemaintheresultofE.SowecomputeE,wegetarelationasaresult,anditsaysthatI'mgoingtocalltheresultofthat,relationRwithattributesA1throughAnandthenwhenthisexpressionitselfisembeddedinmorecomplexexpression,wecanusethisschematodescribetheresultoftheE.Againwe'llseeshortlywhythat'suseful.|Thereareacoupleoftheabbreviationsthatareusedintherenameoperator,thisformisthegeneralformhere.|OneabbreviationisifwejustwanttousethesameattributenamesthatcameoutofE,butchangetherelationname,wewriterowsubRappliedtoE,andsimilarly,ifwewanttousejusttheattributenames,ifwewanttochange,I'msorry,justtheattributenamesthenwewriteattributelisthereanditwouldkeepthesamerelationname.|Thisformofcoursehastohavealistofattributesorwewouldnotbeabletodistinguishitfromthepreviousform.|Butagainthesearejustabbreviationsandthegeneralformistheoneuphere.|Okay,sonowlet'sseetherenameoperatorinuse.|ThefirstuseoftherenameoperatorissomethingIalludedtoearlierinthisvideowhichisthefactthatwhenwedothesetoperators,theunion,difference,andintersectoperators,wedoexpecttheschemasonthetwothesidesoftheoperatortomatch,andinacoupleofourexamplestheydidn'tmatch,andtherenameoperatorwillallowustofixthat.|So,forexample,ifwe'redoingthelistofcollegeandstudentnames,andletmejustremindyouhowwewrotethatquery.|WetooktheCnamefromcollegeandwetookthesnamefromstudentsandwedidthebigunionofthose.|Now,tomakethistechnicallycorrect,thesetwoattributenameswouldhavetobethesame.|Sowe'rejustgoingtoapplytherenameoperator.|Let'ssaythatwe'regonnarenametheresultofthisfirstexpressiontosaytherelationnameCwithattributename.|Andlet'smaketheresultofthesecondexpressionsimilarlybetherelationCwithattributename.|Andnowwehavetwomatchingschemasandthenwecanproperlyperformtheunionoperator.|Again,thisisjustasyntacticnecessitytohavewell-formedrelationalalgebraexpressions.|Now,theseconduseoftherenameoperatorisalittlemorecomplicatedandquiteabinary digitmoreimportantactuallywhichisdisambiguationinselfjoinsandyouprobablyhavenoideawhatI'mtalkingaboutwhenIsaythat,butletmegiveanexample.|Let'ssupposethatwewantedtohaveaquerythatfindspairsofcollegesinthesamestate.|Now,thinkaboutthat.|Sowewanttohave,forexample,StanfordandBerkeleyandBerkeleyandUCLAandsoon.|Sothat,asyoucansee,unliketheunionoperator,we'relookingforthishorizontaljoininghere.|Sowe'regoingtohavetocombineessentiallytwoinstancesofthecollegerelation.|Andthat'sexactlywhatwe'regoingtodo.|We'reeffectivelygoingtodocollegejoincollegemakingthestateequal.|So,let'sworkonthatalittlebinary digit.|So,whatwewannadoiswewannahavecollegeandwewantto,let'sjuststartwith,say,thecross-productofcollege.|Andthenwewanttosomehowsay,"Well,thestateequalsthestate."|Butthat'snotgonnawork.|Whichstatearethese?|Andhowdowedescribethetwoinstancesofcollege?|Sowhatwe'regoingtodoandletmejusterasethis,iswe'regoingtorenamethosetwoinstancesofcollegessotheyhavedifferentnames.|Sowe'regoingtotakethefirstinstanceofcollegehereandwe'regoingtoapplyarenameoperatortothat.|Andwe'llcallitC1andwe'llsaythatthathasname1,state1,andenrollment1.|Andthenwe'lltakethesecondinstancehere.|We'llcallitC2,soN2,S2,E2ofcollegeandnowwehavetwodifferentrelations.|Sowhatwecandoiswecantakethecross-productofthosetwolikethat,andthenwecanselectwhereS1equalsS2,okay?|Andthatgivesuspairsofcollegeinthesamestate.|Actually,letmeshowyouaneventrickier,simplerwayofdoingthis.|Let'stakeawaytheselectionoperatorhere,okay?|Andlet'stakeawaythis.|Andlet'smakethisintoanaturaljoin.|Nowthat'snotgonnaworkquiteyetbecausethenaturaljoinrequiresattributenamestobethesame,andwedon'thaveanyattributenamesthatarethesame.|Sothelastlittletrickwe'regonnadoiswe'regonnamakethosetwoattributenames,S,bethesame.|Andnowwhenwedothenaturaljoin,it'sgonnarequireequalityonthosetwoS'sandeverythingisgonnabegreat.|Okay?|Now,thingsarestillalittlebinary digitmorecomplicated.|Oneproblemwiththisqueryisthatwearegoingtogetcollegespairedwiththemselves.|Sowe'regoingtogetfromthis,forexample,StanfordStanford.|Ifyouthinkaboutit,right?|BerkeleyBerkeley,aswellasStanfordBerkeley.|Now,that'snotreallywhatwewantpresumably.|Presumablyweactuallywantdifferentcolleges.|butthat'sprettyeasytohandle,actually.|Let'sputaselectionconditionheresothatthenameoneisnotequaltonametwo.|Great.|Wetookcareofthat.|SointhatcasewewillnolongergetStanfordStandfordandBerkeleyBerkeley.|Ah,butthere'sstillonemoreproblem.|We'llgetStanfordBerkeleybutwe'llalsogetBerkeleyStanford.|Now,letmepauseforamomentandseeifyoucanthinkofasimplewaytosolvethisproblem.|Actually,there'sasurprisinglysimpleway,kindofclever.|We'regonnatakeawaythisnotequalsandwe'regoingreplaceitwithalessthan.|Andnowwe'llonlygetpairswherethefirstoneislessthanthesecond.|SoStanfordandBerkeleygoesawayandwegetBerkeleyStanford.|Andthisisourfinalqueryforwhatwewantedtodohere.|NowwhatIreallywantedtoshow,asidefromsomeoftheusesofrelationalalgebra,isthefactthattherenameoperatorwasforthisqueryabsolutelynecessary.|Wecouldnothavedonethisquerywithouttherenameoperator.|Nowwe'veseenalltheoperatorsofrelationalalgebra.|BeforewewrapupthevideoIdidwanttomentionthattherearesomeothernotationsthatcanbeusedforrelationalalgebraexpressions.|Sofarwe'vejustbeenwritingourexpressionsinastandardformwithrelationnamesandoperatorsbetweenthosenamesandapplyingtothosenames.|Butsometimespeopleprefertowriteusingamorelinearnotationofassignmentstatementsandsometimespeopleliketowritetheexpressionsastrees.|SoI'mjustgonnabrieflyshowacoupleofexamplesofthoseandthenwe'llwrapup.|Soassignmentstatementsareawaytobreakdownrelationalalgebraexpressionsintotheirparts.|Let'sdothesamequerywejustfinishedasabigexpressionwhichisthepairsofcollegesthatareonthesamestate.|We'llstartbywritingtwoassignmentstatementsthatdotherenameofthetwoinstancesofthecollegerelation.|Sowe'llstartwithC1colonequalsandwe'llusearenameoperatorandnowweusetheabbreviatedformthatjustlistsattributenames.|Sowe'llseesayCone,S,Eoneofcollegeandwe'llsimilarlysaythatC2getstherename,andwe'llcallitC2SE2ofcollege,andrememberweusethesameSheresothatwecandothenaturaljoin.|So,nowwe'llsaythatcollegepairsgetsC1naturaljoinC2,andthenfinallywe'lldoourselectioncondition.|SoourfinalanswerwillbetheselectionwhereN1islessthanN2ofCP.|Andagain,thisisequivalenttotheexpressionthatwesawontheearlierslide.|It'sjustanotationthatsometimespeopleprefertomodularizetheirexpressions.|ThesecondalternatenotationI'mgoingtoshowisexpressiontrees.|Andexpressiontreesareactuallycommonlyusedinrelationalalgebra.|Theyallowyoutovisualizethestructureoftheexpressionalittlebinary digitbetter.|AndasitturnsoutwhenStructured Query Languageiscompiledindatabasesystems,it'softencompiledintoanexpressiontreethatlooksverymuchlikewhatI'mgonnashowyourightnow.|Soforthisexamplelet'ssupposethatwewanttofindtheGPAsofstudentswhoareapplyingtoComputer ScienceinCalifornia.|Sothat'sgoingtoinvolveallthreerelationsbecausewe'relookingatthestateisinCalifornia,andwe'relookingatthestudentGPA'sandwe'relookingatthemapplyingtoComputer Science.|Sowhatwe'regoingtodoiswe'regoingtomakealittletreenotationherewherewe'regoingtofirstdothenaturaljoinofthesethreerelations.|SotechnicallytheexpressionI'mgoingtoshowyouisgoingtostopdownhere.|It'snotgoingtoactuallyhavethetables.|Sotheleavesoftheexpressionaregoingtobethethreerelations:college,students,andapply.|Andinrelationalalgebratrees,theleavesarealwaysrelationnames.|Andwe'regoingtodothenaturaljoinofthosethreewhichasareminderenforcesequalityofthecollegenameagainstthecollegenamehereagainstthecollegenamehere,andthestudentIDhereandthestudentIDhere.|Thatenforcementmeansthatwegettriplesthataretalkingaboutastudentapplyingtoaparticularcollege.|Andthenwe'regoingtoapplytothat,andsothat'sgoingtobewrittenasanewnoteabovethisoneinthetree.|TheselectionconditionthatsaysthatthestateequalsCaliforniaandthemajorequalsComputer Science.|Andfinally,we'llputontopofthattheprojectionthatgetstheGPA.|okay?|Nowactuallythisexpressionisexactlyequivalenttoifwewroteitlinearly,projecttheGPA,selectetc.|ofthethreecollegejoinstudent,joinapply.|I'mjustabbreviatinghere.|Thatwouldbeanequivalentexpression.|Butagain,peopleoftenliketousethetreenotationbecauseitdoesallowyoutovisualizethestructureoftheexpression,anditisusedinsideimplementationsoftheStructured Query Languagelanguage.|Letmefinishupbysummarizingrelationalalgebra.|Let'sstartwiththecoreconstructsofthelanguage.|Soarelationnameisaqueryinrelationalalgebra,andthenweuseoperatorsthatcombinerelationsandfilterrelations.|Sowehavetheselectoperatorthatappliesaconditiontotheresultofanexpression.|Wehavetheprojectoperatorthatgivesusasetofattributesthatwetakefromtheresultofanexpression.|Wehavetheexpressiononecross-productexpressiontwo.|Andagainthosecanbeanyexpressions.|Thenwehaveexpressiononeunionexpressiontwo.|Andwehaveexpressiononeminusexpressiontwo.|Andfinallywehavetherenameoperatorthattakesanexpressionandrenamestheresultofthat,theschemaintheresultofthatexpression.|Now,youprobablynoticedthatIskippedafewofourfavoriteoperators,butthisisthecoreofthelanguageandalltheotheroperatorsareactuallyabbreviationsthatdon'tincreasetheexpressivepowerofthelanguagebuttheycanbeveryusefulperformingqueries.|Andtheabbreviationsthatwelearnedwereexpressiononenaturaljoinexpressiontwo.|Theywereexpressiononethetajoinexpressiontwo.|And,finally,expressiononeintersectexpressiontwo.|Allofthosewherewehadamethodofrewritingthemusingthecoreoperators.|Justasmallasideaboutparentheses.|Aparenthesesareusedinrelationalexpressionsfor,relationalalgebraicexpressions,fordisambiguation,similarlytoarithmeticexpressions.|IwasalittlecavalieraboutwhetherIincludedparenthesesornot,butasyouwriteyourrelationalalgebraexpressionsyouwillseethatit'sprettystraightforwardtofigureoutwhendisambiguationisneeded.|Sotoconcluderelationalalgebra,entirelyit'saformallanguage.|It'sbasedonsets,setoperatorsandotheroperatorsthatcombinedatafrommultiplerelations.|Ittakesrelationsasinput,itproducesrelationsasanswersanditdoesformtheformalfoundationofimplementedrelationaldatabasemanagement.|ThisvideoprovidesanintroductiontotheStructured Query Languagequerylanguage.|Structured Query Language,liketherelationalmodel,hasbeenaroundfordecadesandsupportsamanybilliondollarmarket.|Thefirstthingyoumightbewonderingishowyoupronounceit.|Isit"Structured Query Language,"orisit"sequel"?|Myfriendsinindustrytellmethat"sequel"istheinpronunciation,sothat'stheoneI'llbeusing.|NowStructured Query Languageissupportedbyallmajorcommercialdatabasesystems.|Ithasbeenaroundalongtimeanditisastandardizedlanguage.|Thestandardstartedoutrelativelysimplebutoverthedecadesit'sreallyballooned.|TherearecurrentlythousandsofpagesintheStructured Query Languagestandard.|Buttheessenceofthelanguage,whichiswhatwe'llbelearninginthesevideos,isstillrelativelysimple.|WewillbelearningprimarilytheSQL2standardalsoknownasStructured Query Language92alongwithsomeconstructsfromtheSQL3standard.|WhenStructured Query Languageisused,itcanbeusedinadatabasesysteminteractivelythroughagraphicaluserinterfaceorapromptsoyoutypeStructured Query Languagequeriesorcommandsandyougetresultsback,orStructured Query Languagecanbeembeddedinprograms.|So,themostcommonuseistoembedStructured Query Languageinprogramsbutforthedemosinourvideos,naturally,we'llbesubmittingqueriesthroughaGraphical User Interfaceinterface.|ThelastthingIwantedtomentionaboutStructured Query Languageisthatitisadeclarativelanguage.|ThatmeansthatinStructured Query Language,you'llwriteprettysimplequeriesthatsayexactlywhatyouwantoutofthedatabase,andthequeriesdonotneedtodescribehowtogetthedataoutofthedatabase.|Thelanguageisalsobasedonrelationalalgebra,andIhopeyou'vewatchedtherelationalalgebravideos.|Now,thedeclarativenatureofStructured Query Languageleadstothecomponentofthedatabasesystemcalledthequeryoptimizertobeextremelyimportant.|WhatthequeryoptimizerdoesisittakesaquerywritteninaStructured Query Languagelanguageanditfiguresoutthebestway,thefastestway,toexecutethatonthedatabase.|Nowlet'stalkbrieflyfullyaboutsometerminologyandthecommandsthatareintheStructured Query Languagelanguage.|There'stwopartsofthelanguage,theDataDefinitionLanguageorData Definition Language,andtheDataManipulationorDefinitive Media Library.|TheDataDefinitionLanguageincludescommandstocreateatable.|Wesawthatinapreviousvideo.|Italsoincludescommandstodroptableandtocreateanddropotheraspectsofdatabasesthatwe'llbelearningaboutinlatervideos,suchasindexesandviews.|TheDataManipulationLanguageisthelanguagethat'susedtoqueryandmodifythedatabase.|SointheStructured Query LanguagelanguagetheDataManipulationLanguageincludesforqueryingthedatabase,theselectstatementandthenformodifyingthedatabase:aninsertstatement,adeletestatement,andanupdatestatement.|TherearemanyothercommandsinStructured Query Languageforindexes,constraints,views,triggers,transactions,authorization,allofwhichwe'llbelearningaboutinlatervideos.|Fornow,let'sjusttakealookinalittlemoredetailattheselectstatementwhichisreallythebreadandbutteroftheStructured Query Languagelanguageandit'swhatweusetoquerythedatabase.|Sotheselectstatementconsistsofthreebasicclauses.|There'stheSELECTclause,theFROMclauseandtheWHEREclause.|Thebestordertothinkoftheseactually,isfirsttheFROMclause,thentheWHEREandthentheSELECTandjustthebasicideaisthattheFROMidentifiestherelationsthatyouwanttoqueryover,theconditionisusedtocombinetherelationsandtofiltertherelations.|Andfinally,theSELECTtellsyouwhattoreturn.|Now,ifyou'refamiliarwithrelationalalgebra,thisexpressionhere,thisStructured Query Languagequery,isequivalenttotherelationalalgebraexpressionthatyouprojectthesetofattributesA1throughAN.|Andthenyouselectand,bytheway,it'sdifferentfromthisselecthere.|Infact,thisselectioncorrespondstotheWHERE.|Youselecttheconditiononthecross-productoftherelationsthatarelistedinthefromclause.|Sothat'stheequivalentinrelationalalgebra.|AndthelastthingIwantedtomentionisthat,asyouknow,therelationalquerylanguagesarecompositional.|Thatmeanswhenyourunaqueryoverrelations,yougetarelationasaresult.|Sotheresultofthisselectstatementisarelation.|Itdoesn'thaveanamebuttheschemaofthatrelationisthesetofattributesthatarereturned.|We'lllearnmuchmoreabouttheSELECTstatementinfuturevideos.|Inconclusion,theStructured Query Languagelanguageisveryprominent.|It'ssupportedbyallmajorcommercialdatabasesystems.|It'sbeenstandardizedovertime.|Itcanbeusedthroughprograms.|Itcanbeusedinteractivelyandit'sadeclarativehigh-levellanguagewhosefoundationsarebasedontherelationalalgebra.|Thisisthefirstofsevenvideoswherewe'regoingtolearntheStructured Query Languagelanguage.|ThevideosarelargelygoingtobelivedemosofStructured Query Languagequeriesandupdatesrunningonanactualdatabase.|ThefirstvideoisgoingtofocusonthebasicsoftheSELECTstatement.|Asareminder,theSELECTstatementselectsasetofattributesfromasetofrelationssatisfyingaparticularcondition.|Wewillseeinthedemothatevenwiththethesethreeclauses,wecanwritequitepowerfulqueries.|Allofthesevendemosaregoingtobeusingthesimplecollegeadmissionsdatabasethatwelearnedaboutintherelationalalgebravideos.|Asareminder,wehavethreerelations.|Wehavethecollegerelation:collegerelationcontainsinformationaboutthenameofthecolleges,thestate,andtheenrollmentofthosecolleges.|Wehavethestudentrelation,whichcontainsstudentIDs,theirnames,theirGPA,andthesizeofthehighschoolthattheycomefrom.|Andfinally,theapplicationinformation,thattellsusthataparticularstudentappliedtoaparticularcollegeforaparticularmajorandtherewasadecisionofthatapplicationNowasareminder,intherelationalmodel,whenweunderlineattributes,thatmeanswe'redesignatingakeyfortherelation.|So,theunderlyingattributesinourexamplesaythattheknowledgenameisgoingtobeuniquewithinthecollegerelation.|Thestudent'sideaisuniquewithinthestudentrelationandintheappliedrelation,thecombinationofthesethreeattributesisunique.|Thatmeansthatstudentcan,ifheorshewishes,applytoacollegemanytimes,orapplyforamajormanytimes,butcanonlyapplytoacollegeforaparticularmajoronce.|Let'sturntothedemo.|Let'sstartbylookingattheactualdatathatwe'regoingtobequeryingover.|Wehaveasetoffourcolleges:Stanford,Berkeley,Massachusetts Institute of TechnologyandCornell.|Wehaveabunchofstudents.|Andareminder,eachstudenthasanID,aname,aGPA,andasizeofhighschool.|Andfinally,wehaveasetofapplicationrecordswhereastudentwithaparticularIDappliestoacollegeforaparticularmajor,andthere'sayesornodecisiononthatapplication.|Solet'sgotoourfirstStructured Query Languagequery.|ThisqueryisgoingtofindtheID,name,andGPAofstudentswhoseGPAisgreaterthan3.6.|So,verysimple,it'sthebasicSELECTFROMWHEREstructure.|TheSELECTgivesourtablename,theWHEREgivesourfilteringconditionandtheSELECTtellsuswhatwewanttogetoutofthequery.|We'llexecutethatqueryandwewillfindhereallofourstudentswithaGPAgreaterthan3.6.|Now,it'snotnecessarytoincludetheGPAintheresulttothequeryevenifwefilterontheGPA.|So,IcouldjusttakeGPAawayfromtheSELECTclause,runthequeryagainandnow,weseethesameresultbutwithouttheGPA.|Okay.|Let'sgotooursecondquery.|Oursecondqueryisgoingtocombinetworelations.|Inthisquery,we'regoingtofindthenamesofthestudentsandthemajorsforwhichthey'veapplied.|So,now,we'reinvolvingboththestudenttableandtheapplytableandtheconditionweseehereisthejoinconditionthattellsuswewanttocombinestudentswithapplyrecordsthathavethesamestudentID.|Thisiswhatwouldhappenautomaticallyinanaturaljoinoftherelationalalgebra,butinStructured Query Languageweneedtoalwayswritethejoinconditionexplicitly,andfinallywegetthestudentnameandthemajor.|Andifweexecutethequery,weget,expectedly,abunchofstudentsandthemajorsthatthey'veappliedfor.|Now,wedonoticeherethatwehaveseveralduplicatevalues.|WehavetwocopiesofAmyapplyingtoComputer ScienceandtwocopiesofCraigapplyingtoBio-Engineering.|Aswediscussedintherelationalalgebravideo,inrelationalalgebrawhichunderliesStructured Query Language,it'sbydefaultthesetmodel;wedon'thaveduplicates.|ButintheStructured Query Languagelanguagewedohaveduplicates,it'sbasedonamulti-setmodel.|Ifwedon'tliketheduplicatesinourresultsStructured Query Languageprovidesusaconvenientwaytogetridofthem.|Wesimplyaddthekeyword,"distinct",toourqueryaftertheword,"select",weexecute,andnowwegetthesameresultbutwiththeduplicatevalueseliminated.|Ournextqueryisgoingtobealittlemorecomplicated;it'sgoingtofindthenamesandGPAsofstudentswhosesizehighschoolislessthanathousand,they'veappliedtoComputer ScienceatStanford,andwe'regoingtogetthedecisionassociatedwiththat.|Soagainwehavetworelations,twotablesinvolved,thestudentandtheapply.|Wehavethejoincondition,makingsurewe'retalkingaboutthesamestudentandthestudentandapplytuples.|Veryimportanttorememberthatone.|Wearegoingtofiltertheresultbasedonsizehighschool,major,andthecollegetowhichthey'reapplying.|Solet'srunthisqueryandwewillseetheresultthatwehavetwostudentswhohaveappliedtoComputer ScienceatStanfordfromasmallhighschool.|Ournextqueryisagainajoinoftworelations.|Thistimewe'regoingtofindalllargecampusesthathavesomeoneapplyingtothatcampusinComputer Science.|Sothistimewe'regoingtojointhecollegetableandtheapplytable.|Andagain,weneedtobecarefultomakesureweonlyjointuplesthataretalkingaboutthesamecollege.|Sowehavecollege.cnameequalsapply.cname.|Wehaveanenrollmentthat'sgreaterthan20,000andamajorthatequalsComputer Science.|Let'srunthisquery.|Oops,wegotanerror!|Well,actuallyIknewthatwascoming,butIwantedtoshowyouwhathappenshere.|Sotheerroristhatwehaveanambiguouscolumnname,andthat'stheonerighthere,theCname.|SoIhaven'tpointeditoutexplicitly,butwheneverI'vereferredtoattributeswherethere'sanattributefrombothoftherelationswe'requerying,Iprefaceditwiththenameoftherelationthatwecaredabout,thecollegehereintheapply.|Sotheattributenamehereintheselectclauseisactuallyambiguousbecausethere'saCnameattributeincollegeandthere'sonethereinapply.|Nowwehappentosetthoseequal,butinorderforthequerytoactuallyrunwehavetochooseSolet'sjustsaywe'regoingtotakethatCnamefromcollege.|Now,everythingshouldbefine,andherewego.|SothosearethecollegeswherewehaveatleastoneComputer Sciencemajorandtheirenrollmentisgreaterthan20,000.|Again,weseeduplicatessoifwedon'tlikethetwocopiesofBerkeley,wesimplyadddistinctandwerunthequeryagain.|AndnowwehaveBerkeleyandCornell.|Now,let'sdoaquerywithabiggerresult.|Thistimewe'refinallygoingtojoinallthreeofourrelations.|Student,collegeandapply.|Andwe'regoingtoapplythejointconditionsthatensurethatwe'retalkingaboutthesamestudentandthesamecollege.|Andthenfromtheresultofthatbigcross-product,thatbigjoin,we'regoingtogetthestudentID,theirname,theirGPA,thecollegethatthey'reapplyingtoandtheenrollmentofthatcollege.|Sojustawholebunchofinformationassociatedwiththisstudents'applications.|Andweexecutethisandherewegettheresultwithalltheattributesthatweaskedfor.|Now,onethingIhaven'tmentionedyetistheorderoftheresultsthatwegetwhenwerunStructured Query Languagequeries.|SOStructured Query Languageis,atitsheart,anunorderedmodel.|Thatmeansthatwecangettheresultsofourqueriesinanyorder,andinfact,wecouldrunaquerytodayandgetourresultsinaparticularorder.|Andthenrunthequerytomorrowandgetadifferentorder.|Andthat'spermittedwiththespecificationofStructured Query Languageonrelationaldatabases.|IfwecareabouttheorderofourresultStructured Query Languageprovidesaclausethatwecanaskforaresulttobesortedbyaparticularattributeorsetofattributes.|Solet'ssaywewantourapplicationinformationheresortedbydescendingGPA.|Thenweaddanotherclausecalledtheorderbyclause.|Wetelltheattributewe'dliketobeorderingbyandthenifwewantittobedescendingwewriteDESC.|Thedefaultbehaviorisactuallyascending.|SoifwerunthisquerynowwegetourresultsbydescendingtheGPAweseeallthe3.9's,3.8,3.7,andsoforth.|Nowwemightstillwanttofurthersortwithinallthe3.9sifwewanttodothatwecanspecifyanotherattributetosorteachgroupby.|So,forexample,ifwedecidefromthatwewanttosortbyenrollmentandascending,wewon'tputanythingbecauseascendingisthedefault.|Andweexecute.|NowwestillhaveGPAasdescendingasourprimarysortorderandthenwithineachofthosewillbesortingbyascendingenrollment.|Thisqueryintroducesthelikepredicate.|Likeisabuilt-inoperatorinStructured Query Languagethatallowsustodosimplestringmatchingonattributevalues.|Let'ssuppose,forexample,thatwewantedtofindallstudentswhowereapplyingforamajorthathadtodowithbio.|Insteadoflistingallthebiologymajorswecansimplypatternmatchthemajoragainstthespecialstringherewhichsays,matchanymajorwherethere'ssomesetofcharacters,followedbybio,followedbysomesetofcharactersweexecutethequery,andwe'llfindthestudentswhohaveappliedforvariousbiotypemajors.|Now,Iwanttointroduceanotherconstruct.|I'mgoingtousethesamequerytodoit,whichistheconstructselectstar.|Sofar,we'vealwayslistedexplicitlytheattributesthatwewanttogetintheresultofaquery.|Butifwesimplywanttogetallattributes,thenwecanjustwriteselectstar.|Andwhenwedothat,wedon'tprojectawayanyattributes,butwegetalltheattributesintheresultofthefromandwhereexpression.|Whilewe'reatit,let'sdoagiganticquery.|We'lljustdothecross-productandstudentcollegewithoutanycombination,andwe'lldoselectstartogetalltheattributesout.|So,heregoes,andyoucansee,wegetalltheattributesandwegetawholelotoftuplesaswell.|OurlastqueryisgoingtodemonstratetheabilitytousearithmeticwithinStructured Query Languageclauses.|SoweseehereaquerythatselectsalltheinformationfromthestudentrelationbutaddstoitascaledGPAwherewe'regoingtoboostthestudent'sGPAifthey'refromabighighschoolandreduceitifthey'refromasmallone.|Specifically,we'lltaketheirGPA,multiplyitbythesizehighschooldividedbyathousand.|So,let'srunthisqueryandyoucanseethatwehavethewholestudenttableherewithanadditionalcolumnthathasscaledtheirGPAbasedonthesizeoftheirhighschool.|Now,ifwedon'tlikethelabelonthiscolumn,wecouldchangeitandsoI'llusethisqueryasanexampletodemonstratethe'as'featurewhichallowsustochangethelabelingoftheschemainaqueryresult.|Let'ssayasscaledGPA,andweshouldgetthesameresultwithamorenicelylabeledattribute.|Thatconcludesourvideointroducingthebasicselectstatement.|We'llseemanyotherfeaturesintheupcomingsixvideosonStructured Query Language.|Inthisdemo,we'llbelearningsomemorefeaturesoftheStructured Query Languagelanguage.|Specifically,we'llbelearningabouttablevariablesandaboutsetoperators.|Wealreadylearnedthebasicselectstatement.|whichcanbequitepowerfulforwritingqueriesbutwe'lllearnsomeconstructsinthesedemosthatwillgiveusevenmoreexpressivepower.|Thefirstconstructistablevariables.|TablevariablesareintheFROMclause,andtheyactuallyservetwouses.|Oneissimplytomakequeriesmorereadable,aswe'llsee.|ButasecondpurposeistorenamerelationsthatareusedintheFROMclause,particularlywhenwehavetwoinstancesofthesamerelation.|Thisisexactlywhatweneededintherelationalalgebrawhenwewrotejoinsthatincludedtwoinstancesofthesamerelation.|Thesecondconstructwe'llbelearning,actuallyasetofconstructs,inthisvideo,arethesetoperators.|Andwe'llbelearningthesamethreesetoperatorswehadinrelationalalgebra:theunionoperator,theintersectoperator,andtheexceptoperatorwhichistheminusoperator.|We'llbedoingademoandthedemowillusethesamecollegeadmissionsdatabasethatwe'vebeenusinginpreviousdemoswherewehavetablesaboutcollegeinformation,studentinformationandstudentsapplyingtocolleges.|Let'smovetothedemo.|Let'sstartwithabigjoinquerythatwe'llusetointroducetablevariables.|Thisqueryinvolvesallthreerelations.|Itjoinsthethreerelationsontheirsharedattributesandthenitselectsabunchofinformation.|Sohereweseetheresultofthatquery.|SothemainpointofthisqueryisnottheresultbutjusttoshowyouhowtablevariablesareusedintheFROMclause.|Wecanaddtwo,eachofourrelationnames,avariable.|We'lluseSforstudentandCforcollegeandAforapply.|Andtheneverywhereelseinthequery,insteadofwritingthefullrelationnamewecanjustusethevariable.|Inthiscasewe'renotchangingtheexpressiveness,we'renotchangingtheoutcomeofthequery,we'rereallyjustmakingitabinary digitmorereadableandwecandothesamethinghereinthisleftclause.|We'lltakeSandAandsoon.|Thenwe'llrunthequeryandwe'llgetexactlythesameresult,nochange.|Nowlet'slookatwheretablevariablesareactuallyuseful.|WhatwewanttogetinthisqueryisallpairsofstudentswhohavethesameGPA.|Thisiskindofsimilartotherelationalalgebraquerywedidwherewefoundallpairsofcollegesthatareinthesamestate.|Inordertodothatweneedtohavetwoinstancesofthestudentrelation.|Sowe'llcalloneinstance,S1,andwe'llcalltheotherinstanceS2.|AndtheFROMwilldothecross-productofthosetwo,soitwillconsidereveryeverypossiblepairofstudentsfromthestudentrelation.|Fromallthosepairs,we'lltakethepairswherethestudenthadthesameGPAandwillreturntheID,name,andGPAforeachofthetwostudents.|Solet'sgoaheadandexecutethequery;andherewecanseetheresult.|Now,thisresultisexactlywhatwewrote.|ItliterallyiseverypairofstudentsthathavethesameGPA,butitmightnotbewhatweintended.|AmyandAmy,thesamestudent.|WellAmyhasthesameGPAasherself,butmorelikelywejustwanteddifferentstudentswhohadthesameGPA.|Sotodothatwe'lladdanandthatsaysthesearetwodifferentstudents.|TheSIDsofthestudentsaredifferent.|Now,let'srunthequeryandseewhathappens.|Now,weseethatwenolongerhaveAmyandAmy,andeverystudentispairedwithadifferentstudent.|WedohavetwoAmy'shere,butdon'tbealarmed,thisAmyis123andthisAmyis654.|Sothingsarelookingquiteabinary digitbetter,butthere'sstillonethingthatwemightnotwantintheresultofthequerywhichisthatwehaveAmypairedwithDorisandthenwehaveDorispairedwithAmy.|Sowe'reactuallygettingeverypairofstudentstwiceinthetwodifferentorders.|Asitturnsout,that'sveryeasytofix.|Weonlyneedtoeraseonecharactertomakethatwork.|Maybeyoucanthinkaboutwhatthatcharacteris.|Hereitis.|Insteadoflookingatnotequals,we'lljustmakeitlessthan.|Andthenwe'llgeteverypairofstudentsonlyoncebecausewe'llalwaysbelistingtheonewiththesmallerSIDfirstandfinallywegettheanswerthatweprobablyintendedinthefirstplace.|Nowlet'stakealookatthesetoperatorsandwe'llstartwithunion.|Justlikeinourrelationalalgebravideolet'susetheunionoperatortogeneratealistthatincludesnamesofcollegestogetherwithnamesofstudents.|Sohere'sthequerythatwilldoitforusandwegoaheadandexecutethequeryandweseeourresult.|NowIlefttheschemaashavingtheCnameinthefirstpartoftheunionandtheSnameinthesecond.|Structured Query LanguageallowedmetodothatanditchosetousetheCnametolabeltheresult.|IfIwanttounifytheschemasofthetwosidesoftheunionandgiveanewlabelfortheresult,Iusethe"as"aswesawearlierforre-namingattributesintheresultofqueries.|SoI'lladd"asname"tobothsidesoftheunion,runthequery,andnowIseenameintheresult.|Nowonethingyoumighthavenoticedisthatthisresultisactuallysorted.|Wedidn'taskforittobesorted,butforsomereasonthesystemsorteditforus.|AndIcanactuallyexplainwhythathappened.|I'llalsomentionthatifIranthissamequeryonanothersystem,itmightnotcomeoutsorted.|Infact,itwillnotcomeoutsortedbecauseItriedit.|Here'sthedeal.|TheunionoperatorinStructured Query Languagebydefaulteliminatesduplicatesinitsresults.|SoifwehavetwoAmy's,whichinfactwedo,weonlygetoneAmyinourresult.|Andsimilarly,forCraig,wehavetwoofthoseaswell.|Sothat'sthedefault,anditsohappensthesystemI'musingtoday,whichiscalledSQLite,eliminatesduplicatesgetsbysortingtheresult.|So,itsortstheresult,looksforadjacentpairsthatarethesameandeliminatesallbutoneofthose,andthenitgivesustheanswer.|Butagain,Iwanttoemphasizethat'snotsomethingonecancountonwhenonerunsthesamequeryonadifferentsystemorevenonthesamesystemonadifferentday.|Now,ifwewanttohavetheduplicatesinourresult,that'ssomethingwecandoquiteeasily.|Weaddtounionthewordallthatwillturnthesetoperatorintowhat'stechnicallyamulti-setoperatorthatretainsduplicates.|Werunthequery.|Well,thefirstthingwenoticeisit'snotsortedanymore.|That'sbecauseitdidn'tneedtoeliminatetheduplicates.|Butifwelookclosely,we'llalsoseethattheduplicatesarenowthere.|WehavetwoAmys,forexample,andwehavetwoCraigsaswell.|Ifwewantthisresulttobesortedandtoguaranteethattheotherone'ssorted,wewouldaddanorderbyclause.|Sowecanjustsayorderbyname.|Werunthequeryandnowwehavetheresultinsortedorder.|Ournextquerydemonstratestheintersectoperator.|ThisqueryisgoingtogettheIDsofallstudentswhohaveappliedtobothComputer ScienceforamajorandEEforamajor.|So,verysimplequery.|WegettheIDsofstudentswhoappliedtoComputer Science,theIDsofstudentswhoappliedtoEE,andthenweperformtheintersectoperatorontheresultofthosetwoqueries.|Weexecuteit,andwefindthatthereareindeedtwostudentswhoappliedtoComputer ScienceandEE.|Somedatabasesystemsdon'tsupporttheintersectoperator.|Theydon'tloseanyexpressivepower.|Wejusthavetowriteourqueriesindifferentways.|So,thisnextqueryiscomputingexactlythesamething.|ThesIDsofstudentswhohaveappliedtobothComputer ScienceandEE,butthistimewe'redoingitbydoingtwoinstancesoftheapplyrelation.|Oneoftheseselfjoins,sowehavetousetablevariablesagain,sowetakeeverypairofapplytuples,welookatcaseswhereit'sthesamestudent,andinonecase,they'reapplyingforComputer Science,intheothercasethey'reapplyingforEE,andwe'llreturnthesIDofthosestudents.|Sowerunthequeryandwegetsortofthesameanswer,butnotexactly,becausewehaveawholebunchofduplicatesnowthatwedidn'tgetwhenwediditwithanintersectoperator.|Now,wheredidthoseduplicatescomefrom?|Let'stakealookattheapplyrelationitself.|Here,weseethatstudent123appliedtothatthereareindeedtwostudentswhoappliedtoComputer ScienceandEE.|Somedatabasesystemsdon'tsupporttheintersectoperator.|Theydon'tloseanyexpressivepower.|Wejusthavetowriteourqueriesindifferentways.|Sothisnextqueryiscomputingexactlythesamething,theSIDsofstudentswhohaveappliedtobothComputer ScienceandEE,butthistimewe'redoingitbydoingtwoinstancesoftheapplyrelation,oneoftheseselfjoins,sowehavetousetablevariablesagain.|Sowetakeeverypairofapplytuples,welookatcaseswhereit'sthesamestudent,andinonecase,they'reapplyingforComputer Science.|Intheothercase,they'reapplyingforEE,andwe'llreturntheSIDofthosestudents.|Sowerunthequeryandwegetsortofthesameanswer,butnotexactlybecausewehaveawholebunchofduplicatesnowthatwedidn'tgetwhenwediditwithanintersectoperator.|Nowwheredidthoseduplicatescomefrom?|Let'stakealookattheapplyrelationitself.|Hereweseethatstudent123appliedtoComputer ScienceandtoEEandtoComputer ScienceagainandtoEEagain.|Andwe'regonnagetallpairsof123tuples,whereonepairpairofthetuplesisComputer ScienceandtheotherisEE.|So,we'llgetComputer SciencewithEE,Computer SciencewithEEandsoon.|Goingbacktoourqueryresult.|Hereitis.|Wecanseethatwegotthefour123'swhenweranthequery.|Well,that'seasytogetridof.|Wejustwriteselectdistinctandthatwillgetridofduplicatesandnowwe'rebacktoouroriginalqueryresult.|NowinsteadoffindingstudentswhoappliedtobothComputer ScienceandEE,let'sfindstudentswhoappliedtoComputer SciencebutdidnotapplytoEE.|Forthatweneedthedifferenceoperator.|It'scalleddifferenceinrelationalAlgebra.|Sometimes,it'scalledminus.|Thewordthat'susedintheStructured Query Languagestandardisthewordexcept.|Sohere'sourquery.|WefindthestudentIDswhoappliedtoComputer ScienceandthenwetakeawayfromthosetheIDsofstudentswhoappliedtoEE.|WerunthequeryandwefindthattherearethreestudentswhoappliedtoComputer ScienceandnottoEE.|Somedatabasesystemsdon'tsupporttheexceptoperatoreitherandhere,thingsgetalittletricky.|So,let'strytorewritethatquerywithoutusingtheexceptoperator.|Soasareminder,wewanttofindstudentswhoappliedtoComputer SciencebutdidnotapplytoEE.|So,here'smyattemptatwritingthatquery.|Iagaindoaselfjoinofapplywithapply,andIfindallpairswhereit'sthesamestudentwe'retalkingaboutandthemajorinoneofthetuplesofComputer ScienceandthemajorintheotheroneisnotEE.|Well,itlooksprettygood.|Let'sseewhathappens.|Whoa,wegotalotofresults.|Okay,wellthat'sprobablyjustthatproblemwithduplicatesagain,solet'sjustadddistinctandgoforit.|Itstillseemslikealotofresults.|Let'sgobacktoourpreviousquerythatusesexceptandthenwefoundthattherewerethreestudentsintheresultwhereherewe'restillgettingfiveintheresult.|Well,ifwethinkaboutexactlywhatwewrote,whatwewroteisfindingallpairsofapplyrecordswhereit'sthesamestudentandtheyappliedtoComputer Scienceinoneofthepairsandtheydidn'tapplytoEEintheother.|So,itcouldbe,forexample,biologyorgeology.|Buttheproblemisthatwhenweconsiderthesepairs,thatdoesn'tmeanthere'snotanotherpairwiththesamestudentwheretheyappliedtoComputer ScienceandEE.|AllthisisactuallyfindingisstudentswhoappliedtoComputer Scienceandalsoappliedtoanothermajorthat'snotEE.|So,that'squitedifferentfromthequerywe'reshootingfor.|Andactually,theinterestingthingisthatwiththeconstructswe'veseensofarinStructured Query Language,it'snotpossibletowritethequerywehadearlierwithoutusingtheexceptoperator.|ButinlatervideoswewillseeadditionalconstructsinStructured Query Languagethatdoallowustowritethatquery.|ThisStructured Query Languagevideo,whichasusualwillconsistmostlyofrunninglivequeries,introducessub-queriesinthewhereclause.|Asusual,westartwithourbasicselectfromwhereexpression,andwe'regoingtoaddtoitnowtheabilityintheconditionpartoftheselectfromwhereexpressiontoincludesub-queries.|Sub-queriesarenested,selectstatementswithinthecondition,andwe'llseethey'reactuallyquitepowerful.|Asusual,we'llbeusingasampledemonstrationdatabasethatconsistsofcolleges,students,andstudentsapplyingtocolleges.|Asalways,we'llhaveourfourcolleges,abunchofstudents,andabunchofrecordsthatshowstudentsapplyingtocolleges.|Solet'slaunchrightintoourfirstquerythatshowsasub-queryinthewhereclause.|WhatthisqueryfindsistheID'sandnamesofallstudentswhohaveappliedtomajorinComputer Sciencetosomecollege.|Sohere'sthesub-queryinthewhereclause.|ThisexpressionrighthereinthewhereclausefindstheID'sofallstudentswhohaveappliedtomajorinComputer Science.|SonowwehavethatsetofID's,ourouterquerysayslet'stakefromthestudentsthosestudentswhoseIDisinthatset,andlet'sselecttheirIDandtheirname.|SowegoaheadandexecutethequeryandwefindoutthatfivestudentshaveappliedtomajorinComputer Science.|Nowweactuallycandothisquerywithoutasub-queryinthewhereclause.|Solet'stakealook.|Wecandoitinsteadbyjoiningthestudentrelationwiththeapplyrelation.|Soherewedowhatwelearnedinpreviousvideos.|Wetakestudentandapply,wewritethejoinedconditiontomakesurewe'retalkingaboutthesamestudent,wemakesurethey'remajoringinComputer Science,andwegettheirIDandtheirname.|Let'srunthequery.|Whoops,anerror.|Iknewthatwascoming.|Thisisjusttoremindyouaboutdisambiguatingattributes.|TheIDhereintheselectclausecouldhavecomefromstudentorapply,andeventhoughthevalueisequal,wedohavetodisambiguatebyputtingoneofthose.|Solet'sputstudentdotSIDandlet'srunthequery.|Okay.|Nowweseewegotmorestudentsbackthanwegotbackwhenweranthequeryusingthesub-query.|Let'sgobackandlook.|Wegotfiveresultshereandwegotseveralmorehere,buttheadditionalresultsareactuallyduplicatevalues.|Sowehavetwocopies,forexample,of1-2-3Amy.|ThereasonforthatisthatAmyactuallyappliedtomajorinComputer Scienceatmultiplecolleges.|Soifwegobackandwelookattheapplydata,we'llseethatAmywhois1-2-3appliedtomajorinComputer ScienceatStanfordaswellasBerkeley.|Let'shopesheselectsStanford.|Inanycase,that'swhywegotAmytwiceinthejoinbecausesheappliedtwice.|Backherewhereweusedthesub-query,wewerejustlookingatstudentsandwhethertheirIDwasintheset.|Okay,sowhenwedothejoinwegetbasicallythesameanswer,butwehavesomeduplicatevalues.|Ofcourse,wecanfixthatbyaddingdistinct.|Werunthequeryandnowwehavethesameresultthatwegotwhenweusedthesub-query.|Let'slookatsomeothersimilarqueriesandlet'sfocusagainontheduplicatesissuebecauseitgetsalittletricky,aswe'llsee.|Thisqueryisverysimilartothepreviousone,findingstudentswhoareapplyingtomajorinComputer Science,butthistimewe'reonlygettingthenamesofthestudentsandnottheirID's.|Sowerunthequeryandwefindoursamefivestudents.|JustwanttomentionthatthesetwoCraigsaretwodifferentCraigs.|Ifwegobacktoouroriginalresult,there'sthree-four-fiveCraigandfive-four-threeCraig.|Socomingbackhere,wefindthenamesofthestudentswhomajoredinComputer Science.|Nowsimilarlytowhatwedidpreviously,let'swritethisqueryusingajoininsteadofusingthesub-queryinthewhereclause.|Sohere'sthejoin.|We'rejoiningstudentandapplyonthestudent'sIDmajoringinComputer Science,asalways.|Theonlydifferenceisthatwe'rejustselectingthename.|WerunthequeryandwegetagainmanymoreresultsthanwegotpreviouslybecausewegettwocopieswhenastudenthasappliedtotomajorinComputer Scienceattwodifferentplaces.|Andjustaswedidbefore,wecanadddistincttogetridoftheduplicates.|Well,somethingdifferenthappenedthistime.|Thistime,whenwegetridoftheduplicates,weonlyhavefourresultswherepreviouslywehadfive.|AndthereasonisthatpreviouslyweincludedthestudentIDintheresult,andsothetwoinstancesofCraigweretwodifferentCraigsanddidn'tcauseduplicatestobeeliminated.|Wecanseethatbackhere:CraigandCraig.|Butinthisresult,becauseweonlykeptthenames,thetwocopiesofCraigturnedintooneresult.|Nowwemightwonderwhydowecareaboutduplicatessomuch.|Let'sseeanexamplewhereduplicatesreallydomatterquiteabinary digit.|We'regoingtodoexactlythesamequeryagain,findingstudentswhohaveappliedtomajorinComputer Science,butnowwe'renotretrievingtheIDsornames,we'reretrievingtheGPAsofthosestudents.|Presumablywhatwe'reinterestedindoingissomeanalysisoftheGPA'sofstudentswhochoosetoapplyforComputer Science.|Solet'srunthequery.|Asalways,wegetourfiveresults.|Andhere'stheGPA'softhefivestudentswhohaveappliedtomajorinComputer Science.|Onceagain,thiswillbethelasttime,Ipromise,we'lldothisqueryusingajoininsteadofthesub-query.|Soherewego.|We'vegotstudentandapplyjoinonSID,majoringinComputer Science,andreturningtheGPA.|Onceagain,becausewehavestudentswhoappliedmultipletimesforComputer Science,we'regettingmorethanourfiveresults.|Sowegetaratherlargenumberofresultshereandagainwehaveduplicates.|Sohere'swheretheproblemcomesin.|IfweusethisresulttocomputetheaverageGPA,we'llbecountingsomestudentsmultipletimes.|Andpresumably,that'snotwhatwewanttodo.|Presumably,wewanttocounteachstudentwho'sappliedtoComputer Scienceonceinthecomputationof,say,theaverageGPA.|ThatworkedinthepreviousquerywhenwegotthefiveresultsforthefivestudentswhoappliedtoComputer Science.|Whenwedothejoin,wegettoomanyresults.|Butthistime,again,we'regoingtohaveaproblemwhenwedoselectdistinct,becausesomeofthesestudentshavethesameGPA.|AndnowweonlyhavefourGPAsinsteadofthefivethatweshouldhave.|AndifwecomputetheaverageGPAnow,thenwe'renotfactoringinoneofthestudent'sGPAs.|Sointhiscase,neithertheversionwithdistinctnortheversionwithoutdistinctgivesustherightnumberofGPAs.|Neitherofthosewillgiveusthecorrectaverage.|Theonlywaytogetthecorrectnumberofduplicatesistousetheversionofthequerythathasthesub-queryinthewhereclause.|Nowlet'smovetosomedifferentexamplesthatalsousesubqueriesinthewhereclause.|Youmightrememberfromthepreviousvideowhenwewerelearningthedifferenceoperatorthatwehadaquerythatwecouldwriteusingthedifferenceoperator,whichinStructured Query Languageiscalledaccept,butwewereunabletowritethatquerywithoutthedifferenceoperator.|AndthequeryweweretryingtowriteistofindstudentswhohaveappliedtomajorinComputer Science,buthavenotappliedtomajorinEE.|Nowthatwehavesub-queriesinthewhereclause,wecanwritethatquerywithoutusingtheexceptoperator.|Andhereitis.|ThequerylooksforstudentswheretheirIDisamongthesetofID'sofstudentswhohaveappliedtoComputer Science,buttheirIDisnotamongthesetofID'sofstudentswhoareapplyingtomajorinEE.|Solet'srunthequery.|AndwediscoverthattherearethreestudentswhohaveappliedtomajorinComputer Science,butnotappliedanywhereinEE.|Bytheway,letmejustshowyouaslightlydifferentwaytowriteexactlythesamequery.|Youcanseethatweusethiskeywordcombination"notin"tospecifythattheideaisnotinthisset.|WecanactuallywriteitbywritingtheSIDisinthesetandthenapplyinga"not"tothatresult.|We'llexecuteandwe'llgetexactlythesameresult.|It'sfairlycommoninStructured Query Languagefortheretobemultiplewaystowritethesamequery,andwe'llseemoreexamplesofthatlaterinthisvideo.|Sofar,ourexamplesofsub-querieshaveused"in"and"notin"fortestingmembershipinthesetsthatareproducedbysub-queries.|Ournextexamplesaregoingtoshowthatwecanapplytheexistsoperatortosub-queriesjusttotestwhetherthey'reemptyornotempty.|Here'sthequery.|Thisqueryusesexiststocheckwhetherasubqueryisemptyornotemptyratherthancheckingwhethervaluesareinthesubquery.|Theothernewconstructthat'sbegintointroducehere'swhat'sknownasacorrelatedreference.|Butinsidethesubquerywe'regoingtorefertoavalue,C1,thatcomesfromoutsidethesubquery.|Solet'stalkaboutexactlyhowthisqueryworks.|Firstletmetellyouwhatthequeryistryingtoreturn.|Thequeryisgoingtofindallcolleges,suchthatthere'ssomeothercollegethatisinthesamestate.|Okay?|So,inourexample,justareminder,wehaveStanford,Berkeley,Massachusetts Institute of TechnologyandCornell.|So,thetwoCollegesweshouldgetbackareStanfordandBerkeleybecauseineachcasethere'sanothercollegeinthesamestate.|Sohowdoesthisquerywork?|Itsayswe'regonnatotakethecolleges,andforeachcollegewe'regoingtocheckwhethertheirexistsanothercollegeandwe'regoingtocallthatoneC2,wherethestateofC2isthesameasthestateofC1.|Thisissortofsimilartowhatwesawwhenweredoingself-joinswithtablevariables,butnow,thevariablesareappearingintheouterqueryandtheinnerquery.|Okay.|So,let'srunthequeryandweseethatwegetthewronganswer.|Thatwasagainintentional.|Well,here'stheproblem.|Whenwewereinthisquery,C1andC2couldbeboundtothesamecollege.|Soeverycollegeisinthesamestateasanothercollegeoftheothercollegecouldbethesamecollege.|Whatweneedtodoisaddinsidethesub-queryafurtherconditionthatsaysthatC1andC2aredifferentcolleges.|Specifically,C1.CnameisnotequaltoC2.Cname.|Let'srunthequeryandnow,wegetthecorrectanswer.|Now,let'slookatsomeotherusesoftheexists,constructandsub-query.|IfyouhappentoalreadyknowStructured Query Languagealittlebinary digitandsomeoneasksyoutowriteaquerywhereyouweregoinggoingtogetalargestvalueofsometype,thefirstthingyouwouldthinkofisprobablyusingthemaxoperator,butwedon'tknowmaxyet,we'llbelearningthatlatervideos.|Andasithappens,anumberofqueriesthatareeffectivelycomputingamaxcanbewrittenusingsub-queries.|Andhere'sourfirstexample.|Thisexampleisfindingthecollegethathasthelargestenrollment.|Andwe'regoingtodothatwiththesub-queryandwiththenot-existsoperator.|Specifically,we'regoingtofindallcollegeswheretheredoesnotexistanothercollegewhoseenrollmentishigherthanthefirstcollege.|Solet'sgoaheadandrunthequery.|And,notsurprisingly,wegetBerkeleyasaresult.|Sothisisaformofquerythatwecanwriteanytimewe'relookingforsomethingthat'sthelargestorthesmallest.|Let's,forexample,lookforthestudentwiththehighestGPA.|Sowe'llchangeittothestudentname,andwe'llbelookinginsteadofcollegesatstudents.|Otherwisethisformofthisqueryisgoingtostayverysimilar.|We'regoingtolookforstudentshereaswell.|Andfinally,we'regoingtohaveGPAinsteadofenrollment.|So,thewaythisqueryworksisitsays"Iwanttofindallstudents,suchthattheredoesnotexistanotherstudentwho'sGPAishigher".|Werunthequeryandwegetfourresults.|Seemsodd.|Actuallyit'sthatodd.|Let'sjustaddtheGPAtoourqueryandwe'llseeexactlywhathappened.|WecanseethatthesefourstudentsallhaveaGPAof3.9,sothey'realltiedforhavingthehighestGPAandveryspecificallyitfaithfullyrunsthequerythattheredoesnotexistanotherstudentwhoseGPAishigherthanthesestudents.|Now,let'sseeifwecanwritethissamequerywithoutusingasubquery.|Soasusual,ifwewanttowriteaquerywithoutasubquery,we'llneedtodosometypeofjoint.|Sowe'relookingforstudentswiththehighestGPAs.|So,weneedtojointwoinstancesofthestudentrelationaswe'vedonehereandthenwe'llapplyaconditionthattheGPAofthefirstoneisgreaterthantheGPAofthesecondone.|Werunthequery.|Wow,wegotalotofanswersthere.|Maybeourproblemisjustoneofduplicates.|Sofirstthingwedowhenitlookstoobigweaddselectdistinct.|Nope,thatdoesn'tsolvetheproblemeither.|ActuallythisqueryisfundamentallywrongandwecannotwritethequerythatfindsthestudentwiththehighestGPAjustbyusingjoins.|WhatthisqueryactuallydoesisitfindsallstudentssuchthatthereissomeotherstudentwhoseGPAislower.|Inotherwords,it'sfindingallstudentsexceptthosewhohavethelowestGPA.|Nowlet'sseeanothernewconstructwecanusewithsub-queriesinthewhereclauseandwe'llcontinuewiththesamequeryoffindingthestudentwiththehighestGPA.|Thisqueryusestheallkeyword.|Whatalltellsusisthatinsteadofcheckingwhetheravalueiseitherinornotintheresultofasub-query,we'regoingtocheckwhetherthevaluehasacertainrelationshipwithalltheresultsofthesub-query.|Andhere,inthiscase,we'recheckingtoseeiftheGPAisgreaterthanorequaltoallelementsofthesub-querythatreturnstheGPA'sofallstudents.|Ifthestudent'sGPAisindeedgreaterthanorequaltoallGPA'sthenthestudenthasthehighestGPAinthedatabase.|We'llrunthequery,andwe'llgetthesamefourstudentswiththe3.9GPA.|Now,let'strywritingthisinaslightlydifferentfashionjustforfuntoillustratesomeconcepts.|Onceagain,we'regoingtotrytofindthestudentswhoseGPAishighestinthedatabase.|Here'showwe'regoingtodoitthistime.|Insteadofusinggreaterthanorequaltoall,we'regoingtousegreaterthanall.|So,we'regoingtofindallstudentswheretheirGPAishigherthaneveryotherstudentbysayingGPAisgreaterthanallGPA'sofstudentsinthedatabasewhoarenotthestudentwe'relookingat.|BysayingthattheID'sarenotequal.|Let'srunthequery.|Well,wegotanemptyresult.|Let'sthinkaboutitforasecond.|Thatisactuallythecorrectresulttothequery.|Thequeryitselfwasincorrect.|ThequeryislookingforallstudentswherenobodyelsehasthesameGPAasthatstudent.|Everybodyelse'sGPAislower.|Well,remember,wehadfourstudentswitha3.9GPA,sononeofthosestudentsaregoingtosatisfythequeryandnorwillanyotherstudent.|Sothisisanincorrectformulationofthequerythatwewanted.|NowthisquerywouldbecorrectifweknewthateverystudenthadthesameGP...I'msorry.|Thisquerywouldbecorrectifweknewthateverystudent'sGPAwasunique,becausetherewouldbethenonestudentwhohadthehighestGPA.|Solet'smodifythequerytoinsteadlookforthecollegesthathavethehighestenrollment.|Becauseitturnsoutinourdatabaseeverycollegehasauniqueenrollment.|Sowe'llchangeittogettingtheCnameofcollegeinsteadofstudent.|Andwe'llwanttheenrollmenttobegreaterthanallotherenrollments.|Sowe'll...enrollment,college,almostdonehere.|Grabacupofcoffeeifyouwant.|IjusthavetomakethisbeCnameandthisonebeCnameandwe'reallset.|Sowhatareweaskingforhere?|We'reaskingforallcollegeswhoseenrollmentisgreaterthanalloftheenrollmentsofcollegesthataredifferentthantheonewe'relookingat.|WerunthequeryandwegetBerkeleyasaresultwhichisexactlywhatwe'dexpect.|Sofarwe'veseenthekeywordallforcheckingwhetheravaluehasrelationshipwithalloftheresultsofasubquery.|There'salsoakeywordanythatisacompanionbutinsteadofhavingtosatisfyaconditionwithalloftheelementsofasetanysaysyoumustsatisfytheconditionwithatleastoneelementoftheset.|Sowhatwe'regoingtodonowisgoingtodothesamequerybutwe'regonnawriteitalittledifferently.|Letmejusttypeitinandthenexplain.|Herewhatwe'regoingtosayisgetmeallcollegeswhereit'snotthecasethattheenrollmentislessthanorequaltoanyothercollege.|Okay?|Soinotherwordsthere'snoothercollegeshavebiggerenrollment.|Justthinkaboutitforasecond,thisisifyouhappentoknowpredicatelogic.|Thisisanequivalencewherewhenyousayforallit'sequivalenttonotexistsnot.|Inanycaseifyoudidn'tfollowthatdon'tletthatbotheryou.|Let'srunthequeryandweseeweagaingettheresultBerkeley,soagainalltestsaconditionagainsteveryelementintheresultofasubquery,andtheconditionistrueifit'ssatisfiedwitheveryelement;whereasanyistrueiftheconditionissatisfiedwithoneormoreelementsofthesub-query.|Let'suseanyforanotherquery.|Thisqueryfindsallstudentswhoarenotfromthesmallesthighschoolinthedatabase.|So,whatwearelookingforhereisallstudents,wherethesizeoftheirhighschoolisgreaterthananyhighschoolsize.|Inotherwords,astudentisgoingtobereturnedifthere'ssomeotherstudentwhosesizehighschoolissmallerthanthisstudent.|Werunthequery,andthere'stheresult.|Andyoucanverifyifyoulookbackatthedata,butthereisinfact,afew,therearestudentswhoarefromhighschoolsthathave200students,sohere,wehaveinourresulteverystudentthatcomesfromahighschoolbiggerthanthat.|Somesystems,notablyatthecurrenttimeSQLite,donotsupporttheanyandthealloperators.|Wedonotloseexpressivepower,wejusthavetowritethosequeriesalittledifferentlytypicallyusingexistornotexists,solet'slookatthesamequerywrittenwithoutusingany.|Here'swhatwedo.|Welookforstudentswherethereexistssomeotherstudent,okay,whosehighschoolissmallerthanthestudentwereturned.|Sothisisgoingtogiveusexactlythesameresultandwewillseewewillgetthesamesetofstudents.|Nostudentsfromahighschoolwithtwohundredbutwegetalltherestofthestudentswithoutusinganyorall.|Andjusttoemphasize,anyorallareveryconvenientforwritingqueries,buttheyaren'tnecessary.|Itturnsoutwecanalwayswriteaquerythatwoulduseanyorallbyusingtheexistsoperatorornotexistsinstead.|Asagrandfinalequery,let'srevisitthequerythatfindsstudentswhohaveappliedtomajorComputer ScienceandhavenotappliedtomajorinEE.|Andnowwe'regoingtowritethatqueryusingtheanyoperator,twoinstancesofit.|Nowlet'sgobackandlookwhenwewrotethequeryusinginandnotin,andweseethattherearethreeresults,Helen,IreneandCraig.|Andnowlet'slookatourqueryusinganyandnotequaltoany.|SowefindstudentswheretheirSIDisinthesetofSID'sofstudentswhohaveappliedtomajorinComputer ScienceandtheirSIDisnotequaltoanyofthestudentswhohaveappliedtomajorinEEandlet'srunthequery.|Wellwegotthewronganswerandthatwasonceagainintentional.|Let'slookverycloselyatwhatthisqueryasksfor.|ThisqueryasksforstudentsstudentswheretheirIDisinthesetofID'sthatappliedtoComputer Science,that'sallfineandgoodbutthisiswherethingsgottricky.|Whatwe'resayinghereisthatwewanttheconditiontocheckwhetherthere'sanyelementinthesetofEE'sthatarenotequaltothisSID.|So,infact,thissecondconditionissatisfiedaslongasthere'sanybodywhoappliedtoEEthat'snotequaltothestudentwe'relookingatandthatofcourseiscommonlythecase,sowemadeamistakehereandit'sactuallyquitetrickytousetheanyandalloperatorsandalwaysgettherightanswer.|It'sespeciallytrickywhenyoucan'tjusteyeballtheanswerandcheckbutthecorrectformulationthatwewanthereisthatit'snotthecasethattheSIDisequaltoanymemberoftheset.|Inotherwords,foreachmemberofthesetoftheEEapplication,thatvalueisnotequaltotheSIDofthestudentwe'regoingtoretrieve.|Andnowwerunthequeryandwegettherightanswer.|ThenextsetofquerieswillshowintroducedtheconceptoftheaggregationinStructured Query Language.|Onceagainwestartwiththebasicselectfromwhereconstruct,andthistimewe'regoingtointroducewhatareknownasaggregateoraggregationfunctions.|Thesearefunctionthatwillappearintheselectclauseinitiallyandwhattheydoistheyperformcomputationsoversetsofvaluesinmultiplerowsofourrelations,andthebasicaggregationfunctionssupportedbyeveryStructured Query Languagesystemareminimum,maximum,some,averageandcount.|Nowoncewe'veintroducedtheaggregationfunctionswecanalsoaddtwonewclasuestotheStructured Query Languageselectfromwherestatement,thegroupbyandhavingclause.|Thegroupbyallowsustopartitionourrelationsintogroupsandthenwillcomputeaggregatedaggregatefunctionsovereachgroupindependently.|Thehavingconditionallowsustotestfiltersontheresultsofaggregatevalues.|Thewhereconditionappliestosinglerowsatatime.|Thehavingconditionwillapplytothegroupsthatwegeneratefromthegroupbyclause.|Alloftheseconstructswillbecomeveryclearwhenweshowsomeexamples.|Asusualourexamplesweusearesimplecollegeadmissionsdatabase,thathasatableofcolleges,atableofstudentsandinformationaboutstudentsapplyingtocolleges.|Asusualwehavefourcolleges,abunchofstudents,andapplicationsofstudentstocollegesforspecificmajors.|OurfirstaggregationqueryisaverysimpleonecomputestheaverageGPAofthestudentsinthedatabase.|Hereisthequery,butjusttoexplainthequeryletmefirstreplacetheaggregationwithstar.|Whenwerunselectstarfromstudentswegetourresulthere.|SpecificallywhenwelookattheGPAcolumn,whattheaggregationisgoingtodoisperformacomputationoverallvaluesinthecolumn,andthenproducejustonetupleintheresultsthathasthatvalue.|Sowe'llwriteaverageGPA.|We'llrunthequery,andweseenowtheaverageGPAinthedatabase.|Oursecondquerieisabinary digitmorecomplicated.|Itinvolvesajoin.|WhatitfindsistheminimumGPAofstudentswhohaveappliedforaComputer Sciencemajor.|SowedothejoinofstudentandapplyonstudentID.|FilterformajorequalComputer Science.|Onceagainletmejustremovetheaggregationfirst,sowecanseetheresultwithoutaggregation.|Hereweseealloftheinformationaboutstudentswho'veappliedtoaComputer Sciencemajor.|TheaggregationisgoingtolookattheGPAcolumnandit'sgoingtotakethelowestvalueinthatcolumn.|SowewriteminGPA.|Runthequery,andwediscoverthatthelowestGPAisthreepointfour.|Nowlet'sgobacktotheaverageaggregatefunctionagain.|Solet'scomputetheaverageGPAofthestudentswhohaveappliedtocomputerscience,runthequeryandweseetheresultisaboutthreepointseven.|Infactthisresultisprobablynotpreciselywhatwewerelookingfor.|InapreviousvideowetalkedinsomedetailaboutthisparticularformofqueryversususingasubquerytofindtheGPAofstudentswhohaveappliedtoComputer Science.|Theissuewiththisparticularquery,andlet'sgobacktoselectstarversion,isthatifastudentappliedtoComputer Sciencemultipletimesforexamplestudent123AmyappliedtobothStanfordandBerkeley.|ThenWhenwecomputetheiraverageGPAwe'regoingtobecountingtheirGPAtwice.|PresumalywhatweactuallywantistocounttheGPAonceforeachstudentwhoappliedtoComputer Science,nomatterhowmanytimestheyapplied.|soinordertodothatweusethesubqueryformwhereweselectfromstudentandthenwejustcheckforeachstudentwhethertheirIDisamongthosewhoapplytoComputer Science.|Solet'sjustdoabinary digitofeditinghere,fromapplywheremajorequalsComputer Science.|I'mnotaverygoodtypist.|Let'sjustfirsttakethesubqueryform,andweseethatwemadeamistakehere,anditsaysthatweforgotawordherewhichisin.|Apologizeforthat.|Okay,nowwehavethestudentswhoappliedtoComputer Scienceandinthiscaseweonlyhaveoneinstanceofeachstudent.|SonowifweruntheaggregationwhenwecomputetheaverageGPAwe'llcorrectlycountstudentsGPAonlyonetime.|Sorememberwiththreepointsevenapproximatelybeforenowwerunthequeryandweseethatthecorrectresultisthreepointsixeightnotthatdifferentbutthisoneisthenumericallycorrectresult.|Sofarwe'veseentheaverageandminaggregatefunctions.|Thisqueryshowsthecountfunction.|Sonotsurprisinglythecountfunctionjustreturnsthenumberoftuplesintheresult.|Sothisparticularqueryfindsthenumberofcollegesinourdatabasewhoseenrollmentisgreaterthanfifteenthousand,justforittobethoroughlet'srunthequerywithouttheaggregatefunctionandweseethattherearetwoofthemandtheaggregatefunctionsimplycountsthosenumberoftuples.|Werunthequeryandtheresultistwoasexpected.|Let'sdoanothercountquerythatlooksverysimilar.|InthiscasewearecountingthenumberofstudentswhohaveappliedtoCornell.|SothequerylooksthesamewillrunthequeryandwediscoverthatsixstudentshaveappliedtoCornell.|Wellinrealitywhatwe'veactuallycountedinthenumberofapplicationstoCornell,notthenumberofstudentswhohaveappliedtoCornell.|Ifastudentappliedthreetimes,thenwe'recountingthemthreetimesinthisresult.|Soinsomesensethisissimilarthepreviousonewesaw,wewereovercounting,andwecouldtrytofixitwiththesubqueryandtheinandsoforthbutactuallyStructured Query Languageprovidesaverynicewayforustoperformthequerythatwewant.|Inthecountfunctionwecanputaspecialkeyworddistinctandthenthenameofoneormoreattributesandinthiscasewhatthecountwilldo,iswilllookattheresultandthenitwillcountthedistinctvaluesfortheparticularattributesowerunthequeryandwearefindthattherearethreedistinctstudentIDs.|Ifweranitwithoutjustlikethis.|Whenwesee,wewouldlookandagainwewouldfindthattherearethreedistinctstudentIDs.|SocountdistinctactuallyturnesouttobeaveryusefulfeatureinStructured Query Language.|Here'sarathercomplicatedlookingqueryandIhavetoadmititcomputessomethingfairlyobscurebutitdoesdemonstratesomefeatures.|Whatthisquerycomputesis,itgivesusbackallstudentswherethenumberofotherstudentswhohavethesameGPAasthestudentisequaltothenumberofotherstudentthathavethesamehighschoolsizeatthestudent.|AgainIadmitit'salittlebinary digitofobscurebutlet'stakealookathowitworks.|Soitlooksatthestudentrelationandforeachstudentitcountsthenumberofotherstudents,that'sbytestingthattheIDisdifferent,thathavethesameGPA.|Italsocountsthenumberofotherstudentsthathavethesamesizehighschoolandifthosetwovalues,andthesubqueriesbothproduceasinglevaluewhichiswhywouldcontestequality,ifthosetwovaluesarethesamethenthestudentcomesoutintheresult.|Let'srunthequery.|Wegetouranswer.|I'llleaveittoyoutoverifybylookingatthedatathatthisisindeedthecorrectresult.|Here'sanothercomplicatedlookingqueryalthoughthisonecomputessomethingquiteabinary digitmoreintuitive.|WhatthisquerycomputesistheamountbywhichtheaverageGPAofstudentswhoapplytocomputerscienceexceedstheaverageGPAofstudentswhodon'tapplytocomputerscienceandwearegoingtoassumeitdoesinfactexceed.|SoweareusinginthisexamplesubqueriesinthefromclausewhichIhopeyourememberfromthepreviousvideo.|Asubqueryinthefromclauseallowsyoutowriteaselectfromwhereexpressionandthenusetheresultofthatexpressionasifitwereanactualtableinthedatabase.|Sowearegoingtocomputetwosubqueriesinthefromclause,oneofthemwhichistheaverageGPAofComputer ScienceapplicantsandonetheaverageGPAofnonComputer Scienceapplicants.|Let'slookalittlecloserheresothisqueryheresayslet'sfindthestudentswhohaveappliedtomajorinComputer Science,let'scomputetheiraverageGPAandwe'llcallitaverageGPA.|We'lltakethewholeresultandwe'llnameitComputer Science.|SimilarlythesecondnewrelationthatwerecomputinginthefromclausecomputestheaverageGPAofstudentswhodidnotapplytoComputer SciencesotheirstudentIDisnotinthesetofstudentswhoappliedtoComputer Science.|We'llcallthatonenonComputer Science.|SonowwiththisfromclausewehavearelationcalledComputer SciencewithanattributecalledaverageGPAandarelationcallednonComputer SciencewithanattributecalledaverageGPAandintheselectclausewe'llsimplydothesubtractionofthenonComputer ScienceGPAfromtheComputer ScienceGPA.|WerunthequeryandwediscoverthattheComputer ScienceapplicantsexceedonaveragethenonComputer Sciencebypointonenine.|Nowjustfordemonstrationpurposesletmeshowthatwecanwritethesamequerybutusingsubqueriesandtheselectclause.|Youmightrememberfromthepreviousvideothatinaselectclausewecanwriteasubqueryaslongasitreturnsasinglevalue.|We'regoingtogoevenfurtherwe'regoingtowritetwosubqueriesthatreturnsinglevaluesandsubtractthem.|SoI'mgoingtoreplacethisfromwithselect.|I'mgoingtotakeupthiswholefirstlinehere.|AndthenI'mgoingto...Let'ssee.|WhatelsedoIneedtodo?|I'mgoingtotakeouttheashereandI'mgoingtoreplaceitwithaminus.|I'mgoingtotakeouttheashere.|Sonowwhatwe'vegotiswe'vegottheaverageGPAofComputer Sciencestudentintheselectclauseproducingavalue.|TheaverageGPAofnonComputer Sciencestudents.|Weperformthesubtractionaspartoftheselectclause.|Thelastthingweneedissomethinginthefromclausesowe'llsayfromstudentwillcalltheresultofthissubtractiondasinfordifferencewerunthequeryandwegetalmostthesameresultexceptforabunchofduplicates.|Thereasonfortheduplicatesisthatwecomputethisresultonceforeachtupleinstudent.|Wecanadddistinct,andnowwegetthesingleresult.|Nowlet'slearnaboutthegroupbyclausewhichisonlyusedinconjunctionwithaggregation.|Ourfirstqueryisgoingtofindthenumberofapplicantstoeachcollegeandit'sgoingtodosobyusinggrouping.|Effectivelywhatgroupingdoes,isittakesarelationanditpartitionsitbyvaluesofagivenattributeorsetofattributes.|Specificallyinthisquerywe'retakingtheapplyrelationandwe'rebreakingintogroupswhereeachgrouphasoneofthecollegenames,soit'llbetheStanfordgroup,theBerkeleygroupandsoforthandthenforeachgroupwewillreturnonetupleintheresultcontainingthecollegenameforthatgroupandthenumberoftuplesinthegroup.|Sotoillustratewhat'shappeningwithgroupingveryclearly,letmestartbyreplacingtheselectclausewithuh...selectstar,removingtheaggregationanddoinganorderbyonthecollegename.|Sothatillustratesthegroupsthatwe'regoingtobeusinginintheactualquerysoweseetherearethreetuplesforBerkeleytheresixtuplesforCornellandsoforth.|Withineachgroupthenfortheparticularquerywe'redoingwe'resimplygoingtocountthenumberoftuplesSogoingbacktothegroupbyformwereturnthecollegenameandwereturnthecountofanumberoftuples.|NowbeforeIactuallyrunthequeryonethingtonoticeiswhatitmakessensetoputinthatselectclausehere.|We'regroupingbythecollegenamesothecollegenameisgoingtobethesameforallofthetuplesofthegroupsoit'ssensibletoincludethat,butitwouldn'treallybesensibletoincludewhentheotherattributesthatdiffersalthoughwe'llseeanexamplelaterwhereweincludethatandinterestingthingshappen.|Fornowwe'lljustputthenameofthegroupingattributeandthenwecanperformaggregationoverthat.|Inthiscasecount.|WerunthequeryandweseethattherearethreeapplicantstoBerkeley,sixtoCornellandsoforth.|Here'saverysimilarquery,justasasecondexample,andthisexamplewe'refindingthetotalenrollmentofcollegestudentsforeachstate.|Nowweonlyhappentohavethreestatesandfourcollegesinourdatabasebutwhatthisquerydoesisittakesthecollegerelationitbreaksitupintopartitionsbystateandthenwithineachpartitionorgroupitwillreturnthestateforthatpartitionandthesumoftheenrollment.|Werunthequeryandweseetheexpectedresult.|Hereisamorecomplicatedgroupbyquery.|Inthiscasewe'regroupingbytwoattributes.|Wealsohaveajoininvolvedandwe'regoingtocomputetwoaggregatefunctionsinourresult.|WhatthisquerycomputesisforeachcollegeandmajorcombinationtheminimumandmaximumGPAsforthestudentswho'veappliedtothatcollege.|Asusualbeforewedotheaggregationlet'sreplacethequerywithonewherewecanseethegroupsexplicitly.|SoI'llputGPAhereandinsteadofgroupingI'llorderbyandwerunthequeryandweseeforBerkeleybiologyweactuallyonlyhaveoneapplicantforBerkeleyComputer Sciencewehavetwo.|IthinkStanfordComputer Sciencehasthelargestnumberofapplicantsatthree.|SoonceweputtheaggregationbackeachofthesecombinationsofcollegeandmajorisgoingtobeconsideredindividuallyandforeachonewillcompetetheminimumandmaximumGPA.|Solet'sgoaheadanddothat.|Allthoseparentheses.|Ok,changethistogroupby.|RunthequeryandhereweseeforBerkeleybiologytheminimumandmaximumarethesamebecausewesawthattherewasonlyoneuh...studentuh...whoappliedtoBerkeleybiology.|StanfordComputer SciencewehadthreewecanseethespreadoftheirGPA'sandsoforthforeachcollegemajorcombination.|NowwhatifwewereinterestedinfindinginformationaboutthespreadofGPAsforeachcollegeandmajoruh...whatthedifferencesbetweentheminimumandthemaximum.|Solet'ssupposeinfactwhatwewantedtofindwaslargestspread,butlet'stakethatinsteps.|I'mgoingtotakethiscurrentqueryhereandI'mjustgonnaslapitintothefromclause.|SonowinthefromclauseI'mgoingtohavearelation,we'llcallitM,that'sgoingtohavethecollegemajorcombinationsandtheminimumandmaximumGPA.|ThisMisgoingtonowhavetheresultthatweseebelow.|Nowoncewehavethatresulttoworkwithintheselectclausewecanaccesstheattributeshere.|Letmecallthisonemnandthisonemxandifwewritejustmxminusmnherewhatwe'regoingtogetisalistofthespreadsoftheminandmaxGPAforeachcollageandmajor.|Soweseemanyofthemarezero.|Thoseareallofthecombinationthathadjustonestudent,butinsomecasesweactuallyhaveaspread,butwhatwewanttofinditisthelargestspread,watchthisit'sverycute,wejustsimplyputamaxfunctionrighthere.|Runthequeryandwefindthatthelargestspreadbetweenminandmaxisapproximatelyone.|Ournextsequenceofqueriesintroducessomesubtletiesofthegroupbyclause.|Whatourqueryfindsisthenumberofcollegesthathavebeenappliedforthenumberofcollegesthathavebeenappliedtobyeachstudent.|Sothequeryjoinstudentandapply.|ItgroupstheresultforthestudentinthestudentIDandthenforeachstudentIDfindsthenumberofdistinctcollegesinthatgroup.|Soonceagainjusttoillustratelet'stakeawaytheaggregation,let'sreplacethegroupbybyanorderby,justsowecanseethedatathatwe'reworkingon,andrunthequeryandweseethatstudentonetwothreehasfourapplicationstoStanford,BerkeleyandCornell.|Threedistinctcolleges.|Twothreefourhasone,andsoforth.|Sonowlet'sreturntoouroriginalquerygroupbystudentwe'llcountthedistinctcollegenames.|Runthequery,andwegettheexpectedanswerstudentonetwothreeappliedtothreedistinctcollegestwothreefourtooneandsoforth.|Maybewe'dliketohavethestudent'snameintheresultaswell.|That'seasytodo.|Wejustaddthestudentnametotheselectclauseandwerunqueryandnowwe'veaddedAmyisonetwothree,Bobistwothreefourandsoforth.|Thatworkedoutfineinthiscasebutwe'regonnaseeinamomentwheresimplyaddinganattributestotheselectclauseinthecaseofagroupbydoessomethingalittlestrange.|InfacttheonlyreasonthatitworkednicelyinthiscaseisthatwhenwegroupbuythestudentIDwithineachgroupwehavethesamestudentname.|Let'sseethat...Let'sjusttakealookatthat.|Againwe'llreplacethegroupbywithanorderby.|We'resortingbystudentIDandweseeforthefirstgroupwhichisonetwothreewehaveallAmysforthethreefourfivegroupwehaveallCraigsandsoon.|Sowhenweputstudentnameintheselectclauseforourgroupbyqueryitwasokbecauseforeachgroupwehadthesamenameofthestudent.|Whenthat'snotthecaseweshouldpresumablygetanerrorbutlet'sseewhathappens.|Solet'ssaythatwe'reinterestednownotonlyinfindingtheuh...studentnameinourquerybutwe'refurthergonnaaddacollegename.|Solet'sgobacktotheoriginalquery.|Distinctcollegename.|Let'saddcollegenameinourresultandlet'sgobacktogroupingbystudent.|Sonowforeachstudentwe'regonnareturntheI..foreachgroup,whichisidentifiedbythestudentID,we'regonnareturntheID,thename,thenumberofdistinctcollegesandthenacollege.|Let'srunthequeryandwedogetaresultwedon'tgetanerror.|Sowe'vegotAmyonetwothree.|SheappliedtothreedistinctcollegesbutforwhateverreasonthesystemdecidedtotellusaboutStanford.|CraigappliedtotwocollegesandthesystemtellsusaboutMassachusetts Institute of Technology.|Let'sgobackagain,revertnowtoourorderbyformofthisqueryandtakeawaytheaggregationandwhenwerunthequeryweseethere'sAmyandshedidapplytofourdifferentcollegesbutwhenweputthecollegenameinthegroupingqueryitchosetotellusaboutStanford.|Whatthissystemisactuallydoingiswhenweincludeintheselectclauseofagroupingquery,againifwegobacktogroupby,andweputintheselectclauseanattributethat'snotoneofthegroupingattributes.|ItactuallychoosesarandomvaluefromthegrouptoincludeinthecaseofthestudentnametherandomvaluewasalwaysthesamebecausethestudentnameisalwaysthesameforthesamestudentID.|Inthecaseofthecollegeitshowsarandomvalueamongthecolleges.|I'mpersonallynotcrazyaboutthisbehavior.|Amongthreeopen-sourcedatabasesystemsthatwe'vebeenusingforourdemostwoofthemallowthisbehavior,SQLiteandMySQL.|IhappentobeusingMySQLtoday.|IfwewereusingPostgreitwouldactuallythrowanerrorinthiscase.|Let'sgobacktotheoriginalquerythatfindsanumberofcollegesappliedtobyeachstudent.|Hereitisasweoriginallywroteit,andhereistheresult.|Nowtherearemaysomestudentsinthedatabasewhohaven'tappliedtoanycollegeatallandthey'renotgoingtoberepresentedinourresultbecausethey'renotgoingtobeintheresultsofthejoinandwedon'tseeanyzerocountshere.|WhatifwewantedtoactuallyliftthestudentIDsofstudentswhohaven'tappliedanywhereandincludeazerointheresult.|Thisisactuallyoneofmyfavoritequeriestogiveasanexerciseoranexamquestioninmyclassbecauseittakesalittleinnovationtofigureouthowtowriteit.|Thewaywewriteit,actually,isbyusingtheunionoperator,whichIhopeyourememberfromapreviousvideo.|We'regoingtotaketheunionofthestudentswhohaveappliedsomewhereandthenumberofplacesthey'veappliedtogetherwiththestudentswhohaven'tappliedanywhereandforthosestudentswe'regoingtoputacerointheresultdirectly.|Soletmejustwritethebeginningsofthissowe'regoingtofindthosestudentswhohaven'tappliedanywhereatallsothosearethestudentswhosesIDisnotinatallthesetofsIDsintheapplyrelation.|Sothatfindsthestudentswhodidn'tapplyanywhereforeachstudentwillreturntheirstudentIDandthenwewanttohaveazerointheresult.|Verysimpletodo,wesimplywritezero.|Werunthequery,andnowwescrolldownwe'llseethatinadditiontoallthestudentswhohaveappliedsomewherewegetzerosintheresultforthestudentswhohaven'tappliedanywhere.|Thelastclausethatwe'regoingtointroduceinthisvideoisthehavingclauseandthehavingclauseisalsoonlyusedinconjunctionwithaggregation.|Whatthehavingclauseallowsustodoisapplyconditionstotheresultsofaggregatefunctions.|Sothehavingclauseisappliedafterthegroupbyclauseanditallowsustocheckconditionsthatinvolvetheentiregroup.|Incontrastthewhereclauseappliestoonetupleatatime.|Sothisparticularqueryisfindingcollegesthathavefewerthanfiveapplicant.|Sowelookattheapplyrelationwegroupitbycollegenamesowe'regoingtohaveonegroupforeachcollege.|Thenwe'reonlygoingtokeepthosegroupswerethenumberoftuplesinthegroupislessthanfiveindicatingthatwehavefewerthanfiveapplicantstothecollege.|We'llrunthequery,andwe'llseethatBerkeleyandMassachusetts Institute of Technologyeachhavefewerthanfiveapplicants.|SopresumablyCornellandStanfordhavegreaterthanorequaltofiveapplicantsandyoucancheckthatbyexaminingthedata.|Nowitispossibletowritethesamequerywithoutthathavingclauseandinfactwithoutthegroupingclauseandletmeshowyouhowthat'sdone.|We'regoingtoselectagainthecNamefromapplyandhere'swhatwe'regoingtodo.|We'regoingtoaddanattributethere,sorryatablevariable.|We'regonnaerasethiswholebusiness,andwe'regoingtofindallapplicants,soallapplicationswhereletmejusttypethisoutforyoufiveisgreaterthanthecountfromapplyA2whereA2dotcNameequalsA1dotcNameandlet'stakealookatwhatthisisdoing.|Sowhatwe'redoinghereiswe'relookingateachapplicationrecordandwe'recheckingwhetherthenumberofotherapplicationstothesamecollege,weregonnafindalltheapplicationstothesamecollege,we'regoingtocountthemandwe'regoingtoseeifthatnumberislessthanfive.|Soit'salittlebinary digitnonintuitive.|NowremembertheresultshouldbeBerkeleyMassachusetts Institute of Technology.|Let'srunthequeryandwedogetBerkeleyMassachusetts Institute of Technology.|Weagaingetduplicateshowever.|Thereasonisthatwe'rerunninguh...we'recheckingthisconditionforeachapplicationrecord.|SoforeachapplicationtoBerkeleywecheckedtheconditionthatwillbemanyofthemandforeachonetoMassachusetts Institute of Technologyandsoon.|Ofcourseasusualwecanadddistinct.|Wecanrunthequeryandnowwegettheresult.|Itdoeshappenactuallythatuh...everyquerythatcanbewrittenwiththegroupbyandahavingclausecanbewritteninanotherformsometimeitcanbeinextremelycontortedbutanothersortofcomplicatedexerciseIliketogivesometimesinmyclassestoprovethefactthatyoucanwriteeverygroupbyhavingquerywithoutusingthoseclauses.|Nowlet'sgobacktoouroriginalformofthequerywereweusedthegroupbyandthehaving.|Sowe'lljustgetridofallthis.|I'msorryI'msuchaterribletypist.|Groupbycollegenamehavingcountstarlessthanfiveandwe'llrunthequerywillgetthesameresult.|Whatifwewereinterestednotinthosecollegesthathavefewerthanfiveapplicationsbutratherthosecollegesthathavefewerthanfiveapplicants?|It'sasubtlepointbutinsteadofcountingthenumberofapplytuplesforeachcollegewhatwewantcountisthenumberofdistinctstudentID'sthatappearinthegroupofapplytuplesforthatcollege.|Soagain,nowwe'relookingforthenumberofcollegeswhohavefewerthanfivedistinctpeople,distinctstudentsapplyingtothem,andnowweseethatonemorecollegejoinsthegroupsoCornellhadmorethanfiveapplicationsbutatleastfiveapplicationsbutithasfewerthanfiveapplicants.|Here'sourgrandfinalequeryithasahavingclauseandgroupbyandinadditiontothatishasasubquerywithinthehavingclausethatalsousesaggregation.|WhatthisqueryfindsisallmajorsrepresentedinthedatabasewherethemaximumGPAofastudentapplyingforthatmajorislowerthantheaverageGPAinthedatabase.|Sowejoinstudentandapplyandwegroupbythemajorsowecanlookateachmajorone-at-a-time.|WithinthemajorwefindthemaximumGPAofastudentapplyingforthatmajorandwecheckwhetherit'slowerthantheaverageGPAinthestudentrelation.|Werunthequeryandwediscoverthatbioengineeringandpsychology,atthispointintime,aregarneringapplicantswhoseuh...highestGPAislowerthantheaverageinthedatabase.|Ofcoursethatdoesnotrepresentreality.|Inthisvideo,we'llbelearningaboutnullvaluesinStructured Query Language.|Asusual,we'llbeconsideringasimplecollegeadmissionsdatabase,andwe'llbeexploringtheselectfromwherequeryexpressions.|Nowinsteadofextendingwhatwecanwriteinqueries,inthisvideowe'llbelookingatextendingwhat'sinthedata.|Specifically,inrelationaldatabases,unlessspecifiedotherwise,anyvalueinanattributecantakeonthespecialvaluenull.|Nullisusuallyusedtomeanthatthevalueisundefinedorunknown.|Forexample,wemighthaveastudentwhoseGPAisunknownorwhodoesn'thaveaGPA,andwewouldrepresentthatinourdatawithnull.|Orwemightcreateourreplyrelationwiththedecisionsnotyetdecided,andthosedecisionvalueswouldalsobenull.|Sowhatwe'regoingtolookatinourdemoqueriesiswhathappenswhenwehavenullvaluesandwerunqueriesoverthedatabase.|Hereisthesetofstudentsinourdatabase.|Inordertoexplorewhathappenswhenwehavenullvalues,let'sinserttwonewstudents,KevinandLaurie,eachofwhichhaveanullGPA.|WegobackandwelookatourstudenttableandnowweseeKevinandLaurieaspartofthattable,andinthisparticularinterfacenullvaluesaredepictedasblanks.|Nowlet'srunsomequeries.|OurfirstqueryfindsstudentswhoseGPAisgreaterthan3.5.|It'sasimplequerytowrite.|Werunthequeryandwefindanumberofstudentsinourresult.|Wedon'thaveKevinandLaurie,becausetheirGPAsarenull,sowecan'tdeterminethatthey'regreaterthan3.5.|Let'srunanotherquerythatsaysGPAlessthanorequalto3.5.|We'llgetadifferentsetofstudents,aswesee,butwestilldon'tgetKevinandLaurie.|Nowlet'srunaquerywhereweaskfortheGPAtobegreaterthan3.5orlessthanorequalto3.5.|Andthisistheonethat'salittlebinary digitfunny.|Actually,wetalkedaboutthisverysamequerybackwhenweweretalkingabouttherelationalmodel.|Whenyoulookatthequery,youwouldthinkthatyouwouldgeteverystudentinthedatabase,becauseeverybody'sGPAobviouslyiseithergreaterthan3.5orlessorequalto3.5.|Or,fromamorelogicalpointofview,thisisanexpressionthat'salwaystrue.|Butyoumightnotbesurprisedwhenwerunthequery,westilldon'tgetKevinorLaurie,becausewecan'tdeterminethattheirGPAsatisfieseitheroftheseconditions.|Soevenwhenwehaveaquerythatlookslikethewhereclauseisatautology,meaningalogicalexpressionthat'salwaystrue,westilldon'tgetallthedataintheresult.|Ifwewantthisquerytoreturnallstudentsinthedatabase,wecandothatbyaddingonemoreclausetothewhere,whichisorGPAisnull.|Nowthisistrulyaconditionthatwillbematchedbyeverytuple,becauseeithertheGPAisgreaterthan3.5,lessthanorequal3.5,orit'sanullvalue.|"Isnull"isakeywordphraseinStructured Query Languagethatmatchesvaluesthatarenull.|Nowwhenwerunthequery,wefinallygetallofthestudentsinthedatabase,includingKevinandLaurie.|Justtodrivethepointhomeabinary digitfurther,let'scontinuelookingatquerieswherewehavenullvaluesinvolvedinwhereclauses.|Inthisquery,we'relookingforstudentswheretheirGPAisgreaterthan3.5ortheirsizehighschoolislessthan1600.|Solet'srunthequeryandseewhoweget.|Wegetallofthesestudents,includingKevin.|SoalthoughhisGPAisnullandthereforewecan'tdeterminethatitsatisfiesthispartofthecondition,becausesincehishighschoolsizeis1500,hedoessatisfythesecondpartoftheconditionandhedoescomeoutinourresult.|Nowlet'saddonemorecondition,whichisorsizehighschoolisgreaterthanorequalto1600.|Sonowwehaveagainsomethingintheconditionthatlookslikeatautology.|Itlookslikeitshouldalwaysbetrue.|Everyone'shighschooliseithersmallerorlargerthan1600.|Furthermore,inthiscase,wehavenonullvaluesforthehighschoolsize,sowhenwerunthisquery,weshouldgetbackeverybody,andindeedwhenwerunthequery,wedogetbackallofthestudents.|Now,I'mnotgoingtogointodetailsherebecauseyoucancertainlyreadaboutit.|Thewaythewhereclauseisevaluatedwhennullvaluesareinvolvedisusingathreevaluedlogicwhereeveryexpressioniseithertrueorfalseorunknown.|Theselogicalvaluesarecombinedtofinallyyieldavalueforthewhereexpressionthatdetermineswhetheracoupleisintheresult.|Ourlastseriesofqueriesexplorestheinteractionbetweennullvaluesandaggregatefunctions,specificallyinthiscasethecountfunction.|Thereareactuallyquiteafewsubtletiesaboutnullvaluesandaggregationandalsonullvaluesandsub-queries.|We'renotgoingtodoanexhaustiveexplorationofthesesubtletiesherebutjustgiveoneexample.|Andweencourageyouifyouareusingadatabasewithnullvaluestobeverycarefulwhenyouwriteyourqueriestomakesureyouunderstandhowthenullvaluesaregoingtoinfluencetheresult.|OK,soourqueryhereiscountingthenumberofstudentswhoseGPAisnotnullforstarters.|Sowerunthequeryandweseethattheretwelvestudentswhohaveanon-nullGPA.|Thosearethe12studentswehadoriginallyinthedatabasebeforeweaddedKevinandLorriewiththeirnullGPA's.|Nowinsteadofjustcountingthestudents,let'scountthedistinctGPAs.|Soamongthesetwelvestudents,howmanydifferentGPAsarerepresented?|ItturnsouttherearesevendistinctGPAsamongthosethatarenotnull.|Let'sfurtherdropthenotnullconditionandjustcountthethedistinctGPAsamongthestudents.|Thatwilltelluswhethercountdistinctincludesnullsornotinitscount.|We'llrunthequeryandwegetthesameanswersowestillhave7GPAsandwearenotcountingthenullvalues.|Now,let'sdoonelastquery,whichistotakeawaytheandjustlookatthedistinctGPAsthemselves.|So,wehadsevenwhenwedidthecount.|Werunthequerynowandwegeteight.|Whathappened?|Wellthisfirsttupleishardwiththevisualization.|Thisfirstanswerisemptyandthat'sactuallythenullvalue.|SowhenwerightselectthedistinctGPA.|WedoincludethenullvalueinourresultifthereisanullGPA.|However,whenwecountthedistinctvalues,wedon'tincludethenull.|Andthat'sreallyjustoneexampleofthetypeofsubtletiesandpossiblyunexpectedbehaviorwemightgetwhenwehavenullvalues.|Soagain,Iencourageyoutobeverycarefulwhenwritingqueriesoverdatabasesthatincludenullsthatyouknowexactlywhatyou'regoingtogetinyourresult.|Inthisfinalvideo,we'lllearnthemodificationstatementsofStructured Query Language.|Therearestatementsforinsertingdata,fordeletingdataandforupdatingexistingdata.|Forinsertingdata,therearetwomethods.|Thefirstmethodallowsustoenteronetuppleintothedatabasebyspecifyingit'sactualvalue.|Sothat'sthecommandhere.|Wesayinsertintoatable,wespecifythevaluesofatupleandtheresultofthatcommandwillbetoinsertonenewtupleintothetablewiththatvalue.|Theotherpossibilityistorunaqueryoverthedatabaseasaselectstatement.|Thatselectstatementwillproduceasetoftuples,andaslongasthatsetoftupleshasthesameschemaasthetablewecouldinsertallofthetuplesintothetable.|Sothosearethetwomethodsofinsertingdataandwe'llseethoseshortlyinourdemo.|Todeletedata,wehaveafairlysimplecommand.|Itsayswedeletefromtablewhereacertainconditionistrue.|Sothisconditionissimilartotheconditionsthatweseeintheselectstatement.|Andeverytupleinthetablethatsatisfiesthisconditionwillbedeleted.|Nowthisconditioncanbefairlycomplicated.|Itcanincludesub-queries.|Itcanincludeaggregationoverothertablesandsoon,againtobeseeninourdemo.|Finally,we'reinterestedinupdatingexistingdata,andthat'sdonethroughacommandsimilartothedeletecommand.|Itsimilarlyoperatesononetable.|Itevaluatesaconditionovereachtupleofthetable.|Andnowwhentheconditionistrue,wedon'tdeletethetuple.|Instead,wemodifythetuple.|Wetaketheattributethat'sspecifiedhereandwereassignittohavethevaluethat'stheresultoftheexpression.|Aswe'llseeinthedemo,thisconditionherecanbefairlycomplicated.|Itcanhavesub-queriesandsoon.|Andthisexpressioncanalsobequitecomplicated.|Itcaninvolvequeriesoverothertablesorthesametableinthedatabase.|Finally,Iwantedtomentionthatwecanactuallyupdatemultipleattributesinatuple.|Soifwe'reupdatingatable,again,exactlythesame,asingletable.|Aconditionidentifiesthetuplestoupdate,butnowwecanupdatesimultaneouslyanynumberofattributes,eachbyevaluatinganexpressionandassigningtheresultofthatexpressiontotheattribute.|Asalways,ourdemoswillusethesimplecollegeadmissionsdatabasewithcolleges,studentsandapplications.|Asusual,wehavefourcolleges,abunchofstudents,andabunchofapplicationsforthestudentsforthecolleges.|We'llfirstseesomeinsertcommands,thensomedeletecommands,andfinallysomeupdatecommands.|AsImentioned,there'stwodifferentformsofinsertcommand.|Onethatinsertsatuppleatatimebyspecifyingthevaluesandanotherthatusessubqueriestoinserttuples.|Solet'sstartwithasimpleone.|Let'saddanewcollege,CarnegieMellon,toourdatabase.|Wedothatbysayingwewanttoinsertintocollege,weusethekeywordvaluesandwesimplylistthevalueswewanttoinsert:thenameofthecollege,thestateandtheenrollment.|Werunthequeryandwegotakealooknowatthecollegerelation.|Let'sgotocollege.|HerewegoandweseenowthatCarnegieMellonhasbeenaddedtoourdatabase.|Nowlet'sdolittlemorecomplicatedinsertcommands.|NowthatCarnegieMellonisinourdatabase,let'shavesomestudentsapply.|Whatwe'regoingtodoishavethosestudentswhohaven'tappliedanywhereyet,applytoCarnegieMellon,tobeacomputersciencemajor.|Letmetakeitstepbystep.|Let'sstartbyfindingthosestudentswhohaven'tappliedanywheresothisisareviewofwhatwesawearlier.|We'regoingtofindthosestudentswhoseIDisnotinthesub-querythatselectsalloftheIDsintheapplyrelation.|Werunthequeryandwediscoveredthatwehavefourstudentswhohaven'tyetappliedanymore.|Thenextthingthatwe'regoingtodoisturnthisqueryintosomethingthatconstructsthecouples,thatwewanttoinsertintotheapplyrelations.|Asareminder,theapplyrelationhasthestudent'sID,thenameofthecollege,themajorthatthey'reapplyingforandthedecision.|Sowe'llconstructthestudent'sIDofcourse.|WewantthemtoapplytoCarnegieMellon.|WewantthemtomajorinComputer Science.|Andfornowlet'ssaythatwedon'tknowwhatthedecisionis,sowe'llputanullvalueinforthedecision.|Solet'srunthisqueryandnowweseeforourfourstudents,we'veconstructedatuple,fourtuples,thatarereadytobeinsertedintotheapplyrelation,theyhavetheappropriateschema.|Sonowthatwehavethatqueryallreadytogowesayinsertintoapplyandwerunthequeryandwe'llseethat4tuplesareinsertedintheapplyrelation,let'sgotakealookattherelation.|Let'stryagain,herewe'vegotapply,andnowweseewehaveourfournewtuplesandasareminderinthisuserinterface,ablankcelliswhat'susedasanullvalue.|Now,let'sseealittlemoreactionforCarnegieMellon.|Let'sfindstudentswhohaveappliedforanEEMajoratothercollegesandhavebeenturneddownandlet'shavethemapplytoCarnegieMellonandlet'sacceptthemrightaway.|Soagain,I'mgoingtodothisstepbystep.|Thefirstthingwe'lldoiswewillfindstudentswhohaveappliedforEEatanothercollegesowe'llchangethistoNwherethemajorequalsEEandwewantstudentswhowererejectedsothedecisionequalsno.|Wehavey/nforourdecision.|Andlet'sjustcheckhowmanystudentswehaveinthatcategory.|Let'srunthequeryhere.|Andnowweseethere'stwostudents.|Andifwewentbackandlookedattheapplyrelation,wewouldfindthatindeedthey'dappliedtoEEandbeenrejected.|Nowlet'sturnthisintoaquerythatconstructstuplesthatwe'dliketoinsertintotheapplyrelation.|SoweneedthestudentID.|WewantthemtoapplytoCarnegieMellon.|Excusemyslowtyping,asusual.|Thistimethey'regoingtoapplytoEEandwe'regoingtoacceptthemrightaway.|Solet'sjustcheckthatquery.|Sonowwe'veproducedtwotuplesthatarereadytobeinsertedintotheapplyrelation.|Wesayinsertintoapplywiththesub-query,werunit,andweseethattworowshavebeeninsertedintoapply.|Let'sgotakealookatthat.|Andweneedtorefreshhere.|Andwelookdownandweseethatindeed,thetwostudentshaveappliedtoEEandthey'vebeenaccepted.|Nowlet'sexplorethedeletecommand.|Whatwe'regoingtodointhisexampleiswe'regoingtofindallstudentsthathaveappliedtomorethantwodifferentmajors,andwe'regoingtodecidethattheyareunreliablestudentsandwearegoingtoentirelydeletethemfromthedatabase.|Solet'sstartbyformingthequerythatfindsthestudentswhohaveappliedtomorethantwomajors.|Hereitis.|YoumaywanttorememberthegroupIamhavingclause.|So,itsayswegototheapplyrelation.|WeformgroupsorpartitionsbySID's.|So,we'regoingtoconsiderthesetofapplicationforeachstudentindividually.|We'regoingtocounthowmanydistinctmajorsthereareineachgroup.|Andifthatnumberisgreaterthan2,we'regoingtoreturnthestudent'sIDandfornow,let'slookathowmanymajorstheyappliedfor.|Sowefindinourdatabasethattherearetwostudentswhohaveappliedforthreemajors.|And,wedon'tlikethosestudents,sowerejustgoingtogetridofthem.|Here'showwedoit;wesay"deletefromstudent"whereandasareminderthedeletecommandisoftheformdeletefromthetablewhereandthenyoucanhaveasimpleconditionoracomplicatedconditionsothisisasortofcomplicatedcondition.|We'regoingtoseewheretheirSIDisinandwe'regoingtoturnthisintoasub-query.|Wedon'tneedtocountdistincthereandletmejustformatthisalittlebetter.|Isinthesetofstudentidswhohaveappliedtomorethanonemorethan,morethantwomajors.|Soweshouldbedeletingstudentsthree-four-fiveandeight-seven-sixifallgoeswell.|Let'srunthequery.|Wediddeletetworows,let'sgobackandtakealookatthestudents,andweshouldfindthatthree-four-fiveandeight-seven-sixaregone,andindeedtheyare.|Now,we'vedeletedthemfromthestudents,butwehaven'tdeletedthemfromtheapplyrelation,sowecanwritethesamedeletionstatementexactlyasamatteroffactandjustdeletefromapplied.|NowIwanttomentionthatnotalldatabasesystemsallowthisparticulardeletion.|Somedatabasesystemsdon'tallowdeletioncommandswherethesub-queryincludesthesamerelationthatyou'redeletingfromanditcanbealittletricky,butsomedo,PostGRESdoes,that'swhatwe'rerunningtoday,andsowe'llrunthequeryand,thistime,eightrowswereaffected,sowehadeightapplicationsforstudents,whohadappliedtomorethantwodistinctmajors,andagain,itwillbethosesamestudents.|Orwecangobackandcheckifwewanttolookintheapplyrelationwe'llseethat876and345arenowgonefromtheapplyrelationaswell.|NowgoingbacktoourqueryasImentionedsomedatabasesystemsdon'tsupportthisformofdeletion,andsoit'sabinary digitmorecomplicatedtodothisexactdeletioninthosesystems.|Thewaytodoitwouldtypicallybetocreateatemporarytable,putintheresultsofthissub-queryandthendeletefromapply,wherethestudentIDispresent,inthattemporarytable.|YoucangivethatatryonStructured Query Languagelight,orMySQL,andseeifyougetthesameresults,yououghtto.|Let'sseeonemoredeletion.|Inthisexample,wehavedecidedthatanycollegethatdoesn'thaveaComputer Scienceapplicantisprobablynotworthkeepinginthedatabaseandwe'lldeleteit.|We'llstartbydoingtheselectcommandandthenwe'lltranslateittoadelete.|Sothisselectcommandfindscollegeswheretheircollegenameisnotamongthecollegenamesintheapplyrelation,wherethemajorisComputer Science.|Inotherwords,thisfindsallcollegeswherenobodyhasappliedforComputer Science.|Werunthequeryandwediscoveredthatnobody'sappliedforComputer ScienceatCornell.|Ifwewanttonowdeletethetupple.|Whatwedo,it'sverysimpletransformationhere.|Wejustsay"deletefromcollege"andthentherestisthesamewherethecollegenameisnotamongthosewheresomeonehasappliedtoComputer Science.|Werunthequery,it'ssuccessful,andifwegobackandnowwelookatourcollegerelation,wewillseethatCornellisindeedgone.|Finally,let'stakealookatsomeupdatecommands.|Inthisfirstcommandwe'regoingtofindstudentswhoseGPAislessthanthreepointsixandwhohaveappliedtoCarnegieMellon.|We'regoingtoacceptthosestudents,butwe'regoingtoturnthemintoeconomicsmajors.|Let'sstartbyfindingthestudentswhohaveappliedtoCarnegieMellon,withaGPAoflessthanthreepointsix,herethequery,again,thisisareview,frompreviousvideos,wefindintheapplyrelationwherecollegeisCarnegieMellon,andwherethestudentIDisamongthosestudents,whoseGPAislessthanthreepointsix.|Werunthequeryandfindthattherearetwosuchapplications.|Sonowwhatwewanttodoisupdatetheapplyrelationandwe'regoingtoacceptthesestudents,butforaneconomicsmajor,sowechangetheselecttoanupdateandthisis,weregoingtoupdatetheapplyrelation,andwe'regoingtoupdateeverytuplethatsatisfiestheconditions,wehappentoknowit'sthesetwotuples,andwe'regoingtosetthedecisionforthestudentstobeequaltoyesandwe'regoingtosetthemajortobeequaltoeconomics.|Werunthequery,itsucceededandwegonow,andwelookattheapplyrelation,andwefindthesetwostudentshavenowappliedtoeconomicsandthey'vebeenaccepted.|Here'samorecomplicatedandhighlymotivatedupdatecommand.|Inthiscommandwe'regoingtofindthestudentwhohasthehighestGPAandhasappliedtomajorinEEandwe'regoingtochangethemfromanEEmajortoaComputer Science and Engineeringmajor,acomputerscienceandengineering,ratherthanjusthavingthemwastetheirtimeonelectricalengineering.|Allrightsolet'stakealookatthisquerywhichisgoingtofindtheapplicationsthatwe'regoingmodify.|Thisqueryisanexcellentreviewfrompreviousvideosbecauseithastriplynestedsub-queries.|So,again,ourgoalistofindstudentswhohaveappliedtoMajorinEE.|SoherearestudentswhohaveappliedtomajorinEE,butwewantthemtohavethehighestGPAofanybodywho'sappliedtomajorinEE.|SointheinnermostwefindthestudentswhohaveappliedtoEE,theirstudentID's,thenmovingoutonelevel,wefindtheGPA'sofallthestudentswhohaveappliedtomajorinEE.|NowwefindallstudentswhoseGPAisatleastashighasthehighestEEmajor,EEapplicant,andfinallywefindallstudentswhohaveappliedtoEEandhavethathighestGPA.|Whew!|OK,let'srunthequeryandseewhothisis.|Wediscoveritisstudent123.|Andthatstudenthasappliedthreetimes,actually,toEE,toStanford,Cornell,andCarnegieMellon.|Sonowthatwehaveidentifiedthosestudents,transformingthiscommandtodotheupdateisactuallyrelativelysimple.|WeupdateapplyandinsteadofhavingthemajorbeEEthenwehavethemajorbeCSEEthatmajorequals,sorry,Computer Science and Engineering.|That'sit,werunthequery.|And,itsucceeded,andwegobackandwelookattheapplyrelation,andwerefreshandhereweseethatstudent123hasnowappliedtoComputer Science and EngineeringratherthanEEatthosethreeuniversities.|Let'sseeacouplemoreupdatesthatarealittlesillybutdemonstratesomefeatures.|Inthisexample,we'regoingtogiveeverystudentthehighestGPAandthesmallesthighschoolinthedatabase.|So,whatit'sdemonstratingisthat,inthesetcommand,theright-handsideoftheequalscanitselfbeasub-query.|Herewe'reupdatingeverystudent.|There'snowhereclause,sothatmeanseverytupleisgoingtosatisfythecondition,andforeachstudent,we'regoingtosettheirtheirGPAtotheresultoffindingthemaximumGPAinthedatabaseandwe'regoingtosettheirsizehighschooltotheresultoffindingtheminimumsizehighschool.|Werunthequery,andwegotakealookatthestudentrelation,andwewillseenowthateverystudenthasaGPAof3.9andeverystudenthasasizehighschooloftwohundred,whatwereformerlythelargestandsmallestvaluesinthedatabase.|Ourverylastquerysayswe'reinagreatmoodtoday,let'sgotoourapplyrelation,andlet'saccepteverybody.|Verysimplequery,justsays"updateapply"there'snowhereconditions,soeverytuplesatisfiesthequery.|Wesetthedecisionequal"Y".|Herewego,makealotofstudentshappy,let'stakealookattheapplyrelation,andwewillseenowthateverybodyhasbeenaccepted.|Now,we'lllearnaboutthejoinedfamilyofoperatorsinStructured Query Language.|GoingtoourselectfromWherestatement.|IntheFromclause,welisttables.|separatedbycommasandthat'simplicitlyaclauseproductofthoselabels,butit'salsopossibletohaveexplicitjoinoftablesandthisfollowstherelationalAlgebrastyleofjoin.|There'safewdifferenttypes.|Oneofthemiswhat'scalledtheinnerjoinonacondition.|Andwe'llseethatthat'sequivalenttowhatinrelationalAlgebrawewerecallingthethetajoinwherethethetahereisacondition.|So,it'seffectivelytakingtheclauseproduct,butthenapplyingtheconditionandonlykeepingthetupplesintheclauseproductthatsatisfythecondition.|TheseparatetypeofjoinwecanuseinStructured Query LanguageisthenaturaljoinandthatisinfactexactlythenaturaljoininrelationalAlgebrawhereitequatescolumnsacrosstablesofthesamenamesoitrequiresthevaluesinthosecolumnstobesametokeepthetupplesintheclauseproductandthenitalsoeliminatestheduplicatecolumnsthatarecreated.|We'llseethisveryclearlywhenwegettothedemo.|ThethirdtypeofjoinoperatorandStructured Query Languageisagain,interjoinbutwithaspecialclausecalledusingandlistingattributesandthat'skindofagainthenaturaljoinexceptyouexplicitlylisttheattributesthatyouwanttobeequated.|Andfinally,thefourthtypeandactually,themostinterestingtypeistheotherjoinandthere'saleftouterjoin,rightouterjoinandfullouterjoinandthisisagaincombiningtupplessimilartothethetajoinexceptwhentupplesdon'tmatchthethetacondition.|They'restilladdedtotheresultandpattedwithnovalues.|Now,IwillsayrightoffthatnoneoftheseoperatorsareactuallyaddingexpressivepartofStructured Query Language.|Allofthemcanbeexpressedusingotherconstructs.|Buttheycanbequiteusefulinformulatingqueriesandespeciallytheouterjoinisafairlycomplicatedtoexpresswithouttheouterjoinoperatoritself.|So,asusual,we'llbedoingourdemowithoursimplecollegeadmissionsdatabasewithcollegetables,studenttableandappliedtable.|So,let'smoveaheadtothedemo.|Asusual,we'llhavefourcolleges,abunchofstudentsandstudentsapplyingtocolleges.|Let'sstartwiththesimpleparadethatwe'veseenbeforewhichmatchesstudentsnameswithmajorstowhichthey'veapplied.|So,thatcombinesthestudentinapplyrelation,makingsurethestudentIDisthesameacrossthetworelationsandgivesusthenamesandmajorback.|Now,ifyourememberyourrelationalAlgebra,youcanseeclearlythatthisisajoinofthestudentonapplyrelation.|Actually,anaturaljoin,butwe'llcometotheminWe'regonnafirstrewriteitusingtheequivalentofathetajoinoperatorwhichiscalledinnerjoininStructured Query Languageandso,thisdoesthethetajoinorthecombinationofstudentandapplyonaspecificcondition,sowe'llchangethe"Where"to"on"anditiseffectivelythecrossproductofthetwotables.|Butthenwhenitdoesthecrossproduct,itchecksthisconditionandonlykeepsthetuplesthatsatisfythecondition.|So,let'srunthatqueryandofcourse,wegetthesameresult.|Thetwoquerieswesawareexactlyequivalent,we'rejustexpressingthemalittlebinary digitdifferently.|NowtheinnerjoinisthedefaultjoinoperatorinaStructured Query Language.|Sowecanactuallytakeawaytheword"inner"andwhenwerunthat,weagaingetthesameresult,becausejoinisanabbreviationforinnerjoin.|happenswhenwehaveajointoperatorwithadditionalconditionsbesidestheoneonthetwotables.|So,thisisalsoaquerythatwe'veseenbefore.|ThistimesthenameandGPAofstudentswhocamefromahighschoolwithlessthanathousandstudents.|They'veappliedtomajorinComputerScienceatStanford.|So,weranthequeryandwefindjusttoastudentsinourresult.|So,nowlet'srewritethatusingthejoinoperator.|So,wetypejoininsteadofcomma,thecommabeingthecrossproductandthejoinconditionisagaincombiningthestudentandapplyrecordswherethestudentIDmatchesandtherestofthisbecomesourWherecondition.|Goaheadandrunthequeryandwegetthesameresult.|Now,itturnsoutthatwecanactuallyputalloftheseconditionsintoourOnclause,sowecanmakethisWherebackintoanAnd,andourOnclausenowistheAndofallallthreeconditions.|Werunthequeryandwegetthesameresult.|Now,you'reprobablythinkinghowdoIknowwhattoputintheOnclauseandwhatdoIputintheWhereclausebecausethisareobviouslyequivalent.|Well,firstofalltherearemanyequivalentqueriesinStructured Query Language.|Wecanwritethingsindifferentways.|Intheory,Structured Query Languagequeryprocessorshouldexecutethemallinthemostefficientpossibleway,butthejoinclauseinparticularisoftenusedasahinttothequeryprocessoronhowtoexecutethequery.|So,ifweputalloftheseintheOncondition.|We'resortofsayingasthequeryprocessordoesthejoin,itshouldbealltheconditionswhenwemakethisaware.|It'ssortofahintsayinghere'stheconditionthatreallyappliestothecombinationofthetuplesandtherestoftheconditionsapplytoseparateattributes.|Nowlet'stakeatwhathappens|Thesecondwaytocheckisbasedonasetofaxioms,asetofrulescalledArmstrong'saxioms.|Wesawsomerulesforfunctionaldependenciesearlier,butArmstrong'sAxiomsareaspecificsetofrulesthatarewhat'scalledcomplete.|It'sguaranteedthatifonethingaboutfunctionaldependenciescanbeprovedfromanother,thenitcanbeprovedusingtheArmstrong'sAxioms.|I'mnotgoingtocoverArmstrong'sAxiomsinthevideos,butyoucanlookatanyoftherecommendedreadingsandfindthemthere.|SoyoumightwonderwhydidIintroducethisnotionofonesetoffunctionaldependenciesfollowingfromanotherandforthatmatter,whydidIintroducetrivialandnon-trivialfunctionaldependencies.|Well,I'mgoingtosumupinonesentencewhatwe'relookingforwhenwespecifythesetoffunctionaldependenciesforarelation.|Sowehaveanotionoftherealworlddata,wehaveourattributesbutweneedtospecifythefunctionaldependenciesinordertogetagooddesignerforsomeofthereasonsthatImentioned.|Whatwewouldliketofindisaminimalsetofcompletelynon-trivialfunctionaldependenciessuchthatallfunctionaldependenciesthatholdontherelationfollowfromusingthetechnicaldefinitionIgave,thedependenciesinthisset.|Wow,thatseemslikesomeverycomplicatedthing,butthefactiswhenyoustartspecifyingfunctionaldependencies,you'lldiscoverthatyouwillactuallygetthisdefinitionprettynaturally.|Sotoconclude,functionaldependenciesareagenerallyusefulconceptindatabasesystems.|They'reakeyingredientofdoingrelationaldesignbydecomposition,becauseweusethefunctionaldependenciestogetBoyce-CoddNormalFormwhichiswhatwe'llcoverinthenextvideo,butthey'realsousefulforthesystemtodeterminehowtostoredata,tocompressdataandalsotoreasonaboutqueryprocessing.|Inthissequenceofvideos,we'lllearnaboutdesigninggoodschemasforrelationaldatabases.|Solet'ssupposewe'rebuildingadatabaseforanapplicationorsetofapplicationsandwehavetofigureoutwhatschemawewanttostoreourdata.|Usuallytherearemanydifferentpossibleschemadesignsforadatabase,anddatabasesdotendtogetquitecomplicated.|Andsomedesignsaremuchbetterthanothers.|Sohowdowechoosewhatdesigntouse?|Nowtherealityisthatpeopleoftenusehigherleveltoolstodesignrelationaldatabasesanddon'tdesigntheschemasdirectlythemselves.|Butsomedesignersdogostraighttorelations,andfurthermore,it'susefultounderstandwhytherelationsthatareproducedbydesigntoolsarewhattheyare.|Furthermore,fromanacademicpointofview,itturnsoutthere'saverynicetheoryforrelationaldatabasedesign.|Solet'sconsidertheprocessofdesigningtheschemaforourdatabaseaboutstudentsapplyingtocolleges.|Specifically,foragivenstudent,let'ssupposewehavetheirsocialsecuritynumberandtheirname,thecollegesthatstudentisapplyingto,thehighschoolstheyattendedandwhatcitythosehighschoolswerein,andthestudent'shobbies.|Soifthat'swhatwewantwecancreateasinglerelationcalledapply,thathasoneattributeforeachofthosepiecesofinformation.|Nowlet'stakealookathowthatdatabasewouldbepopulated.|Let'ssupposethatwehaveastudent,Anne,withSocialSecuritynumber123,shewentto2differenthighschoolsinPaloAlto,sheplaystennisandthetrumpet,andshe'sapplyingtoStanford,Berkeley,andMassachusetts Institute of Technology.|Solet'slookatsomeofthetuplesthatwewouldbehavingintheapplyrelationtorepresentthisinformationaboutAnne.|Sowe'llhave1,2,3,Anne,hername,she'sapplyingtoStanford,shewenttoPaloAltoHighSchool,andthat'sinPaloAlto,andoneofherhobbiesistennis.|Andthenwealsohave123andsheappliedtoBerkeleyandwenttoPaloAltoHighSchoolinPaloAltoandtennisthereaswell.|Ofcourseshealsohasatuplerepresentingthefactthatshe'sapplyingtoBerkeleyandandwe'llstickwithPaloAltoHighSchool,andsheplayedthetrumpet.|Andasyoucanseewe'llhavemoretuples,we'llhavevariousStanfordandBerkeleys,we'llhavesomeforherotherhighschoolscalledGunnHighSchoolalsoinPaloAlto,andsoon.|Soifwethinkaboutitwewillneedatotalof12tuplestorepresentthisinformationaboutAnn.|Nowdowethinkthat'sagooddesign?|I'mgoingtoargueno,it'snotagooddesign.|Thereareseveraltypesofanomaliesinthatdesign.|Firstofall,wecaptureinformationmultipletimesinthatdesign,andI'llgivesomeexamplesofthat.|Forexamplehowmanytimesdowecapturethefactthat123theSocialSecuritynumberisassociatedwithastudentnamedAnn?|Wecapturethattwelvetimesinourtwelvetuples.|HowmanytimesdowecapturethatAnnewenttoPaloAltoHighSchool?|We'regoingtocapturethatsixtimes.|Andwe'regoingtocapturethefactthatsheplaystennissixtimes.|Andwe'regoingtocapturethefactthatshewenttoapplytoMassachusetts Institute of Technologyfourtimes,soforeachpieceofinformation,infact,we'recapturingitmany,manytimes.|Sothatdoesn'tseemlikeagoodfeatureofthedesign.|Thesecondtypeisanupdateanomaly,andthat'sreallyadirecteffectofredundancy.|Whatupdateanomaliessayisthatyoucanupdatefactsinsomeplacesbutnotallallordifferentlyindifferentplaces.|Solet'stakethefactforexamplethatAnnplaysthetrumpet.|ImightdecidetocallthatthecoronetinsteadbutIcangoaheadandIcanmodify,say,threeoftheincidenceswherewecapturedthefactaboutherplayingthetrumpetandnotthefourthoneandthenweendupwithwhat'seffectivelyaninconsistentdatabase.|Andthethirdtypeofanomalyiscalledadeletionanomaly,andthere'sacasewherewecouldinadvertentlycompletelydoacompletedeletionofsomebodyinthedatabase.|Let'ssayforexamplethatwedecidethatsurfingisanunacceptablehobbyforourcollegeapplicants,andwegoaheadandwedeletethetuplesaboutsurfing.|Ifwehavestudentswhohavesurfingastheironlyhobby,thenthosestudentswillbedeletedcompletely.|Nowyoumayarguethat'stherightthingtodo,butprobablythatisn'twhatwasintended.|Sonowlet'stakealookataverydifferentdesignforthesamedata.|Herewehavefivedifferentrelations,onewiththeinformationaboutstudentsandtheirnames,onewherethey'veappliedtocolleges,onewheretheywenttohighschool,wheretheirhighschoolsarelocatedandwhathobbiesthestudentshas.|Inthiscasewehavenoanomalies.|Ifwegobackandlookatthethreedifferenttypes,theydon'toccurinthisdesign.|Wedon'thaveredundantinformation,wedon'thavetheupdateanomalyorthedeletionanomaly.|Furthermore,wecanreconstructalloftheoriginaldatafromourfirstdesign,sowehaven'tlostanyinformationbybreakingitupthisway.|Soinfactthislookslikeamuchbetterdesign.|Nowletmementionacoupleofmodificationstothisdesignthatmightoccur.|Let'ssuppose,forexample,thatthehighschoolnamealoneisnotakey.|Sowhenwebreakupthehighschoolnameandhighschoolcity,wenolongercanidentifythehighschool.|Inthatcase,thepreferreddesignwouldbetomovethehighschoolupheresowe'llhavethattogetherwiththehighschoolnameandthenwedon'tneedthisrelationhere.|Andactuallythat'safinedesign.|Itdoesnotintroduceanyanomalies,that'sjustbasedonthefactthatweneedthenameofthehighschooltogetherwiththecitytoidentifyit.|Asanotherexample,supposeastudentdoesn'twantalloftheirhobbiesrevealedtoallofthecollegesthattheyareapplyingto.|Forexample,maybetheydon'twantStanfordtoknowabouttheirsurfing.|Ifthat'sthecasethenwecanmodifythedesignagain,andinthatcasewewouldputthehobbyupherewithwherethey'reapplyingtocollege.|Andsothatwouldincludethehobbiesthattheywanttorevealtothoseparticularcolleges,andwe'lltakeawaythisone.|Soitlookedlikeweweretakingournice,smallrelations,andmovingbacktoadesignthathadbiggerrelations.|Butinthiscaseitwasverywellmotivated.|Weneededtheseattributestogethertoidentifythehighschoolandwewantittohaveourhobbiesspecifictothecolleges.|Sowhatthatshowsisthatthebestdesign,foranapplicationforrelationaldatabasesdependnotonlyonconstructingtherelationswell,butalsoinwhatthedataisrepresentingintherealworld.|Sothebasicofideaofwhatwe'regoingtodoisdesignbydecomposition,specifically,we'regoingtodowhatwedidattheverybeginningofthisexample,whichisstartbycreatingmega-relationsthatjustcontainattributesforeverythingthatwewanttorepresentinourdatabase,thenwe'regoingtodecomposethosemegarelationsintosmalleronesthatarebetter,butstillcapturethesameinformation.|Andmostimportantlywecandothisdecompositionautomatically.|Sohowdoesautomaticdecompositionwork?|Inadditiontothemegarelations,we'regoingtospecifyformally,propertiesofthedata.Thesystemisgoingtousethepropertiestodecomposetherelations,andthenit'sgoingtoguaranteethatthefinalsetofrelationssatisfywhat'scalledanormalform.|Andwe'llbeformalizingallofthis.|Butthebasicideabehindnormalformsisthattheydon'thaveanyofthoseanomaliesthatIshowedandtheydon'tloseanyinformation.|Sospecificallyforspecificationofproperties,we'regoingtobeginbylookingatsomethingcalledfunctionaldependencies.|Andoncewespecifyfunctionaldependencies,thesystemwillgeneraterelationsthatareinwhat'scalledBoyseCoddnormalform.|AndBoyseandCoddbythewayweretwoearlypioneersinrelationaldatabasesingeneral.|Thenwe'regoingtolookatanothertypeofspecificationcalledmultivalueddependencieswhichwilladdtofunctionaldependenciesandwhenwehavebothfunctionalandmultivalueddependencies,thenwecanhavewhat'scalledfourthnormalform,andagain,thatwouldberelationsthataregeneratedbythesystemthatsatisfythenormalform.|Boyce-Coddnormalformisstricterthanfourthnormalform.|SpecificallyifwemakeabigVenndiagramhereofalltherelationaldesignsthatsatisfiedBoyce-CoddNormalForm,whichbythewayisveryoftenabbreviatedBoyceCodd normal form,thenthatcontainsalloftherelationsthatsatisfyfourthnormalform,normallyabbreviatedFourth Normal Form.|Soeveryrelationthat'sinfourthnormalformisalsoinBoyce-Coddnormalform,butnotviceversa.|Youmightbewonderingwhathappenedtofirst,secondandthird,normalforms.|Sofirstnormalformisprettymuchjustaspecificationthatrelationsarerealrelationswithatomicvaluesineachcell.|Secondnormalformisspecifyingsomethingaboutthewayrelationsarestructuredwithrespecttotheirkeys.|Neitherofthoseisdiscussedverymuchanymore.|ThirdnormalformisaslightweakeningofBoyce-Coddnormalformandsometimespeopledoliketotalkaboutthirdnormalform.|Soyoucanthinkofthirdnormalformasalittlebinary digitofaevenbiggercirclehere.|We'renotgoingtocoverthirdnormalforminthisvideobecauseBoyce-Coddnormalformisthemostcommonnormalformusedifwehavefunctionaldependenciesonly,andfourthnormalformifwehavefunctionalandmultivalueddependencies.|Sowhat'sgoingtohappennextisI'mgoingtogivesomeexamplestomotivatethesefourconcepts:functionaldependencies,Boyce-Coddnormalform,multivalueddependenciesnormalform,andthenlatervideoswillgointoeachoneinmuchgreaterdepth.|SoletmejustgivethegeneralideaoffunctionaldependenciesandBoyce-CoddNormalForm.|Andwe'lluseaverysimpleforexample,anabbreviatedversionofourapplyrelationthathasstudents'socialsecuritynumbers,thestudent'snameandtheircollegesthatthestudentisapplyingto.|Eventhissmallrelationactuallyhasredundancyandupdateanddeletionanomalies.|Specifically,let'ssaythatourstudent,123Ann,appliesto7colleges.|Thentherewillbe7tuplesandtherewillbe7instanceswhereweknowthatastudentwiththesocialsecuritynumber123isnamedAnn.|Specifically,we'regoingtostoreforeverystudentthenameandsocialsecuritynumberpaironceforeachcollegethattheyapplyto.|Sonowletmeexplainwhatafunctionaldependencyisandthenwe'llseehowfunctionaldependenciesareusedtorecognizewhenwehaveabaddesignlikethisone,andtoseehowwecanfixit.|Afunctionaldependency,inthiscasefromsocialsecuritynumbertoname,andwe'resayingsocialsecuritynumberfunctionallydeterminesthestudentnamesaysthatthesamesocialsecuritynumberalwayshasthesamename.|Inotherwords,everytimewesee123,we'regoingtoseeAnn.|Nowitdoesn'tnecessarilygointheotherdirection.|ItmightnotbethatwheneverweseeAnn,it's123,butwheneverwesee123,itisAnn.|Andsowhatwe'dliketodoisstorethatrelationshipjustonetime.|Onetimesaythatfor123,thenameisAnn.|NowwhatBoyceCoddNormalFormsaysisthatwheneverwehaveoneofthesefunctionaldependencies,thenthelefthandsideofthatfunctionaldependencymustbeakey.|Andthinkaboutwhatthat'ssaying.|Rememberakeysaysthatwehavejustonetupplewitheachvalueforthatattribute.|SoifwehavesaysocialsecuritynumbertonameasafunctionaldependencyandwesatisfyBoyce-CoddNormalForm,thenwe'regoingtosaythatsocialsecuritynumberhastobeakeyinourrelation,andwe'llonlyhaveonetuppleforeachsocialsecuritynumber.|Specifically,wecangobacktoouroriginalrelation.|Wehavethisfunctionaldependencysocialsecuritynumberhereisnotakey,right?|SothenweknowthatthisisnotinBoyce-CoddNormalForm.|Sowe'regoingtousefunctionaldependenciestohelpusdecomposeourrelationsothatthedecomposedrelationsareinBoyce-CoddNormalForm.|Andhere'swhatwouldhappeninthisexample.|Ourfunctionaldependencywouldtellustopulloutthesocialsecuritynumberandstudentnameintoitsownrelationwherethesocialsecuritynumberisakeyandthenwehavejustonetimeforeachsocialsecuritynumberthatstudentsname,andthenseparatelywe'llhavetheinformationaboutthestudentsandwhichcollegestheyappliedto.|Again,we'llcompletelyformalizethiswholeidea,thedefinitionoffunctionaldependencies,theirproperties,thenormalform,andhowwedothedecompositioninalatervideo.|Now,let'ssimilarlymotivatetheconceptofmulti-valuedependencies,andfourthnormalform.|Itisactuallyalittlebinary digitmorecomplicated,butitfollowsthesameroughoutline.|Nowlet'slookatadifferentportionoftheinformationaboutapplyingandlet'ssuppose,fornow,thatwe'rejustconcernedaboutstudents,whatcollegesthey'reapplyingto,andwhathighschoolstheywentto.|Westillhaveredundancyandupdateanddeletionanomalies.|Forexample,astudentwhoappliestoStanfordisgoingtohavethatfactcapturedonceforeveryhighschoolthattheywentto.|AstudentwhowenttoPaloAltohighSchoolwillhavethatfactcapturedonceforeverycollegetheyapplyto.|Inaddition,wegetakindofmultiplicativeeffecthere.|Becauselet'ssayastudentappliestoCcollegesandtheywenttoHhighschools;Iknowstudentsdon'tgotoalotofhighschoolsbutlet'ssupposethatthisisonethathadmovedalot.|Inthatcase,we'regoingtohaveCtimesH,tuples.|Whatwe'dreallyliketohaveissomethingmoreontheorderofCplusH,becausethenwe'dbecapturingeachpieceofinformationjustonce.|NowtheinterestingthingisthatthebadnessofthisparticulardesignisnotaddressedbyBoyce-CoddNormalForm,infactthisrelationisinBoyce-CoddNormalForm,becauseithasnofunctionaldependencies.|It'snotthecasethateveryinstanceofasocialsecuritynumberisassociatedwithasinglecollegenameorasinglehighschool.|Aswewillseelater,iftherearenofunctionaldependencies,thentherelationisautomaticallyinBoyce-CoddNormalForm,butit'snotinandfourthnormalform.|Sofourthnormalformisassociatedwithwhatarecalledmulti-valuedependencies.|Whenwespecifyamulti-valuedependencyaswe'vedoneherewiththedoublearrow,whatthisissayingisthatifwetakeaparticularsocialsecuritynumberintherelation,wewillhaveeverycombinationofcollegenamesthatareassociatedwiththatsocialsecuritynumberwitheveryhighschoolthat'sassociatedwiththatsocialsecuritynumber.|We'llactuallyseethatwhenwehavethismulti-valuedependency,weautomaticallyhavethisone,too.|Iknowitseemsabinary digitcomplicated,andwewillformalizeitcompletely,butfornownowjustthinkabouttheEnglishstatementthatmulti-valueddependencyissayingthatwearegoingtohaveeverycombinationofthosetwoattributesandvaluesinthoseattributesforagivensocialsecuritynumber.|Inotherwords,thosevaluesarereallyindependentofeachother.|Soifwehavethatsituation,thenwhatweshouldreallydoisstoreeachcollegenameandeachhighschoolforeachsocialsecuritynumberonetime,andthat'swhatfourthnormalformwilldoforus.|Fourthnormalform,similarlytoBoyce-Coddnormalform,saysifwehaveadependency,thenthelefthandsidemustbeakey.|Inthiscase,it'samulti-valuedependencywe'relookingat,soit'sreallysayingsomethingdifferentbutthebasicideaisthesamewhichisthatwewantonlyonetuplethathaseachvaluethat'sappearsonthelefthandsideofamulti-valuedependencySolet'sseewhatwouldhappen,inthisexample,ifweuseourmulti-valuedependenciestodecomposetherelation,basedontheideaoffourthNormalForm.|Wellitistheintuitivethingthathappens.|Weseparatetheinformationaboutthecollegenamesthatastudentappliestofromtheinformationaboutthehighschoolsthemselves,andthenwe'llseethatthatweonlystoreeachfactonceandwedogetthebehaviorofhavingCplusHtuplesinsteadofhavingCtimesHtuples.|LikewithfunctionaldependenciesandBoyce-CoddNormalFormwe'llbecompletelyformalizingallofthisreasoningandthedefinitionsinlatervideos.|Tosummarize,we'regoingtodorelationaldesignbydecomposition.|We'regoingtostartbyspecifyingmegarelationsthatcontainalltheinformationthatwewanttocapture,aswellasspecifyingpropertiesofthedatausuallyreflectingtherealworldinsomefashion.|Thesystemcanautomaticallydecomposethemega-relationsintosmallerrelationsbasedonthepropertieswespecify,andguaranteethatthefinalsetofrelationshavecertaingoodpropertiescapturedinanormalform.|Theywillhavenoanomalies,andthey'llbeguaranteednottoloseinformation.|We'llstartbyspecifyingpropertiesasfunctionaldependenciesandfromtherethesystemwillguaranteeBoyce-CoddNormalFormandthenwe'lladdtothatpropertiesspecifiedasmulti-valuedependencies,andfromtherethesystemwillguaranteefourthnormalform,whichisevenstrongerthanBoyce-CoddNormalFormandisgenerallythoughttobegoodrelationaldesign.|Thisvideocoversfunctionaldependencies.|Firstaquickrecapofrelationaldesignbydecomposition.|Theideaisthattheapplicationdesignerwritesmegarelationsthatcontainalltheinformationthatwewanttohaveandpropertiesofthedatathatwe'restoring.|Andthenthesystemwillautomaticallydecomposethosebasedonthepropertiesthatarespecified.|Thefinalsetofdecomposedrelationswillsatisfywhat'scalledthenormalform,andnormalformsaregoodrelationsinthesensethattheyhavenoanomaliesandtheydon'tloseinformationfromwhatwasspecifiedintheoriginalmegarelations.|NowthepropertiesthemselvesaredefinedeitherasfunctionaldependenciesinwhichcasethesystemwillgenerateBoyce-CoddNormalFormrelationsormulti-valuedependencies,whichwillthenyieldfourthnormalformrelations.|Sothisvideo,asyoucantell,isaboutfunctionaldependenciesthemselves.|Andletmesaythatfunctionaldependenciesareactuallyagenerallyusefulconceptindatabasesnotonlyforrelationaldesign.|Soforfunctionaldependencies,aswe'llseesoon,areageneralizationofthenotionofkeysandtheyallowthesystemto,forexample,storethedatamoreefficientlywhenthesystemknowsaboutfunctionaldependencies.|Compressionschemescanbeusedbasedonfunctionaldependenciesforstorage,andalsofunctionaldependencies,asageneralizationofkeys,canbeusedtoreasonaboutqueriesandforqueryoptimization.|Whichisareminderofaveryimportantaspectofdatabasesystems.|Whichallowsdeclarativequeriestobeexecutedbythesystemefficiently.|Bythewayathirduseoffunctionaldependenciesisforexamquestionsindatabasecoursesbecausethereisaverynicetheoryfunctionaldependenciesasyou'llsee.|It'squiteeasytowritequestionsaboutthem.|Theremainderofthevideowillcoverfunctionaldependenciesingeneralasageneralconceptandnotspecificallytorelationaldesignandthenlatervideoswilltiefunctionaldependenciesbacktodesignbydecomposition.|Asalwayswe'llbeusingasasampleacollegeapplicationdatabaseandthiscaseI'veexpandedtheinformationthatwe'reincludingquiteabinary digit.|We'llbeusingthesesametworelationsasexamplesthroughoutthisvideoandsubsequentvideosonrelationaldesign.|Inthiscasewe'regonnalookattworelations,onewithinformationaboutstudentsandthenaseparateonewithinformationaboutwherethey'reapplying.|Thestudentinformationwillhavesocialsecuritynumber,thestudent'sname,theiraddressandthenthreeattributesabouttheirhighschool.|We'llassumethereareuniquecodesforhighschools,buttheyalsohaveanameandareinacity,finallythestudent'sGPA,andapriorityfieldforadmissionsthatwe'llseeinamoment.|Forapplications,we'llhavethestudent'ssocialsecuritynumber,thecollegenamethey'reapplyingto,thestateofthecollege,thedateofapplicationandthemajor.|Notalloftheseattributeswillevenbeusedinthisvideo,butlikeIsaid,thiswillpermeateseveralvideosasourrunningexample.|Tomotivatefunctionaldependencies,let'sfocusonthestudentrelationandspecificallyontheGPAandpriorityattributes.|Let'ssupposethatastudent'spriorityisdeterminedbytheirGPA.|Forexample,wemighthavearulethatsaysifGPAis3.8,greaterthan3.8thenpriorityis1.|IftheGPAissay,inbetween,let'ssay,3.3and3.8.|Thenwe'llsetprioritytobeequal2,andlet'ssayiftheGPA,then,islessthan3.3,thenthepriorityvalueisthree.|So,ifthisrelationshipisguaranteedinourdatathenwhatwecansayisthatanytwotuplesthathavethesamepriorityareguaranteedtohavethesameGPA.|Andlet'sformalizethatconcept.|SoI'mgoingtowritealittlelogicalstatementheretoformalizetheconcept.|I'mgoingtousetheforallsymbolfrompredicatelogicandI'mgoingtosayifwehaveanypairoftuples.|SoforallTorU,thosearetuplesinthestudentrelation,thenifthestudent,iftheTandUhavethesameprioritiesI'msorrythesame,letmefixthat,theyhavethethesameGPA.|SoifT.GPAequalsU.GPA,thenandthisisthelogicalimplicationsymbol,thenT.prioritywillequalU.priority.|Sothislogicalstatementisinfactadefinitionofafunctionaldependency,andwewouldwritethatfunctionaldependencyasGPAarrowpriority,sothatsaystheGPAdeterminesthepriority,any2tupleswiththesameGPAmusthavethesamepriority.|Sothatwasaspecificexample.|Nowlet'sgeneralizeourdefinition.|So,letmereplaceGPAandpriorityherewithjusttwoattributesAandBEofsayarelationR.Andthenwe'llalsoneedtomodifyourdefinition.|Soyoucansee,I'veerasedthespecificattributesandrelation.|AndI'lljustsayforevery.|TandUinourrelation,R.IfTdotAequalsUdotAthenTdotBequalsUdotBandthat'sthedefinitionofthefunctionaldependencyAdeterminesBforarelationR.ActuallyI'mgonnageneralizethisdefinitionevenfurtherbecausefunctionaldependenciesdon'talwayshavetohaveoneattributeoneachside,theycanactuallyhaveasetofattributes.|SonowIwriteA1A2dotdotdotANonthelefthandside,thesewillallbeattributesofrelationR.Andontherighthandside,B1B2commaBM,again,attributesofR.Modifyingtheformaldefinitioninred,nowIcan'tusethedotnotationanymore,soI'lluseasquarebracketandI'llwriteA1throughAnequalsUsquarebracketA1throughAN,sowhatI'msayinghereinthiscaseisthatthetwotuplesTandUhavethesamevaluesforalloftheattributesA-1throughA-N,andiftheydo,thentheywillalsothoughhavethesamevaluesforB-1throughB-M.We'llbegettingtosomeconcreteexamplessoon.|Justonelastbinary digitofnotationbeforewemoveon.|ForsimplicityI'mgoingtoofteninthevideoabbreviatealistofattributesorsetofattributesbyusingabar.|SoI'llwriteAbartoindicateasetofattributesAandBbartoindicateasetofattributesB.|Andagain,thisisjustforconvenience.|Sowe'veseenthemotivationforafunctionaldependencyinarelation.|Afunctionaldependencyforarelationisbasedonknowledgeoftherealworlddatathat'sbeingcaptured.|Andwhenwespecifyone,justlikespecifyingkeys,allinstancesoftherelationmustadheretothefunctionaldependency.|Sojusttosummarizefunctionaldependencies,wesaythatattribute,asetofattributesAfunctionallydeterminesasetofattributesB,ifagainanytimetuplesagreeintheirAvalues,theyalsoagreeintheirBvalues.|Andlet'ssaythatourrelationhereRhasthetuplesAthetuplesandBandalsoafewmoreattributeswe'llcallthoseC.So,letmedrawapictureofarelationnowherethathasthoseattributesinit.|So,we'llhavehere..letsjustthreecolumns,butagainthesearemultipleattributes.|AndthesearetheattributesA,thesearetheattributesB,andthesearetheattributesCAndifweputinacoupleoftuples,thenwhatwe'llsayis,ifwehavetwotupleshere,thathaveandI'mgonnauseabarevenforthevaluesinthetuples.|IfwehavetwotupleswhoseAvaluesarethesamethentheirBvaluesmustalsobethesame.|Andwe'regoingtobeusingthistypeoftemplateforsomereasoninglateron.|Butwe'renotsayingtheirCvalueshavetobethesamesowecouldhaveC1andanddifferentCvalueshereaswell.|Butagain,ifwespecifythisfunctionaldependency,wearesayingthateveryinstanceofourrelationmustsatisfytheconditionthatiftheAvaluesarethesame,thentheBvaluesarealsothesame.|Finally,let'scomebacktoourexample.|AndIthinkwhenwestartwritingfunctionaldependenciesforouractualrelationsit'llgiveyouagoodideaofwhatthey'rereallycapturing.|Solet'swriteafewfunctionaldependenciesforourstudentrelationbasedonwhatweexpecttobetrueintherealworldinthedatathatwe'recapturingintherelation.|Sohere'safirstexample,SocialSecuritynumberfunctionallydeterminesS-name,thestudent'sname.|Sowhatwesay,wehavemultipletuplesaboutaparticularstudentandtheyhavethesamesocialsecuritynumber,saytwotuplesaboutstudent123,we'reexpectingthemtohavethesamenameinfact,we'rerequiringthemtohavethesamename.|Andpresumablybecause1to3issortofidentifyingthestudentthatwouldbeanaturalfunctionaldependencythatwouldholdinthiscaseandsimilarlywewouldexpectsocialsecuritynumbertodetermineaddress,althoughwe'realreadymakinganassumptionabouttherealworldhere,ifwehavethisparticularfunctionaldependency,thenwe'resayingastudentdoesn'tmove.|Theydon'thavemultipleaddresses.|Everytuplethatdescribesthatstudentbytheirsocialsecuritynumberwillhavethesameaddress.|Let'sgotothehighschoolandseewhatmightbegoingonthere.|SoImentionedthatthehighschoolcode,whatI'mtryingtocapturethereisauniquecodeforeachhighschoolthatmightbefilledincollegeapplicationthenwewouldexpectthehighschoolcodetodeterminethehighschoolname.|Everytimewehavetheparticularhighschoolcode,maybefordifferentstudents,itwouldhavethesamenameandalsoitwouldhavethesamecity.|Sothat'sanexampleofafunctionaldependencywithtwoattributesontherighthandside.|Now,let'slookatonethat'salittlemorecomplicated,whichisonethathastwoattributesonthelefthandsideinstead.|Thatactuallyturnsouttobeamoreinterestingcase.|Infact,inthisparticularcase,wecanprobablyreversethearrowandhaveafunctionaldependencyintheotherdirection.|Ifwehaveacombinationofhighschoolnameandhighschoolcity,I'mgoingtoassumethat'sunique,thattherearen't,there'snevertwohighschoolswiththesamenameinthesamecity.|Andifthat'sthecase,ifthat'sunique,thenwewouldexpectafunctionaldependencytothehighschoolcode.|Anytimewehavethesamenameandcity,we'retalkingaboutthesamehighschoolsoweshouldhavethesamecode.|Whatotherexamplesdowehave?|Ifweassumethatthere'soneGPAforeachstudentthenwe'dhavethesocialsecuritynumberdeterminestheGPAandwealreadytalkedaboutGPAdeterminespriorityandanotherexample,actuallyifweputthesetwotogetherweshouldseewellifwehavethesamesocialsecuritynumbertwiceweshouldhavethesamepriority.|Andyoumaybethinkingwell,that'skindofatransitiveruleifittakesthesetwoandproducesthatone.|Andindeeditis.|Andwe'lltalkaboutrulesforfunctionaldependencieslater.|Andtheremaybemoreinthiscase.|Nowlet'stakealookatfunctionaldependenciesforourapplyrelation.|Actually,thisoneisalittletrickier,it'sevenpossibletherearenofunctionaldependenciesatall.|Itreallydependsontherealworlddata,therealworldconstraints.|Onepossibilityforexampleisthateverycollegehasaparticularsingledateonwhichitreceivesitsapplication.|Soifthatwerethecase,thenwe'dhavethecollegenamedeterminesthedate.|Inotherwords,everyapplicationforaparticularcollegemusthavethesamedate.|Anotherconstraintmightbethatstudentsareonlyallowedtoapplytoasinglemajorateachcollegetheyapplyto.|Soifthatwerethecase,thisisanotheronewithtwoattributesonthelefthandsid,we'dsaythatthesocialsecuritynumber,togetherwiththecollege,impliesthemajor.|Inotherwords,wecannothaveastudentandcollegecombinationwithtwodifferentmajorsandthatcapturedthatconstraint.|Maybewehaveaconstraintthatstudentsareonlyallowedtoapplytocollegesinonestate.|Thatseemsratherunlikely,butIwasstrugglingtofindfunctionaldependenciesforthiscase.|Inthatcase,we'dhavethisfunctiondependency,again,sayingastudentcouldonlyapplytocollegesinasinglestate.|Fortheapplyrelationspecifically,again,it'sreallytherealworldconstraintsthatdrivewhichfunctionaldependenciesholdfortherelation.|Butit'simportanttounderstandthoseconstraintssotheycanbetranslatedtofunctionaldependencies,whichthencandriveagoodrelationaldesign.|SoI'vealludedafewtimestothefactthatfunctionaldependenciesgeneralizethenotionofkeys.|Andlet'smakethatconnectionexplicitnow.|Let'ssupposewehavearelationRandRhasnoduplicatetuples.|RhassomeattributesAandithassomeotherattributes.|Let'scallthoseB.|Andlet'ssupposethatwehaveafunctionaldependencythatAdeterminesalloftheattributesintherelation.|Nowletmedrawapictureofthat.|Sohere'sourrelationRwithattributesAandattributesB.|Andnowlet'ssupposethatwehavetwotupleswiththesamevaluesforA.|Nowwe'lljustwritethoseaslittleabar.|Andnowlet'sseewhathappenswiththeBvalues.|We'llmakethemB1barandB2bar.|Becausewehavethefunctionaldependency,theequalvalueshereforAsaythatB1andB2havetobeequal.|SoB1equalsB2.|Let'sjusterasethelittleoneandtwo.|Butnowwe'vegeneratedduplicatetuples.|Sowhatthefunctionaldependencytellsusinthatcaseisthatthesetwotuplesareactuallythesame,orratherwecannothavetwoseparatetupleswiththesameAvalues.|SowecannothavetwoseparatetupleswiththesameAvaluesisexactlywhatitmeansforAtobeakey.|Nowagain,thisisonlythecasewhenwehavenoduplicatesinR.Butifwehavenoduplicates,ifasetofattributesdeterminesalltheotherattributes,thenthoseattributesareakey.|Sohereareafewotherdefinitionsrelatedtofunctionaldependencies.|Wehaveanotionofatrivialfunctionaldependency.|AfunctionaldependencyistrivialAtoBifBisasubsetofA.|Andlet'sdrawalittlepictureofwhatthatmeans.|SoherewehaveourattributesA,andthenwe'resayingandthat'salloftheattributeshere,andwhatwe'resayingisthatBisasubsetofA.|Soinotherwords,someportionoftheseattributeshere,we'lljustmarkthatinpurplehereareattributesB.|Well,it'sprettyobviousthatiftwotupleshavethesamevaluesacrosstheirentireexpansehereforA's,thenobviouslythey'realsogoingtohavethesamevaluesforjustthisportionhere,theBportion.|Sothat'swhyit'scalledthetrivialfunctionaldependency.|Soanontrivialfunctionaldependencyisafunctionaldependencythat'snotatrivialone.|Bytheway,FDisacommonabbreviationforfunctionaldependency.|SoifwehaveAdeterminesB,thenthatisnon-trivialifit'snotthecasethatBisasubsetofA.|Goingtoourpicture,let'shavehereourattributesA.|Andnowwe'resayingtherearesomeattributesinBthatarenotpartofA.|Sowecansay,wellmaybeBispartiallypartofA,butthere'ssomeportionthatisnotpartofA.|Solet'ssaythattheseareourBattributeshere.|Sonowourfunctionaldependencyisactuallysayingsomething.|It'ssayingwehavetwoattributesthatagreeinthesevalues,thenthey'realsogoingtoagreeinthesevaluesoverhere.|Andthelastdefinitionisacompletelynontrivialfunctionaldependency,andthat'sAdeterminesBwhereAandBhavenointersectionatall.|Sointhatcase,again,goingbacktoourpicture,we'llhaveourAattributeshereandthenourBattributesaregoingtobesomeportionoftheremainingattributes.|Andherewe'resayingalot.|We'resayingifthesetwohavethesamevalue,thenthesetwohavethesamevalueaswell.|Andtherealityisthatcompletelynontrivialfunctionaldependenciesaretheonesthatwe'remostinterestedinspecifying.|ImentionedthattherearesomerulesthatapplytoallfunctionaldependenciesandI'llgiveacoupleofthoserightnow.|Thefirstoneisthesplittingrule.|Thesplittingrulessaysthatifwehaveasetofattributesthatdetermineanothersetofattributes-andthistimeI'mgoingtowriteitoutinsteadofusingthebarnotation-thenwealsohave...thisimpliesthatwehaveAdeterminesB-1andAdeterminesB-2andsoon.|Inotherwords,wecansplittherightsideofthefunctionaldependency.|Andifyouthinkaboutit,thisisprettyIfwesaythatthewhentheAvaluearethesamealloftheBvalueshavetobethesamethencertainlywhentheAvaluesarethesametheBvalueshavetobethesameindependently.|Nowyoumightwonderifthesplittingrulealsogoestheotherway.|Solet'ssaywehave,I'llputthelefthandside,I'llwriteouttheattributesexplicitlysolet'ssaywehaveA-1throughA-NdeterminesBthenisitfromthatthecasethatA-1determinesBandA-2determinesBonitsown,andsoon.|Well,theanswertothatisno.|AndI'llgiveasimpleexamplefromourcollegeapplicationdatabase.|Solet'ssaythatwehavethefunctionaldependencyhighschoolnameandhighschoolcitydetermineshighschoolcode.|Wetalkedaboutthatonebefore.|Oops,here,that'sanarrowthere.|Sothatsaysthatwhenwehaveaparticularnameandcitycombinationforahighschool,that'sidentifyingasinglehighschool,andsoitwillalwayshavethesamecode.|Sothatmakesalotofsensebutitisnotthecase,I'llputabigXhere,necessarily,thatifwesplitthelefthandsidethathighschoolnamealonewilldetermineahighschoolcode.|Soforexample,IwouldventuretoguessthattherearealotofJeffersonHighSchoolsalloverthecountryandtheywon'tallwillbethesamehighschool.|Soit'sreallythecombinationofattributesontheleftthattogetherfunctionallydeterminetherighthandsideandsowedonotthenhavethesplittingruleasageneralprinciple.|Thecombiningruleistheinverseofthesplittingrule.|ItsaysifwehaveAdeterminesB-1andwehaveAdeterminesB-2andsoonuptoAdeterminesB-N,thenwealsohaveAdeterminesB-1throughB-Ntogether.|Next,wehavetwotrivialdependencyrules.|Letmeremindremindyouwhatatrivialdependencyis.|It'sAdeterminesBwhereBisasubsetofA.|Soinotherwords,everylefthandsidedeterminesitselforanysubsetofitself,andthat'swhatdrivesthetwotrivialdependencyrules.|OneofthemsaysthatifwehaveAdeterminesB,thenwealsohaveAdeterminesAunionB,soinotherwordswecanaddtotherighthandsideofeverydependencywhat'salreadyonthelefthandside.|Sortofasaconverse,wecanalsosaythatifAdeterminesBthenAdeterminesAintersectB.|Actuallythisoneisalsoimpliedbythesplittingrule.|Sowehavetwodifferentrulesinthiscasethataredoingthesamething.|Andfinallythetransitiverule,whichistheonewealludedtoearlier.|ItsaysifwehaveAdeterminesBandandwehaveBdeterminesC,thenwehaveAdeterminesC.NowalloftheserulescanactuallybeprovenformallyandI'mgoingtogothroughasketchofthisparticularone.|Sohere'smyrelationRandI'llhaveattributesA,B,Candthenlet'sletDbetheleftofourattributes.|AndmygoalistoprovethatAdeterminesC.AndtheinformationIhavetoprovethatisthesetwofunctionaldependencieshere.|SotoprovethatAdeterminesC,IhavetoprovethatiftwotuppleshavethesameAvalues--we'llputlittlebarsthere--thentheyalsohavethesameCvalues.|SoIneedtoshowthatthesetwoCvaluesherearegoingtobethesame.|Soyoucanseewhat'sgoingtohappen.|Usingthefirstfunctionaldependency,becausethesetwoAvaluesarethesame,IknowtheirBvaluesmustbethesame.|AndthenIjustusethesecondfunctionaldependencyandbecausethetwoBvaluesarethesame,IthenknowthatthetwoCvaluesarethesame,andthathasshownthatthisfunctionaldependencyholds.|Andyoucandoasimilarthingtoprovetheotherrulestoyourself.|Now,I'mgoingtointroducetheconceptofclosureofattributes.|Let'ssupposewe'regivenarelation,asetoffunctionaldependenciesforthatrelation,andthenasetofattributesAbarthatarepartofthatrelation.|I'minterestedinfindingallattributesBoftherelationsuchthatAbarfunctionallydeterminesB.|Andthisiswhat'scalledtheclosure,andI'llshowinabinary digitwhywemightwanttocomputethat.|Notationallytheclosureiswrittenusingthe+sign.|SotheclosureofAbarisAbar+.|Letmebealittlemoreexplicit,letmewriteoutAbar,becauserememberwheneverwewritebar,we'reactuallytalkingaboutalistofattributes.|Sowe'regoingtowriteitasA-1throughA-N,andI'minterestedincomputingtheclosureofthatsetofattributes.|Inotherwords,theentiresetofattributesthatarefunctionallydeterminedbytheattributesA-1throughA-N.AndI'mgoingtogiveanalgorithmfordoingthat.|Myalgorithmsaysstartwiththesetitself.|SoI'mgoingtostartwithA1throughAN,exceptI'mnotgoingtoclosethat.|I'mgoingtoleavealittlespacethere.|AndthenI'mgoingtorepeatuntilthere'snochange.|I'mgoingtoaddattributestothatsetuntilIgettotheclosure.|SoI'mgoingtorepeat.|IfAdeterminesB-andnowwe'llputbarsinhere-andallofAareintheset,thenaddBtotheset.|SoImighthavemyattributeshere,A1throughAN,anditmightbethecasethatA,youknow,4determinesattributesCandD,soI'lladdCandDtotheset.|Irepeat.|Maybethere'saCgoestoEandI'lladdEtotheset,andsoon.|Andwhenthere'snomorechange,thenI'vecomputedthecompleteclosure.|Nowifyouhappentobesomeonewholikestothinkintermsofrulesinstead,whatwe'reeffectivelydoingisapplyingthecombiningandtransitiverulestotheattributesinthesetuntilthere'snochange.|Solet'srunanexampleoftheclosurealgorithm.|Let'sgotoourcompletestudenttableandlet'saddthreefunctionaldependencies.|Onethatsaysthatstudent'ssocialsecuritynumberdeterminestheirname,addressandGPAandthatwouldbeanormal...GPAdeterminespriority,andhighschoolcodedetermineshighschoolnameandhighschoolcity.|Again,theseareallexampleswegaveearlierthatwouldbenaturalfunctionaldependenciesforthisparticularrelation.|Let'ssupposethatwe'reinterestedincomputingtheclosureofthetwoattributes-socialsecuritynumberandhighschoolcode.|Soinotherwords,wewanttofindallattributesinthestudentrelationthatarefunctionallydeterminedbythesetwoattributes.|Sothealgorithmsaysstartwiththetwoattributesthemselves,socialsecuritynumberandhighschoolcode,andthenaddattributesthatarefunctionallydeterminedbyonesintheset.|Soifwestartwithourfirstfunctionaldependencyhere,becausewehavesocialsecuritynumber,thatallowsustoaddthestudentname,theaddress,theGPA...andthat'sitforthatone.|Nowlet'srepeatagain.|BecausewehavetheGPA,oursecondfunctionaldependencytellsuswecanaddthepriorityAndthat'sitforthatone.|Andthensincewehavethehighschoolcodeinthisset,ourthirdonetellsusthatwecanaddthehighschoolnameandthehighschoolcityandatthatpointwecertainlyknowwe'redonebecausewe'veactuallygottheentirerelationatthispoint.|NowIdidn'tpickthisparticularexampleatrandom.|Wetooktwoattributes,socialsecuritynumberandhighschoolcode,wecomputedtheirclosure,andwediscoveredthattheytogetherfunctionallydetermineallattributesofthestudentrelation.|Nowrememberjustafewslidesago,whenasetofattributesfunctionallydeterminealltheattributes,thenthoseattributestogetherformakeyfortherelation.|Andinfactifyouthinkaboutit,socialsecuritynumberandhighschoolcodetogetherareanaturalkeyfortherelation.|Astudentmightgotomultiplehighschools,butthere'snoreasontohavemorethanonetupplewiththecombinationofaparticularstudentandthehighschooltheyattended.|Solet'sformalizeabinary digitthisrelationshipbetweenthenotionofclosureandkeys.|Let'ssupposewe'reinterestedinansweringthequestion...isaparticularsetofattributesakeyforarelationwecanuseclosuretodothat.|Remember,wehavetherelation,andwehaveasetoffunctionaldependenciesfortherelation,sowhatwedoiswecomputetheclosureofAthat'sgoingtogiveusasetofattributesandifthatequalsallattributes,thenAisthekey.|Asamoregeneralquestion,let'ssupposewe'regivenasetoffunctionaldependenciesforarelation,howcanweuseittofindallofthekeysfortherelation?|Sousethesamebasicideaofcomputingclosure,butthistimewehavetodoitforeverysubsetoftheattributes.|Solet'scalleachsubsetAbarandwejustcheckiftheclosureofAbardeterminesallattributes.|Andifitdoes,thenit'sakey.|AndbyconsideringeverysubsetoftheattributesinR,thenwe'reconsideringeverypossiblekeyandwe'lljustcheckforeachonewhetherit'sactuallyakey.|Nowthatseemsfairlyinefficientandactuallywecanbealittlemoreefficientthanthat.|Wecanconsiderthesesubsetsinincreasingsizeorder.|Soforexample,ifwedeterminethatAandBtogetherdetermineallattributesfunctionallydetermineallattributesintherelation.|ThattellsusABisakey,andthatactuallyalsotellsusthateverysupersetofABisalsoakey.|Andifyouthinkaboutit,thatfillsoutnaturally.|Sotherealalgorithmwouldsaylet'sstartwithsingleattributesanddetermineiftheyarekey.|IfasingleattributesayC,isakeythensoiseverysupersetofC,andthenwegotopairsofattributesandsoon.|Finallylet'stalkabouthowwespecifythesetoffunctionaldependenciesforarelation.|FirstI'lldefineanotionofonesetoffunctionaldependenciesfollowingfromanotherone.|Solet'ssupposewehavearelationRandwehavetwosetsoffunctionaldependenciesthataren'tidentical,S-1andS-2.|WeseethatS2followsfromS1ifeveryrelationinstancesatisfyingS1alsosatisfiesS2.|Asasimpleexample,supposeS-2issocialsecuritynumberdeterminespriority,andsupposeS-1isthetwofunctionaldependencies-socialsecuritynumberdeterminesGPA,andGPAdeterminespriority.|Thenit'scertainlythecasethatinan...forthisexample,S-2followsfromS-1.|EverytimewehavearelationthatsatisfiessocialsecuritynumberdeterminesGPAandGPAdeterminespriority,thenthatrelationwillalsosatisfysocialsecuritynumberdeterminespriorityandwekindofprovedthatactuallyinanearlierpartofthisvideo.|Soonequestionyoumighthaveishowdowetestwhetheronesetoffunctionaldependenciesfollowsfromanother.|Thatreallyboilsdowntotestingwhetheronefunctionaldependencyfollowsfromaset.|SoandletmejustmakethisAbar,Bbarheretomakecleartheycanbesetsofattributes.|BecauseifwehaveS-1andS-2,thenwejustcheckwhethereveryfunctionaldependencyinS-2followsfromthefunctionaldependenciesinS-1.|There'sactuallytwowaysofgoingaboutthistest.|Oneofthewaysistousetheclosure.|We'llcomputeA+basedonthefunctionaldependenciesthatareinSandthenwe'llcheckifBisintheset.|Reminder-computingtheclosuretellsuseveryattributethat'sfunctionallydeterminedbytheattributesinAbasedonthefunctionaldependenciesinS.IfthoseincludeB,thenAdeterminesBdoesindeedfollowfromS.|Nowthatwe'velearnedaboutfunctionaldependencies,let'stalkabouthowthey'reusedtocreaterelationsthatareinBoyceCoddNormalForm.|Veryquickreminderaboutrelationaldesignbydecomposition.|Thedatabasedesignercreatesmegarelationsthatcontainalltheinformationtobecapturedandspecifiespropertiesofthedatatobecaptured.|ThesystemusesthepropertiestodecomposetherelationsintosmalleronesandthosefinaldecomposedrelationssatisfywhatisknownasaNormalForm.|Theydon'thaveanomaliesandtheydon'tloseinformation.|FunctionaldependenciesareusedtocreaterelationsinBoysCoddNormalFormandmulti-doubtvaluedependenciesareusedtocreaterelationsinFourthNormalForm.|ThisvideotalksabouttheprocessofusingfunctionaldependenciestocreaterelationsinBoyceCoddNormalForm.|Let'sstartbydefiningwhatitmeanstodoadecompositionofarelationalschema.|Let'ssupposewehavearelationRwithasetofattributesA-1throughA-N.WecandecomposeRintotworelations.|We'llcallthemR-1andR-2suchthatR-1has...|I'lljustlabelthemB-1throughB-KandC-1throughCandlet'ssay,letmeusethenotationforthelistofattributesA,BandCthatI'vebeenusinginothervideos.|SoR1andR2areadecompositionofR.FirstofalliftheattributesthatcaptureBunionCareequaltothesetofattributeswestartedwithA.|Inotherwordsrecoveringalloftheattributes,andfurthermore,thisisthetrickypart,R1naturaljoinR2equalsR.So,letmedrawthispictorially.|Sohere'sourrelationRandallofourattributestogetheraretheAattributes.|Andthenwe'regoingtodecomposeRintoR1andR2.|So,let'ssaythisfirstsetofattributesherearetheBattributesandthesecondbunchofattributesherewithsomeoverlaparetheCattributes.|So,nowR-1consistsofthisportionofRandthepurplepartherenowisR2.|So,clearlytheBandCattributesareequaltotheoriginalattributesandthenisthejoinofR-1andR-2givingusR.Nowremember,allofthisislogical.|Wedon'thaveRitselfandwedon'thavethedataandwedon'thaveR-1andR-2,soeverythingisbeingdoneattheschemalevel.|AndwewillexplorelaterhowwecanguaranteethatthisjoindoesreturnRandnotsomethingelse.|Nowjustusingalittlebinary digitmorerelationalalgebrahere,letmementionthatR-1canbedefinedastheprojectionontheBattributesofRandtheninpurple,R-2istheprojectionoftheCattributesofR.Soagainallofthisislogical,buttheideaisthatwhenwedotheprojection,ifthereareduplicatesthatarepresentsimplybecausewehavesay,differentvaluesintheremainingattributes,thoseduplicatesdon'thavetoberetainedintheprojection.|Wesawinsomeofourexamplesinothervideoswherewehadredundancybecausewewerecapturinginformationmultipletimesthatwedidn'tneedto.|Andwe'regoingtoseethatwhatBoyceCoddNormalFormreallydoesisseparatetherelationssothatwecaptureeachpieceofinformationexactlyonce.|Iknowthat'sveryabstractnow,butwhenweseeexamples,we'llseehowthatworks.|Solet'slookattwopossibledecompositionsofthestudentrelationandseewhichonesarecorrect.|Solet'sstartwithadecompositionwherewetake...we'regonnadecomposestudentintoS-1andS-2,andinS-1we'llputthesocialsecuritynumber,name,address,letmeabbreviatealittlebinary digithereandthehighschoolcodebutnomorehighschoolinformation,theGPAandthepriority.|Andtheninrelation2,we'llputthehighschoolcodeandwe'llputthehighschoolnameandthehighschoolcity.|SoyoucanseewhatI'vedonedonehereisI'veseparatedoutthehighschoolinformationintoaseparaterelation.|Sofirstofall,isthisacorrectdecompositioninthesensethatAunionBequalsC.Certainlyalloftheattributesarestillpresentandfurthermore,ifyouthinkaboutitandwe'llformalizethisconceptlaterS1joinS2andthat'sgoingtooccurbythewaybasedonthishighestschoolcodevalue.|S1joinS2inthiscasewill,forthedatathatyouwouldexpect,equalstudent.|Again,we'llformalizethatmomentarily.|Nowlet'slookatasecondpossibledecompositionofthestudentrelationagainintotworelationsS1andS2.|Inthefirstonewe'llputthefirstbunchofattributes.|Sowe'llputthesocialsecuritynumber,thestudent'sname,theiraddress,theirhighschoolcode.|Let'ssayhighschoolnameandhighschoolcity.|Andtheninthesecondrelation,we'llputagainthestudentname.|We'llputthehighschoolnameandwe'llput,saytheGPAandlastlythepriority.|Soagain,isthisadecomposition?|Well,certainlyagainwehavethecasethattheAunionBequalsC,inotherwordswe'vecapturedalloftheattributesofthestudentrelationinourdecomposedrelationanddowethinkit'sthecasethatifwejoinS1andS2thenwe'llgetthestudentrelationbackandI'llputaquestionmarkhereandyouknow,ofcourse,theanswerisgoingtobeno.|Whenwejoinbackwe'llbejoininginthiscaseonthestudentnamehereandthehighschoolnameandlikelythesearenotuniquevaluessowhenwejoinback,wemaybegettinginformationtogetherthatdoesn'treallybelongtogether.|And,again,we'llbeformalizingthatandseeingadditionalexamplesmomentarily.|Sonowlet'sdigalittlefurtherintotheactualprocessofdecomposition.|So,firstofallwedefinitelywantgooddecomposition.|So,aswesawagooddecompositionmustcapturealloftheattributesofcourse.|Butthemoreimportantpropertyisthatthisreassemblybythejoinproducestheoriginalrelation.|Sometimesthat'scalled,bytheway,alosslessjoinproperty.|Butthesecondthingthatwewantisnotonlythatwehaveagooddecompositionbutthattherelationsthatwedecomposeintoaregoodrelations.|AndthoserelationsaregoingtobetheonesthatareinBoyce-CoddNormalForm.|SoletmefirstdefineformallyBoyce-CoddNormalFormandthenwe'llgobacktofigureoutanalgorithmforautomaticallydecomposingrelationsusinggooddecompositionsintodecomposedrelationsthatareinBoyce-CoddNormalForm.|Sohere'stheformaldefinitionofwhenarelationisinBoyce-CoddNormalForm,usuallyabbreviatedB,CandF.ArelationRwithfunctionaldependenciesisinBoyce-CoddNormalFormifeveryfunctionaldependenciesissuchthatit'sleft-handsideisakey,ok.Let'sseewhathappenswhenit'snotthecasethatthelefthandsideofafunctionaldependencyisnotthekeyandwe'llseewhythat'sabaddesign.|Sohere'sourrelationRandhere'sasetattributesAontheleftsideofthefunctionaldependency,attributeBandtherest.|Andlet'sjustputinsomevalues.|Solet'ssupposethatwehavetwotuplesherewiththesameAvalue.|Thenbyourfunctionaldependency,we'regoingtohavethesameBvalueandtherestcanbeanything.|Whathashappenedhereisthatwe'vecapturedthepieceofinformationtheconnectionbetweenAandBtwice.|Andthereasonthat'sallowedtohappenisbecauseAisnotakey.|ifAwereakey,wewouldnotbeallowedtohavethesituationwherewehavethesetwotuplesbothpresentintherelation.|Sothisrelationisnotinvoicecodnormalform.|AndthisfunctionaldependencyhereiswhatwewouldcallaBCandFviolation.|Thatviolationiscausingustohaveredundancyinourrelationandthatalsogiveusaswe'veseentheupdateanomaliesanddeletionanomalies.|Letmeclarifyalittlebinary digittherequirementthattheleft-handsideoffunctionaldependencieshavetobekey,sothat'swhattellsuswe'reinBoyce-Coddnormalform.|NowI'mnotsayingthattheleft-handsideofeveryfunctionaldependencyhastobedeclaredastheprimarykeyforarelation,onlythatitis,infact,akey.|And,asyoumightrecall,thedefinitionofakeyisanattributethatdeterminesallotherattributes,ifyou'rethinkingaboutfunctionaldependencies,orifyoudon'thaveanyduplicatesinyourrelation,thenakeyisavaluethatisneverduplicatedacrosstacets.|Soifyouthinkaboutitforasecond,you'llrealizethatwheneverasetofattributesisakey,soisanysupersetofthoseattributes.|Soif"A"isakey,thensoisacandsoisa,c,dandsoon.|Sosometimesyou'llseeinthedefinitionofBoyceCoddnormalformthiswordingnotisakeybutwillbecontainsakeywhichinfactisexactlythesamethingorsometimesitwillevensayisasuperkey,andasuperkeyisakeyorasupersetofakey.|Again,allofthosearesayingexactlythesamething,butIjustwantedtoclarifybecausedifferentwordingandsometimesdifferentnotationisusedforthatconcept.|Sofar,thingshavebeenprettyabstract.|Let'strytogetabinary digitmoreconcretehere.|Let'slookattwoexamplesanddetermineifthoseexamplesarein"B","C",and"F".|RemembertodetermineissomethingisinB,C,andFweneedtherelationalschemaandasetoffunctionaldependencies.|Soherewehaveourstudentrelationandthisisasetoffunctionaldependencieswehadinearlierexamples,wherethesocialsecuritynumberisdeterminingthename,address,andGPA.|Thatmeansthatifthere'stwotupleswiththesamesocialsecuritynumbertheywillhavethesamename,address,andGPA.|That'sthesamestudentandtheyonlyliveinoneplace.|TheGPAdeterminesthepriority,soanytwostudentswiththesameGPAwillhavethesamepriorityand,finally,thehighschoolcodedeterminesthehighschoolnameandcity.|Sothehighschoolisauniqueidentifierforaparticularhighschoolinacity.|Sothoseareourthreefunctionaldependenciesinordertotestwhetherthisisrelationisinnormalformwithrespecttothefunctionaldependenciesweneedtoknowwhatthekeyoftherelationisorthesetofkeysoftherelationandweworkedonthisinanearliervideousingtheclosureidea,soI'lljustremindyounow,thatforthisrelation,thissetoffunctionaldependencies,there'sonekeyoroneminimalkeyandthat'sthesocialsecuritynumbertogetherwiththehighschoolcode,thosetwoattributesdofunctionallydetermineallotherattributesintherelationand,therefore,theyaretogether,formingakey.|Sonow,tocheckifwe'reinBoyce-CoddNormalForm,wehavetoaskthequestion,"Doeseveryfunctionaldependencyhaveakeyonitsleft-handside?"|andtheanswer,ofcourse,isno,notall.|Infact,therealityisthatnofunctionaldependency,inthiscase,hasthekeyonthelefthandside.|Wehavethreelefthandsidesandnoofthemhaveorcontainouronekey.|Ifyou'vegivenanythoughtatalltothisdatabasedesign,youwillseethatit'snotagoodone.|It'scombiningtoomuchinformationinoneplace,whichisourbasicidea,thatwestartwithamegarelationandbreakitdown.|Andsowhatwe'regoingtodoisusethesefunctionaldependencies,andspecificallythefactthatthoseareBoyceCodd normal formorBoyceCoddNormalFormviolations,tobreakthisrelationdownintoonethatisabetterdesign.|Nowlet'slookatasecondexample,ourapplyrelationtoseeifthisoneisinBoyceCoddNormalForm.|Sointhiscaseasareminder,wehavesocialsecuritynumber,college,state,dateandmajor.|Sothedateisthedateofapplication;themajorismajorthestudentisapplyingforatthatparticularcollegeandwe'llhaveonefunctionaldependencywhicheffectivelysaysinEnglishthateachstudentmayapplytoeachcollegeonlyonceandforonemajor.|Nowlet'scomputethekeyforthisrelation,orkeysforthisrelationbasedonthefunctionaldependency.|Well,it'sprettystraightforwardthatthesethreeattributesformakeybecausetheydeterminetheotherattributesintherelationandthereforetheydeterminealltheattributesoftherelation.|Furthermore,wecanseethatouroneandonlyfunctionaldependencyobviouslyhasakeyonitslefthandsideandsosothisrelationisinfactalreadyinBoyce-Coddnormalformandwe'llseethere'snowaytodecomposethisrelationfurtherintoabetterdesign.|Sohereweareagain,talkingaboutourdecompositionprocess,sonowweknowwhatgoodrelationsare.|TheyareinBoyceCodd normal form.|Andwesawearlierwhatgooddecompositionsare,sonowwe'regoingtogiveanalgorithmthat'sgoingtoperformgooddecompositionsandthosedecompositionsaregoingtoyielddecomposedrelationsthatareinBoyceCoddnormalform.|Sohere'sthealgorithm.|Theinputisarelationrandthesetoffunctionaldependenciesforthatrelation,andtheoutputisgoingtobeourgooddecompositionintogoodrelations.|Solet'sjustgothroughitstepbystep.|Thefirstthingwe'regoingtodoiscomputekeysfromrandweregoingtodothatusingfunctionaldependenciesaswehaveseen,andwesawintheactualalgorithmfordoingthatinapreviousvideo.|Thenwearegoingtostartdoingthedecompositionprocessandwe'regoingtorepeatthedecompositionuntilalloftherelationsareinBoyceCodd normal form.|thoughwe'regoingtotakerandbreakitupintosmallerrelationsandwemightfurtherbreakthoseintosmallerrelations,andsoon,untileveryrelationisgood.|Sothebreakingdownprocesssayspickarelationthat'sbad.|Sowe'regoingtopickarelation,rprimeinourcurrentset,andagain,we'restartingwithonlyrinourset.|Andwe'regoingdefineasituationwherethatrelationhasafunctionaldependencyandIguess,technicallyspeaking,thiswouldbewithlinesontop,thatviolatesBoyce-CoddNormalFormandthatviolationiswhat'sgoingtoguideustodothedecompositionintobetterrelations.|Soourdecompositionthen,inthesecondstep,isgoingtakeourprimeandandit'sgoingtoputtheattributesinvolvedinthefunctionaldependencyintoonerelation,andthenit'sgoingtokeeptheleft-handsideofthefunctionaldependencyandputtherestoftheattributesalongwiththatleft-handsideintoaseparaterelation.|Solet'sdrawthisasapicture.|Sohere'sourrelation,rprimeandofcoursethefirsttimethroughourloop,thatrelationwouldhavetoberself,andthenbecausewehaveafunctionaldependencyfromAtoBandAisnotakey-thatmeansit'sBoyceCodd normal formviolation-we'regoingtodecomposethisintoR1andR2.|SoR1willcontaintheattributesinthefunctionaldependency.|R2willcontaintheleft-handsideofthefunctionaldependencyandtherest.|Wecanseeclearlythatthisisadecompositionthatkeepsallattributes,andwhatwe'llseesoonisthatthisisalsoagoodoneinthatlogicallythejoinofthesetworelationsisguaranteedtogiveusbackwhatwehadoriginally.|Nowtheremainingtwolinesofthealgorithmcomputeafterthedecompositionthesetoffunctionaldependenciesforthedecomposedrelationsandthenthekeysforthose.|I'mgoingtocomebacktothisparticularlinehereafterdoinganexample.|Thisisoursameexample,althoughsquishedtogivememorespacetowrite.|And,asareminder,inthisexample,we'vecomputedacoupleofthetimesthatthekey,giventhefunctionaldependencies,isthecombinationofthesocialsecuritynumberandthehighschoolcode.|SoourgoalistotakethestudentrelationanditerativelybreakitdownintosmallerrelationsuntilalloftherelationsareinBoyce-Coddnormalform.|Solet'sstarttheiterativeprocess.|WepicksomefunctionaldependencythatviolatesBoyce-Coddnormalformandweuseitguideourdecomposition.|SoallthreeofthesefunctionaldependenciesactuallyviolateBoyce-Coddnormalformbecausenoneofthemhaveakeyontheleft-handside.|Solet'sstartwiththehighschoolcodeone.|So,todothedecomposition,basedonthisviolatingfunctionaldependency,we'regoingtocreatetworelations.|Thefirstoneisgoingtocontainjustthethreeattributesthatareinthefunctionaldependencyitself,soit'shighschoolcode,highschoolnameandhighschoolcity.|Andthesecondoneisgoingtohaveallremainingattributesintherelation,plusthelefthandside,sowe'llhavethesocialsecuritynumber,thename,theaddress.|Wewillhavethehighschoolcodebecauseit'sontheleft-handsideofthefunctionaldependencywe'reusing,butwewon'thavethenameandcityfromtherightsidehandsideandI'llhaveaGPAandthepriority.|Nowatthispointouralgorithmcomputesthefunctionaldependenciesforthedecomposedthoserelations.|Forthisparticularexample,wecanjustseewhattheyare,they'rethesamefunctionaldependenciesthatwehadforthenon-decomposedrelation.|Sometimesthere'salittlebinary digitofcomputationyouhavetodoandI'mgoingtotalkaboutthatinabinary digit.|But,inthiscase,wecansee,forexample,forourrelationS1,theonlyfunctionaldependencyisthisfunctionaldependencyhere.|ThattellsusthathighschoolcodehereisakeyforS1.|Soouronlyfunctionaldependencyhasakeyontheleft-handsideandthattellsusthatthisrelationisinBoyce-Coddnormalform.|Sowe'redonewiththatone,butwe'renotdonewithS2.|SoforS2thekeyisstillthesocialsecuritynumberandhighschoolcodetogether,sowestillhavethesetwofunctionaldependenciesthatareBoyce-Coddnormalformviolations.|Solet'staketheGPApriorityoneandlet'sguidethattodecomposeS3further.|We'lldecomposeS2intoS3andS4.|S3willcontaintheGPAandpriorityfromthefunctionaldependencywe'reusing,andthenS4willtaketheremainingattributesinS-2togetherwiththelefthandsideoftheGPA.|So,we'llkeepoursocialsecuritynumber,name,address,highschoolcodeandGPA,butwedon'tkeepthepriority.|Soatthispoint,S-2iscompletelygoneandlet'stakealookattheremainingrelations.|S-3nowjusthasonefunctionaldependencythatappliesandtheleft-handsideisnowakey.|Andsonowwe'redonewithS-2.|It'sinBoyceCoddNormalForm,butwe'renotdone,I'msorry,we'redonewithS-3,butwe'renotdoneyetwithS-4.|S-4stillhassocialsecurityandhighschoolcodeasitskey,andsowestillhaveaviolatingfunctionaldependency,solet'sdecomposeS-4further.|WedecomposeintoS-5andS-6.|S-5containstheattributesinthefunctionaldependencythatwe'reusingnow,soit'sthesocialsecuritynumber,name,addressandGPAandthenas6containstheremainingattributesplusthelefthandside,sothat'sthesocialsecuritynumberandthehighschoolcode.|AndIwilljusttellyourightnowbecauseyoumightbegettingboredwiththisexample,we'redonewithS-4S5andS6arenowbothinBoyceCoddnormalform.|Sothisisourfinalschema.|Itcontains4relations,S1,withtheinformationabouthighschools,S3withtheinformationaboutGPA'sandpriorities,S5hasstudentwiththeirname,addressandGPAandS6,astudentwiththehighschooltheywentto.|And,ifyouthinkaboutit,thisreallyisagoodschemadesignandit'swhat'sproducedautomaticallybytheBoyceCodd normal formdecompositionalgorithm,usingourfunctionaldependencies.|Letmementionafewmorethingsaboutthealgorithm.|Firstofall,Ileftthisstepkindofmysterious,whichishowwecomputethefunctionaldependenciesforthedecomposedrelations.|Wecan'tjusttakethefunctionaldependencieswealreadyhaveforthebiggerrelation,andthrowawaytheonesthatdon'tapplyexclusivelytooneortheotherofthedecomposed,weactuallyhavetocomputethefunctionaldependenciesthatareimpliedandthatapplytotheserelations.|Sointhevideoonfunctionaldependencies,welearnedallofimpliedfunctionaldependencies,andwewouldusetheclosureaswedidinthatvideotodeterminetheimpliedfunctionaldependencies.|Nowtherealityis,formanyexamples,it'sprettyobvious,wesawinthepreviousexampleitis.|And,theotherthingis,thatthisisbeingdonebyacomputerso,wedon'tactuallyhavetoworryaboutitexceptwhenwe'redoingexercisesforourclass.|Second,letmementionthatthereislittlenondeterminisminthisalgorithm.|Itsays"pickanyofourrelationswithaviolatingfunctionaldependencyandusethattoguidethenextdecompositionstep".|So,thefactis,thatyoucangetadifferentanswer,dependingonwhichoneyouchooseatthispointintime.|AlloftheresultswillbeBoyceCodd normal formdecompositionbuttheymightnotbethesameone.|And,infact,ifyougobacktotheexamplethatIdid,andyoupickthefunctionaldependenciesinadifferentorder,youmightgetadifferentfinalschema.|But,again,itwillbeinBoyceCodd normal form.|Andlastly,somepresentationsoftheBoyceCodd normal formdecompositionalgorithmactuallyhaveanotherstephere,whichistoextendthefunctionaldependencythatisusedforthedecomposition.|Sowe'reusingAtoBbutifwehaveAtoBwealsohaveAtoBandwecanaddmoreattributes,thoseintheclosureofA.|Ifyouremembertheclosureandthat'salsoacorrectfunctionaldependency.|Bydoingthisextension,wewillstillgetacorrectBoyceCodd normal formanswer,butwe'lltendtogetrelationsthatarelargerthantheoneswegetifwedon'tdotheextensionfirst.|Insomecases,largerrelationsarebetterbecauseyoudon'tneedtojointhembackwhenyou'redoingqueries,butthatcandependonthequeryloadonthedatabase.|Sotoconclude,doesBoyceCodd normal formguaranteeagooddecomposition?|WellofcoursetheanswerisyesorIwouldn'thavespentallthistimeteachingyouaboutit.|Doesitremovetheanomaliesthatwelookedatinourfirstexampleinanothervideoofbadrelationaldesign?|Yes,itdoesremoveanomalies.|Whenwehavemultipleinstancesofthesamepieceofinformationbeingcaptured,that'swhat'ssqueezedoutbythedecompositionintoBoyceCodd normal form,andthat'sfairlyeasytoseethroughtheexamplesthatwe'vedonealready.|It'salittlelessobviousseeingwhyBoyceCodd normal formcompositiondoesallowustohaveabreakdownofarelationthatlogicallyreconstructstheoriginalrelation.|Solet'slookatthatalittlebinary digitmore.|Sowe'retakingarelationinR,we'reproducingR1andR2,andwewanttoguaranteethatwhenwejoinR1andR2,wegetRback.|Wedon'tgettoofewtuplesandwedon'tgettoomanytuples.|Toofewisprettyeasytosee.|IfwebreakRintoR1andR2andtheirprojectionsofRthenwhenwejointhemback,certainlyallthedataisstillpresent.|Ifthey'retoomanytuples,that'salittlebinary digitmorecomplicatedtosee.|Let'sjustuseasimpleabstractexample.|Sohere'sarelationRwiththreeattributes.|Let'shavetwotuples:1,2,3and4,2,5.|Let'ssupposethatwedecomposeRintoR1andR2.|R1isgoingtocontainAB,andR2isgoingtocontainBC.|Solet'sfillinthedata:inR1wehave1,2,4,2.|AndinR2wehave2,3,2,5.|Nowlet'sseewhathappenswhenwejoinR1andR2backtogether.|Whenwedothat,youmightseewhat'sgoingtohappen.|We'reactuallygoingtogetfourtuples.|We'regoingtoget"1,2,3","1,2,5","4,2,3"and"4,2,5".|Thatisnotsameasouroriginalrelation,sowhathappened?|Well,whathappenediswedidn'tdecomposebasedonafunctionaldependency.|Theonlywaywewoulddecomposewith"B"asthesharedattributewereifhaveafunctionaldependencyfromBtoAorBtoC.Andwedon't.|Inbothcases,there'stwovaluesofBthatarethesamewhereheretheAvaluesarenotthesameandheretheCvaluesarenotthesame.|SoneitherofthesefunctionaldependenciesholdN,B,C,andFwouldnotperformthisdecompostion.|SoinfactB,C,andFonlyperformsdecompositionswhenwewillgetthepropertythatthey'rejoinedback.|Againthat'scalledalosslessjoin.|So,B,C,andFseemsgreat,wejustlistallourattributesafewfunctionaldependenciesandthesystemschurnsonandoutcomesawonderfulschema.|Andingeneralthatactuallyiswhathappens.|Inourstudentexample,thatworkedverywell.|Thereare,however,shortcomingsofBCandFandwewilldiscussthoseinalatervideo|Thisvideocontinuesthetopicofrelationaldesign,talkingspecificallyaboutmultivalueddependenciesandFourthNormalForm.|IknowI'veremindedyoumanytimesaboutrelationaldesignedbydecomposition,soletmedoitveryquickly.|Thedesignerspecifiesmegarelationswithalltheinformationtheywanttostoreandpropertiesofthedata.|Thesystemdecomposesthemegarelationsintosmallerrelationsthathavegoodproperties--noanomaliesandnolostinformation.|Whenwehavefunctionaldependencies,asarepropertiesofthedata,wegetBoyce-CoddNormalform,andthenwhenweaddtothefunctionaldependenciesmulti-valuedependencieswegetfourthnormalform.|Andthespecificationofmulti-valuedependenciesanddecompositionintoFourthNormalFormisthetopicofthisvideo.|Asareminderfromearlier,FourthNormalFormisstrongerthanBoyce-CoddNormalFormsoifwehaveherealloftherelationsthatareinBoyce-Coddnormalform,somesubsetofthosearealsoinfourthnormalform.|Whenwehavefunctionaldependencies,wecanguaranteeBoyceCoddnormalformandthenwhenweaddmulti-valuedependenciesthat'swhatallowsustonarrowdowntothestrongerpropertyoffourthnormalform.|Solet'sstartwithanexample.|Wehaveinformationaboutstudentsapplyingtocolleges.|Thestudentisidentifiedbytheirsocialsecuritynumber.|Theymayapplytoseveralcollegesandinthisvideowe'renotgoingtohavecollegestates,justcollegenames.|We'llassumethey'reunique.|Andthenthestudentmayhavehobbies.|Andtheymayapply,asI'vesaid,toseveralcollegesandhaveseveralhobbies,butlet'sassumefornowthoseareindependent.|Sodowehaveanyfunctionaldependenciesforthisrelation?|Actuallywedon'thaveanyall.|Thesocialsecuritynumberdoesnotdeterminethecollegenameorthehobbyoranythingintheotherdirection.|Withnofunctionaldependencies,theonlykeyfortherelationthenisallattributesoftherelation.|SoisthisrelationinBoyce-CoddNormalForm?|Asyoumightrememberfromthepreviousvideo,Boyce-CoddNormalFormsaysallfunctionaldependencieshaveakeyonthelefthandside.|Well,sincewehavenofunctionaldependenciesthentheanswerisyes.|ItisinBoyce-Coddnormalform.|Ontheotherhanddowethinkthisisagooddesign?|I'mgoingtosaynothisisnotagooddesignWhynot?|Well,let'ssupposethatsomebodyappliestofivecollegesandtheyhave,say,sixhobbies.|Thentohaveallcombinationsofcollegesandhobbiesthatwouldyield30tuplesintherelationandclearlythat'snotagoodidea.|We'dratherseparatethecollegeandhobbiesiftheyareindependent.|Sotheseparationofindependentfactsiswhatfourthnormalformisabout.|Andnowlet'sgetalittlebinary digitmoreformal.|Likefunctionaldependencies,multivalueddependenciesarespecifiedbasedonknowledgeoftherealworldconstraintsonthedatabeingcapturedandallinstancesofarelationwithamultivalueddependencymustadheretothedependency.|Nowlet'sdefineexactlywhatamultivaluedependencyis.|ForrelationRwewriteamultivaluedependencyusingadoubleheadedarrowandwesay'A'multidetermines'B'.|Inthiscase,again,with'A'and'B'possiblybeingsetsofattributes,sothatwouldbeAonethroughANandBonethroughBM,whichI'mabbreviatingwithAbarandBbar.|SoletmewritetheformaldefinitionofAmultideterminesB.|Againusingfirstorderlogicsimilarlytowhatwedidwithfunctionaldependenciesbutthisone'sabinary digitmorecomplicated.|ItsaysforalltuplesTandUthatareinrelationR,ifTwiththeattributesAofTequalUfortheattributesAofU.|Againthesearelistsofattributes.|SoifthetwotuplesagreeontheirAvaluesthen,andrememberforfunctionaldependenciesitwassimplewejustsaidtheyagreedontheirBvalues.|Butnowitgetsmorecomplicated.|We'regoingtosaythatthereexistsathirdtupleVinRthathasthefollowingproperties.|VhasthesameAvaluesasTandU.|SoVsubAequalsTsubA,furthermoreVhasitsBvalue,okay,drawnfromTsoit'sequalthere.|Andfinallyithasitsrest,sothosearealltheattributesotherthanAandBequaltoUrest.|Okay,sothat'samouthfulbutlet'slookatthatpictorially.|Sohere'sourrelationRandwe'llhavethesetofattributesA,thesetofattributesBandtherestoftheattributes.|Andnowlet'smakesometuples.|Solet'ssaythatthisistupleTandthisistupleU.|AndwesaidthatTandUagreeontheirAvalues.|SotheyhavethesameAvaluesandthentheydon'thavetohavethesameBvalues.|Sowe'llcallthefirstoneB-1andthesecondoneB-2andthenfortherestwe'llcallthisR-1andR-2.|Sowhatthemulti-valuedependencysaysisthatwehaveathirdtuple,VandVagainhasthesameAandithasitsBvaluefromtupleT.SoithasB-1,butithasitsrestvaluefromtupleU,sothenithasR-2here.|Soagainwhatwe'resayingisthatifwehavethesefirsttwotuplesTandU,thenwealsohavetupleV.Nowletmedosomethingalittletricky.|LetmeswaptherolesofTandUandshowthatwealsowiththisdefinition,areguaranteedtohaveafourthtupleandwe'llcallthatfourthtupleW.ByswappingtherolesofTandU,WhasagainthesameAvalue.|NowitwilltakeitsBvaluefromUandthatwillgiveusB2,andwe'lltakeitsrestvaluefromTandthatgivesusR1.|SowhatwecanseehereisthatwhenwehavethefirsttwotuplesthathavethisparticularcombinationofBvaluesandrestvalues,ittellsuswemusthavetheothercombinationsaswell.|WemusthaveB1withR2,andB2withR1.|Whatit'sreallysayingisthoseBvaluesandtherestvaluesareindependentofeachotherandwe'llhaveallcombinations.|Sothatmightgetyouthinkingbacktoourcollegesandhobbies.|Incidentally,sometimesmulti-valuedependenciesarecalledtuplegeneratingdependencies.|Andthat'sbecausethedefinitionisisabouthavingadditionaltupleswhenyouhavesomeexistingtuples,unlikefunctionaldependencieswhichjusttalkabouttherelationshipsamongexistingtuples.|Solet'sgobacktoourexample.|Nowwehavestudentsapplyingtocollegesandhavinghobbies.|Thoseareindependentfactsaboutthestudent.|We'llwriteourmulti-valuedependencyas'socialsecuritynumbermultidetermineCname'andnowletsusesomeexampledatatoseeourdefinitionandhowitworkshere.|Here'sourapplyrelationwiththesocialsecuritynumber,thecollegenameandthehobby.|Let'ssupposethatwehaveastudent,123who'sappliedtoStanfordandplaysthetrumpet.|Now,let'ssupposethatsamestudent,123,hasappliedtoBerkeleyandplaystennis.|Sowhatourmultivalueddependencysays,andlet'smakethistupleTandtupleU,isthatthere'safurthertupleV.Vtakesthesamesocialsecuritynumberandittakesthefirstvalueforthecollegenameandthesecondforthehobby.|Itsaysifwehavea123playingtrumpetatStanfordandtennisatBerkeley,thenthatsamepersonwillbeplayingtennisatStanford.|Furthermore,Ishowthatthesamedefinitionwillgenerateautomatically.|AfourthtuplewiththeothercombinationwhichwouldbeBerkeleyandTrumpet.|Bythewayonethingyoumightnoticehereisthatwealsohavethemultivalueddependency,socialsecuritynumbermultidetermineshobby.|ThisisactuallyoneoftherulesformultivalueddependencysayingthatwhenyouhaveAdeterminesB,thenyou,AmultideterminesB,thenyoualsohaveAmultideterminesrestandwe'llseesomerulesformultivalueddependencieslater.|Let'slookquicklyatamodificationofourexamplewheretherealworldassumptionsaboutthedataaredifferent.|Sowestillhaveexactlythesamerelationwiththesameattributes.|Butlet'ssupposethatwedon'twanttorevealeveryhobbytoeverycollege.|Maybewe'lldecidethatwedon'twantStanfordtoknowthatwe'reasurferorBerkeleytoknowthatwe'reonthespeechanddebateteam.|Soifthat'sthecase,thenwhatmultivalueddependenciesdowehaveinthisrelation?|Weactuallyhavenone.|Andwedon'thaveanyfunctionaldependencieseitherbytheway.|Andisthisagooddesign?|Well,actuallyIwouldargueyes.|Inthiscase,thisdesignisagoodonebecausewe'renotgoingtohavethatmultiplicativeeffectofinformation.|Everytuplethatwehaveintheappliedrelationwillbeanindependentpieceofimportantinformation.|Let'slookatonemoreexamplebeforewegoontotalkaboutpropertiesofmultivalueddependencies.|I'veextendedtheapplyrelationnowtonotonlyincludecollegesandhobbiesbutalsothedateofapplicationtoacollege,andthemajorormajorsthatarebeingappliedfor.|Let'scontinuetoassumethathobbiesarerevealedtocollegeselectively.|Wedon'tneedtohavesamehobbiesforeachcollegethatastudentappliesto.|Secondly,letsassumethatwerestrictstudentstoapplyonlyoncetoeachcollege,butwhatIwhatwemeanbythatisjustononeday.|Astudentcanstillapplytomultiplemajorsatasinglecollegeandtodifferentmajorsatdifferentcolleges.|Let'salsoassumethatmajorsareindependentofhobbies,whichseemstomakesense.|Ittakessomethinkingtocomeupwiththerightfunctionalandmultivalueddependenciestocapturetheseconstraints,butheretheyare.|Thefirstonewhenwesaythatwerevealhobbiestocollegeselectivelyisactuallytheabsenceofamultivalueddependencyonhobbiesandcolleges.|Thesecondonesaysasweapplyoncetoeachcollege,orononeparticulardaytoeachcollege,sothatwouldsaythatwhenwehaveaparticularstudentandaparticularcollegethatalwaysgoingtohavethesamedate,soanytwotuplesforastudentandcollegecombinationwillbeonthesamedate.|Thelastdependencythatwewillhaveinvolvestheindependenceofthemajorsthatarebeingappliedforandthehobbiesthatastudenthas,sowe'llwritethatasthemultivaluedependencysocialsecuritynumber,pluscollegename,plusdate,multideterminesmajor,andrememberwhatthat'ssayingisthatmajor,foragivenstudent,college,anddatethemajorsthattheyapplyforareindependentofwhatwecalltherest,whichinthiscaseisthehobbies.|So,youmighttakesometimetolookattheformaldefinitionsoffunctionaldependencies,multivaluedependencies,andmaybewriteoutsomesampledatatoconvinceyourselfthatthesearethedependenciesthatarecapturingtheassumptionsthatwemakeabouttherealworld.|Likewithfunctionaldependencieswehaveanotionoftrivialdependencythosethatalwaysholdwealsohavesomeruleformultivalueddependencies.|ThedefinitionforatrivialmultivalueddependencyAmultideterminesBisinthiscase,thateitherBisasubsetofA,orAunionBareallattributes,amulti-valuedependencyisnon-trivialifthat'snotthecase.|Solet'stakethelookatwhythesemulti-valuedependenciesaretrivial.|Solet'sstartwiththefirstcasewherewehaveourattributesAandtherestandthenattributesBareasubsetofAsoletssaythattheseareattributesB.|Sowhataredefinitionofmulti-valueddependenciessaysthatwhenwehavethesamevaluesforAintwotuples,sohereAandA,thenwehaveeverycombinationoftheBvaluesandtherest,wellobviouslywedosincetheB'saresubsetsoftheA'shere,theBvaluesaregoingtobethesameaswellandweclearlyhaveeverycombination.|Fortheothercaseoftrivialmulti-valuedependencies.|WehaveAandBtogetherbeingallattributesoftherelation,sointhatcase,there'snorest,soclearlywehaveeverycombinationofvaluesofAandBandrest,becausethere'snoresttocombinewith.|Likewithfunctionaldependenciesthereareawholebunchofrulesthatholdformulti-valueddependencies.|Wewilljusttalkaboutthreeofthem,andthefirstoneisthemostimportantandinteresting,andthat'stherulethatsaysifwehaveafunctionaldependencyfromAtoBthenwealsohaveamulti-valueddependencyfromAtoB.|AndI'mgonnagoaheadandprovethatruleforyouagainbecausethisisanimportantone.|I'mgoingdothisproofusingatemplatefortherelationsimilartothewhatIdidwithrulesforfunctionaldependencies.|Solet'ssaywehaveourAattributes,ourBattributes,andourrest,andwhatweneedtoprove,toprovethemulti-valuedependencies,iswhentherearetuplesTandUwithacertainform,thereexistsatupleVofanotherform.|Solet'sfillinsomevaluesfirstforthetuples.|SoLet'ssaythatwehaveAandAhere,that'swhatweneedfortheequalityoftheAvalues.|ThenwehaveB1andR1,andwehaveB2andR2,andinordertoprovethismulti-valuedependency,IneedtoprovethatthereexistsatupleVthathasthesameAvaluethatithasB1fromtupleTandR2fromTupleU,andwhatIhaveinordertoprovethatisthefactthatwehaveafunctionaldependencyfromAtoB.|BecausewehavethefunctionaldependenciesandbecauseTandUhavethesameAvalue.|WhatthattellsusisthatB1equalsB2here.|AndsoifB1equalsB2thenweknowthatthisvalueB1hereisequivalenttoB2andinordertoprovetheexistenceofthistuplewellwehavethattupleherealreadyandwe'redone.|Soyoumightcheckthatagain,butwhatthatsaysisusingtheknowledgeofafunctionaldependencywecanprovethatwealwayshaveacorrespondingmultivalueddependencythereareacouplemorerulesformultivalueddependenciesthatyoucanproveforyourselfifyou'resoinclined.|Thefirstoneistheintersectionrule,itsaysthatifwehaveAmultideterminesBandAmultideterminesC,thenwehaveAmultideterminesBintersectsC.Thetransitiveruleisslightlydifferentthanfromexacttransitivity.|WhatitsaysisifwehaveAmultidetermineB,andwehaveBmultideterminesCthenwehaveAmultideterminednotCexactlybutCminusB.|Andyoumightworksomeexamplesbecauseityourselfwhywedon'thavejustAmultideterminesBandtosubtracttheattributesforB,althoughit'sfairlycomplicated.|Soagaintheserulescanbeprovenandtherearemanyotherrulesofmultivalueddependenciesthatyoucanreadaboutinanyofthereadingsprovidedonourwebsite.|Bytheway,regardingrules,let'scomebacktothefactthateveryfunctionaldependencyisamultivalueddependency.|SowecanuseanotherVenndiagram.|Thisisdifferentthanourpreviousone.|Wecanlistallofourmultivalueddependencieshereandthefunctionaldependenciesareasubsetofthose,sowhatthattellsusisifweeverhavearulethatappliesformultivalueddependencieshere,thatwillcovertheentireVendiagramandsothatrulewillapplyforfunctionaldependenciesaswell.|SoeveryruleforMVDsisalsoaruleforfunctionaldependencies.|OntheotherhandifwehavearulethatappliesforfunctionaldependenciesthatruledoesnotnecessarilyhavetoapplyallmultivalueddependenciesbecauseitmightbespecializedjustforthisportionoftheVenndiagram.|Soanexampleofsucharuleisthesplittingrule.|Thesplittingruleisarulethatappliestofunctionaldependencies,butdoesnotalwaysapplytomultivalueddependencies.|Andagainyoucouldworkanexampletoconvinceyourselfofthatfact.|Woo.|Soafterallthatsetupofmultivaluedependencies,we'refinallyreadytotalkaboutfourthnormalform.|ThedefinitionoffourthnormalformlooksverysimilartotheoneforBoyce-Coddnormalform.|Sayswetakearelationandwetakenowasetofmultivalueddependenciesforthatrelationandtherelationisinfourthnormalformifeverynon-trivialmultivalueddependencyhasonit'slefthandsideakey.|Rememberforfunctionaldependenciesitlooksexactlythesameexceptwehavethefunctionaldependencyallhereinsteadofmultivalueddependencies.|So,let'sseeexactlywhatfourthnormalformtellingusandwhyit'sagoodthing.|SowehaveA,B,andrestasusualandlet'ssupposethatwehaveanontrivialmultivalueddependency.|Sothat'stellingusthatifwehave2tuples,TandUandwe'llputinsomevaluesforBandtherest,thenwe'regoingtohavethecombinationofthose,aswell.|So,that'skindoftheproliferationoftupleswegetwhenwesquishindependentfactsinthesamerelation.|But,iftheleftsideisakey,soiftheAattributesareakeyherethenwewon'thavethose2tuplesandwillneverhavetoworryabouttheproliferation.|Now,rememberthatIsaidfourthnormalformimpliesBoyce-CoddNormalForm.|OrifyoupreferitinVenndiagramformat,FourthNormalFormisstrongerthanBoyce-CoddNormalFormandlet'sseewhythat'sthecase.|Ifwehaveafourthnormalformandwewanttoshowthatwe'reinBoyce-Coddnormalform,thenwehavetoshowthatifwehaveafunctionaldependencythenthelefthandsideAisakey.|Thatwouldtelluswe'reinBoyce-Coddnormalform.|Well,ifwehaveafunctionaldependency,wehadarulethattellsuswealsohavethemultivalueddependencyandthensincewe'reinfourthnormalform,wegetthatAasakey.|Soagain,fourthnormalformimpliesBoyce-Coddnormalform.|Nowlet'stakealookatthedecompositionofalgorithmintofourthnormalform.|It'sextremelysimilartotheBoyceCodd normal formdecompositionalgorithm.|Theinputisarelation.|Asetoffunctionaldependenciesandmultivaluedependenciesandweneedtoseparatethembecauseweusethefunctionaldependenciestofindkeys.|TheoutputisadecompositionofRintogoodrelations,inthiscasefourthnormalform,andit'sagooddecompositioninthesensethatreassemblingtherelationsgivesyoubacktheoriginal.|AswithBoyce-Coddnormalformwestartbycomputingkeysusingthefunctionaldependencies,andthenwerepeatthedecompositionprocessuntilallofourrelationsareinfourthnormalform.|JustaswithfunctionaldependenciesinBoyceCodd normal form,wepickarelationthathasaviolatingdependency,inthiscaseamulti-valuedependency,andwesplittherelationbasedonthatdependency.|Sowecreateonerelationthathastheattributesofthedependencyandanotherrelationthathastheleft-handsideofthedependencyandtherestoftheattributes.|Afterthat,weneedtocomputethefunctionaldependenciesforthedecomposedrelationandthemulti-valuedependenciesforit,andthenwecancomputethekeys.|Nowfindingthesemulti-valuedependenciesisactuallyafairlycomplexprocess.|Usuallyit'sveryintuitive,butI'mgoingtoreferyoutothereadingstoreadaboutthealgorithmitself.|Andinfact,itcanbesocomplicatedinthegeneralcasethatsomeofthereadingsdon'tevenprovidethealgorithm.|Butagain,ingeneral,it'sveryintuitive.|Ourfirstexampleisgoingtobeveryfasttodo.|Asyouremember,thisexamplehasonemulti-valuedependency-socialsecuritynumberdeterminescollegename,multideterminescollegename-andithasnokeysotherthanalloftheattributes.|Soobviously,thisisaviolatingmultivaluedependency,andsowedecomposeintotworelations,we'llcallthemA1andA2.|Thefirstonehastheattributesofthemultivaluedependency,thesocialsecuritynumberandthecollegename,andthesecondonehasthelefthandsidemultivalueddependencyaswellasalltheremainingattributes,whichinthiscaseisthehobby.|ThesetwodecomposedrelationsactuallyhavenoFDsandnoMVDssointhatcasewe'redefinitelyin4thnormalformandwe'redonewiththedecompositionandIthinkwecanagreethatthislookslikeagoodschemaforthedataathand.|Oursecondexampleisquiteabinary digitmorecomplicated.|Rememberinthisexamplewehavethatthesocialsecuritynumberandcollegenamefunctionallydeterminedate.|Thatmeanswehaveeachstudentappliestoeachcollegeonaspecificdate.|Andsecondly,weassumethatmajorsthatwerebeingappliedforwereindependentofhobbies.|Sowehavesocialsecuritynumber,collegenameanddatemultideterminesthemajor.|Andincidentallythatwouldmeanitmultideterminesthehobbytoo.|Onceagain,wehavenokeysfortherelation,exceptforallattributes.|Sowehavebothaviolatingfunctionaldependencyinthiscaseandwehaveaviolatingmultivaluedependency.|Let'susethemultivaluedependencyforourfirstdecompositionstep.|Sowe'llcreateA1andA2.|A1willcontainalltheattributesofourmultivalueddependency.|AndthenA2willcontainalltheremainingattributesalongwiththelefthandsideofourmultivaluedependency.|Andthatturnsouttobealloftheattributesexceptthemajor.|Nowlet'slookatourdecomposedrelationsandseewhatwehaveintermsoffunctionaldependenciesandmulti-valuedependenciesforthem.|Soafterthedecomposition,wedon'thaveanymoremultivalueddependencybutourfunctionaldependencyactuallyappliestobothofthedecomposedrelationsandwestilldon'thaveakeyonthelefthandside.|Soweneedtodecomposefurtherbasedonthefirstfunctionaldependency.|Solet'sstartbydecomposingA1.|We'llturnA1intoA3andA4,andA3willhavethefunctionaldependency,allthreeattributes.|AndthenA4willhavetheleftsideofthefunctionaldependencyandtheremainingattributes,whichinthiscaseisthemajor.|Sonowwe'refinishedwithA1andwehaveasimilarproblemwithA2.|AndsowedecomposeA2similarly,althoughwe'lldiscoverthatA3isthesamerelationinthedecompositionofA2aswegotwithA1.|Soweactuallyonlyaddonemorerelationnow,whichisA5.|Thatcontainsthesocialsecuritynumberandthecollegenamefromtheleftsideofthefunctionaldependencyandthehobby,whichistheremainingattribute.|AndthenwecrossoutA2.|Nowtheonlyfunctionaldependenciesaremulti-valuedependencieswehaveleftdohaveakeyontheleft-handside.|I'llletyouverifythatforyourself.|Andthesethreerelationsareourfinaldecompositioninto4thnormalform.|AndIthinkyouwillagreethatthisisagooddesignagainforthedataathand.|Solet'swrapupthislongunitonondependenciesandnormalformswithaquicksummary.|IfwehavearelationRABC,afunctionaldependencyfromAtoBtellsusthatwhenwehavethesameAvalues,wehavethesameBvalues,andtheBoyce-Coddnormalformtellsustofactorthat...thoseattributesintotheirownrelationsothatwedon'trepeatthatrelationshipoverandover.|Formulti-valuedependencies,let'ssaywehavetherelationRABCD,andifwehavethemulti-valuedependencyAmultideterminesB,whatthattellsusisthatwehaveeverycombinationforagivenAofBvaluesandCompact Discvalues-wecalledthoserestearlier-andwhenwehavethatmultiplicativeeffectofcombinations,again,wetaketheAandBattributesandweputtheminaseparaterelationsothatwecanseparateoutthosefactsfromtheindependentfactofAanditsCompact Discvalues.|Finally,inthedesignprocess,multi-valuedependenciesaresomethingweaddtofunctionaldependencies,onlythey'restronger.|SofourthnormalformisastrongerpropertythanBoyce-Coddnormalform.|Nowusuallythisdesignprocessworksverywellandisveryintuitiveformanyschemas,IhopefortheexamplesthatIgavehere.|ButthereareactuallyafewshortcomingstousingBoyce-CoddNormalFormorFourthNormalFormandwe'llcoverthoseinthenextvideo.|ThelastseveralvideostalkedaboutBoyce-CoddNormalformandFourthNormalformasdescribinggoodrelations.|AsaremainderBoyce-Coddnormalformisbasedonfunctionaldependenciesanditissayswheneverwehavefunctionaldependencyonarelationthelefthandsideneedstobeakeyorcontainakey.|Fourthnormalformusesmultivaluedependenciesandsayswheneverwehaveanon-trivialmultivaluedependency,againtheleft-handsideisakey.|Andasareminder,functionaldependenciesarealsomultivaluedependencies,soFourthnormalformimpliesBoyce-Coddnormalform.|WhatwecanseeinthisvideoisafewexampleswhereBoyce-CoddNormalformorFourthnormalareactuallynotnecessarilydesirableforthespecificrelationswearedesigning.|Asusualwe'llbeusingourcollegeapplicationinformationdatabase,althougheachofourexampleswillbeabinary digitdifferent.|Forourfirstexamplelet'stakealookattherelation.|Andlet'ssupposethatwehavethestudent'sSocialSecuritynumber,thecollegethattheyareapplyingto,thedateofthetheirapplicationandthemajortheyareapplyingfor.|Andfurthermore,let'ssaythateachstudentcanapplytoeachcollegeonlyonceandforonemajor.|Sothatwouldbeononedateformajor.|Furthermore,let'ssupposethatallofthecollegesinourdatabasehavenon-overlappingapplicationdates.|Andthisisobviouslycontrivedforthespecificexamplethatwewanttodemonstrate.|Soundertheseassumptions,thefunctionaldependenciesforourrelationwillbethatthesocialsecuritynumberandthecollegenamedeterminethedateandthemajor.|Andsothat'sbasedonourfirstassumption.|Andwehaveonemorefunctionaldependency,whichisthatthedatedeterminesthecollegenameandthat'sbasedonoursecondassumption.|Soifwehavetwotupleswiththesamedate,theyhavetobethesamecollegebecausecollegeshavenon-overlappingdates.|SousingthesefunctionaldependencieswecandeterminethatthekeyfortherelationisSocialSecuritynumberandcollegenametogether,sincetheydeterminetheothertwoattributes.|SoisthisrelationinBoyce-Coddnormalform?|Theanswerisno,andthereasonisthesecondfunctionaldependencywhichdoesnothavekeyonitslefthandside.|Solet'sfollowthedecompositionprocessandcreatetworelationsfromourbigrelation.|Thefirstonewillhavetheattributesfromtheviolatingfunctionaldependency.|Andthesecondonewillhavealltheremainingattributesplusthelefthandsideofthefunctionaldependency.|Sothatwouldbethesocialsecuritynumber,thedate,andthemajor.|Sodidwethinkthisisagooddesign?|ItcertainlyisinBoyce-CoddnormalformbutIwouldargueitisnotreallyagooddesign.|Wedocorrectlyfactorouttheinformationconnectingtheapplicationdatesandthecolleges.|Ontheotherhand,we'venowseparatedastudent'sapplication,thedate,andthemajoroftheirapplicationfromthecollegethey'reapplyingto,soeventocheckthisfirstfunctionaldependencyhere,wouldrequireustojointhesetworelationstogether.|Intuitivelywemightjustprefertokeepthatinformationtogether,evenifwearecapturingsomeinformationmultipletimes.|So,I'dsaynotnecessarilygooddesignhere.|Andthereisanothernormalform,it'scalledthirdnormalformandI'mnotgoingtodefineithere,butthirdnormalformactuallyallowsthisrelationheretostayasiswithoutbeingdecomposedandyoucanreadaboutthirdnormalforminanyofthereadingsmentionedonthewebsite.|Justtoputthirdnormalformincontext,we'llgobacktoourVenndiagram.|RememberthatfourthnormalformisstrongerthanBoyce-CoddNormalForm.|Soeverythingthat'sinfourthnormalformisalsoinBoyce-CoddNormalForm,andthirdnormalformisevenweakerthanBoyce-CoddNormalForm.|Soifwehavearelationthat'sinthirdnormalformit'snotnecessarilyinBoyce-CoddNormalFormandhere'sanexampleofonethat'snot,butifwehavesomethinginBoyce-CoddNormalFormitisinthirdnormalform.|Andagain,youcanreadaboutthirdnormalformonthereadingsfromthewebsite.|Foroursecondexampleletsgobacktoourstudentrelation.|Andnowwe'regoingtohaveastudent'sSocialSecuritynumber,thehighschoolsthatthey'veattended,theirGPAandtheirpriorityforadmission.|Andlet'sassumethatstudentsmightattendmultiplehighschools,andthatthepriorityisdeterminedfromtheGPA.|SointhatcaseourfunctionaldependenciesinthiscasearesocialsecuritynumberdeterminesGPA.|We'regoingtoassumethatstudentshaveoneGPA.|We'llhaveGPAdeterminespriorityandbythewaywealsohaveusingthetransitivityrule,socialsecuritynumberdeterminespriority.|Thekeyforthisrelationisthecombinationofsocialsecuritynumberandhighschoolname.|Becausestudentscouldgotomultiplehighschools,butoncewehavethesocialsecuritynumber,wedofunctionallydeterminethroughthesefunctionaldependencies,theremainingattributes,thepriorityandtheGPA.|SoisthisrelationinBoyceCodd normal form?|No,it'sclearlynot.|Andinfact,allthreeofourfunctionaldependenciesviolateBoyceCodd normal form.|Solet'sgoaheadanddothedecomposition.|Sowe'lldecomposeintoS1andS2.|Let'sstartwiththesocialsecuritynumberdeterminespriority.|Sothenwe'llhavesocialsecuritynumberandpriorityinS1.|Andintheotherone,we'llhavealltheremainingattributesandthelefthandside-highschoolnameandthatwouldbetheGPA.|Thenthesecondonestillneedstobedecomposedfurther,sothatonewillbecomeS3andS4.|S3willhavethesocialsecuritynumberandtheGPAbasedonthefirstfunctionaldependencyandthenS4willhavethesocialsecuritynumberandthehighschoolname.|AndthenwetakeawayS2.|Now,dowethinkthisisagooddesign?|Again,Iwouldsaynotnecessarily.|Itdoesn'tquitefeelright;foronethingwe'velosttheGPAtopriorityfunctionaldependency.|WecanjointhetworelationsS1andS3tocheckthatdependency,butitwouldbeniceifthatdependencyweretogetherinarelationandinfact,inthiscasewecanhaveaBoyce-Coddnormalformrelationthatdoesmaintainthatdependency.|SoifwehadmadeS1haveGPAandprioritytogether,thenwewouldn'thaveneededS3andwe'reactuallystillinBoyce-Coddnormalform.|Sothatwouldwouldhavehappenedifwehadstartedwiththefunctionaldependencywhichisalsoimplied,thatwasSSNtoGPAandpriority.|Actuallywaybackinthedecompositionalgorithm.|Imentionedthatsometimeswhenpeopleusethatalgorithmtheytrytostartwiththebiggestfunctionaldependenciestheycantogetabetterenddesign.|Andthisisacasewherewewouldwanttodothatifweprefertoendupwithadesignwithjustthesetworelations.|SooverallwiththefirsttworelationsthatillustratedwhenyouhaveBoyce-CoddNormalformandFourthNormalformit'spossiblethatafterthedecompositionthere'snoguaranteethatallofouroriginaldependenciescanbecheckedonthedecomposedrelations.|Theymayrequirejoinsofthoserelationsinordertocheckthem.|Now,letslookatadifferenttypeofexample.|Let'ssupposethatwehavearelationthatcontainsthescoresofstudentswhoareapplyingtocollege,sowe'llhavethestudent'sSocialSecuritynumbersforandtheirname.|AndthenSATscoresandACTscoresandtheymighthavemanySAT'sandACT's.|Sotheonlyfunctionaldependencywe'dhaveinthatcaseistheonethatsayssocialsecuritynumberdeterminesthestudentname,andasfaraskeysgothere'snokey.|Nowinthisexamplewedohaveamulti-valueddependency.|IfastudenthasseveralSATandACTscoreswecanassumethey'reindependentofeachother.|Andsothat'scapturedinthemulti-valueddependencythatsaysforagivenstudent,identifiedbytheirsocialsecuritynumberandname,iftheyhaveasetofSATscores,thoseSATscoresareindependentoftherestoftheattributes.|YourememberthatfromtheMVDvideo,whichinthiscasewouldbeACT.|Inthatcase,we'llhaveforeachstudenteverycombinationoftheirSATandACTscores.|Soisthisrelationsinfourthnormalform?|Well,clearlyit'snot;wehaveaviolatingmulti-valuedependencyheresinceitdoesn'thaveakeyonthelefthandsideandwealsohaveaviolatingfunctionaldependency.|Solet'squicklydothedecomposition.|We'llstartwiththemulti-valuedependencysothatwouldgiveusinthefirstrelationtheattributesofthemulti-valuedependencyandthenitwillgiveustheattributesthatareremainingplustheonesonthelefthandside.|Sosocialsecuritynumber,studentname,andACT.|Sonowwe'redonewiththemultivaluedependency.|Actuallyinthiscasebecauseit'snowatrivialmultivaluedependencywhenitcoversallattributes,andnowlet'stakealookatthefunctionaldependencythat'sstillaviolationbecausethesocialsecuritynumberisnotakeyonthelefthandsideforeitheroftheserelations.|So,we'llsplitS1intoS3andS4.|S1willcontinuetheSocialSecuritynumberandstudentname,andS4willcontaintheSocialSecuritynumberandtheSAT.|AndactuallysimilarlyneedtosplitS2.|AndthatwillgiveS5,whichcontainstheSocialSecuritynumberandtheACTscore.|AndsonowregardofS1andS2.|Anjustincaseyou'regettingconfusedatthispointthisisourfinalschema.|Andthisschemaisinfourthnormalform.|Andthat'sgood,we'veseparatedoutalltherelevantfacts.|Soactuallyitfeelslikeaprettygoodschema.|Butlet'ssupposenowthatallofthethequeriesthatwe'regoingtorunontheserelations.|Takeasocialsecuritynumberandwhattheyreturnisthestudent'snameandsomecompositescorethat'sbasedonalloftheirSATandACTscoresandagainlet'ssupposeeverysinglequerydoesthat.|Ifthat'sthecase,theneveryqueryisgoingtohaveto-recombineallofthesethreerelationsinordertocomputeit'sresults.|So,wemighthavebeenbetteroff,evenifitincludedsomeredundancyandsomeadditionalstoragewithouroriginaldesignbecauseeachqueryagainisgoingtoaccessallofthedatainthatonerelation.|So,thereissomethingcalledade-normalizerelation.|Andwhenqueriestendtoaccessallattributes,wheneveryquerywouldbereassemblingthenormalizedrelations,itactuallymightbepreferabletouseonethatisquote"de-normalized".|Andhere'sourfinalexample.|Thistimelet'stalkaboutcollegeinformation.|So,wehaveacollegeandthestateit'sin.|Let'ssupposewehavesomeotherinformationandwedecidetoputitinseparaterelationsWehavethesizeofthecollege,thenumberofstudentsinthecollege,andwemighthavetheaverageSATscoreforeachcollege,theaverageGPAforeachcollege,andmaybesomeadditionalrelations,eachcontainingonefactaboutthecollege.|SoalloftheserelationsinBoyce-CoddNormalformandFirstNormalform,yestheyare,actuallyforeachrelationwehaveafunctionaldependencyfromthecollegenametotheotherattributebuttheleftsidewillbeakeysowereinagoodshape.|Isthisagooddesign?|onceagainIsaynotnecessarily,wemaynotwanttodecomposesomuch.|Isortoffeellikethisrelationistoodecomposed,becausewecancapturealloftheinformationinonerelationoracoupleofrelationsstillbeinginBoyce-Coddnormalform.|SooneoftheproblemsIactuallyliketogiveinmydatabaseclassistocreateatheoryofcompositionthat'ssortofacomplimenttothetheoryofdecomposition,figuringoutwhenyoucantakemultiplerelationsandcombinethemwhilestillstayinginadesirablenormalform.|Soyoumightgivethatathought.|Soinconclusion,whendesigningadatabaseschema,thereareoftenmanydifferentdesignsthatarepossible,someofthedesignsaremuchbetterthanothers,andwehavetohaveasomewayofchoosingthedesignwewanttouseforourapplication.|Wedohaveaverynicetheoryforrelationaldatabasedesignthatwe'vegonethroughinthepastseveralvideos.|Wedefinenormalformsthattelluswhenwehavegoodrelations.|Wehaveaprocessfordesigningbydecomposition,andit'susuallyquiteintuitiveandworkswell.|Therearehowever,someshortcomingstothenormalformsthatwe'vedefined,andinthisvideowesawsomespecificshortcomingsinvolvingandforcingdependenciesindecomposedrelations,aboutconsideringwhatthequeryworkloadmightlooklikewhenonedoesone'sdatabasedesignandfinally,thepossibilityofoverdecomposingone'srelationsunnecessarily.|Nowlet'sturntothesubjectofqueryingeXtensible Markup Language.|Firstofall,letmesayrightupfrontthatqueryingeXtensible Markup Languageisnotnearlyasmatureasqueryingrelationaldatabases.|Andthereisacoupleofreasonsforthat.|Firstofallit'sjustmuch,muchnewer.|Secondofallit'snotquiteasclean,there'snounderlyingalgebraforeXtensible Markup Languagethat'ssimilartotherelationalalgebraforqueryingrelationaldatabases.|Let'stalkaboutthesequenceofdevelopmentofquerylanguagesforeXtensible Markup Languageupuntilthepresenttime.|ThefirstlanguagetobedevelopedwasXPath.|XPathconsistsofpathexpressionsandconditionsandthat'swhatwe'llbecoveringinthisvideooncewefinishtheintroductorymaterial.|ThenextthingtobedevelopedwaseXtensible Stylesheet Language Transformations.|eXtensible Stylesheet Language TransformationshasXPathasacomponentbutitalsohastransformations,andthat'swhattheTstandsfor,anditalsohasconstructsforoutputformatting.|AsI'vementionedbefore,eXtensible Stylesheet Language TransformationsisoftenusedtotranslateeXtensible Markup LanguageintoHypertext Markup Languageforrendering.|Andfinally,thelatestlanguageandthemostexpressivelanguageisXQuery.|SothatalsohasXPathasacomponent,pluswhatIwouldcallafullfeaturedquerylanguage.|Soit'smostsimilartoStructured Query Languageinaway,aswe'llbeseeing.|Theorderthatwe'regoingtocovertheminisfirstXPathandthenactuallysecondXQueryandfinallyeXtensible Stylesheet Language Transformations.|Thereareacoupleofotherlanguages,XLinkandXPointer.|Thoselanguagesareforspecifying,asyoucansee,linksandpointers.|TheyalsousetheXPathlanguageasacomponent.|Wewon'tbecoveringthoseinthisvideo.|Nowwe'llbecoveringXPath,XQuery,andeXtensible Stylesheet Language Transformationsinmoderatedetail.|We'renotgoingtocovereverysingleconstructofthelanguages,butwewillbecoveringenoughtowriteawidevarietyofqueriesusingthoselanguages.|TounderstandhowXPathworks,it'sgoodtothinkoftheeXtensible Markup Languageasatree.|SoI'dlikeyoutobearwithmeforamomentwhileIwritealittlebinary digitofatreethatwouldbethetreeencodingofthebookstoredatathatwe'vebeenworkingwith.|Sowewouldwriteasourrootthebookstoreelement,andthenwe'llhavesub-elementsthatwouldcontainthebooksthatarethesubelementsofourbookstore.|Wemighthaveanotherbook.|Wemighthaveoverhereamagazineandwithinthebooksthenwehad,asyoumightremembersomeattributesandsomesubelements.|WehadforexampletheISBNnumberI'llwriteasanattributehere.|Wehadapriceandwealsohadofcoursethetitleofthebookandwehadtheauthor,excuseme,overhere,I'mobviouslynotgoingtobefillinginthesubelementstructureherewearejustgoingtolookatonebookasanexample.|TheISBNnumberwenowareattheleafofthetreesowecouldhaveastringvalueheretodenotetheleafmaybe,100fortheprice,forthetitle:"AFirstCourseinDatabaseSystems",thenourauthorshadfurthersub-elements.|Wehadmaybetwoauthors'subelementshere,I'mabbreviatingabinary digit,belowhere,afirstnameandalastname,againabbreviatingsothatmighthavebeenJeffUllman,andsoon.|IthinkyougettheideaofhowwerenderourXandLasatree.|Andthereasonwe'redoingthatissothatwecanthinkoftheexpressionswehaveinXPathasnavigationsdownthetree.|Specifically,whateXtensible Markup Languageconsistsofispathexpressionsthatdescribenavigationdownandsometimesacrossandupatree.|AndthenwealsohaveconditionsthatweevaluatetopickoutthecomponentsoftheeXtensible Markup Languagethatwe'reinterestedin.|SoletmejustgothroughafewofthebasicconstructsthatwehaveinXPath.|Letmejusteraseafewofthesethingsherethatgotinmyway.|Okay.|I'mgonnausethislittleboxandI'mgonnaputtheconstructinandthensortofexplainhowitworks.|Sothefirstconstructissimplyaslash,andtheslashisfordesignatingtherootelement.|Sowe'llputtheslashatthebeginningofanXPathquerytosaywewanttostartattheroot.|Aslashisalsousedasaseparator.|Sowe'regoingtowritepathsthataregoingtonavigatedownthetreeandwe'regoingtoputa'/'betweentheelementsofthepath.|Allofthiswillbecomemuchclearerinthedemo.|SoI'lltrytogofairlyquicklynowsowecanmovetothedemoitself.|Thenextconstructissimplywritingthenameofanelement.|Iput'x'herebutwemightforexamplewrite'book'.|Whenwewrite'book'inanXPathexpression,we'resayingthatwewanttonavigatesaywe'reuphereatthebookstoredowntothebooksub-elementaspartofourpathexpression.|Wecanalsowritethespecialelementsymbol'<i>'and'<i>'matchesanything.</i></i>Soifwewrite'/<i>'then</i>we'llmatchanysub-elementofourcurrentelement.|WhenweexecuteXPath,there'ssortofanotionaswe'rewritingthepathexpressionsofbeingataparticularplace.|Sowemighthavenavigatedfrombookstoretobookandthenwewouldnavigatesayfurtherdowntotitleorifweputa'<i>'thenwenavigatetoanysub-element.</i>Ifwewanttomatchanattribute,wewrite'@'andthentheattributename.|Soforexample,ifwe'reatthebookandwewanttomatchdowntotheISBNnumber,we'llwriteISBNinourquery,ourpathexpression.|Wesawthesingleslashfornavigatingonestepdown.|There'salsoadoubleslashconstruct.|Thedoubleslashmatchesanydescendantofourcurrentelement.|So,forexample,ifwe'rehereatthebookandwewritedoubleslash,we'llmatchthetitle,theauthors,theoff,thefirstnameandthelastname,everydescendant,andactuallywe'llalsomatchourselves.|Sothissymbolheremeansanydescendant,includingtheelementwherewecurrentlyare.|SonowI'vegivenaflavorofhowwewritepathexpressions.|Again,we'llseelotsoftheminourdemo.|Whataboutconditions?|Ifwewanttoevaluateaconditionatthecurrentpointinthepath,weputitinasquarebracketandwewritetheconditionhere.|So,forexample,ifwewantedourpricetobelessthan50,thatwouldbeaconditionwecouldputinsquarebracketsifwewere(actually,betterbetheattribute)atthispointinthenavigation.|Nowweshouldn'tconfuseputtingaconditioninasquarebracketwithputtinganumberinasquarebracket.|Ifweputanumberinasquarebracket,N,forexample,ifIwritethree,thatisnotaconditionbutratheritmatchestheNthsubelementofthecurrentelement.|Forexample,ifwewerehereatauthorsandweputoffsquarebrackettwo,thenwewouldmatchthesecondoffsubelementoftheauthors.|Therearemany,manyotherconstructs.|Thisjustgivesthebasicflavoroftheconstructsforcreatingpathexpressionsandevaluatingconditions.|XPathalsohaslotsofbuiltinfunctions.|I'lljustmentiontwoofthemassomewhatrandomexamples.|There'safunctionthatyoucanuseinXPathcalledcontains.|Ifyouwritecontainsandthenyouwritetwoexpressions,eachofwhichhasastringvalue-thisisactuallyapredicate-willreturntrue,ifthefirststringcontainsthesecondstring.|Asasecondexampleofafunction,there'safunctioncalledname.|Ifwewritenameinapath,thatreturnsthetagofthecurrentelementinthepath.|We'llseetheuseoffunctionsinourdemo.|ThelastconceptthatIwanttotalkaboutiswhat'sknownasnavigationaxes,andthere's13axesinXPath.|Andwhatanaxisis,it'ssortofakeywordthatallowsustonavigatearoundtheeXtensible Markup Languagetree.|So,forexample,oneaxisiscalledparent.|Youmighthavenoticedthatwhenwetalkedaboutthebasicconstructs,mostofthemwereaboutgoingdownatree.|Ifyouwanttonavigateupthetree,thenyoucanusetheparentaccessthattellsyoutogouptotheparent.|There'sanaccesscalledfollowingsibling.|Andthecoloncolon-you'llseehowthatworkswhenwegettothedemo.|Thefollowingsiblingsaysmatchactuallyallofthefollowingsiblingsofthecurrentelement.|Soifwehaveatreeandwe'resittingatthispointinthetree,thenwe...thefollowingsiblingaxiswillmatchallofthesiblingsthatareafterthecurrentoneinthetree.|There'sanaxiscalleddescendantsdescendants,asyoumightguess,matchesallthedescendantsofthecurrentelement.|Nowit'snotquitethesameasslash,slash,becauseasareminder,slash,slashalsomatchesthecurrentelementaswellasthedescendants.|Actuallyasithappens,thereisanavigationaccesscalleddescendantsandselfthat'sequivalenttoslash,slash.|Andbytheway,there'salsoonecalledselfthatwillmatchthecurrentelement.|Andthatmaynotseemtobeuseful,butwellseeusesforthat,forexample,inconjunctionwiththenamefunctionthatwetalkedaboutuphere,thatwouldgiveusthetagofthecurrentelement.|Justafewdetailstowrapup.|XPathqueriestechnicallyoperateonandreturnasequenceofelements.|That'stheirformalsemantics.|ThereisaspecificationforhoweXtensible Markup LanguagedocumentsandeXtensible Markup Languagestreamsmaptosequencesofelementsandyou'llseethatit'squitenatural.|WhenwerunanXPathquery,sometimestheresultcanbeexpressedaseXtensible Markup Language,butnotalways.|Butaswe'llseeagain,that'sfairlynaturalaswell.|SothisvideohasgivenanintroductiontoXPath.|We'veshownhowtothinkofeXtensible Markup LanguagedataasatreeandthenXPathasexpressionsthatnavigatearoundthetreeandalsoevaluateconditions.|We'veseenafewoftheconstructsforpathexpressionsorconditions.|We'veseenacoupleofbuilt-infunctionsandI'veintroducedtheconceptofnavigationaxes.|ButtherealwaytolearnandunderstandXPathistorunsomequeries.|SoIurgeyoutowatchthenextvideowhichisademoofXPathqueriesoverourbookstoredataandthentrysomequeriesyourself.|Inthisvideo,we'lldemonstrateXPathbyrunninganumberofqueriesoverourbookstoredata.|Let'sfirsttakealookatthedata,we'veexpandeditslightlyoverwhatwe'vebeenusinginpreviousvideos,butitcontinuestohaveprettymuchthesamestructure.|Wehaveanumberofbooks.|Bookshaveattributes,ISBN,price,sometimesinaddition,theyhaveatitlesubelement,authorswithfirstnameandlastname.|Sowehaveourfirstcoursebookandourcompletebook.|Andourcompletebookalsohasaremarkasyoumayrecall.|ThenI'veaddedacouplemorebooks.|I'veaddedHectorandJeff'sDatabaseHintsbyJeffreyUllmanandHectorGarciaMolinawitharemark,anindispensiblecompaniontoyourtextbook.|I'vealsoaddedJennifer'sEconomicalDatabaseHints,forthatatamerepriceof$25yougetsomehints.|Andthenfinallyjusttodemonstratecertainexpressions,I'veinsertedthreemagazines,twoNationalGeographicsandaNewsweek.|Andfinally,amagazineseencalledHectorandJeff'sDatabaseHints.|Sowiththisdatainmind,let'smovetothequeries.|We'llstartwithsimplequeries,andgetmorecomplicatedasweproceed.|Inthiswindow,we'llbeputtingourXPathexpressionsintheupperpane,thenwe'llexecutethequeryandwe'llseetheresultsinthelowerpane.|ThewayXPathworks,thefirstpartofeveryexpressionspecifiesthedocumentdocumentoverwhichtheXPathexpressionistobeevaluated.|Sowehavethedatathatyousawinadocumentcalledbookstoreq.xmlandyou'llseeineachofourexpressionsthatwebeginbyspecifyingthatdocument,andthenmoveaheadtotherestoftheXPathexpression.|Ourfirstexpressionisaverysimplepathexpression.|ItsaysnavigatethroughtheeXtensible Markup Languagebygoingfirsttotherootelementcalledbookstore,thenlookatallthebooks...sotheelementsofbookstoreandfinallyallthetitlesofelements.|Let'srunthequeryandwewillseeourresultsbelow.|SoaswecanseeourresultshereisactuallywrittenineXtensible Markup Languagelittleheaderappears.|Andthenweseethefourtitlesofbooksthatareinourdatabase.|Nowlet'smodifyourpathexpression.|Insteadofonlygettingbooktitles,let'sgetbookormagazinetitles.|Wedothatbyextendingourmiddlematchingelementheretouseasortofregularexpressionlikesyntax,bookormagazine,andweputitinparentheses.|Sonowitsaysmatchanypathofthedatathatstartsatthebookstoreelement,followseitherabookormagazinesub-element,andthenfinallyatitlesub-element.|Whenwerunthequery,weseenowthatwegetnotonlythetitlesofourbooks,butalsothetitlesofourmagazines.|Sofar,we'vementionedelementnamesexplicitlyinourpathexpressions.|ButasImentionedintheintroductoryvideo,wecanalsousewhat'sknownasawildcardsymbol,thesymbolstar.|Starsaystomatchanyelementname.|Sonowwe'regoingtostartagainwithbookstore,matchanyelementbelowbookstore,andfinally,findtitlesofelementsbelowthoseanyelements.|Nowitsohappensthattheonlyelementsbelowbookstorearebooksandmagazines,sowhenwerunthequery,wewillgetexactlythesameresult.|Sofarwe'vebeennavigatingwiththesingleslashoperatorwhichtellsustogooneelementatatime.|We'reataparticularelementandthenwematchsub-elementswiththespecifictagthatwetyped.|Thereisalsothedoubleslashoperator.|Asyourecallfromtheintroductoryvideo,doubleslashsaysmatchmyselforanydescendantsofmyselftoanylength.|SoifIputadoubleslashtitle,whatwe'llbematchingisanytitleelementanywhereatallintheeXtensible Markup Languagetree.|Werunthequery,andagainwegetexactlythesameresultbecausewehadalreadybeengettingallofthetitleswhichweresub-elementsofbooksormagazines.|Nowlet'sgetsomethingalittledifferent.|Let'sputslash,slash,star.|Nowthat'skindofawildthingtoput,becauseitsaysI'mgoingtomatchanyelementintheentiretree,andfurthermore,itcanbeofanytheelementtype,let'srunthequeryandseewhathappens.|Whatwegetisahugeresult.|Letmejustscrolldownsoyoucanseetheresult.|Infact,whatwe'regettingiseveryelementateverylevelofthetree,includingallofitssubelements.|Soinfact,thefirstelementinourresultisourentiretreebecauseit'sourbookstoreelement.|Andwe'llgoallthewaydowntotheendofthebookstore.|Thenextelementinourresultissomechildrenofthebookstore,sowegetthebookelements.|Andwe'realsogoingtogettheirchildrenintheanswer.|Andaswekeepscrollingdown,we'llseethatwegeteveryelementoftheentiredatabase.|That'snotausefulquerybutitdoesdemonstratetheconstruct,thedoubleslashmatchinganyelementinthetreeandthestarmatchinganytagofanyelement.|Nowlet'sturntoattributes.|Let'ssupposewe'reinterestedinreturningalltheISBNnumberinthedatabase,sowe'llgobacktosayingbookstore,booksofelementsandthenwe'llgettheattributeISBN.|SowetypeatsignandISBN.|Let'srunthequeryandwegetanerror.|ItturnsoutthatattributescannotbewhatiscalledserializedinordertoreturntheminanXML-lookingresult.|Sowhatweneedtodoactuallyisobtainthedatafromtheattributeitself,andoncewedothat,we'llseethatwe'regettingtheanswerthatwedesire.|Sowe'llaskforthedataoftheattribute,runthequery,andnowweseewehaveallitsISBNnumbers.|Nowtheattributedataisjuststrings,sowe'rereturningtheISBNnumbersasasetofstringswithblanksbetweenthem.|SosomeofthesearesortofpeculiaritiesofhowXPathworks.|Again,wewerenotabletoreturnanattributebecauseitdidn'tknowhowtostructuretheresult,butonceweextractedthedatafromtheattribute,itreturneditasstringvalues.|Sofar,we'veonlyseenpathexpressionswithnoconditionsinvolved,solet'sthrowinacondition.|Let'ssaythatwe'reinterestedinreturningbooksthatcostlessthan$90.|Sowhatwe'regoingtodohereisnavigatetothebook,andthenwe'regonnausethesquarebracketwhichsaysstartevaluateaconditionatthecurrentpointofthenavigation.|SotheconditionthatI'mgoingtoputisthatthepriceofthebookislessthan90.|We'llrunthatqueryandwe'llseethatwehavetwobookswhoseprice...threebooks,Iapologize,whosepriceislessthan90.|Nowherewereturnthebookthatsatisfiedthecondition.|Whatifwhatweactuallywanttoreturnisthetitleofthebookswhosepriceislessthan90?|Whatwecandoisafterevaluatingthisconditiononthebook,wecanactuallycontinueournavigation.|Sowejustputslashtitlehere.|Itsaysfindthebooks,onlykeeptheonesthatmatchthecondition,andthencontinuenavigatingdowntotheirtitlesandreturnthatastheresultofthequery.|Werunthequeryandweseeourresult.|Nowanothertypeofconditionthatwecanputinsquarebracketsisanexistenceconditioninsteadofacomparison.|Ifweput,forexample,justthelabelremarkinsideoursquarebrackets,thatsaysthatweshouldmatchbooksthathavearemark.|Soputtinganelementnameinsquarebracketsisanexistenceconditiononthatsubelementexisting.|Oncewe'veisolatedthebooksthathavearemark,we'llreturnthetitleofthebooks.|Werunthequeryandwediscoverthattwoofourbookshavearemark.|Youcangobackandcheckthedataandyou'llseethat'sindeedthecase.|Let'sgetalittlebinary digitmorecomplicatednow.|Let'sgetridofthisqueryandputinawholenewone.|Inthisquerywe'regoingtofindthetitlesofbookswherethepriceislessthan90andwhereUllmanisoneoftheauthors.|Sonowwehaveinoursquarebracketsalongercondition.|Thepriceislessthanninetyandthereexists,andimplicitlythisisanexist,thereexistsasubpartfromthebook,authorslashauthorslashlastnamewherethevalueofthatisUllman.|Ifwesatisfybothofthoseconditionsitwillreturnthetitleofthebook,sowerunthequeryandwediscovertwobooksthatarelessthan90whereUllmanisoneoftheauthors.|Nowlet'sexpandthequerybyaddinganothercondition.|WewantnotonlythelastnameoftheauthortobeUllmanbutthefirstnametobeJeffrey.|Sonowwe'relookingforbookswhereJeffreyUllmanisoneoftheauthors,andthebooksarelessthan90.|Sowerunthequeryandwegetthesameresult,notsurprisingly,sinceUllmanisalwayspairedwithJeffrey.|Butactuallythisisnotdoingquitewhatwe'reexpecting,andI'mgonnaexplainwhybydemonstratingsomechanges.|Let'ssaythatwechangeourquerytonotlookforJeffreyUllmanasanauthorbuttolookforJeffreyWidom.|Hopefully,we'llgetnoanswers,butwhenwerunthequeryweseestillgetabook,"TheFirstCourseInDatabaseSystems."|Sothetwoauthorsofthatbook,ifyoulookbackatthedata,areJeffreyUllmanandJenniferWidom.|Solet'sseewhythatbookwasreturnedinthisquery.|Thereasonis,ifwelookcloselyatthiscondition,whatwe'resayingiswe'relookingforbookswherethepriceislessthan90andthereexistsanauthor'sauthorlastnamepathwherethevalueisWidomandthereexistsanauthor'sauthorfirstnamepathwherethevalueisJeffrey.|Well,thatinfactistrue.|WehaveoneauthorwhoselastnameisWidomandanotherauthorwhosefirstnameisJeffrey.|Let'strytoformulatethecorrectthatquerynow.|Soinsteadofmatchingtheentirepathtothelastnameandthentheentirepathtothefirstnameseparatelythroughtheauthor'ssubelements,whatwewanttodosoifwewanttolookateachauthoratatimeandwithinthatauthorlookatthelastnameandfirstnametogether.|Sotomodifyourquerytodothatwer'regoingtouseaconditionwithinthecondition.|Specificallywithintheauthorslashauthor,we'lllookatthelastnameandthefirstname.|Thissyntaxerroristemporaryoncewefinishthequery,everythingwilllookgood.|SoweputasecondbracketthereandletmeshowagainwhatI'vedone,thatsaidwe'relookingforbookswherethepriceislessthan90andthereexistsanauthorslashauthorsubelementwherethelastnameisWidomandthefirstnameisJeffrey.|Hopefully,we'llgetanemptyanswerhere.|Weexecutethequeryandindeedwedo.|NowouroriginalgoalwastohaveJeffreyUllman,sofinallywe'llchangeJeffreyUllman,runthequery,andnowwegetthecorrectanswer.|Incidentally,it'saverycommonmistakewhenwehaveaconditiontoputaslashbeforethecondition.|Ifwedidthatwewouldgetasyntaxerror.|Whenwewritethesquarebracket,itessentiallyactslikeaslashsowhenwereferenceasub-elementnamewithinasquarebracket,we'reimplicitlynavigatingthatsub-element.|Next,we'regoingtotryasimilarquerywithatwist.|We'regoingtotrytofindbookswhereUllmanisanauthorandWidomisnotanauthor.|Sowe,wenavigatethebooksasusualandwelookforcaseswherethere'sanauthorsauthorlastnameequalsUllmanandthere'sanauthorsauthorlastnamenotequaltoWidom.|Nowyoumayalreadydetectthatthethisisnotthecorrectquery,butlet'sgoaheadandrun.|Andweseethatwegotthreebooksbutweknowthefirsttwobooks,Widomisanauthorsoasyoumaydetectedthisisnotcorrect.|Whatthisasksforarebookswherethere'sanauthorwhoselastnameisUllmanandthere'ssomeauthorwhoselastnameisnotWidom.|well,infact,everybookwithUllmanasanauthorhassomeauthorwhoselastnameisnotWidom.|ThatwouldbeUllman.|SoevenifItookawaythisconditionandranthequeryagain,I'llgetexactlyforthesameresults.|Well,actuallyIgotasyntaxerror.|Iforgottoerasetheand,solet'sgetridofthat,runthequery,andnowwedoinfactgettheexactsameresult.|Soasareminder,weweretryingtofindbookswherethelast,whereUllmanisanauthorandWidomisnot,infactwedonothaveconstructyettowritethatquery.|Alittlelaterinthedemowe'llseehowwecaninakindoftrickyfashionbutforwhatwe'veseensofarwithpathexpressionsandconditions,we'reunabletowritethatspecificquery.|Sofar,we'veseentwotypesofconditionsinbrackets,wesawcomparisonsandwesawexistenceconstraintswherewecheckedtoseewhetheraparticularsubelementexisted.|Asyoumightrememberfromtheintro,wecanalsoputnumbersinsideinsquarebracketsandthosenumberstellustoreturntheFsubelement.|Specifically,ifwelookatthisquery,we'reusingslash,slashtonavigatedirectlytoauthorselementsandthenwewanttoreturnthesecondauthorsubelementofeachauthor'selement.|Sowerunthequeryandwe'llseeifwelookthatourdatathatJenniferWidom,JeffreyUllmanandHectorGarciaMelinaeachappearonceasthesecondauthorofabookoramagazine,ifwechangedthistothree,we'llbereturningthirdauthorsonlyandwecanseeonlyJenniferWidomasathirdauthor.|Ifwechangethistoten,hopefully,we'llgetanemptyresultandinfact,wedo.|Nowlet'stakealookatsomebuilt-infunctionsandpredicates.|Inthisquery,we'regoingtofindallbookswherethere'saremarkaboutthebookthatcontainsthewordgreat.|Sowe'regoingtonavigateusingslash,slashdirectlytobookelementsandwithinthebookelement,we'llhaveaconditionthatinvokesthebuiltinpredicatecontains,whichImentionedintheintroductoryvideo,whichlooksattwostringsandcheckswhetherthefirststringcontainsthesecondone.|Soifwehaveabookwherethere'saremarkwhichisastringthatcontainsthewordgreat,thenthebookmatchestheconditionandwillreturnthetitleofthebook.|Werunthequeryandweseethatwehaveonebookthathastheremarkcontainingthewordgreat.|Ournextquerydoessomethingkindofnew.|Iliketocallthisqueryaselfjoinbutthat'sprobablyonlybecauseI'marelationallybiasedperson.|Butwhatit'sactuallydoingisqueryingsortoftwoinstancesofourbookstoredataatonceandjoiningthemtogether.|Sowe'llseethatourDocBookstoreappearstwiceinthisexpression.|Letmeexplainwhatthisexpressionisdoing.|It'sfindingallmagazineswherethere'sabookthathasthesametitleasthemagazineandhere'showitdoesit.|Soourfirstpathexpressionnavigatestwomagazinesandthenitextractsintheconditionthetitleofthemagazines.|Themagazinewillmatchifthetitleequalssomebooktitleandsotofindthebooktitles,weneedtogobacktothetopofthedocumentsowegetasecondincidenceofthedocumentandwefindbooktitles.|Nowwhenwehavetheequalshere,thisequalsisimplicitlybeexistentiallyquantified.|Didyoufollowthat?|Implicitlyexistentiallyquantified.|Thatmeansthateventhoughwe'redoingequalsonwhat'seffectivelyaset,theconditionissatisfiedifsomeelementofthesetisequaltothefirsttitle.|Okay.|There'salotofimplicitexistentialquantificationgoingoninequalityinXPathandinXQuery,aswell,aswe'llseelateron.|Inanycase,let'srunthequeryandwewillgetbackthefactthatthemagazinecalled"HectorandJeff'sDatabaseHints"hasthesametitleasabook,andifyoulookbackinthedata,you'llseewedohaveabookofthesamename.|Wesawoneexampleofabuiltinpredicatecontains.|Thisexampleshowsanotherbuiltinfunction,inthiscasethenamefunction,anditalsoshowsourfirstexampleofanavigationaxis.|We'regoingtousetheparentaxis.|Whatthisqueryisgoingtofindisallelementswhoseparentelementtagisnotbookstoreorbook.|Ofcourse,thisisjustfordemonstrationpurposes.|It'snotreallythatusefulofaquery.|Butletmejustwalkthroughtheconstructionofthequery.|Sowe'restartingwithourbookstoreandthenwe'reusing//whichfindsallelements.|Wesaw//earlierwhenweranthequerywesawthatitmatchedeveryelementinthebook,inthedatabase.|Now,sincewe'vealreadyputinbookstore.|We'renotgoingtomatchthebookstoreelementitselfbutwe'llmatcheverychildofthebookstoreelement.|Sowhattheconditionlooksforisthetagoftheparentofthecurrentelementanditseesifit'sbookstoreorbookandwereturntheelementifit'sneitherbookstoreorbookattheparenttag.|Here'showwefindtheparenttag.|Sonameisabuiltinfunction,nameoperatesonanelementanditreturnsthetagofthatelement.|Theelementwewanttolookatistheparentofthecurrentelementandthewaywedothatiswiththeparentnavigationaxiswhichisparentcolon,colon.|Finally,thestarismatchingthetagsoftheparents.|Well,herewesaymatchanytagoftheparent,extractthetagandcheckifit'sbookstoreorbook.|Sowhenwerunthequery,we'llseethatwegetthatpackalotofdatabutallofthemareelementsinthedatabasewhoseparentisnotthebookstoreorbook.|Here'sanotherexampleofanavigationaxis.|Inthiscase,we'reusingfollowingsibling.|Followingsiblingsaysifweareataspecificpointinthetreeyoushouldmatcheverysiblingsoeveryotherelementatthesamelevelthat'slaterinthedocument,thatfollowsthecurrentsibling.|Solet'swalkthroughthisexpressionandseewhatwe'redoing.|Whatthisexpressionislookingforisallbooksandmagazinesthathaveanon-uniquetitle.|Inotherwords,allbooksormagazineswheresomeotherbookormagazinehasthissametitle.|Sowenavigatedowntobooksormagazineelements,thisiswhatwesawinoneofourearlierpathexpressions,we'llmatchanybookormagazineelementandthenwewanttofindonewherethetitleisequaltosometitleofalatersibling.|Nowourbooksandmagazinesareallatthesamelevelinourdatasowhenwedofollowingsibling,we'regoingtobematchingallotherbooksandmagazinesthatappearafterthecurrentone.|Andagain,thisstarsaysthatwecanmatchonelementofanytype.|Wecouldequivalentlyputbookormagazineinherebecauseweknowthey'reallbooksormagazines,andwe'lldothatinamoment,butfornowlet'sjustfocusonrunningthequery.|Soweexecutethequeryandwefindtwoanswers.|Wefind"HectorAndJeff'sDatabaseHints,"whichisabookbecausewehadamagazineofthesametitleandwefind"NationalGeographic,"whichisamagazinebecausethere'sanothermagazineofthesametitle.|Soactuallythisquerywassomewhatincomplete.|Andthatwasourfault.|Thewaywewrotethequerywesaidthatwewanttoreturnbookormagazineelementswhenalateronehasthesametitle.|Sothatdoesn'tactuallyreturnalloftheoneswithnon-uniquetitles,itonlyreturnsthefirstinstanceofeachonewithanonuniquetitle.|Let'smodifythequerytodotherightthing.|Whatweneedtodoisnotonlycheckwhetherthetitleequalsthefollowingsiblingtitleofsomebookormagazine,butwhetheritmightalsoequalaproceedingone.|Soweaddtitleequalsthesameconstructusingtheproceedingsiblingaxisslash,slash,title...|Herewego,andnowwhenwerunthequery,weseethatwegetHectorandJeff'sDatabaseHintsandNationalGeographic,butwealsogetanotherinstanceofNationalGeographicandanotherinstanceofHectorandJeff'sDatabaseHints.|Sonowwehavethecorrectanswer.|Wedon'tonlygetthefirstinstanceofduplicatedtitles,butwegetbothofthem.|Nowtoshowtheuseofthestar,wewerematchinganybookormagazineasthefollowingsibling.|Whatifallwewereinterestediniscaseswherethere'sabookthathasthesametitle,butnotamagazine,andwecandothesamethinghere.|Inthatcase,weshouldn'tget"NationalGeographic"anymore.|Let'srunthequeryandindeedallwegetinfact,is"HectorandJeff'sDatabaseHints,"asamagazinebecausethatwastheonlyinstancewheretherewasanactualbookthathadthesametitleasopposedtomatchingbooksormagazineswiththestar.|Don'ttakealookatthisqueryyet.|LetmeexplainwhatI'mdoingbeforeyoutrytountanglethesyntaxtodoit.|AsImentionedearlier,Xpathrevolvesaroundimplicitexistentialquantification.|Sowhenwearelookingforexample,foranauthorwhosenameisUllman,implicitlywewillmatchthepathifanyauthorhasthelastnameUllman.|Andingeneral,mostofXPathrevolvesaroundmatchingsetsofvaluesandthenreturningthingsifanyelementofthatsetmatchesthecondition.|Whatifwewanttodouniversalquantification,inotherwords,forall.|Thatturnsouttobemorecomplicated,butwecandoitinatrickyfashion.|So,whatI'dliketodowiththisqueryiswe'regoingtofindbookswhereeveryauthor'sfirstnameincludesJ.|Ifwewroteitinthefashionthatwemightbetemptedto,orwejustsaybookauthor/authorfirstnameincludesJ,thenwe'llgetbookswheresomeauthorsfirstnamecontainsJ.|Togetbookswhereallauthor'sfirstnamescontainsJismoredifficultandthewaywe'regoingtodoitis,it'skindofakluge,we'regoingtousethebuiltinfunctioncount.|Sohere'swhatwe'redoinginthisquery.|We'refindingallbookswherethenumberofauthorswhosefirstnameincludesJisthesameasthenumberofauthorsofthebookwithoutacondition,okay?|So,specificallyunder"book"wecountthenumberofmatchesofanauthor'sauthorsub-element,wherethebuilt-infunction,thebuilt-inpredicatecontains,istrue,wherethefirstnamecontainsJ.|AndsowearecountingthenumberofauthorswhosefirstnamecontainsJandwe'resettingthatequaltothecountofthefirstnamesub-elements.|We'llrunthequeryandwewillfind,indeed,thattherearetwobookswherealloftheauthors'firstnameincludesJ.|WecanusearelatedtricktowritethequerywetriedtowriteearlierbutfailedtofindbookswhereUllmanisanauthorandWidomisnotanauthor.|Sowiththeimplicitexistential,whathappenedbeforeisthatwefoundbookswheretherewasanauthorwhosenamewasUllmanandthentherewasanauthorwhoselastnamewasnotWidom.|Andofcourse,westillgoteverythingback.|Whatwewanttofindisbookswherethere'salastnamethat'sUllmanandwherenoneoftheauthorshavethelastnameofWidom.|That'seffectively,again,auniversalquantificationforall.|Foralloftheauthors,theirlastnameisnotWidom.|Sincewedon'thaveaforallconstructinXPath,we'reagaingoingtousethecounttrick.|Sointhisquery,we'relookingforbookswhereoneoftheauthors'lastnameisUllmanandthenumberofauthorsusing,countagain,thenumberofauthorswhoselastnameisWidomiszero.|Sonowwe'veexpressedthatquery,werunit,andwegetthecorrectanswer.|ThatconcludesourdemonstrationofXPath.|We'veshownalargenumberofconstructsandwe'vewrittensomefairlycomplicatedqueries.|Ontheotherhand,wecertainlyhavenotcoveredtheentireXPathlanguage.|Ifyou'reinterestedinourmanyonlinematerials,we'llalsoprovideadataandweencourageyoutoexperimentonyourown.|ThisvideogivesanintroductiontotheXQueryquerylanguageforeXtensible Markup Language.|Asareminder,queryingeXtensible Markup Languageisnotnearlyasmatureasqueryingrelationaldatabases.|It'smuchnewer.|Andthereisnocleanunderlyingalgebrathatisequivalenttotherelationalalgebra.|ThesequenceofdevelopmentofeXtensible Markup LanguagequeryingwhichisstartedwithXPath,whichwe'vealreadycovered.|ThenAccessLT,whichwe'llbecoveringlater;andinthisvideoandthesubsequentdemo,we'llbecoveringtheXQuerylanguage.|XQueryisanexpressionlanguage,alsoknownasacompositionallanguage.|Andwe'veseenthatalreadywithrelationalalgebra.|Whatthatmeansis,whenwerunanexpressionofthelanguageonatypeofdatatheanswertothatexpressionorqueryisthesametypeofdata.|Soletmejustdrawthepicturehere.|Wehavesomedata.|Werunanexpressionorqueryoverthatdataandwegetgetaresultbackandthatresultisalsogoingtobeinthesametypeofdata.|Thatmeanswecanrunanotherqueryorexpressionoverthesametypeofdatathatwastheresultofthepreviousone.|Andagain,we'llagain,wegetaresultofthesametypeofdata.|Nowthatalsomeansthatwecansortofputthesetogether.Andwhenweputthemtogether,thatwillgiveusadditionalexpressionsorqueriesthatarevalidinthelanguage.|Whenwetalkedaboutcompositionalityintherelationalmodel,thetypesofdatawewereusingwererelations.|Wewouldhavemaybesomerelationshere,werunaqueryoverthoserelationstheresultitselfisarelationandwecanrunfurtherqueriesoverthatrelationthat'stheanswer.|Andthenwhenwelookedatrelationalalgebra,wesawacomposingtheexpressionsofrelationalalgebraintomorecomplicatedexpressionsandeverythingworkedtogether.|IneXtensible Markup Language,it'ssimilar,excepttheexpressionsoperateonandreturnwhatareknownassequencesofelements.|Nowwe'renotgoingtogointoagreatdetailofthismodel.|AswementionedforXPath,thesequencesofelementscanbegeneratedfromaneXtensible Markup Languagedocument.TheycanalsobegeneratedfromaneXtensible Markup Languagestreamandtheinterpretationisquitenatural.|NowletmementionthatoneofthebasictypesofexpressionsinXQueryisXPath.|SoeveryXPathexpressionisinfactanXQueryexpressionoravalidqueryinXQuery.|ThenwecanuseXPathandotherconstructsofXQuerytoputtogetherintomorecomplicatedqueries.|Now,oneofthemostcommonlyusedexpressionsinXQueryiswhat'sknownastheFLWORexpression,anditlooksclosesttoStructured Query LanguageofanyoftheconstructsinXQuery.|Letmeexplainhowitworks.|WehaveuptofiveclausesinthatFLWORexpressionandthat'swheretheFLWORcomesfrom.|Thefirst,theforclause,setsupwhatareknownasiteratorvariables.|Sotheideahereisthatintheforclause,thisexpressionisevaluatedanditwillproducepotentiallyasetresult.|AndthenthevariablewillbebackedCounttoeachelementofthesetoneatatimeandthentherestoftheexpressionwillbeevaluatedforeachelement.|Soinotherwordsifthisproducesasetofendresults.|ThenwewilleffectivelyevaluatetherestofthequeriesNtimes.|Wewillseethatmuchmoreclearlywhenwedothedemonstration.|Theletclauseismoreofatypicalassignment.|Soit'sonlyrunonce,eachtimetherestofthequeryisrun.|Andsothisexpressionisevaluatedandevenifit'saset,it'sassignedoncetothisvariable.|Soit'snotiteratingnow,it'sjustdoinganassignment.|Again,it'llbecomequiteclearwhenwedothedemonstration.|Thewhereclausespecifiesaconditionandit'safilterverysimilartothefiltersthatwe'veseeninStructured Query Language.|TheorderbyisalsosortofsimilartoStructured Query Language.|Itsortstheresultssothatyoucangettheresultinaparticularorder.|Andfinallythereturnclausesayswhatwewanttoactuallygetintheresultofourquery.|Andjustasareminder,whenwestartthequerywiththefor,ifweareeffectivelyexecutingthequeryNtimestheneachoneofthoseNexecutionsmayresultinoneoftheelementsintheresult.|TheFLWORexpressionhasuptofiveclauses,butactuallyalloftheclausesexceptthereturnclauseareoptional.|Thereturnistheonlyonethat'srequiredtohaveawell-formedqueryandtogetaresult.|Ialsowanttomentionthattheforandletclausecanberepeatedmultipletimesifwewanttosetupmultiplevariablesormultipleassignmentsandtheycanbeinterleavedwitheachother.|Theydon'tneedtobeinaparticularorder.|Anextquery,it'spossibletomixqueryevaluationwithsimplywritingdowntheeXtensible Markup Languagedatathatwewantintheresult.|Andhere'sanexample.|Inthiscase,we'rewritingtheopeningandclosingtagsthatwewanttobeintheresultofourquery.|Andtheninsidecurlybraces,wewritethequeryitself.|Andwhatthesecurlybraceseffectivelysayareevaluateme.|ThecurlybracesareanindicatortotheXQueryprocessorthatwhat'sinsidethemneedstoberunasaquery,isreplacedwiththeeXtensible Markup Languagethat'sthequeryresult,andthefinaloutputisouropeningandclosingtagswiththeeXtensible Markup Languagequeryresultinside.|Atthispoint,let'smoveaheadtothedemo.|We'llonceagainbeusingourbookstoredata,andwe'lldoasequenceofXQueryexamplesoverthatdata.|Againwearenotgoingtobecomprehensive.|XQueryisabiglanguagebutwillshowtheflavorofthelanguageandalotofitsmostusefulconstructsandwe'llbeabletowritesomequitepowerfulqueries.|Inthisdemowe'regoingtorunanumberofqueriesintheXQuerylanguage.|We'llbeusingthesameeXtensible Markup Languagedatawe'veusedforpreviousdemos.|Herewecanseethebookstoredatabase,withanumberofbooks,fourbooks,andafewmagazines.|XQuerylanguageisquitecomplex.|CertainlymorecomplexthanStructured Query Language.|We'llbecoveringanumberoftheconstructs,butwewon'tbeabletocovereverything,andeventheoneswecoverwilltakealittlegettingusedto.|Ihighlysuggestthatyoutaketimetopausethevideototakealookatthequeries,orevenbetter,downloadthedataandthequeriesandtrythemforyourself.|Ourfirstqueryisafairlysimpleone,demonstratingaFLWOR,orF-L-W-O-R,expression.|That'sthebasicexpressionoftheXQuerylanguage.|HereweonlyhavetheF,WandRpart,"for""where"and"return".|ThisqueryisgoingtoreturnthetitlesofbooksthatcostlessthanninetydollarswhereUllmanisanauthor.|Let'sgoaheadandtakealookattheconstructsofthequery.|Thefourconstruct,aswedescribed,hasanexpressioninthiscaseit'sanXPathexpressionthatreturnsthebooksinourdocument.|ItbindsthevariabledollarBtoeachbookoneatatimeandruntherestofthequeryforthatfinding,thenextthingitdoesischeckwhetherthepriceofthebookislessthanninety,andwhetherthereexistsanauthorslashauthorthelastnameunderthebookelementwherethevalueofthatisUllman.|Inthecasewherebothoftheseconditionsaretrue,itwillreturnthetitleofthebook.|Let'srunthequery.|Whenwerunthequery,weseethatwegetaresultthat'sformattedaseXtensible Markup LanguagewithtwotitlesofthebooksthatcostlessthanninetyandUllmanisanauthor.|Ournextqueryisabinary digitmorecomplicated.|Itstillconsistsofafor,where,andreturnclause,butinthewhereclausewehaveexistentialquantificationandtheninthereturnclausewe'reconstructingourresultineXtensible Markup Language.|Whatthisquerylooksforisbookswherethetitleofthebookcontainsoneoftheauthor'sfirstnames.|Foreachofthosebooksitreturnsthebooktitle,andthefirstnameoftheauthor.|Soweagaininourforclause,binddollarBtoeacheachbookinthedatabase.|Theninourwherecondition,whatwelookforisafirstnamesubelementofthebookwhichgetsboundtoFN,suchthat,thatthetitleofthebookcontainsthatfirstname.|Sotheseasaexistentialquantifiedexpressionsomeinandsatisfiesourkeywords.|Sosomebindstoavariablewhichwebindintheset,andthenwecheckifanyofthosebindingssatisfythiscondition.|Again,Iurgeyoutotakeacloselookatthis.|Youmaywanttopausethevideo.|Oncewe'vedeterminedthatourbooksatisfiesthecondition,theninreturnclause,we'reconstructinganeXtensible Markup Languageelementwheretheopeningandclosingtagsarebook.|Andthenwithinthat,wereturnthetitleofthebookandwereturnthefirstnameofallauthorsofthebook.|Whew.|Solet'srunthequery.|Wefindthattherearetwobookssatisfyingtheconditionswherethereisafirstnameinthetitle,HectorandJeff'sDatabaseHintsandJennifer'sEconomicalDatabaseHints.|NowthereistrickythingherewhichisthatinHectorandJeff'sDatabaseHintsthattitledoesinfactcontainafirstnamecontainsHector,butitdoesnotcontainJeffrey.|Ourqueryreturnedthetitleofbookssatisfyingtheconditionwitheveryfirstnameofanauthorofthatbook.|Whatwe'regoingtodonextisrestricttheresultofthequerytoonlyreturnthefirstnamesthatareactuallypartofthebooktitle.|Whatwe'regoingtodoismodifythesecondportionofourreturnstatementtobealittlemorecomplicated.|Infact,we'regonnaputanentireforreturnaqueryrightinsidethebraceshere.|InXQuerywecanmixandmatchqueriesandexpressionsaswewish.|SowhatI'vedonenow,isI'magainreturningthetitlebutinthesecondclause,insteadofreturningallthefirstnames,I'mgoingtofindthefirstnamesthatarewithinthebookandwhenthetitlecontainsthefirstnamethenI'llreturnthatone.|SoeffectivelyI'mrestrictingthefirstnamesreturnedtojustbetheonesthatappearinthetitle.|Let'srunthequeryandwecanseethatcorrectlyJeffreydisappearedfromthefirstbookelementreturned.|Ournextqueryagaindemonstratesafewnewconstructs.|Firstofall,we'llbeusingtheletclauseinthisqueryratherthantheforclause.|Secondofall,we'llbeshowingsomeaggregation.|Andfinally,we'veembeddedthefullqueryinsideeXtensible Markup Language.|Sowe'veputaverages,openingandclosingtagsforourresultandwithinthat,we'reputtingourentirequery.|Ourquerysaysthatwe'regoingtoassignthevariablekeylisttotheresultofthisexpression.|Soremembertheforclauseisaniterator,whiletheletclauseisanassignment.|Sothisexpressionisgoingtofindallofthepriceattributesinthedatabase,assignittheP-Listasalist,andthenitwillreturntheaverageoftheelementsinthatlist.|Let'sgoaheadandrunthequery,andweseethatouraveragebookpriceissixtyfive.|Wecanactuallyrunthisqueryinanevenmorecompactfashion,wecanassignvariable'A'tobetheaverageofthisentireexpressionhere,andthenwecanjustreturn'A'.|Notmuchmorecompact,butperhapsalittlebinary digitmoreintuitive.|Let'sdothat,let'serasetheanswertorunthequeryagain,andagainwegetthesameresult.|Nowlet'sseeaquerywhereweuseboththe"let"andthe"for"expressions.|Inthisquery,we'regoingtostartbyassigningdollarAtotheaveragebookprice,justlikewedidinthepreviousquery,andthenwe'regoingtofindallbookswherethepriceofthebookisbelowaverage.|Sowe'll,again,asinpreviousqueries,assigndollarBoneatatimetothebooksinourdatabase,andthenforeachonewe'llcheckifthepriceislessthantheaveragepricethatwehadfromour"let"clause.|Ifitis,we'llreturnthebookelement,andwe'llreturnthetitleofthebookandwe'llput,asasubelementinthisbookelement,theprice.|Andherewecanseewherewe'retakinganattributeandwe'returningitintoanelement.|Sowehaveourattributetheprice,weobtainthedata,aswesawweneededtodointheXdemo,andweplaceitinsidethepriceelement.|Let'srunthequery,andweseeindeedthatwehavetwopriceswhosebooksarebelowaverage,andherewe'veconvertedthepricefromanattributetoasubelement.|Asareminder,theFLWORexpressioninXQueryhasaFor,Let,Wear,Orderby,andReturn.|Weseeinalloftheclausesexceptthe"orderby".|Solet'sseethe"orderby"inthisexample.|We'regoingtofindthetitleandpricesofbooks,justaswefoundbefore.|We'llconvertthepricetoasubelement.|Butinthiscasewewanttoordertheresultbythepriceofthebook.|Sowedosobyaddingthisclauseherebetweentheforandreturnsayingwewanttoorderbythepriceeasyenough.|Werunthequeryandweseeoutresult.|Actuallyitdoesn'tlookquiterightdoesit?|Wehaveonehundredbefore2550andeightyfive.|Well,that'sbecausepriceisactuallyastring,andsoitwasdoingalexicalgraphicorderingofthestring.|Wecanfixthateasilybycallingabuilt-infunctioncalledXS:INTthatconvertsthatvaluetoaninteger.|Whenwerunthequerynow,wegetthecorrectorderingbasedonthevaluesoftheprice.|Nowthatwe'veseenordering,let'stakealookatduplicateelimination.|Let'saquerythatfindsallthelastnamesinourdatabase.|SowewriteasimplequerythatsaysforallnamesintheXPathexpressionthatfindsthelastnamesand,justasareminder,hereweusethedoubleslashthatlooksatanydepthintheeXtensible Markup Languagetreeandpicksoutthelastnames,willreturnthoselastnames,andweknowthattheseareourlastnames,andwe'vegotmanyrepeatsofthembecausetheselastnamesappearseveraltimesinthedatabase.|Solet'sseeaboutgettingridofthoserepeats.|Thereisabuilt-infunctioninXQuerycalled"distinctvalues".|Sowhatwecandoisadddistinctvalueshereinourforclause.|Wecanapplyittothelastname,andnowourdollarNwillbeboundtoeachvalueonlyonceandthenwe'llreturntheresult.|Werunthequery,andwefindthatwehaveourthreelastnamesappearingonlyonce,butit'sprobablynotquitewhatwewanted.|Thistimewhenwerundistinctvaluesitjustturnsthesethreevaluesintothreeseparatestringsandthereturnsoneatatimeratherthanembeddingthemwiththelastnametag,whichwaswhatwegotwhenwedidn'tusedistinctvalues.|Soifwewantthelastnametag,thenwecanaddthelastnameheretoourreturnclause,let'sjustputintheopeningtagandtheclosingtagwasputinforus.|Solet'sputdollarNhere.|Sonowwe'veaddedopeningandclosingtagstoourpreviousquery,werunitandwhoopswhatdoweget,wegotdollarN.Thisisareminderthatwhenwewriteareturnclauseifwewantactuallyhaveanexpressionevaluatedinthecurlybrackets.|SobyputtingdollarNincurlybracketshere,nowtheexecutionenginewillactuallyevaluatethisqueryandputtheresultwithintheopeningandclosingtags,werunthequeryandnowfinallywegotexactlywhatwewerelookingfor.|Thethreelastnamesthatappearinthedatabasewiththeduplicateseliminated.|Inapreviousquerywesawexistentialquantificationinthewhereclause.|Wewereusingthesomekeyword.|S-O-M-E.Nowwe'regoingtoseeuniversalquantificationinthewhereclause.|Soforall,andforthatweusetheeverykeyword.|Whatthisqueryfindsisbookswhereeveryauthor'sfirstnameincludestheletterJ.|Onceagain,weusetheforclausetobind$Btoeverybookinthedatabase,andthenforeachbook,wecheckourwhereclause.|Ourwhereclauserequiresthateveryfirstnamethat'sasub-elementinthatbooksatisfiestheconditionwherethefirstnamecontainstheletter"J".|Ifwehavesuchabook,thenwereturnitasaresultofthequery.|Sonowwecanseethatourresultis"AFirstCourseinDatabaseSystems"and"Jennifer'sEconomicalDatabaseHints",becauseforbothofthose,allofthefirstnamesincludetheletter"J".|ThisquerydemonstrateswhatIliketocallaselfjoin,becauseit'scombiningtwocopiesofthebookdata.|Specifically,whatthequeryislookingforaretitlesofbooksthatshareacommonauthor,andwe'llassumewe'rejustlookingforcommonlastnames.|Thisisalsothefirstquerywe'reseeingwherewehavetwocopiesoftheFORclause.|Sowe'resettinguptwoiteratorvariables,essentially,onecalledB1andonecalledB2,thatarebothiteratingoverthebooksinthedatabase.|Ifyou'dliketothinkofthisinrelationalterms,itwouldbesimilartohavingtwocopiesofthebooktable--oneofthemboundtovariableB1andonetovariableB2.|ThenwhatwelookforintheWHEREclauseiswhetherB1andB2haveanauthorlastnameincommon.|AndwedothatbycheckingthesetwoXPathexpressionsandseeingifthey'reequal.|NowwesawthisbehaviorinXPathandwe'reseeingitagainhere,wheretheWHEREclausehaseffectivelyanexistentialquantificationoccurringautomatically.|Whatit'slookingforisifthereissomelastnameunderB1thatisequaltosomelastnameunder"B2",evenif"B1"or"B2"havemanylastnames.|Inthecasewherethatequalityissatisfied,thenwewillconstructabookpair,wherewereturnthefirsttitleandthesecondtitle.|Andhere,we'retakingthetitleswhichwereoriginallyattributes.|Ohno,I'msorry,thosewereoriginallysub-elements.|We'retakingthosesub-elementtitlesandwe'recallingthemtitle1andtitle2.|Solet'sgoaheadandrunthequery,andwedidgetabunchofbookpairs,probablymorethanweexpected.|Nowallthesebooksdoinfacthaveacommoncommonlastnameintheirauthors,butwhatweforgottodowaseliminatebookswiththemselves.|Becauseofcourseeverybookhasincommon,alastnamewithitself.|Solet'smodifyourquerysothatwereturnonlybookswheretheyaretwodifferentbooks,andwecandothatfairlyeasilybyjustsaying$b1/titleisnotequalto$b2/title.|Okay,herewewego.|WerunthequeryandwegotanerrorbecauseItypedBluetoothinsteadofB2.|Let'srunthatagain.|Alright.|Andnowweseethatwenowarenotgettingthepairsofbookswiththemselves.|We'restill,perhaps,gettingmorethanweexpected,however.|What'sgoingon?|Well,onethingwe'reseeingisthatwe'regettingeverypairtwiceinbothorders,ifyoutakealookatthedata.|Sothisisasameoldtrickthatyoumayrememberbackfromtherelationalqueryexamples,insteadofdoingnotequals,let'strydoinglessthan.|Inotherwords,we'regoingtoreturneachpaironce,andwe'regoingtohavethelexicalgraphicallylesserbooklistedfirst.|Nowwe'verunthequeryagain,andnowweseeweactuallygotwhatwewereexpecting.|Asourgrandfinale,we'regoingtoinvertourbookstoredatabase.|ThewaywesetupoureXtensible Markup Languagedata,wehadourbooks,andthenunderneathourbookswehadtheauthorsofthebooks.|Whatifwewanttoinsteadourdataconstructedwherewehavetheauthorsastheouterelements,andwithineachauthorwelistthebooksthatthey'vewritten.|Nowtounderstandthisquery,you'reabsolutelygoingtoneedtopausethevideo.|Letmejustbrieflyshowwhat'sgoingon.|Butagainitwouldtakequitesometimetogothrougheverydetail.|Thewaywearegoingtoconstructourinvertedbookstoreistofindtheauthorsbylastnameastheoutermostportionofourquery.|Foreachauthor'slastname,we'regoingtogettheirfirstnames,andthenwe'regoingtoreturntheauthorwiththefirstname,thelastname,andnextfindallofthebooksthatwerewrittenbythatauthor,returnthebookwiththeirISBNpricetitle.|Okay?|Again,Iurgeyoutopausethevideoandlookverycloselyatwhat'sgoingon.|Orevenbetter,downloadthedatainthequery,runityourself,andplaywithituntilyouunderstandit.|Let'softhequeryandwe'llseeourresult.|Justscrollupalittlebinary digithere.|Andwe'llseehowthequerydideffectivelyinvertthebookstore.|Nowwehaveourauthorsastheoutermostelements.|Withineachauthor,thefirstoneJeffreyUllman,wehavethebooksthatwerewrittenbythatauthor,includingtheirISBNandpriceasattributesandthetitleasasub-element.|Nowinmyoriginalversionofthequery,Ididn'tincludetheeditionortheremarksincethosedidn'tappearineverybook.|Butinfact,itdoesn'tcauseanyproblematalltoaddthosein.|Soletmejustaddrightheretheedition.|Sowe'reusingdollarBasourvariableforthebookandtheeditionisanattribute.|Again,noteverybookhasanedition,butwe'llseethatit'snotgoingtocauseaproblemwhenitdoesn't.|Andsimilarly,downherewe'llincludetheremark,again,forthosebooksthatincludethem.|Let'srunthequeryandlet'stakealookatourresultsandseewhathappened.|SoforJeffreyUllman'sfirstbook,wegottheedition,forthesecondbookwegottheremark,andeverythingjustworkedoutjustfine.|So,again,thereisourinvertedbookstore.|ThatconcludesourdemonstrationoftheXQuerylanguage.|I'llagainemphasizethatit'saverylargelanguage,verypowerful.|We'veseenanumberofdifferentconstructs.|We'vewrittensomeprettyinterestingqueries.|Buttofullyunderstandthelanguage,you'llneedtorunabunchofqueriesforyourself,andexperimentwithhowitworks.|Inthisvideowe'llintroducequeryingeXtensible Markup LanguagedatausingeXtensible Stylesheet Language Transformations.|Asareminder,queryingeXtensible Markup Languagedataisnotnearlyasmatureasqueryingrelationaldataduetoitbeingmuchnewerandnothavinganiceunderlyingalgebraliketherelationalalgebra.|WealreadytalkedaboutXPathwhichwasthefirstlanguagedevelopedforqueryingeXtensible Markup Languagedata.|Andwe'vealsotalkedaboutXQuerywhichwasactuallydevelopedaftereXtensible Stylesheet Language Transformations,butit'ssimilartoXPathinit'sstyle,whereeXtensible Stylesheet Language Transformations,whichwe'regoingtocoverinthisvideo,isactuallyquitedifferent.|eXtensible Stylesheet LanguagestandsfortheExtensibleStylesheetLanguage,anditwasintroducedoriginallybutsoonextendedtoincludedtransformationsandeXtensible Stylesheet Language TransformationsiscurrentlymuchmorewidelyusedthaneXtensible Stylesheet Language.|Here'showwecanthinkofeXtensible Stylesheet Language Transformationsasaquerylanguage.|WehaveaneXtensible Stylesheet Language TransformationsprocessorandwefeedtothatprocessoroureXtensible Markup Languagedataintheformofadocumentorastream.|AndwealsogivetheprocessoraspecificationineXtensible Stylesheet Language Transformations,whichbythewayisexpressed,usingtheeXtensible Markup Languageformat.|Theprocessortakesthedataandthespecification,andittransformsthedataintoaresult,whichisalsoexpressedasaneXtensible Markup Languagedocumentorstring.|Nowifwethinkabouttraditionaldatabasequeryprocessing,there'sactuallyanaturalmapping.|Ifwethinkevenaboutrelationalprocessing,wehaveaqueryprocessorandadatabase.|Wefeedthedatatothequeryprocessor,wefeedthequerytothequeryprocessoraswell,andoutcomestheanswer.|SoeXtensible Stylesheet Language Transformationsprocessing,althoughitreallyisthroughtransformations,itcanbethoughtofverymuchlikequeryingadatabase.|SoeventhougheXtensible Stylesheet Language Transformationsbethoughtofasaquerylanguage,thequeryparadigmitselfisquitedifferentfromwhatwe'reusedtowithStructured Query LanguageorevenwithXPathorXQuery.|It'sbasedfundamentallyonthenotionoftransformingthedata.|Andthattransformationoccurswithrules.|Tounderstandwhattherulesdoandhowthetransformationswork,it'sagainveryinstructivetothinkoftheeXtensible Markup Languageasatree.|Solet'stakeourbookstoredataandagainmakeitatreeaswedidbeforewhenwewerefirstlearningaboutXPath.|Sowehavesomebookssub-elementsandwehaveamagazinesub-elementandIwon'tbeelaboratingallofthese.|We'lljustimaginesub-treesherewithourbookwehaveatitleandwehavesomeauthors.|Thetitlemightbeourleafsowe'llhaveafirstcourseindatabasesystemsforexample,whereasourauthorsmayhaveauthorsub-elements,andwithinthoseauthorsub-elementswemighthavefirstnamenameandlastname,abbreviatedhere,withstringvaluesforthose,andofcoursemoreauthorssub-elementsaswell.|SothatgivethebasicideaofatreestructureofeXtensible Markup Language,exactlyaswe'veseenbefore.|Sonowlet'sseewhathappenswitheXtensible Stylesheet Language Transformationsinlightofthistreestructure.|Sothefirstthingthatwehaveistheconceptofmatchingatemplateandreplacingit.|SotheideaineXtensible Stylesheet Language TransformationsisthatwecanwriteanexpressionthatfindsatemplatethatfindsportionoftheeXtensible Markup Languagetreebasedontemplatematching.|Forexamplewemightfindbooksthathavecertainauthorsandoncewefindthosewillactuallyreplacetheentiresubtreewiththeresultofwhatweputinourtemplate.|Forexample,wemightdecidethatwanttopickthetitlehereandreplacethisentiresubtreewiththetitle.|Orwemightmatchdowntoourauthorsandwemightfindourfirstnameandlastname,andsayreplacethisentireauthorsub-elementwiththeconcatenationofthefirstandlastname.|Againtheideabeingthatyouwritetemplatesthatmatchwithinthetree,using,infact,XPathaswe'llseeasoneoftheportionsofwritingthosetemplates,andthenreplacethatportionofthetree.|Wecanalsodothatrecursively.|Sowecan,forexample,decidethatwe'regoingtoreplacethisbookwithadifferentelementandthenrecursivelyapplyourtemplatestoitschildren.|We'llseethatinademo.|Ittakesalittlegettingusedtoagain.|TheeXtensible Stylesheet Language Transformationslanguagehastheabilitytoextractvalues,andagainitoftenusesXPathexpressionsinordertodothat.|Italsohassomeprogramminglanguage-likeconstructs.|IthasaForEachsowecandoiteration,andithasconditionalssowecandoif.|Allofthesewillbemuchbetterseeninthedemo.|Finally,I'llhavetomentionthatthere'ssomesomewhatstrangebehaviorhavingtodowithwhitespaceineXtensible Markup Languagedataandsomedefaultbehavior,whichwe'llseeinthedemo.|Andthere'salsoanimplicitpriorityschemewhenwehavemultipletemplatesthatcanallmatchthesameelements.|Solet'smovedirectlytothedemo.|We'reagaingoingtobeusingoursamebookstoredataandwe'llseeanumberofeXtensible Stylesheet Language Transformationsexamples.|EvenmorethanXQueryorXPathourexampleswillnotbeexhaustive,buttheywillgiveaflavorofthelanguageandyou'llbeabletoexpresssomefairlypowerfulqueriesusingjustwhatweshowinthevideos.|Nowlet'sseeeXtensible Stylesheet Language Transformationsinaction.|Letmefirstexplainwhatwehaveonthescreen.|Intheupperleftwindowwehavethedocumentthatwe'llbequeryingover.|It'stheexactsamebookstoredatathatwe'vebeenusingforallofourexamples.|SoI'mactuallygoingtomakethatalotsmaller,sothatwecanseeourtemplatesbetter.|Intheupperrightcorner,eXtensible Stylesheet Language Transformationstemplates.|Andeveryexamplewe'regoingtodoisgoingtohaveusopeningandclosingastylesheetwithsomeparametersistotellushowwe'dliketodisplayourresults.|AndthenI'llbeputtingdifferenttemplatesbetweenthoseopeningandclosingtags.|NoticeagainthateXtensible Stylesheet Language TransformationsisexpressedusingeXtensible Markup Languageoncewehaveourdataandoursetoftemplatematchingruleswe'llrunourtransformationandinthebottomwe'llseeourresult.|Soyoucanthinkofitasaqueryintheupperright,thedataintheupperleft,andtheresultdisplayedinthebottom.|NowevenmorethanXQuery,it'snotgoingtobepossibletoexplaineverysingleintricacyofthetemplatesthatwe'regoingtowrite.|SoIagainencourageyoutopausethevideototakealook,aswellasdownloadthedatafileandthetransformationfilesothatyoucanexperimentwiththemyourself.|Ourfirstexampleisgoingtodosomeverysimpletemplatematching.|It'sgoingtolookforbooksub-elementsandwhenitfindsthem,it'sgoingtoreplacethosebooksub-elementswithabooktitleelement,thevalueofthetitlecomponentofthebookandaclosingtagbooktitle.|Andit'ssimilarlygoingtomatchmagazinesofelementsandreplacethosemagazinesofelementswithanelementthat'sanopeningtagofmagazinetitle,thevalueofthetitle,sub-elementofthemagazine,andtheclosingtag.|SoagainthetemplatewilllookthroughtheeXtensible Markup Languagetree.|Theywillmatchthesubelementsinthetree.|It'llmatchthebookofelementsandthemagazineofelements.|Andforeachoneitwillreplacethosesubelementswiththeexpression,inthiscasewithouropeningandclosingtagsthathavechangedandthevalueofthetitle.|Werunthetransformationandwesee,indeed,thattheresultsareourfourbooktitles,nowopeningandclosingtagsthatarebooktitles,andourfourmagazinetitles.|Forournextexample,we'regoingtoonlymatchbooksthatsatisfyacondition.|WedothatbyinourmatchingexpressionusingXPath.|Nowthere'sonesmallstrangethinghere,whichiswecan'twritethelessthansymbol,weactuallyhavetousetheescapesymbolforlessthan.|Butotherwise,thistemplatefindsbookswhosepriceattributeislessthan90,justlikewedoinXPathusingthesquarebracketsforconditions,andwhenitmatchesthosebooks,whatitdoeshereisitcopiesthosebooks.|SothisisanimportantconstructthatsaysifImatchthebook,I'llcopythebook,I'llselectdotwhichthecurrentelement,soineffectit'ssayingfindthebooksandretainthemexactlyastheyare.|Let'srunthetransformationandtakealookatwhatweget.|Wecanseethatwegotthisbookbecauseit'spriceis85andwehaveanotherbookwhosepriceis50andanotherbookwhosepriceis25.|Butwedoseesomethingalittlebinary digitstrangehere.|Wegotourbookssowealsohavethesestringshere.|Theselongbitsoftextthatwewellwedon'treallyknowwheretheycomefrom.|WellthisisoneofthepeculiaritiesofeXtensible Stylesheet Language Transformations.|Whenyouhaveelementsinyourdatabasethataren'tmatchedbyanytemplate,whateXtensible Stylesheet Language Transformationswilldoisactuallyreturntheconcatenationofthestringleafortextleafvaluesofthoseelements.|Iknowitseemskindofstrange.|There'sactuallyasimplefixforthat.|We'regoingtoaddasecondtemplatethatmatchesthosetextelementsandforthosereturnsnothing.|Soherewe'veaddedatemplateandletmeexplain.|Whatwe'rematchinghereiselementsthatsatisfythetextpredicatessothatwillmatchthoseleaftextelementsandwhenwewriteatemplatethathasnobody,soweopenthetemplateandthenweclosethetemplatewithnobodyatall,thatsaysmatchtheelementandthendon'treplacewithanythingatall.|Sothisisveryusefulconstruct,thetemplatesthatdon'thaveabody,forgettingridofportionsofthedatawe'renotinterestedin.|Solet'srunthetransformationnowandtakealookattheresult,andnowwhenwescrolldownweseethatallofthatextraneoustextthatwesawinthepreviousexampleisnowgone.|Soaswe'veseen,eXtensible Stylesheet Language Transformationsworksbydefiningtemplatesthatarematchedagainstthedata.|Whenaportionofthedataismatchedbyatemplatethetemplatesayswhattodo.|Wemightplacethatportionofdatawithsomethingdifferentandwemightjustremovethatportionofthedatafromtheanswerorwemightjustcopyitoverintotheanswer.|Nowlet'sexplorewhathappenswhenwehaveportionsofthedatathatarematchedbymorethanonetemplateinoureXtensible Stylesheet Language Transformationsspecification.|Soherewe'regoingtohavethreetemplates.|Thefirsttwotemplatesbothmatchbookelements.|Thefirsttemplatesayswhenwematchabookelement,justthrowitaway.|Again,thisisanexampleofthetemplatewhenwedon'thaveabodythatsayseliminatethematchedelementsfromtheanswer.|Thesecondtemplatesaystodoexactlytheopposite.|Sayswhenwematchabooksub-element,keepthatbooksub-elementexactlyasitis.|Asareminder,thisbodyheresayscopythecurrentelementintotheresult.|Ourthirdtemplatematchesmagazines,andthisonewejusthaveoneanditsayscopythemagazineintotheresult.|Solet'sgoaheadandrunthistransformationandseewhathappens.|Well,firstofall,wegotanambiguousrulematch,sothat'sgood.|Thesystemrecognizedthatwehavetwodifferentrulesthatarematchingthesameelement.|Butthenitdiddecidetogiveusaresult.|Solet'stakealookatwhathappened.|Itdidreturn,infact,allofthebooksinthedatabaseaswellasallthemagazines.|Sowecanseethatitchosetousethesecondtemplateinsteadofthefirsttemplatewhenwehadtheambiguity.|Solet'stryanexperiment.|Let'stakeourtwobooktemplatesandlet'sjustreversetheirorder.|Sonowwehavetheonethatcopiesfirst,andtheonethateliminatessecond.|Let'srunthetransformation,andindeed,somethingchanged.|Wenolongergotthebooks.|Sowhatwecandeducefromthatisthatwhenwehavetwotemplatesthatbothmatchandwegetthisambiguitywarning,itstilldoesthetransformationanditchoosesthesecondofthematchingtransformations.|Actually,itturnsoutnottobequitethatsimple.|Itdoesn'talwayschoosethesecondone.|Inthisexample,we'regoingtochangeourfirsttemplatetomatchonlybookswhosepriceislessthan90.|Sowe'llusethesamesyntaxweusedbeforethatbefore.|Wehavetoescapethatlessthancharacterlikethis.|Lessthan90.|Closeourscorebracket.|Sonowourfirsttransformationsayswhenwefindbooksthatarelessthan90,let'sreturnthem,andwhenwefindanybook,let'snotreturnit.|Soagainwe'regoingtohavesomeambiguity;let'srunthetransformation.|Well,weactuallydidn'tgetanambiguityerrorthistime,orwarning,andthereasonisthateXtensible Stylesheet Language Transformationsactuallyhasabuilt-innotionofsometemplatesbeingmorespecificthanothers,andwhenatemplateismorespecific,itisconsideredthehigherprioritytemplate.|Sowhathappenedwhenweranthisparticulartransformationisthebooksthat,wherethepricewaslessthan90,werematchedbythefirsttemplateandbecausethatone'sconsideredmorespecifictheywerenotmatchedbythesecondtemplate.|Sowecanseebelowthatwedidgetbackallofthebooksthatarelessthan90,andnoneoftheotherbooks,andagain,wegotbackallofourmagazines.|Solet'smakeonelastchangetoexperiment.|Let'stakeoursecondbook,andlet'saddtoitasimpleconditionthat'ssatisfiedbyeverybook,whichistheconditionthatthebookhasatitlesub-element.|Again,thisisXPath.|Now,perhapsourtworuleshaveequivalentspecificity,inwhichwecasewewouldagainhaveambiguity.|Let'sjustdeleteourresulthereandthenlet'srunthetransformationandseewhathappens.|Indeed,nowwehaveanambiguousrulematchbecausebothofthesetemplateshaveacondition,sotheyareconsideredequivalentagain,justwhen,justlikewhenneitherofthemhadacondition.|Andnowthatthey'reconsideredequivalent,againthesecondoneisgoingtotakeprecedence,becauseasyoucanseewedidn'tgetanybooksinourresult.|Soeventhoughwehavesomebooksthatarelessthan90,thosebooksalsohaveatitle,sothosebookswerematchedbythesecondtemplateandtheywerenotreturned.|SowhatyoucanseefromtheseexamplesisthatyoudoneedtobeverycarefulwhenyouwriteeXtensible Stylesheet Language Transformationsprogramsorqueries,wheremultipletemplateswillmatchthesamedata.|Nowlet'slookatacoupleofdifferentwaysofcopyingourentireinputdataasaresultofourquery.|Ourfirstexampleisthesimplestone.|Wewriteatemplatethatmatchestherootelementofthedocument.|AsyoumayrememberfromXPath,asingleslashistherootelement.|Andthenasthebodywehavethatcopyoftemplatethatcopiestheentirecurrentelement.|Let'srunthetransformationandwewillseethewegetourentiredatabaseasaresult.|Incidentallywecouldchangethatslashtobebookstore.|Itwoulddoexactlythesamething,sinceourbookstoreisourrootelement.|Okay,deletethis,runthetransform,andonceagain,wegettheentiredatabaseasourresult.|NowI'mgoingtoshowactionwithamuchmorecomplicatedwayofcopyingtheentiredocument,butitusesanimportantkindoftemplatethatwe'llseeinothercontexts.|Thistemplateisourfirstexampleofrecursivelyapplyingtemplatestoourresult.|WhatwehavehereisatemplatethatmatchesabsolutelyanythingineXtensible Markup Languagedata.|Thisisactuallyanex-path-expressionthatsaysmathanelementwithstar,thatmeansanyelementtag,anyattribute,atstar,oranytextleafoftheeXtensible Markup Languagedata.|Soagainthisor-constructhereisseenquitefrequentlyineXtensible Stylesheet Language Transformationsspecificationstomatchjustanythingatallinthedata.|Whenanythingatallismatchedthatelementofthedataiscopied,andthenthetemplatesareappliedrecursivelytoeverythingbelowthat'sofanytype.|Soitmaybebestjusttotakemywordforit,oryoucanspendsometimeonyourownthinkingaboutexactlywhythisworksbut,again,theideathatwematchanytypeofelementinoureXtensible Markup Languageelement,attributeortext,andwecopythatobject,andthenweapplythetemplatestoallofitssub-elementsrecursively,againcopyingthem.|Nowobviouslythisisnotthebest,theeasiestwaytocopyanentiredocument.|Wesawtheeasiestwaytodoitwithourpreviousexample,butwe'llsoonseewhythisparticulartemplateisvaluable.|Whenwerunit,ofcoursewegetbacktheentiredocument.|Nowthereasonthatthistypeoftemplateisvaluableisthatwecanusethisasoneofourtemplatesandthenaddadditionaltemplatesthatgiveusexceptionstocopyingthewholedocument.|Andthatwillallowustocopythewholedocumentexceptwithchangesincertainparts,andwhatI'maddinghereactuallyisawholebunchofadditionaltemplates.|Sothefirstonesays:applyalltemplatesrecursivelytolinktotheentiredocument.|Thesecondsays,"Whenyoufindwhileyou'reapplyingthemrecursivelythatyou'reatanattributecalledISBN,we'llchangethattoasub-element."|Sowe'llmatchtheISBNattribute.|We'llchangeittoasub-element,similarlytowhatwesawbeforebygivinganopentagISBNandthevalueofthecurrentelement.|We'llsimilarlytakeourattributes,ourpriceattributes,andchangethemtosub-elementsandoureditions,ourmonths,andouryearsandourmagazine.|Andlastofall,we'llalsomakeachangetoourauthors.|Whenwematchanauthor,insteadofhavingsub-elements,we'llconvertthosesub-elementstobeattributes,thelastnameattributeandthefirstnameattribute.|Solet'srunthetransformation,andwe'llseeourdataisnowsignificantlyrestructured.|Wehaveourbookstoreandwehaveourbooks,butourISBNnumbersarenowsub-elements,andinourauthorsthelastnamesandfirstnamesareattributes.|Andallofthebooksarerestructuredinthatfashionandourmagazinesagainhaveattributesrestructuredassub-elements.|Nowlet'sseewhatwouldhavehappenedifweranthiseXtensible Stylesheet Language Transformationsspecificationbutwedidn'thavethismegatemplateatthebeginningthatdoestherecursiveapplicationoftemplatestotheentiredatabase.|Whenwerunthetransformationnow,well,wegetakindofsurprisingresult.|Wewon'ttrytoanalyzeitinitsentirety.|It'sacombinationofonlymatchingautomaticallyofsub-elementsandnotattributes.|Andfurthermore,dumpingoutallthetextleaveslikewesawinanearlierexample.|So,again,presumingthatwewouldnotwantthistobeourresult,thatshowsthenecessityofincludingthesortofgenerictemplatethatmatcheseverytypeofobjectinthedatabase,andrecursivelyappliestemplatestoitschildren.|Nowlet'sswitchgearsentirely.|Whatwe'regoingtodointhistransformationiseffectivelywriteaprogram.|We'regoingtousethe"foreach"and"sorting"andan"If"statement,andtheprogramisfurthermoregoingtotaketheeXtensible Markup Languagedataandit'sgoingtotransformitintoHypertext Markup Language,whichwecanthenrenderinabrowser.|Soit'sjustonetemplatethatmatchestherootelementofourdocument,andoncethatrootelementismatched,itspitsoutthetagHypertext Markup Language,itsetsupthetable,soagainwe'reactuallywritingtheresulthere,andputsomeheadersforthetable.|Andthenweseeaforeachthatsayswe'regoingtorunthebodyoftheforeachforeachbookinthedatabase.|We'regonnasorttheresultbyitsprice.|Ifthepriceislessthan90,thenwe'regoingtogeneratearowinthetable.|Andthatrowisgoingtobesetupwithitalicsforthetitle,andit'sgoingtogivethevalueoftheprice,it'sgoingtoclosetherow,andwe'regoingtocloseallthetags.|Soagain,thisisquitedifferentinacoupleofways.|Firstofall,thatit'swrittenmoreinaprogrammaticstyle,andsecondofallthattheresultactuallygoingtobeHypertext Markup Language.|Let'srunthetransformation,andwecanseetheresulthere,whichisindeedHypertext Markup Language.|Infact,wecantakethisveryHypertext Markup Languageandwecanrenderitinabrowserandseehowniceitlooks.|Andhereitis.|Wecanseeverybeautifullyformattedthethreebooksthatcostlessthan90,sortedbyprice,withthetitleinitalics,allformattedinanHypertext Markup Languagetable.|AndthatwaswithnotaverycomplicatedeXtensible Stylesheet Language Transformationsprogram.|Soit'snotsurprisingthateXtensible Stylesheet Language TransformationsisusedfrequentlyforfortranslatingdataexpressedineXtensible Markup LanguagetoHypertext Markup Languageformatforrendering,aswellasbeingusedasaquerylanguage.|Ourlasttwoexamplesarebacktoamoretraditionaltemplatematchingstyle.|Againwe'regoingtostartwiththisrecursivetemplatematchthatmatcheseverythinginthedatabase.|Thatmeanswe'regonnacopyeverythingoverexceptwe'regonnamakeonetypeofchange.|Specifically,we'regoingtochange...we'regoingtotakeJenniferoutofthedatabaseandthenwe'regoingtochangeWidomtoMs.Widom.|SoeveryplacewherewehaveJenniferasthefirstnameandWidomasthelastname,we'llendupwithjustaname,Ms.Widom.|Specifically,wedoitwithtwotemplates.|ThefirsttemplatesayswhenwefindafirstnamewherethedatainthatfirstnameequalsJennifer...okay,sowe'reagainareusingthedottorefertothecurrentelement.|Thedataisabuilt-infunction.|Soafirstnamethat'sequaltoJennifer.|Whenwematchthat,wewantto...we'llactuallyreturnnothing.|There'snobodyinthistemplate,sothatwillremovethatelement.|Nowyoumightwonderwhywedidn'tjustwriteaconditionthatsaidfirstnameequalsJennifer.|Theproblemis,towritethatcondition,thecurrentelementwouldbetheparent,andwedon'twanttoremovetheparent,weactuallywanttoremovethefirstnameitself.|InadditiontoremovingfirstnamesthatareJennifer,we'llalsomatchlastnametemplateswherethevalueisWidomandwewillreplacethosewithanopeningtagname,thestringisWidom,andaclosingtagname.|Solet'srunthetransformationandlet'stakealook.|AndwewillseeinthecasewheretheauthorwasJenniferWidom,it'snowthesingleelementnameMs.Widom,andweshouldseethatoccurafewothertimesinthedatabaseaswell.|Asourverylastexample,let'sperformthesametransformation,butlet'sdoitwithjustonetemplate.|Whatwe'lldoiswe'lllookforofficeofelementswherethefirstnameequalsWidom.|Nowwedon'tneedtousedata.|SofirstnameequalsWidom.|Andwe'lltakethoseentireauthorsub-elementsandwe'llreplacethemwithanauthorsub-elementwherethenameisWidom.|Soweneedtoputauthorhere.|Let'sgetridofthisautomaticsimplygeneratedclosingtab;wewantittobeoverhere.|We'llgetridofthisfirsttemplate.|Soagain,we'regoingtomakeexactlythesamechange,butwe'regonnadoitwithasingletemplate.|It'sgoingtolookforauthorswherethefirstnameis...whoops,bettermakethatJennifer.|Andit'sgoingtoreplacethemwiththeauthorsub-elementwithjustMs.Widom.|Werunthetransformationandlet'stakeaquicklookatwhatwegot.|Andweagainseeexactlythesameresult,withasomewhatsimplerprogram.|ThatconcludesourdemonstrationofeXtensible Stylesheet Language Transformations.|Again,we'veshownonlysomeoftheconstructs.|Wehaven'tgoneintogreatdetailorwalkedthroughthesyntax.|eXtensible Stylesheet Language Transformationsisverypowerful.|We'veseenquiteafewdifferentthings.|We'vealsoseenalittlebinary digitofnon-intuitivebehavior.|Wehavetobealittlecarefulwithwhitespace.|Wehavetobealittlecarefulwhenwehavemultipletemplatesthatmatchthesamedata.|Butoncewegetitallfiguredout,itcanbequitepowerfulfortransformingdataandforqueryingdata.|ThisvideotalksaboutdatamodelingandUser-Mode Linux,theUnifiedModelingLanguage.|Theareaofdatamodelingconsistsofhowwerepresentthedataforanapplication.|We'vetalkedagreatlengthabouttherelationaldatamodel.|Itswidelyusedandwehavegooddesignprinciplesforcomingupwithrelationalschemas.|WealsotalkedabouteXtensible Markup Languageasadatamodel,eXtensible Markup Languageisquiteabinary digitnewerandtherearenodesignprinciplesthatareanalogoustotheonesfortherelationalmodel.|Butfrequentlywhenpeoplearedesigningadatabase,they'llactuallyuseahigherlevelmodelthat'sspecificallyfordatabasedesign.|Thesemodelsaren'timplementedbythedatabasesystem,ratherthey'retranslatedintothemodelofthedatabasesystem.|Solet'sdrawapictureofthat.|Let'ssupposethatwehavearelationaldatabasemanagementsystemwhichisabbreviatedRelational Database Management Systemoften,andI'lldrawthatasadiskjustoutoftradition.|So,ifwecreateadatabaseinarelationalsystemthedatabaseisgoingtoconsistofrelations.|butinsteadofdesigningrelationsdirectly,thedatabasedesigner,we'lldrawthatuphere,willuseinsteadahigher-leveldesignmodel.|Thatmodelwillthengothroughatranslator,andthiscanoftenbeanautomaticprocessthatwilltranslatethehigherlevelmodelintotherelationsthatareimplementedbythedatabasesystem.|Sowhatarethesehigher-levelmodels?|Historically,fordecadesinfact,theentityrelationshipmodel,alsoknownastheERmodel,wasaverypopularone.|Butmorerecentlytheunifiedmodelinglanguagehasbecomepopularforhigher-leveldatabasedesign.|Theunifiedmodelinglanguageisactuallyaverylargelanguage,notjustfordatabasedesigns,butalsofordesigningprograms.|Sowhatwe'regoingtolookatisthedatamodelingsubsetofUser-Mode Linux.|Bothofthesedesignmodelsarefundamentallygraphical,soindesigningadatabase,theuserwilldrawboxesandarrows,perhapsothershapes.|Andalsobothofthemcanbetranslated,generallyautomatically,intorelations.|Sometimestheremaybelittlehumaninterventioninthetranslationprocess,butoftenthat'snotnecessary.|SointhedatamodelingsubsetofUser-Mode Linux,therearefivebasicconcepts.|Classes,associations,associationclasses,sub-classes,andcompositionandaggregation.|We'rejustgoingtogothrougheachoneofthoseconceptsinturnwithexamples.|SothatclassconceptinUser-Mode Linuxisnotspecifictodata-modeling.|It'salsousedfordesigningprograms.|Theclassconsistsofanamefortheclass,attributesoftheclass,andmethodsintheclass,andthat'sprobablyfamiliartoyouagainfromprogramming.|Fordatamodelingspecifically,weaddtotheattributestheconceptofaprimarykey,andwedropthemethodsthatareassociatedsincewe'refocusing,really,onthedatamodelingatthispoint.|Sowe'llbedrawingourexamples,asusual,fromaimaginarycollegeadmissionsdatabasewithstudentsandcollegesandstudentsapplyingtocollegesandsoforth.|Sooneofourclasses,notsurprisingly,willbethestudentclass.|AndinUser-Mode Linuxwe'lldrawaclassasaboxlikethis,andatthetopweputthenameoftheclassandthenweputtheattributesoftheclass,solet'ssupposethatwe'lljustkeepitsimple.|We'llhaveastudentID,astudentname,andfornow,thestudent'sGPAanddownhereinUser-Mode Linuxwouldbethespecificationofthemethods.|Againwe'renotgoingtobefocusingonmethodssincewearelookingatdata-modeling,andnottheoperationsonthedata.|Andsoonedifferenceisthatwe'llhavenomethods.|Anotheristhatwespecifyaprimarykeyifwewishandthat'sspecifiedusingtheterminologyPK.|Sowe'llsaythatthestudentIDinthiscaseistheprimarykey.|Andjustasinkeysintherelationalmodel,thatmeansthatwhenwehaveasetofobjectsforthestudentclass,eachobjectwillhaveauniquestudentID.|TherewillbenostudentIDsrepeatedacrossobjects.|inourcollegeapplicationdatabase,we'realsolikelytohaveaclassforcolleges,sowe'llhaveaclassthatwecallcollege.|Andfornow,we'llmaketheattributesofthatclass,justthecollegenameandthestate.|AndagaininfullUser-Mode Linux,theremightbesomemethodsdownhere.|Andwe'llmakethecollegenameandthiscasebetheprimarykey.|Sowe'reassumingnowthatcollegenamesthemselvesareunique.|Sothat'sitforclasses.|Prettystraightforward,theylookalotlikerelationsandofcourse,theywilltranslatedirectlytorelations.|Nextlet'stalkaboutassociations.|Associationscapturerelationshipsbetweenobjectsoftwodifferentclasses.|SoletssupposeagainthatwehaveourstudentclassandIwon'twritetheattributesnow,I'lljustwriteitlikethatandwehaveourcollegeclassinourUser-Mode Linuxdesign.|Ifwewanttohavearelationshipthatstudentsapplytocolleges,wewritethatjustasalinebetweenthestudentsandthecollegeclassesandthenwegiveitaname.|Sowe'llcallitappliedandthatsaysthatwehaveobjectsinthestudentclassandobjectsthatareinthecollegeclassthatareassociatedwitheachotherthroughtheappliedassociation.|Ifwewanttointroduceadirectionalitytotherelationship,sotosaythatstudentareapplyingtocolleges,wecanputinaarrowthere,that'spartoftheUser-Mode Linuxlanguagealthoughwe'llseethatitdoesn'treallymakemuchdifferencewhenweenduptranslatingUser-Mode Linuxdesignstorelations.|Whenwehaveassociationsbetweenclasses,wecanspecifywhatwecallthemultiplicityofthoseandthattalksabouthowmanyobjectsofoneclasscanberelatedtoanobjectofanotherclass.|Sowe'llseethatwecancaptureconceptslikeone-oneandmany-oneandsoforth.|Solet'slookspecificallyathowwespecifythoseinaUser-Mode Linuxdiagram,andfornowI'lljustusetwogenericclasses.|Solet'ssayIhaveaclassC1andIhaveaclassC2,andlet'ssaythatIhaveanassociationbetweenthosetwoclasses,sothatwouldbealine.|AndIcouldgivethataname,let'scallitA.|Let'ssaythatIwanttospecifythateachobjectinClassC,wellI'mjustgoingtowritethoseobjectskindofasdotsherebelowtheclassspecification.|Let'ssaythatIwantedtosaythateachoneofthoseisgoingtoberelatedtoatleastMbutatmostNobjectsinclassC2,sohereareclassC2objects.|I'mgoingtohavethiskindoffanoutinmyrelationship.|TospecifythatintheUser-Mode LinuxdiagramIwritethatasM..andontherightsideoftheassociationlineandagainthat'ssayeachobjecttheninC1,thenwillrelatedtobetweenMandNobjectsofC2.|Nowtherearesomespecialcasesinthisnotation.|IcanwriteMdotdotstar,andstarmeansanynumberofobjects,sowhatthatwouldseeisthateachobjectin"C1"isrelatedtoatleast"M"and,asmanyasitwants,elementsof"C2".|IcanalsowritezerotoendandthatwillsaythateachobjectinC1isrelatedtopossiblynoneforexampleherewehaveonethatIhaven'tdrawanyrelationstips.|PossiblynoneanduptoNelementsofC2.|Icanalsowritezerodotdotstar,andthat'sbasicnorestrictionsonthemultiplicity.|Andjusttomention,thedefault,actually,isonedotdotone.|Soifwedon'twriteanythingonourassociationwe'reassumingthateachobjectisrelatedtoexactlyoneobjectoftheotherclassandthat'sinbothdirectionsbytheway,soIcanputaX..Yhereandnowwe'llrestricthowmanyobjectsofelementofC2isrelatedto.|IncidentallyUser-Mode Linuxallowsomeabbreviations,1..1canbeabbreviatedasajustplainoldoneand0..canbeabbreviatedwithjuststar.|Solet'stakealookatourstudentandcollegeexampleandwhatthemultiplicityoftheassociationofstudentsapplyingtocollegesmightbe.|Solet'ssupposethatweinsistthatstudentsmustapplysomewhere,sotheyapplytoatleastonecollegebutthey'renotallowtoapplytomorethan5andfurthermoreletssaythatnocollegewilltakemorethan20,000applications,sothisexampleiscontrivedtoallowmetoputmultiplicityspecificationsonbothsides.|Soagain,we'llhaveourstudentclassandwe'llhaveourcollegeclassandwe'llhaveourassociationbetweenthestudentandthecollegeclass,andI'lljustwritethenameunderneathhere.|Nowapplied.|Soletsthinkabouthowtospecifyourmultiplicitiesforthis.|Sotospecifythatastudentmustapplysomewherebutcannotapplytomorethan5colleges,weputaonedotdotfiveonthisside.|Itreallytakessomethinkingsometimestorememberwhichsidetoputthespecificationon.|Butthat'swhatgivesusthefanoutfromtheobjectsonthelefttotheobjectsontheright.|Soitsayseachstudentcanapplytouptofivecollegesandmustapplytoatleastone,sowewon'thaveanywhohaven'tappliedanywhere.|Ontheotherside,wewanttotalkabouthowmanystudentscanhaveappliedtoaparticularcollege,andwesaiditcanbenomorethan20,000.|Wedidn'tputalowerrestrictiononthat,sowewouldspecifythatas0to20,000.|SoImentionedearlierthatmultiplicityofassociationscapturessomeofthesetypesofrelationshipsyoumighthavelearnedaboutsomewhereelsecalledonetoone,manytoone,andsoon.|So,letmeshowtherelationshipbetweenassociationmultiplicityandthisterminology.|Soifwehaveaone-to-onerelationshipbetween"C1"and"C2,"technicallyone-to-onedoesn'tmeaneverythinghastobeinvolved.|Whatitreallymeansisthateachobjectoneachsideisrelatedtoatmostoneontheotherside.|Sotosayit'saone-to-onerelationshipwewouldputa"zero,dot,dot,one"onbothsides.|Let'sseeifIcanusesomecolorshere.|Sowhataboutmany-to-one?|Many-to-onesaysthatwecanhavemanyelementsof"C1"relatedtoanelementof"C2,"buteachelementof"C2"willberelatedto,atmost,oneelementof"C1."|Sointhatcasewestillhavea"zero,dot,dot,one"ontherightsideindicatingthateach"C1"objectisrelatedtoatmostoneobjectof"C2"butwehavethestaronthelefthandsideindicatingthatC2objectscanberelatedtoanynumberof"C1"objectsand,asareminder,starisanabbreviationfor"zero,dot,dot,star."|Manytomanyhasnorestrictionsontherelationships.|Sothatwouldbeastaronbothsides.|Prettysimpleandthelastconceptistheideaofcompleterelationships.|Soacompleterelationshipiscomplementarytotheseothers.|Itsaysthateveryobjectmustparticipateintherelationship.|Sowecanhaveacompleteonetoone,andthatwouldbeonedotdotoneonbothsides.|Wecouldhaveacompletemanytoone,andthatwouldbeontheleftsideonedotdotstar,andontherightsideonedotdotoneand,finally,acompletemanytomanywouldbeonedotdotstaroneachside.|Asareminder,thedefaultifwedon'tspecifythemultiplicityisaonedotdotonebothsides.|Sothatwouldbeacompleteonetoonerelationship.|Ok,we'vefinishedwithclassesandwithassociations.|Nowlet'stalkaboutassociationclasses.|Associationclassesgeneralizethenotionofassociationsbyallowingustoputattributesontheassociationitselfand,again,we'lluseourexample.|Sowealreadyknewhowtospecifythatstudentsapplytocolleges,butwhatifassociatedwiththeapplicationwewantedtohave,forexample,thedatethattheyappliedandmaybethedecisionofthatapplication.|Wedon'treallyhaveawaytodothatwithoutaddinganewconstruct,andthatconstructiswhat'sknownasanassociationclass.|Sowecanmakeaclassandwe'lljustcallit"AppInfo".|Anditlookslikeaclass,it'sgottheboxwiththenameatthetopandtheattributes.|Andthenwejustattachthatboxtotheassociation,andthattellsusthateachinstanceoftheassociationbetweenastudentandacollegehasadditionalinformation,adateofthatapplicationandthedecisionofthatapplication.|Nowthere'sacoupleofthingsIwanttomention.|Firstofall,inanumberofexamples,I'llprobablyleaveoutthemultiplicitiesontheendsoftheassociations.|Thatdoesn'tmeanI'massumingthedefaultoneone.|It'sjustwhenit'snotrelevant,I'mnotgoingtofocusonthataspect.|Nowwhenwehavestudentsassociatedwithcolleges.|Sowehaveastudentherewehaveacollege.|Thenwehaveanassociationbetweenthose.|Nowwhatwe'resayingisthatassociationisgoingtohaveaffiliatedwithitadateandadecision.|WhatwecannotdescribeinUser-Mode Linuxisthepossibilityofhavingmorethanonerelationshiporassociationbetweenthesamestudentandthesamecollege.|Sowhenwehaveanassociationthatassumesatmostonerelationshipbetweentwoobjects.|So,forexample,ifwewantedtoaddthepossibilitythatstudentscouldapplytothesamecollegemultipletimessomaybeyouknowthatwanttoapplyforseparatemajors.|Thatwouldactuallyhavetobecapturedquitedifferently.|We'dhavetoaddaseparateclassthatwouldfortheapplicationinformationwithseparaterelationshipstothestudentsandcolleges.|Sothisisa,inmymind,aslightdeficiencyofUser-Mode Linux.|Again,thatanditonlycaptures,atmost,onerelationshipbetweenthetwospecificobjectsacrossthetwoclasses.|Now,sometimeswecanmakeadesignthathasanassociationclassanditturnsoutwedidn'treallyneeditandwe'regoingtocomebacktomultiplicitiestoseehowthiscanhappen,soagainlet'stakealookatjustgenericclassesC1andC2.|Let'ssaythatwehaveanassociationbetweenthemandthenwehaveanassociationclass.|We'lljustcallitAlternating Current.|Andthat'sgonnahavesomeattributes,wecancallthemA1andA2fornow.|Andofcourse,there'sattributesinC1andC2aswell.|Let'ssupposethatthemultiplicityon,let'ssaytheleftsideisstarsoanythinggoes,andontherightsidewehaveonetoone.|SowhatthatmultiplicitysaysisthateachobjectOfC1isrelatedtoatmostoneobjectofC2.|So,actuallyexactlyoneobjectinthiscase.|Soweknowthatthere'sgoingtobejustoneassociationforeachobjectofC1,andifthere'sonlygoingtobeoneassociationactuallywecouldtaketheseattributesandwecouldputthoseattributesaspartofC1insteadofhavingaseparateassociationclass,soforexampleIfthisclasshappenedtobethestudentclass,andthiswasthecollegeclass,andweinsistedthateachstudentapplytoexactlyonecollegethentheattributeswehaddownhere,thedateanddecision,couldbemovedintothestudentclass,becauseweknowthey'reonlyapplyingtoonecollege,sothatwouldbethedateandthedecisionfortheonecollegethey'reapplyingto.|Furthermore,ifwehadzerodotdotone,wecanstillmovetheseattributeshereand,inthatcase,ifastudentwasnotinvolvedinacollege-hadnotappliedtoacollegeatallor,moregenerally,anobjectof"C1"wasnotrelatedtoanyobjectof"C2"thenthoseattributeswouldhavetheequivalentofnullvaluesinthem.|Bytheway,itispossibleforanassociationtobebetweenaclassanditself.|Forexample,wecouldhaveourstudentclassandmaybewe'regoingtohaveanassociationcalled"sibling",astudentbeingassociatedwithanotherstudentbecausethey'resiblings,anassociationbetweenaclassinitselfiswrittenwithalinetgatjustgoesbetweentheclassanditself.|Andthenwecouldlabelthatsibling.|Andformultiplicitieswecanassumethateverystudenthasbetween0andanarbitrarynumberofsiblingsletssay,sowecanputastaronbothendsofthatassociation.|Amoreinterestingassociationmightinvolvecollegeswheresaywehaveforeverycollegeaflagshipmaincampus.|Butthensomecollegeshaveseparatebranchorsatellitecampuses,sothatwouldbeanassociationbetweenacollegeanditselfsayingthatonecollegeisabranchofanothercollege.|Nowlet'sthinkaboutthemultiplicitieshere.|Firstofall,whenwehaveaselfassociation,inUser-Mode Linuxwe'reallowedtolabelthetwoendsoftheassociation.|SoIcould,forexample,sayononeendwehavethehomecampus.|Andonanotherendwehavethesatellitecampus.|Andnowwiththoselabelswecanseetheasymmetryandthatletsusgetourassociationsright.|Solet'ssaythateverysatellitecampusmusthaveexactlyonehomecampus,sothatwouldbeaonedotdothereandeveryhomecampuscanhaveanynumberofsatellitecampuses.|Oractually,let'ssaysomethingelse.|Let'ssayeveryhomecampuscanhavebetweenzeroandtensatellitecampusesbeazerodotdottenonthatsideoftheselfassociation.|Ok,we'refinishedwiththefirstthreelet'smoveontosubclasses.|Forsubclasseswe'regonnadoafairlylargeexamplethatinvolvesstudentsthatwe'regonnaseparateintoforeignstudentsanddomesticstudents.|We'realsogoingtoseparatelyspecifystudentswhohavetakenAPclassesandthosewillbeourAPstudents.|Sowe'regoingtohavethestudentclassasthetopofourhierarchyandthestudentclasswill,again,havethestudentID,let'ssaythestudentname,andGPA,andwe'llsaythethestudentIDistheprimarykeyforobjectsinthatclass,we'regoingtohavethreesubclasses,oneisgoingtobetheforeignstudents,we'llcallitforeignS,oneisgoingtobethedomesticstudentsandthenwe'realsogoingtohaveasubclassforAPstudents.|andI'mgoingtoassumethatyoualreadyknowalittlebinary digitaboutsubclassingfromprogramming.|Sotheideaisthatwhenwehaveasubclass,thereareattributesthatarespecifictotheobjectsthatareinthatsubclassandthey'llinherittheattributesfromtheirsuperclass.|Sowe'regonnamakestudentbeasuperclasshere.|Andthisishowwedrawit,withthreesubclasseshereforforeignstudent,domesticstudent,andAPstudent.|Andwe'llsaythatforeignstudentshaveinadditiontoastudentID,astudentnameandGPA,acountrythattheycomefrom.|We'llsaythatDomesticstudentsaregoingtohaveastatethattheycomefromandwe'llalsosaythattheyhaveaSocialSecuritynumber,whichwedon'tknowthatforeignstudentswouldnecessarilyhave.|APstudents,interestingly,isgoingtobeempty.|It'snotgoingtohaveanyadditionalattributes,buttheAPstudentsarethestudentsthataregoingtobeallowedtohavearelationshipwithAPcourses.|We'llsaythattheAPcoursehasacoursenumberandthat'sprobablytheprimarykey.|Andmaybeatitleforthecourseandsomeunitsforthecourse.|AndthenwhenoneofourAPstudentstakesthecourse.|We'llcallthis"Associationtook".|We'regoingtohaveanassociationclassthatgoesalongwiththat,that'sgoingtohavetheinformation,let'scalledit"APinfo",aboutthemtakingthatparticularAPclassandwe'llsaythatassociationclasshasforexampletheyearthattheytooktheclassandmaybethegradethattheygotintheclass.|Andlastlylet'saddsomemultiplicities.|Let'ssaythatAPstudentscantakebetweenoneandtenAPclassesbuttheytakenatleastonetobeanAPstudentandlet'ssaythateverycoursehastakenbyatleastonestudentandarbitrarynumberofstudents.|SothisisoneofthebiggestUser-Mode Linuxdiagramswe'veseensofar.|Again,thisisasuperclassuphere.|Andwehaveoursubclassesdownhere.|Andthenwealsohaveanassociation,andanassociationclass,andsomemultiplicities.|AndagainnoticethatisokthattherearenoattributesintheAPstudentsubclassthatsubclassesdefineasthosestudentwhohavetakenAPcourse.|Herearesometerminologyandpropertiesassociatedwithsubclassrelationships,asuperclassesandUser-Mode Linuxaresometimescalledgeneralizationwithsubclassescalledspecializationandsomesubclassrelationshipissaidtobecompleteifeveryobjectinthesuperclassisinatleastonesubclassandit'sincompleteifthat'snotthecaseandincompleteisalsosometimesknownaspartial,asubclassrelationshipisknownasdisjointifeveryobjectisinatmostonesubclass.|Inotherwords,wedon'thaveanyobjectsthatareinmorethanonesubclass,andthat'ssometimescalledexclusive.|Andifit'snotdisjoint,thenit'soverlapping,meaningthatobjectscanbeinmultiplesubclasses.|Wecanhaveanycombinationofthesepairs,sowecanhaveincompleteoverlapping,orincompletedisjoint,acompletedisjointthatarecompleteoverlapping,letstakealookbackatourexample,forthisexamplewewillprobablyhavethecasethatit'sacompletesubclassrelationship.|Inotherwords,everystudentisinatleastonesubclass,presumablyeverystudentiseitheraforeignstudentoradomesticstudentandfurthermore,we'regoingtosaythatit'soverlappingbecausewewillhavestudentswho,forexample,arebothadomesticstudentandanAPstudent.|AndinUser-Mode Linux,theactualnotationistoputlittlecurlybracesheretospecifythatthatsubclassrelationshipiscompleteandoverlapping.|Toillustratesomeoftheothercases,let'ssupposethatwedidn'thavethiswholesectionherewiththeAPstudents.|Weonlyhadforeignanddomesticstudents.|Inthatcase,wewouldsaythatthesubclassrelationshipiscomplete.|Butinthatcaseitwouldnotbeoverlapping.|Itwouldbedisjoint.|Orsupposewedidn'thavethiswholeleftsideheresoallwehadwastheAPstudentsubclass.|Inthatcase,itwouldprobablybeanincompletecompletesubclassrelationshipbecausenoteverybodyisanAPstudentandtheywouldn'tmakeanydifferencebetweenoverlappinganddisjointssincetherewouldbeonlyonesubclassinthatcase.|Okaywe'venowmadeittoourlastconceptwhichiscompositionandaggregation.|LetmestartbyclarifyingrightoffthataggregationherehasnothingtodowithaggregationinStructured Query Language.|Well,it'sacompletelydifferentconcept.|Solet'sfirsttalkaboutcomposition.|CompositionisusedwhenwehaveadatabasestructurewhereobjectsofoneclasskindofbelongtotheobjectsofanotherclassandtheexampleIamgoingtouseiscollegesanddepartments.|SoI'vedrawnthetwoclasseshere.|Andlet'ssayforthedepartmentwehavethedepartmentnameandwehavesaythebuildingthatthedepartmentisin.|Andsowe'reassumingthateachcollegehasawholebunchofdepartments,nowwecanmakearelationship,anassociationbetweencollegesanddepartmentstosaythatthedepartmentisinacollegebutwhenwehavetheideathatthedepartmentsbelongtoaspecificcollegethenthat'swhenthiscompositionconstructisused.|Andthewaythecompositioniswrittenisbyputtingadiamondoverhereontheendoftheassociation.|Socompositionisreallyaspecialtypeassociation.|Andwe'llfillinthatdiamondheretoindicatecomposition.|Aggregationhappenstohaveanemptydiamondwhichwe'llseeinamomentsowhenwehavethediamondandwe'recreatingoneofthesecompositionrelationshipsthere'simplicitlyaonedotdotoneontheleftsidesoeachdepartmentbelongstoonecollegebutwhat'skindofinterestinghere,what'slittledifferentfromthenormalrelationshipisthatwe'renotassumingthatthisdepartmentnameisaprimarykeyexactly.|Wecouldhavethissamedepartment,infacteveninthesamebuilding,indifferentcollegesandthatwouldbeokaybecauseadepartmentisthroughthisrelationshipassociatedwithit'scollege.|Sothatwascomposition,objectsofoneclassbelongingtoobjectsofanother.|Letmegiveanexampleofaggregation.|ThisisaslightstretchbutwhatI'mgoingtomakeisaclassofapartments.|Notdepartmentsbutapartments.|Sowe'regoingtoimaginethatthereareapartmentbuildingsrepresentedinourdatabase,maybetheyhaveanaddressthattheprimarykeyandsomethinglikethenumberofunits,andwhatwe'regoingtoimagineisthatsomeapartmentbuildingsareownedbyorassociatedwiththecollegebutnotallofthemare.|Andthat'swhataggregationdoes.|Soforaggragationweagainhavearelationshiphere,butinthiscase,wemakeadiamondonthissidethatisopen,andwhatthatsaysisthateachapartment,eachobjectintheapartmentclassisbelongingtoacollegeeitheratmostonecollegeornocollegeatall.|Sowecanhaveapartmentsthatbelongtoacollegewecanhave,kindof,free-floatingapartmentsandthat'swhattheopendiamond,whichisaggregation,isabout.|Soinconclusion,thedatamodelingportionoftheUnifiedModelingLanguagecanbeusedtoperformdatabasedesignatahigherlevel.|It'sagraphicallanguage.|Wewentthroughthefivemainconceptsofthelanguage,andalsoveryimportantlyUser-Mode Linuxdesignscanbetranslatedtorelationsautomatically.|Andthatisthetopicofthenextvideo.|Inthisvideowe'regoingtolearnabouttranslatingdesignsintheUser-Mode Linuxmodellinginter-relationalschemas.|Asareminderiftheapplicationdeveloperisusingahighleveldesignmodelthentheywillcreatetheirdesignusuallyusingagraphicallanguagethat'ssenttoatranslatorandthetranslatorwillthenproduceaschemausingthedatamodeloftheunderlinedatabasemanagementsystem,whichfrequentlyisrelational.|So,inourcasewe'relookingathighleveldesignintheUser-Mode Linuxdatamodelingsubsetwhichisthentranslatedtorelationsandinstalledinarelationaldatabasesystem.|It'sthistranslationprocessthat'sthetopicofthisvideo.|InthedatamodelofsubsetofUser-Mode Linux,wehavefiveconceptsthatwelearnedinthepreviousvideoandwe'llseenowthatdesignsusingtheseconceptscanbetranslatedtorelationsautomaticallywithoneprovisionwhichisthateveryregularclasshasakey.|Andwe'llseewhatwemeanbyaregularclassinamoment.|So,whatwe'regoingtodoisgothrougheachoneoftheseconceptsoneatatimeandshowshowhowtheconceptsaretranslatedtorelations.|Forourexampleswe'lluseprimarilythesameexamplesthatweusedinthepreviousvideowhereweintroducedUser-Mode Linux.|Forclasseswillhaveastudentclassandacollegeclass.|OurstudentshaveastudentIDwhichistheprimarykey,astudentnameandaGPAandourcollegeswillhaveacollegenamewhichwe'llassumeisunique,sothat'stheprimarykey,thestateandtheenrollment.|Thetranslationfromclassestorelationsisabsolutelydirectwetakethestudentclassandwemakearelationcalledstudent,weputthethreeattributesdownforthatrelationandthentheprimarykeyfromthestudentclassbecomesthekeyattributeinthatrelation.|Andsimilarlyourcollegerelationhasthecollegenameasakey,thestate,andtheenrollment.|Soallwe'redoingtoturnclassesintorelationisbasicallyturningthemsideways.|Sonowwe'redonewithclassesandlet'smoveontoassociations.|We'llseethateachassociationisgoingtobetranslatedtoitsownrelationthatgrabsakeyfromeachsideoftheassociationsolet'sgotoourexample,thesameoneweusedearlier,thathasstudentsapplyingtocolleges.|So,here'sourdiagram,withstudentsapplyingtocollegesandwe'llalreadyhavegeneratedthetworelationsforourclasses,thestudentandthecollegerelationandfortheassociationappliedbetweenstudentsandcollegeswecreatearelation,wecallitappliedandthatrelationhasattributesthekeysfrombothsidessothatwouldbethestudentIDfromthestudentclassandthecollegenamefromthecollegeclass.|Andifyouthinkaboutititmakesalotofsense.|Appliediscapturingrelationshipsbetweenstudentsandcollegessowe'llcaptureeachofthoserelationshipswithonetupleintheappliedrelationidentifyingthestudentwiththekeyandthecollegewiththekey.|Nowonequestionyoumighthaveiswhatisthekeyforarelationthatwegeneratefromanassociation,itturnsoutthatdependsontheconceptofmultiplicitythatwelearnedaboutinthepreviousvideosoletmesetupagenericexampleoftwoclasseswithanassociationandthenandwe'lltalkaboutmultiplicityandkeys.|Ok,soherewehavebothclasses.|We'llcallthemC1andC2.|Andeachonehasakeyattribute,wecalleditK1andK2overhereandthenoneotherattribute01and02andthenwehaveanassociationAbetweenthetwoclasses.|Sointermsoftheirrelationsthatwillbegenerated,we'llhaveforC1,K1-01withK1asakeyforC2we'llhaveK2-02withK2askeyandthenforourassociationA,we'llgrabthekeyfromeachside,K1andK2andthequestionwehavenowis,whatisthekeyforrelationA?|Well,asadefaultthekeycanbebothattributestogether,butincertaincaseswecanbemorespecific,andagainthat'sgoingtodependonthemultiplicityonourassociation.|Let'ssupposethatourmultiplicityis0..1onthelefthandsideandastarontherighthandsideandlet'slookatwhatthatrepresentsintermsofthetypeofrelationshipwe'recapturing.|And,I'llmakesuregetitrightthistime,sowhatthisissayinghereisthatifwehaveobjectsofC1onthelefthandside,eachonecanberelatedtomanyobjectsofC2ontherighthandside,buteachobjectofC2canbeonlyberelatedtoatmostoneobjectofC1,andsomeofthemmightnotberelatedtoany.|Soremembernow,it'stheseedgesthatarebeingcapturedbythetuplesinourrelationfortheassociation,andwecanseethateachelementontherighthandsidecanonlybeinvolvedinatmostonetupleofA,sothattellsusthatK2isactuallyakeyforA.|Sowhenwehavezerodotdotoneoronedotdotone,forthatmatter.|Ontheleftside,orononesideofanassociation,thenthekeyattributefromtheothersideisakeyfortheassociation.|Soletstestoutthatruleonourstudentandcollegeassociationandseeifitmakessense.|SoI'vedrawntheassociationhereandwe'reinterestedintherelationthat'sgoingtobegeneratedfortheassociationitselfwhichwillbetheappliedrelationwiththestudentIDononesidefromonesideandthecollegenamefromtheother,sothat'stherelationwe'regoingtogeneratefortheassociationandthequestioniswhat'skeyforthatrelation.|Well,let'saddtheconstraintthateverystudentappliestoexactlyonecollege.|So,thatwouldbeaonedotdotoneontherightandthenastarontheleftifacollegecanhaveanynumberofapplicants.|So,ourruleofthumb,it'sactuallyarule,saidthatifwehaveonedotdotoneorzerodotonedotdotoneononesidethentheothersidewouldbethekey.|SothatwouldtellusthatifwehavethisonedotdotoneontherightthatstudentIDwouldbeakeyforappliedandindeedthatmakescompletesenseifeachstudentcanonlyapplytoonecollege,then,theywillindeedbeaintheappliedrelation.|Nowthere'sactuallyarelatedconceptherewherewemightneedarelationforassociationsatallandagain,thatdependsonmultiplicityandagainlet'sstartwithagenericexample.|sohere'sourgenericexampleandfromthisourstandardtranslationwouldgiveusthreerelations,oneforC1,oneforC2andthenonecapturingtheassociationAwhichwouldhaveakeyfromeachside.|Now,whatwe'regoingtodiscover,isthatincomecasesit'sactuallypossibletofoldrelationsAintoeitherC1orC2willendupwithjusttworelationinsteadofthreeandwillbecapturingthesameinformation.|Solet'ssupposewehavea1..1andonourlefthandsidesoagainwe'regoingtohavethesituationwherefromtheleftsidetotherightwehaveafanoutsoeachoneontherightisrelatedtoexactlyoneontheleft.|Ifthat'sthecase,theninsteadofhavingaseparaterelationfortheassociationsbasicallyforcapturingtheseedgeshere,wecansimplytaketherelatedelementupfromtheleft,thekeyfromtheleftandaddittotheelementfortheright.|Letmeshowhowthat'sdone.|Sowhatwe'lldoiswe'llchangethisC2tohaveK2andOgotoasbefore,butalsotohavethekeyfromthelefthandsideofclass,orrelationsothekeyfromC-1,andthenwedon'tneedAanylonger.|Andwecanseewhythatworks,becauseeveryelementinC2isrelatedtoexactlyoneelementinC-1,sowejustaddthekeyforthatsingleelementthatisrelatedtothatrelation.|Now,whatifthelefthandsidewerezerodotdotoneinsteadofonedotdotone?|Inthatcase,itwouldbepossiblefortheretobesomeelementsinC2thataren'trelatedtoanyelementsinC1,andthatwouldstillbeokaywiththisdesignaslongasnullvalueswouldbeallowedinthethirdattributeoftherelationforC-2.|Andfinally,what'sthekeytothisrelation?|Well,weknewbeforethatthekeyforC2wasK2,justbydefinitionofitbeingtheprimarykeyfortheclass,andthat'sstillthecaseintheexpandedC2.|K2willstillbeakeybecausewe'llonlyhaveoneinstanceofeachobjectandtheoneKonethatitwouldberelatedtothroughtheassociation.|Sowhatwesaw,tosummarize,isthatwhenwehavezerodotdotoneoronedotdotoneononeasideandthenwehaveanassociationandinsteadofmakingarelationfortheassociationwecanaddthekeyfromthesidewiththezerodotdotoneoronedotdotone,totherelationthatwegeneratedfortheclassontherighthandside.|So,let'stakealookagainwithstudentsandcollegesjusttoconfirmthisintuition.|Solet'sagainsupposethatastudentappliestoexactlyonecollegeandourruleofthumbsaysthatwehaveaonedotdotoneononeside,thenwecantakethekeyfromthatsideandaddittotherelationfortheothersidesowewouldbeaddingtothestudentrelation,thecollegenameattributeandwe'dbegettingridofappliedentirely.|Let'sjustthinkaboutifthatmakessenseifeverystudentisapplyingtoexactlyonecollege,itmakesperfectlygoodsensetojustaddthatcollegenametothestudentrelationandfurthermoreifwehadstudentsjustapplyingtoeitherzerooronecollege,thatwouldstillbeanacceptabledesignprovidedthatnullvaluesareallowedforthecollegenameattribute.|Ok,we'vefinishedwithclassesandwithassociations,nowlet'stalkaboutassociationsclasses.|Associationclassesareprettystraightforward.|We'renotgoingtogeneratenewrelationsmorethenwe'rejustgoingtoaddattributestorelationsthatwe'regeneratinganyway,soletmeuseourusualexamplewiththestudentsandcollegesandwe'lladdsomeinformationtotheirapplication.|Ok,so,here'sourUser-Mode Linuxdiagram.|Westillhavestudentsapplyingtocollegesandthenwe'veaddedanassociationclass,whichasyourememberisattachedtoanassociationanditgivesextraattributesforthatassociation.|So,herewe'resayingwhenastudentappliestoacollege,we'llhaveadateofthatapplicationandadecisionofthatapplication.|ThefirstschemethatI'veshowndownhereiswhatwewouldgetifweusethetechniqueswe'vealreadylearnedwithouttheassociationclasssothestudentclassgeneratesthestudentrelation,collegegeneratescollegeandthentheappliedassociationgeneratesarelationthathasakeyfromeachside.|Andbytheway,rightnowlet'ssaythatthere'snomultiplicitiesorotherinformationthat'sgoingtogiveusspecialkeyssointhatcasetheappliedrelationdoesn'thaveanykeysotherthanthetwoattributestogether.|Andfurthermore,becausewehavenospecialmultiplicities,wewon'tbefoldingthatrelationintoothersasweshowedinthepreviousexample.|So,nowwhatdowedowithourassociationclass?|Well,asyoucanprobablyguess,it'squitesimple.|Allwedoisextendourappliedrelationtoincludetheattributesintheassociationclass.|So,wejustadddateanddecisionrighthereandthenwe'reallset.|Nowthere'sactuallyafewthingsIwanttomentionatthispoint.|Firstofall,IdiscussedinthevideoonUMOmodeling.|ThefactthatUMOassumesthatwhenyouhavearelationshiporanassociationbetweentwoclasses,there'satmostoneinstanceofthatassociationbetweenanytwoelementsoftheclass.|Andthatis,canbeseenquitewellinthisrelationalschemeupbecausewe'reassumingwehaveamostonerelationshipbetweenanystudentandanycollegeandthenwehaveassociatedwiththatonerelationship,thedateandthedecision.|AsecondthingIwantedtotalkaboutatthispointintimeisthefactthatweforanautomatictranslationrequirethatwehaveakeyforeveryregularclass.|WhenImentionedthatatthebeginningofthevideo,Iwasn'tabletomotivateitverywellbutthisexampleexplainsitprettywell.|Whenwewantautomatictranslation,thetranslationforanassociationrequiresakeyfromeachside,andeachsideisgoingtobearegularclassinthatcase.|So,weneededtohaveastudentIDorsomekeyforthestudentclassandweneededakeyforthecollegeclassinordertocapturetheassociation.|Ontheotherhand,heretheapplicationinfoisnotaregularclass,thisisanassociationclassandwe'rejustdefiningthatasnotregularandwedon'tneedtohaveakeyforthisonebecausewe'rejustaddingtheirattributestotherelationfortheassociationitselfandthelastthingthatIwantedtomentionisthattheruleswesawfordeterminingkeysfortherelationassociatedwithassociationsandforfoldingintheclassandrelationsforassociationsalsoworkwhenwehaveanassociationclassanditjustgoesnaturally.|Youjustbringtheattributeswiththeassociationclassalongwiththeattributesthatyouhavefortheassociation.|Youmightwanttogivethatatryonanexamplejusttoseehowitworksbutagainit'sprettystraightforward.|Nowlet'stakealookathowselfassociationsaretranslatedtorelations.|Itactuallyfollowsexactlythesamerulesbutit'sworthwhilelookingattoseeexactlywhathappens.|Sohere'sourfirstexampleofassociationwhichwassiblingrelationshipsbetweenstudents.|Sointhiscase,wegeneratetherelationfortheclassasusual,studentID,nameandGPAandthenwegeneratearelationforourassociationjustfollowingthesamethatwealreadyhadwhenwehadanassociationbetweentwodifferentclassessoweneedtograbonekeyfromeachside,wellit'sthesamesidethatwe'regrabbingfromsotheonethingweneedtodoisjustchangetheattributenamessothatwehavetwoinstancesofthekeyattributefromtheclass,buttheyhavedifferentnames.|Soyoucanseewhatwe'redoinghere.|We'rejustsayingthatwehavesiblingrelationship.|WetakethestudentIDfromthetwostudentswhoaresiblings,andthatpairbecomesatupleinoursiblingrelationandbecausesowehavestarsonbothsidessowe'renotmakinganyassumptionsaboutmultiplicities.|Wedon'thaveanyzerodotdotonesoronedotdotones.|Thenwedon'thaveanykeyforthesiblingrelationexceptthetwoattributestogether.|Now,theotherexamplewehadinself-association,wascollegesbeingbranchesofothercolleges.|Sohere'sourcollegerelationthatwegeneratewiththeusualattributesandthenwehaveour,that'sthekeythere.|Wehaveourassociationwhichwe'recallingbranchwhichtakesahomecampusandasatellitecampusandsincewe'velabeledthosetwosideswecanactuallyusethoselabelsastheattributesfortherelationwegenerate.|Sowe'llcallitbranchandwe'llhavehomeandsatellite.|Sothat'ssayingthatthesatellite,thecampusonthe,thecollegeontherighthandsideisasatelliteoftheoneonthelefthandside.|Nowthesevaluesherewillbecollegenamesthatwillbethedomainthatwe'redrawingfrombutwe'llcallinghomeandsatellitetodistinguishtheirrolesintheassociation.|Nowwhataboutkeys?|Wesaidbeforethateverycampus,everysatellitecampushasexactlyonehomecampussowewriteitthatway.|Andthatahomecampuscouldhave,Ithinkwesaidsomethinglikezerototensatellitecampusesbutintermsofgeneratingourrelationstheonlyreallyimportantthingisthisonetooneandifyourememberwhatourrulessaid,itsaidthatifwehaveoneonetooneononesidethentheothersideisakeyintheassociationrelation.|Sowhatthatwouldtellusisthatsatelliteisakeyhereandthatdoesmakesense,sowe'llonlyhaveeachsatelliteshomecampuslistedonceand,butahomemighthavemanysatellitessothelefthandwouldnotbeakey.|Ok,we'regettingthere.|Wefinishedthefirstthreeandnowit'stimeforsubclasses.|Thisisaprettybigone.|Firstofall,itturnsoutthatthere'swellatleastthreeandthreecommonlyusetranslationsfromasubclassrelationshipintorelationssoletmesetupagenericsubclassingsetupandthenwe'lltalkaboutthethreedifferenttranslationandwhenwemightusewhichone.|So,here'sourgenericsetup,Ihadtodrawitalittlefunnytofititinthespace.|SisoursuperclassandthenwehavetwosubclassesS1andS2andjustasareminderwhatthissaysisthatwehaveobjectoftypeSandtheyhaveakeyattributecallKandanotherattributecallAandthenwehavesubclassesofthose,onecalledS1whichwillhaveattributesKandAandwillalsohaveanattributeBandthedifferencetothesubclassastwothatwillhaveattributesKandAinheritedfromitsparentandthenanadditionalattributeC.Nowtherearethreedifferentways,asIsaid,atleastthreethatwecouldtranslatethisUser-Mode Linuxdiagramtorelations.|Inthefirstway,wehavearelationforeachofourclassesincludingthesub-classesandthesub-classrelationswillcontaintheirownattributes,plusthekeyofthesuperclass.|Inthesecondcase,westillhaveonerelationforeachofourthreeclasses,butinthiscasethesub-classrelationcontainsalloftheattributesfromthesuperclassandthenthethirdcasewejustuseonemegarelationforthewholethingthatcontainsallofthesuperclassandsub-classattributes.|Solet'stakealookatwhatthethreedifferenttranslationswouldproduceforthisparticularsetup.|Forthefirstonewe'llhaveourrelationforSthat'sgoingtohaveKandA,thenwe'llhaveonerelationforeachofthetwosub-classes,S1,thatwillcontainthekeyforthesuperclass,soitwillbeKandthatwillstillbeakeyhereforthesub-classandB.|So,tofindallcomponentsofanobjectofS1willgetit'sAcompetentfromthesuperclass,followingthatkey,andthen,we'llgettheBcomponent.|fromthisrelationandthenfinallysayS2willbesimilar,itwillhavethekeyforthesuperclassandattributeC,againwhatthiswillrequireissomeassemblytogetallattributesofthesubclasses.|Now,let'slookatthesecondtranslation.|Westillhavethesuperclass,andoursubclassesnowaregoingtocontainalloftheattributesthatarerelevantsothey'llhavethekeyattributefromthesuperclass.|They'llalsohaveattributeAandattributeBandthenS2willsimilarlyhaveKandthenAandthenC.Sointhiscasewhatwecanseeisthatwhenwehaveanobjectthat'sinasubclassallofit'sinformationwillbeinit'ssubclassrelationandthesuperclasswillonlybeusedforobjectsthatareinthesuperclassbutnotinanyofthesubclasses.|Andthethirdtranslationsays,let'sjustmakeamegarelationthatcontainseverything.|So,itwillhavethekeyattributeKandAandBandC.Andinthatcase,wecanseethatwemayhavesomenullvalues,soifwehaveanobjectthat'sonlyinsubclassasoneforexample,itwouldthenhaveanullattributeC.IfweaddanobjectthatwasonlyinthesuperclassandnotinanyofthesubclassesitwouldhaveanullforbothBandC.Nowasyoumayhavenoticed,whathasalreadybeenontheslidetheentiretimeisthatthebesttranslationmaydependonthepropertiesofthesubclassrelationshipandifyouremember,wehadthepropertiesoverlappingversusdisjoint,andcompleteversusincomplete.|Sooverlappingmeantthatwemighthaveobjectsthatwereinmorethanonesubclass,disjointmeantthat'snotpossible,completesaidthateveryobjectthat'sinthesuperclassandthesuperclassisalsoinatleastoneofthesubclasses,whereincompletesaidthattherewouldbesomeobjects,ortheycouldbethey'reinthesuperclassandnotinanysubclasses.|Sortof,alludedtohowsomeofthosepropertiesaffectthedifferenttranslations.|But,let'slookatitveryspecifically.|Let'ssuppose,forexample,thatwehadaheavilyoverlappingsubclassrelationship.|Inotherwords,wehavemanyobjectsthatareinmultiplesubclasses;ifthat'sthecasethenwemightpreferdesignthreebecausedesignthreecapturesallofthedifferentattributesinoneplacesoifmanyobjectshaveallthoseattributeswemightliketojusthavethemtogetherratherthanneedingtoassemblethemfromthedifferentpieces.|Ontheotherhand,let'ssaythatwehavehaveadisjointandfurthermore,let'ssayit'scomplete.|So,wehaveeveryelementbeinginexactlyonesubclassandtherearenoelementselementsthatareinjustthesuperclass.|Sointhatcase,wemightliketousedesigntwobecausedesigntwoputseachobjectinindividualsubclassrelationandfurthermore,sinceit'scomplete,wecouldactually,inthisparticularcase,getridofthefirstrelation.|Wewouldn'tneedthat,andsothebestdesignwouldbenumber2,modifiedtoonlyhavethesubclassrelations.|So,now,let'srevisitourgiganticexamplefromtheUser-Mode Linuxmodelingvideoandseehowthatwouldbetranslatedtorelations.|So,justtoremindyouwhat'sgoingoninthisbigdiagramwehavestudents,andstudentshaveastudentIDandanameandthensomeofourstudentsmightbeforeignstudentsandtheyhaveacountry.|Someofourstudentsmaybedomesticstudents,andthattheywouldhaveastateandasocialsecuritynumber.|We'llassumethateverystudentiseitherforeignordomestic,andthensomeofourstudentsareAPstudentsandinterestingly,theyhavenoattributesbut,thosearetheoneswhohaveanassociationcalledtookwithAPcoursesAPcourseshaveacoursenumberandatitleandthen,whenastudenttakesanAPcourse,there'sanassociationclassthatsaystheyeartheytookitandthegradetheygot.|So,let'stranslatethistorelations;thewholediagram.|Andwe'regoingtousethefirsttranslationfromourthreeschemes.|So,that'stheonewherethesub-classrelationscontainthesuperclasskeysandthenallthespecializedattributes.|So,let'sstartbygeneratingtherelationforthestudentclassandthat'sstraightforward,that'sjustthestudentIDandthestudentname,withthestudentIDbeingthekey.|And,thenwe'regoingtogenerateonerelationforeachofourthreesub-classes.|Sothatwouldbetheforeignstudentswhichwilltakethekeythenfromthestudentrelations,sotheirstudentIDandthecountrythatthey'refrom.|They'llbethedomesticstudentsandtherewe'llhaveagain,thestudentID,inheritedfromthesuperclassandthestatethey'refromandtheirsocialsecuritynumber.|And,thenwe'llalsohavetheAPstudentsandthosehavenoneoftheirownattributesbut,wecangetthekey,andwedo,fromthesuperclass.|So,thisisjustgoingtobealistofthestudentID'swhoareAPstudents.|Now,let'skeepgoing.|So,let'stakealookatAPstudentstakingcourses.|So,we'llhave,fromtheAPclass,astraightforwardtranslationtothecoursenumberandthetitleofthecourseandthen,finally,we'regoingtohavearelationforthefactthataAPstudenttookclasses.|Wehadsomemultiplicitiesonthatthefirsttimebut,neitherofthemwereazerooneoroneonesothey'renotgoingtoberelevantinchangingourdesign.|So,tookisgoingtohavethekeyfrombothsides.|Well,wedon'tseeanykeyinheredowe?|But,subclassesalwaysinheritthekeyfromtheirparents,sothekeyhereisimplicitlythestudentIDand,that'swhatwe'llbeusinghere.|StudentID,thekeyfromtherighthandside,thecoursenumber,thatthey'vetakenandthenwe'llhavethetwoattributesfromtheassociationclass,theyearandthegrade.|Sothisactuallylookslikeaprettygooddesign.|Letmejustmakeafewcomments.|ThefirstonehastodowiththeAPstudentrelation.|SoifeveryAPstudentdoeshaveto,doeshavetotakeatleastonecourse.|So,ifwehave,forexample,aonedotdotsomethingoverthere,then,wecouldactuallyeliminateit'srelationbecauseeverystudentIDthatappearsinAPstudent,willalsoappearintheTookrelation,so,thisonewillberedundantinthatcase.|So,again,thatcouldbeeliminatedbasedonthemultiplicity,though,Iwouldn'treallyexpectanautomatictranslatortonecessarilyfigurethatoneout.|AnotherpossibilityIshouldmention,isthatwecouldhaveaprimarykeyspecifiedherefordomesticstudentsforsocialsecuritynumberssincewewouldexpectthattobeunique,andthatwouldtranslatetoakeyhere,butletmebeclear,thiswouldbeaseparatekey.|Itwouldn'tbesocialsecuritynumberandstudentIDtogether,butthesewouldbetwodifferentkeysandinStructured Query Languageyoucanactuallydistinguishbetweenthosetwo,butwecan'tdoitthewaywe'vewrittentherelationshere.|And,finallyletmementionagainthatrequirementthatwehavekeysforregularclassesifwewanttodotranslationautomaticallyandyoumighthavenoticedthatforexample,wecertainlydidn'thaveakeyhereforaforeignstudentwithcountrybeingtheonlyattribute,butsubclassesarealsonotconsideredregularclasses.|Sosubclassesandassociationclassesdon'tneedtohavekeysandwecanstillhaveanautomatictranslation.|Logicallysubclassesareinheritingtheirkeysfromtheirsuper-classandthatonedoesneedtohaveakeyinordertohaveautomatictranslation.|Sothatwasabigone.|Butyou'llbegladtoknowthatcompositionandaggregationisgoingtobequitequick.|Sohereisourexamplewherewehaveourcollegeclassasusual,butcollegescontaindepartments,andthissoliddiamondhereisthecompositionoperatorthatsaysthatwehaveobjectsfromtherighthandsideclassthatarecomponentsofthelefthandsideobjects.|Solet'slookatthetranslationtorelations.|We'lltranslatethecollegesideasusualwithakeyattribute-collegenameandtheotherattributes.|Andthenalthoughthisisanassociation,we'renotgoingtohaveaseparateclassforit,we'regoingtohavetherighthandsideclasshaveboththevaluesoftheobjectinthatclassandtheassociationcapturedtogether.|Sowe'llhavearelationcalleddepartment,anditwillhavethedepartmentnameandthebuildingandthenitwillalsoinclude,thekeyoftheobjectitbelongsto.|Sointhiscase,thatwouldbeacollegename.|Nowifyouthinkcarefullyaboutit,thistranslationactuallymakesalotofsenseandisconsistentwithwhatwe'vealreadydone.|WesaidwhenweintroducedthenotionofcompositionthatwehaveEffectivelyhavebydefinitionaonedotdot,oneonthelefthandsideofthecomposition.|Soifwetreatedthisasaregularassociation,usedourregulartranslationandthenusedourrulethatallowedustogetridofassociationrelations,we'dactuallyendupatexactlythesamedesign.|Bythewaythisisalastexamplewherewehaveaclassthat'snotoneofthoseregularclassesthatrequireakey.|Wedon'thavetohaveakeyfortheright-handsideofacompositioninordertohaveanautomatictranslation.|Aggregation,bytheway,wasthecasewherewehavetheMCdiamondandthat'simplicitlyazerodotdotoneinsteadofonedotdotone.|Wehadanexamplewithapartmentbuildings,I'mnotgoingtobothertogivethatoneagain,butinthatcasewherewehaveanaggregationshouldhaveinanassociation.|Allweneedisthesamedesignbuttheabilityforthatkeywe'regrabbingfromthelefthandsidetobenull,and,then,everythingworksoutfine.|So,toconclude,thedatamodelingportionofUser-Mode Linux,isapopularhighlevellanguagefordatabasedesigns.|It'sgraphicalanditcanbetranslatedautomaticallytorelations,aslongaseveryregularclasshasakey,andthattypicallyisthecase.|Thisvideotalksaboutindexes.|It'sactuallyarelativelyshortvideoaboutaveryimportanttopic.|BeforeIgetstarted,however,letmementionthatindexesarealsosometimesprefertwoasindices,thoseareequivalent.|Ipersonallypreferusingthetermindexes.|Thereasonindexesaresoimportantisthattheyaretheprimarywayofgettingimprovedperformanceoutofadatabase.|Indexesareapersistentdatastructure.|They'restoredtogetherwiththedatabaseitself.|Now,therearemanyveryinterestingimplementationissuesinindexes,butinthisvideoandinthiscourseingeneral,we'refocusingontheperspectiveoftheuserandapplication.|So,we'lltalkabouthowapplicationswilluseindexestospeedupperformance.|So,let'ssupposewehaveaverysimpletableTthathasthreecolumns,butwe'regoingtofocusoncolumnsAandcolumnsB.|AndwecanseethatColumnAisastringvaluedcolumnwithanimalnames,andColumnBisanintegercolumn.|Now,we'regonnabeaskingqueriesthatinvolveconditionsoverthesetwocolumns.|Inordertospeedupthosequeries,ifwe'reconcernedaboutevaluatingconditionsoncolumnA,thenwecanbuildanindexonthatcolumn.|SowecallthatanindexoncolumnT.A.|Whatthatindexallowsustodo-and"us"inthiscaseisactuallythequeryprocessor-isaskquestions,forexample,let'saskwhattupleshave"cow"inthevalueofT.A.|Ifweaskthatquestionofourindex,thatthatindexwillquicklytellusthattuple3andtuple7haveavalue"cow",withoutscanningtheentiretable.|Wecouldalsoasktheindexwhattupleshavesay,value"cat".|Andifweasktheindexthatquestion,itwilltellustuple1andtuple5andtuple6havethevalue"cat."|Ifwe'reinterestedinevaluatingconditionsincolumnBthenwecanalsobuildanindexoncolumnB.|Forexamplenowwecouldaskquestionslike,whenisT.Bequaltothevaluetwo?|Weaskedtheindexandtheindexwilltellusthattuple1andtuple5havethevaluetwo.|Wecouldalsoask,forexample,whenthevalueinT.Bislessthansix?|Andtheindexinthatcasewouldtellusthattuple1islessthansix,two...wow,mostofthem:three,five,andseven.|Wecouldaskanevenmorecomplicatedquestion.|WecouldaskwhenthevalueforT.Bissay,greaterthanfourandlessthanorequaltoeight.|Again,weasktheindex,andinthiscasetheindexwouldtellusthatitistupletwoandtupleseveninthatcase.|Lastly,supposewe'reinterestedinhavingconditionsthatareonbothcolumnsAandB.|Thenwecanbuildanindexthatisonbothcolumnstogether.|Nowwecouldaskquestions,forexample,like,whenisT.AequaltocatandT.B,say,greaterthanfive?|Dowehaveanyofthose?|Well,wehavejustoneofthemthere.|That'stuplesix.|Wecouldalsohaveinequalities,bytheway,onthefirstcolumn.|Sowemightask,whenisT.Alessthan,saythevalueD,andT.Bequaltosaythevalue1,andinthatcasewe'llgetthetuple3asaresult.|SoIthinkthisgivesanideawithasimpletableofhowindexesareusedtogodirectlytothetuplesthatsatisfyconditionsratherthanscanningtheentiretable.|Sothat'sthemainutilityofanindex.|Again,thetablescanbeabsolutelygiganticindatabasesandthedifferencebetweenscanninganentiretabletofindthattuplesthatmatchaconditionandlocatingthetuples,moreorlessimmediatelyusinganindex,canbeordersofmagnitudeinperformancedifference.|Soreallyit'squiteimportanttotakealookatthedatabaseandbuildindexesonthoseattributesthataregoingtobeusedfrequentlyinconditions,especiallyconditionsthatareveryselective.|NowImentionedthatwe'renotcoveringtheimplementationofindexesinthisvideo,butitisimportanttounderstandthebasicdatastructuresthatareused.|Specificallytherearetwodifferentstructures.|Oneofthemisbalancetreesandsubstantiationofthatistypicallywhat'scalledaB-treeoraB+tree.|Andtheotherishashtables.|Nowbalancetreesindexescanbeusedtohelpwithconditionsoftheform"attributeequalsvalue."|Theycanalsobeusedfor"attributelessthanvalue,"for"attributebetweentwovalues"andsoon,aswehaveshownearlier.|Hashtables,ontheotherhand,canonlybeusedforequalityconditions.|Soonlyattributeequalvalue.|Andifyou'refamiliarwiththesestructuresthenyou'llknowwhythere'sthelimitonhashtables.|Sobalancedtreeindexesarecertainlymoreflexible.|Nowthereisonesmalldownside.|Forthoseofyouwhoarefamiliarwiththestructuresandwiththerunningtime,theoperationsonthebalancetreestendtobelogarithmicintheirrunningtime,whilewelldesignedhashtablescanhavemoreorlessconstantrunningtime.|Eveninlargedatabases,logarithmicisokay,althoughwhenonlyequalityconditionsarebeingused,thenahashtableindexmightbepreferred.|Now,let'stakealookatafewStructured Query Languagequeriesandseehowindexesmightallowthequeryexecutionenginetospeedupprocessing.|We'lluseourusualstudentandcollegedatabase.|Thefirstoneisaverysimplequery,it'slookingforthestudentwithaparticularstudentID.|SoifwehaveanindexonthestudentIDthenagaintheindexwillallowthequeryexecutionenginetogoprettymuchstraighttothattuple,whereaswithoutanindextheentirestudenttablewouldhavetobescanned.|Nowletmementionthatmanydatabasesystemsdoautomaticallybuildindexesonprimarykeys.|Soit'slikelythatinanapplicationthestudentIDwouldbedeclaredasaprimarykeyandtherewouldbeanindexautomatically.|Butit'sagoodthingtocheckifthistypeofqueryiscommon.|Andsomesystemsevenalsobuildindexesautomaticallyonattributesthataredeclaredasunique.|Asareminderfromtheconstraintvideo,everytablecanhaveoneprimarykey,andthenanynumberofadditionalkeyslabeledasunique.|Nowlet'stakealookataslightlymorecomplicatedexample.|Herewe'relookingforstudentswhosenameisMaryandwhoseGPAisgreaterthen3.9,andtheremaybeafewofthosestudents.|Soonepossibilityisthatwehaveanindexonthestudentnameandifthatisthecase,expandthequeryprocessingcanfindquicklythetupleswhosestudentnameisMary,andthencheckeachoneofthosetoseeiftheGPAisgreaterthan3.9.|AlternativelywemighthaveanindexontheGPA.|Inthatcase,thesystemwillusetheindextofindthestudentswhoseGPAisgreaterthan3.9andthenlooktoseeiftheirnameisMary.|Finally,itispossiblewecanhaveanindexonthetwoattributestogethersowecanhaveSnameandGPAtogetherandthenthisindexcanbeusedtosimultaneouslyfindstudentsthathavethenameMaryandtheGPAgreaterthan3.9.|Now,Ishouldmentionthatbecausethisisaninequalitycondition,itisimportantthattheGPAisatreebasedindexinordertosupportthatevaluationofthisconditionwherethestudentnameisanequalityconditionsothatcouldbeahashbasedindexoratreebasedindex.|Nowlet'slookataquerythatinvolvesajoint.|We'rejoiningthestudentandapplytablesinordertofindthenamesofthecollegesthateachstudenthasappliedto.|Andwe'rereturningthestudentnameandthecollegename.|Solet'ssupposeforstartersthatwehadanindexonthestudentIDattributeoftheapplyrelation.|Ifthat'sthecasethenthequeryexecutionenginecanscanthestudentrelationand,foreachstudent,usethatSIDandquicklyfindthematchingSIDsintheapplyrelation.|Alternatively,let'ssupposewehadanindexontheSIDattributeofthestudentrelation.|Inthatcase,thesystemcouldscantheapplyrelation,and,foreachstudentIDandeachapplytuple,findthematchingstudentIDsinthestudenttupleusingtheindexthatwehavethere.|Insomecasesit'sactuallypossibletousethetwoindexestogetherandmakethequeryrunevenfaster.|I'mnotgoingtogointodetail,butindexesoftenallowrelationstobeaccessedinsortedorderoftheindexedattributes.|So,supposewecangetthestudentrelationinsortedorderandtheapplyrelationinsortedorder.|Thenwecankindofdoamerge-likeoperationofthetwoindexestogetthematchingstudentandapplyrecords,thosewhoseSIDsareequal.|Ifwehadadditionalconditionsinthequerytheremightbeevenmorechoicesofhowtouseindexes,andthatgetsintotheentireareaofwhatisknownasqueryplanningandqueryoptimization.|Andthisisactuallyoneofthemostexcitingandinterestingareasoftheimplementationofdatabasesystemsandiswhatallowsustohaveofadeclarativequerylanguagethat'simplementedefficiently.|So,indexesseemlikegreatthings.|Wejustthrowsomeindexesontoourdataandallofasuddenourqueriesrunmuch,muchfaster.|So,theremustbesomedownsides,andofcourse,thereare.|Letmelistthreeofthemfromsortofleastseveretomostsevere.|So,thefirstoneisthatindexesdotakeupextraspace.|AsImentioned,theyarepersistentdatastructuresthatresideswiththedata.|Iconsiderthissortofamarginaldownsideespeciallywiththecostofdiskthesedaysitsreallynotthatbigofdealtouseadditionalspace,eventopotentiallydoublethesizeofyourdatabase.|Theseconddownsideistheoverheadinvolvedinindexcreation.|So,whenadatabaseisloaded,ifwe'regoingtohaveindexes,thoseindexesneedtobecreatedoverthedata.|Orifweaddindexeslateron,theyneedtobecreated.|Indexcreationcanactuallybeafairlytimeconsumingoperation,soI'mgoingtomakethisasamediumdownside.|Ontheotherhand,oncetheindexiscreated,allthequeriesrunfaster,soit'susuallyworthwhiletodoit.|Thelastoneisthemostsignificantoneandthat'stheissueofindexmaintenance.|Sotheindexisadatastructurethatsitstothesideofthedatabaseandhelpsanswerconditions.|Whenthevaluesinthedatabasechange,thentheindexhastobemodifiedtoreflectthosechanges.|Soifthedatabaseismodifiedfrequently,eachofthosemodificationsisgoingtobesignificantlyslowerthanifwedidn'thaveindexes.|Soinfact,inadatabasethat'smodifiedawholebunchandnotqueriedallthatoften,thecostofindexmaintenancecanactuallyoffsetthebenefitsofhavingtheindex.|Soitreallyisacost-benefittradeofftodecidewhentobuildindexes.|Sogiventhatwehavethiscost-benefittradeoff.|Howdowefigureoutwhichindexestocreatewhenwehaveadatabaseanapplicationsonthatdatabase.|Thebenefitofanindexfirstofallonhowbigthetableissincetheindexhelpsusfindspecificportionsofthetablequickly.|Itdependsonthedatadistributionsagainbecausetheindexhelpsusfindspecificdatavaluesquickly.|Andfinallyhowoftenwe'regoingtoquerythedatabase.|Firstofallit'showwe'regoingtoupdateit.|AsImentioned,everytimethedatabaseisupdatedindexesneededtobemaintainedandthat'scostly.|Everytimewequerytheindexesmayhelpusanswerourqueriesmorequickly.|Fortunately,overthelastdecadeorso,manydatabasesystemvendorshaveintroducedwhat'scalledaphysicaldesignadvisor.|Inthiscase,physicaldesignmeansdeterminingwhichindexestobuildonadatabase.|Theinputtothedesignadvisoristhedatabaseitselfandtheworkload.|Theworkloadconsistsofthesetsofqueriesandupdatesthatareexpectedtobeperformedonthedatabaseaswellastheirfrequency.|Nowactuallythedesignadvisordoesn'tusuallylookattheentiredatabase,butratherlooksatstatisticsonthedatabasethatdescribehowlargethetablesareandtheirdatadistributions.|Theoutputofthedesignadvisorisarecommendedsetofindexestobuildthatwillspeeduptheoverallworkload.|Interestingly,physicaldesignadvisorsrelyveryheavilyonacomponentofdatabasesystemsthatalreadyexisted,actuallyoneofthemostimportantcomponentsofdatabasesystems,whichisthequeryoptimizer.|That'sthecomponentthattakesaqueryandfiguresouthowtoexecuteit.|Specifically,it'lltakestatisticsonthedatabase,thequerytobeexecutedortheupdatecommand,andthesetofindexesthatcurrentlyexist,anditwillexplorethevariouswaysofactuallyexecutingthequery,whichindexeswillbeused,whichorderthingswillbedonein.|Itestimatesthecostofeachone,anditspitsouttheestimatedbestexecutionplanwiththeestimatedcost.|Sonowlet'slookathowthiscomponentcanbeusedtobuildadesignadvisor.|Let'sjustdrawthedesignadvisoraroundthewholethinghere,andtheinputtothedesignadvisor,again,arethestatisticsandtheworkload,andtheoutputissupposedtobetheindexes.|Sowhatthedesignadviseractuallydoesisitexperimentswithdifferentset-upsofindexes.|Foreachset-upofindexes,ittakestheworkload,itissuesthequeries,andupdatestothequeryoptimizer.|Itdoesn'tactuallyrunthemagainstthedatabaseandsee'swhatcostthequeryoptimizerproduces.|Ittriesthiswithdifferentconfigurationsofindexesandthenintheenddeterminesthoseindexesthatbringdownthecostthemost.|Inotherwords,itwillgiveyoubackthoseindexeswherethebenefitsofhavingtheindexoutweighthedrawbacksofhavingthatindexintermsoftheworkloadandusingthecoststhatwereestimatedbythequeryoptimizer.|Ifyou'reusingasystemthatdoesn'thaveadesignadviser,thenyou'llhavetokindofgothroughthisprocessyourself.|You'llhavetotakealookatthequeriesandupdatesthatyouexpect,howoftenyouexpectthemtohappen,andwhichindexeswillbenefitthosequeries,andhopefullywon'tincurtoomuchoverheadwhenthereareupdates.|Justquickly,here'stheStructured Query Languagestandardforcreatingindexes.|Allindexesaregivennames.|Wecancreateanindexonasingleattribute.|Wecancreateanindexonseveralattributestogether.|Wecanalsosaythatwewantourindextoenforceauniquenessconstraintsowhenweaddtheworduniqueitsortofaddsconstraintenforcement.|Itsays,we'regoingtocheckthatallvaluesfor"A"areuniqueusingourindexandwillgenerateanerroriftherearetwovaluesthathavethesame,twotuplesthathavethesamevalueforA,andfinallywehaveacommandfordroppingindexes.|Insummary,indexesarereallyimportant.|They'retheprimarywaytogetimprovedperformanceonadatabase.|Bybuildingtherightindexesoveradatabaseforitsworkflowwecangetordersofmagnitudeperformanceimprovement.|Althoughwedohavetobecareful,becausetherearetrade-offsinbuildingindexes,especiallyfordatabasesthataremodifiedfrequently.|Therearepersistentdatastructurethatarestoredtogetherwiththedatabase,andtherearemanyinterestingimplementationissues,butinthisvideoandcoursewe'refocusingspecificallyontheuserandapplicationperspective,determiningwhichindexestobuildandhowtheywillgainperformanceimprovementforus.|Thisvideointroducestheconceptsoftransactionsandinteractactionswithdatabasesystems.|Transactionsareaveryimportantconcept.|Theconceptoftransactionsisactuallymotivatedbytwocompletelyindependentconcerns.|Onehastodowithconcurrentaccesstothedatabasebymultipleclients|Inthisvideowe'lldelveintomoredetailaboutthepropertiesoftransactions.|Asareminder,transactionsareaconceptthat'sbeenintroducedasasolutiontoboththeconcurrencycontrolproblemandthesystemfailureproblemindatabases.|Specificallyatransactionisasequenceofoperationsthataretreatedasaunit.|Transactionsappeartoruninisolation,evenifmanyclientsareoperatingonadatabaseatthesametime.|Andfurthermoreifthereisasystemfailureinunexpectedsoftware,hardware,orpowerfailureeverytransactionschangesthatwereissuedtothedatabaseareeitherreflectedentirelyornotatall.|Everydatabaseconnoisseurknowsthattransactionsupport,whatareknownastheAtomicity Consistency Isolation Durabilityproperties.|AlthoughnoteverybodyalwaysrememberswhatAstandsforatomicity;Cstandsforconsistency;Istandsforisolation;andDstandsforfordurability.|Andwe'regoingtotalkabouteachofthesefourpropertiesinturn.|We'regoingtotalkaboutisolationfirst.|We'regoingtotalkaboutdurabilitysecond,thenwe'llnexttalkaboutatomicityandwe'llconcludetalkingaboutconsistency.|Sohere'sthedealwithisolation.|We'llhaveawholebunchofclientsoperatingonourdatabase,andwe'dkindoflikeeachclienttoimaginethatthey'reoperatingontheirown.|Soaswediscussedinthepreviousvideo,eachclientissuestothedatabasesystemasequenceoftransactions.|SothisfirstclientmightbeissuingfirsttransactionT1,thenT2,T3,andsoon.|OverherewehaveT9,T10,T11andasareminder,eachtransactionitselfcanbeasequenceofstatements.|So,thismightbestatementone,statementtwo,statementthreeandsoon,andthenthosestatementswillbetreatedasaunit.|Sotheisolationpropertyisimplementedbyaveryspecificformalnotioncalledserializability.|Whatserializabilitysaysisthattheoperationswithintransactionsmaybeinterleavedacrossclients,buttheexecutionofthoseoperationsmustbeequivalenttosomesequentialserialorderOfallthetransactions.|Soforourexampleoverhere,thesystemitselfmayexecuteallofthestatementswithineachtransactionandoverhereconcurrentlybutithastoguaranteethatthebehavioragainstthedatabaseisequivalenttosomesequenceinorderagain.|SoperhapstheequivalentsequentialorderwillbeasifthesystemfirstdidtransactionT1,thenmayT2,T9andT10,maybebacktoT3andSoon.|Andagainthesystemhastoguaranteethatthestateofthedatabase,atthispointintime,evenifitsinternallythestatementswithinanyofthesetransactionslooksasifthesetransactionsexecutedinorder.|Now,youmightwonderhowthedatabasesystemcouldpossiblyguaranteethislevelofconsistencywhilestillinter-leadingoperation.|Itusesprotocolsthatarebasedonlockingportionsofthedatabase.|Nowwe'renotgoingtodescribetheimplementation,becauseimplementationaspectsarenotthefocusofthiscourse.|Whatyouneedtoknowfromauser'sapplicationperspectiveisreallythepropertiesthatarebeingguaranteed.|Nowwiththeformalnotionofalet'sgobackandlookattheexamplesfromthepreviousvideothatmotivatedtheproblemswecouldgetintowithconcurrentaccess.|ThefirstonewastheexamplewheretwoseparateclientswereupdatingStandford'senrollment.|Let'sjustcalloneofthemT1.|It'snotatransaction.|AndtheotherT2.|Sowhenwerunthingisagainstthesystemandserializabilityisguaranteed,thenwewillhaveabehaviorthatisatleastequivalenttoeitherT1followedbyT2,orT2followedbyT1.|So,inthiscase,whenwestartwithourenrollmentof15,000,eitherexecutionwillcorrectlyhaveafinalenrollmentof17,500solvingourconcurrencyproblems.|Here'soursecondexample.|Inthiscasethefirstclientwasmodifyingthemajorofstudent123intheapplytableandthesecondwasmodifyingthedecision.|Andwesawthatifweallowedthesetoruninaninterleavedfashion,itwouldbepossiblethatonlyoneofthetwochangeswouldbemade.|Again,withserializabilitywe'regoingtogetbehaviorthatguaranteesitisequivalenttoeitherT1andthenT2,orT2andthenT1.|Andinbothcases,bothchangeswillbereflectedinthedatabasewhichiswhatwewouldlike.|ThenextexamplewastheonewherewewerelookingattheApplyandtheStudenttable,andweweremodifyingtheApplytablebasedontheGPAintheStudenttable,andsimultaneouslymodifyingthatGPA.|Soagainiftheseareissuedastwotransactions,we'llhaveeitherT1followedbyT2orT2followedbyT1.|Oratleastwewillhavebehaviorthatisequivalenttothat.|Nowthiscaseisabinary digitinterestingbecauseeitherofthesedoesresultinaconsistentstateofthedatabase.|Inthefirstcase,we'llupdateallthedecisionrecordsbeforetheGPAsaremodifiedforanyone,andinthesecondcase,willupdatetheapplyrecordsaftertheGPAshavebeenmodified.|Theinterestingthinghereisthattheorderdoesmatterinthiscase.|Now,thedatabasesystemsonlyguaranteesserializability.|Theyguaranteethatthebehaviorwillbeequivalenttosomesequentialorderbuttheydon'tguaranteetheexactsequentialorderifthetransactionsarebeingissuedatthesametime.|Soifit'simportanttoget,say,T1beforeT2,thatwouldactuallyhavetobecodedaspartoftheapplication.|AndourlastexamplewasthecasewherewehadtheApplytable,theArchivetable,andweweremovingrecordsfromonetabletoanotherinoneofourclients,andtheotherclientwascountingthetuples.|Andagain,soT1andT2,they'reissuedastransactions.|Thesystemguaranteesthatwe'lleithermoveallthetuplesfirstandthencountthem,orwillcountthetuplesandthenmovethem.|Now,again,here'sacasewheretheordermakesadifference,butifwecarespecificallyabouttheorder,thatwouldhavetobecodedaspartastheapplication.|OK,sowe'vefinishedourfirstofthefourAtomicity Consistency Isolation Durabilityproperties.|Theotherthreewillactuallybequiteabinary digitquickertotalkabout.|Let'stalknowaboutdurability.|Andweonlyneedtolookatoneclienttounderstandwhat'sgoingon.|Solet'ssaythatwehaveourclient,andtheclienthasissuingasequenceoftransactionstothedatabase.|Andeachtransactionagainisasequenceofstatements.|Andfinallyattheendofthetransactionthereisacommit.|Sowhatdurabilityguaranteesforusisthatifthereisasystemcrashafteratransactioncommits,thenalleffectsofthattransactionwillremaininthedatabase.|So,specifically,ifatalaterpointintimeafterthisoccurs,there'safailureforwhateverreason,theclientcanrestassuredthattheeffectsofthistransactionareinthedatabase,andwhenthesystemcomesbackup,theywillstillbeinthere.|Soyoumaybewonderinghowit'spossibletomakethisguaranteesincedatabasesystemsmovedatabetweendiscandmemoryandacrashcouldoccuratanytime.|They'reactuallyfairlycomplicatedprotocolsthatareusedandthey'rebasedontheconceptoflogging.|Butonceagainwe'renotgonnatalkabouttheimplementationdetails.|What'simportantfromtheuserorapplicationperspectiveisthepropertiesthatareguaranteed.|2propertiesdown.|Nowlet'stalkaboutatomicity.|againwe'llonlylookatoneclientwho'sissuingasequenceoftransactionstothedatabase.|Andlet'slookattransactionT2whichitselfisasequenceofstatementsfollowedbycommit.|Thecasethatatomicitydealswithisthecasewherethere'sactuallyacrashorafailureduringtheexecutionofthetransaction,beforeit'sbeencommitted.|Whatthepropertytellsusisthateveninthepresenceofsystemcrashes,everytransactionisalwaysexecutedeitherallornothing.|onthedatabase.|Soinotherwords,ifwehaveeachofourtransactionsrunning,it'snotpossibleinasystemcrashto,say,haveexecutedonthedatabaseacoupleofstatementsbutnottherestofthetransaction.|Nowonceagain,youmightbewonderinghowthisisimplemented.|Italsousesalog-inmechanismandspecificallywhenthesystemrecoversfromacrash,thereisaprocessbywhichpartialeffectsoftransactionsthatwereunderwayatthetimeofthecrash,areundone.|Nowapplicationsdoneedtobesomewhatawareofthisprocess.|Sowhenanapplicationsubmitsatransactiontothedatabase,it'spossiblethatitwillgetbackanerrorbecausetherewasinfactacrashduringtheexecutionofthetransaction,andthenthesystemisrestarted.|Inthatcasetheapplicationdoeshavetheguaranteethatnoneoftheeffectsofthetransactionwerereflectedinthedatabase,butitwillneedtorestartthetransaction.|Nowlet'scomebacktothefactthatthesystemwillundopartialeffectsofatransactiontoguaranteetheatomicityproperty,thateachtransactionisexecutedinanallornothingfashion.|So,thisconceptofundoingpartialFulleffectsofthetransactionisknownastransactionrollbackortransactionabort.|AndthereasonI'mmentioningithereisthatalthoughitistheimplementationmechanismsforAtimaCity,it'salsoanoperationthat'sexposedbythedatabaseinanapplicationwouldliketouseit.|Specifically,atransactionrollbackcanbeinitiatedbythesystem,inthecaseofanerror,oracrashrecovery.|Butitalsocanbeclientinitiated.|Andletmegivealittleexamplewhereaclientmightwritecodethattakesadvantageoftheoperation.|Sohereissometoyapplicationcode.|Inthiscode,theclientbeginsatransaction,itaskstheDatabaseuserforsomeinput.|ItperformssomeStructured Query Languagecommands.|Maybesomemodificationstothedatabasebasedontheinputfromtheuser.|Itconfirmsthattheuserlikestheresultsofthosemodifications.|Andiftheusersaysokay,thenthetransactioniscommitted,andwegetanatomicexecutionofthisbehavior.|Butiftheuserdoesn'tsayokay,thenthetransactionisrolledbackand,automatically,theseStructured Query Languagecommandsthatwereexecutedareundone,andthatfreestheapplicationfromwritingthecodethatundoesthosecommandsexplicitlySoitcanactuallybequiteausefulfeatureforclientstouse.|Butclientsdoneedtobeverycareful,becausethisrollbackcommandonlyundoeseffectsonthedataitselfinthedatabase.|Soifperhapsinthiscode,thesystemwasalsomodifyingsomevariablesorevenworse,saydeliveringcashoutofanAsynchronous Transfer Modemachine,therollbackcommandisnotgoingtoundothose.|It'snotgonnamodifyvariablesandit'scertainlynotgoingtopullthatcashbackintotheAsynchronous Transfer Mode.|So,thereactuallyisanotherissuewiththisparticularclientinteractionthatIamgoingtoputa"frownie"facehere.|Itwasanice,simpleexampleofhowrollbackcanbehelpful.|Butonethingthathappensinthisexampleisthatwebeginatransactionandthenwewaitfortheusertodosomething.|Andweactuallywaitfortheuserbackhere.|Soexperienceddatabaseapplicationdeveloperswilltellyoutoneverholdopenatransactionandthenwaitforarbitraryamountsoftime.|ThereasonisthattransactionsdousethislockingmechanismIalludedtoearlier,sowhenatransactionisrunning,itmaybeblockingotherportions,blockingotherclientsfromportionsofthedatabase.|Iftheuserhappenedtogooutforacupofcoffeeorisgoingtocomebackinaweek,wecertainlydon'twanttoleavethedatabaselockedupforanentireweek.|So,againandageneralruleofthumbisthattransactionsshouldbeconstructedinafashionthatweknowtheyaregoingtoruntocompletionfairlyquickly.|Finally,let'stalkaboutconsistency.|Theconsistencypropertytalksabouthowtransactionsinteractwiththeintegrityconstraintsthatmayholdonadatabase.|Asareminderandintegrityconstraintisaspecificationofwhichdatabasestatesarelegal.|Transactionsareactuallyveryhelpfulinthemanagementofconstraints.|Specifically,whenwehavemultipleclientsinteractingwiththedatabaseinaninterleavedfashion,wecanhaveasetupwhereeachclientcanassumethatwhenitbeginsitoperatesonadatabasethatsatisfiesallintegrityconstraints.|Theneachtransaction,thensorry,eachclient,mustguaranteethatallconstraintsholdwhenthetransactionendsandthat'stypicallyguaranteedbytheconstraintenforcementsubsystem.|Nowwiththatguarantee,sincewehaveserializedabilityoftransactions.|thatguaranteesthatconstraintsalwayshold.|Specificallythebehaviorofthedatabaseissomesequentialorderofthetransactions.|Weknowandwecanassumeatthestartofthetransactiontheconstraintshold.|Andthenweguaranteetheyholdattheend.|Andsincethebehaviorsequivalenttoasequentialorderthenthenexttransactioncanassumetheconstraintsholdandsoon.|Inconclusiontransactionareaverypowerfulconcept.|Theygiveasolutionforbothconcurrencycontrolandsystemfailuremanagementanddatabases.|Theyprovideformallyunderstoodpropertiesofatomicity,consistency,isolationanddurability.|Inthenextvideowearegoingtofocusmoreontheisolationproperty.|We'regoingtoseethatinsomecaseswemaywanttorelaxthenotionofisolationwhilestillprovidingpropertiesthataresufficientforapplicationsincertaincircumstances.|Inthisfinalvideoabouttransactions,we'llfocusontheconceptofisolationlevels.|Asaremindertransactionsareasolutionforboththeconcurrencycontrolandsystemfailureproblemindatabases.|Atransactionisasequenceofoneormoreoperationsthat'streatedasaunit.|Transactionsappeartoruninisolationandifthesystemfails,eachtransactionchangesarereflectedeitherentirelyornotatall.|Onthisvideowearegoingtofocusontheisolationportionoftransactions.|Asareminderwecanhavemultipleclientsoperatingonthesamedatabase.|Andeachclientwillsubmitasequenceoftransactions.|SowehavethisclientwithT1,T2.|HerewehaveT9,T10,T11andsoforth.|Andeachtransactionitselfisasequenceofstatements.|Serializeabilitysaysthatit'sokayforthesystemtointer-leavetheexecutionofthesestatementswiththestatementsthatarebeingperformedbyotherclients;however,thebehavioragainstthedatabasemustbeequivalenttothetransactionsthemselvesexecutinginsomeserialorder.|Forexample,inthiscase,thesystemmayenforcebehaviorthat'sequivalenttosay,doingtransactionT9first.|ThenmaybeT1,T2,andthenT10,andsoon.|Serializabilitygiveusunderstandablebehaviorandconsistencybutitdoeshavesomeoverheadinvolvedinthelockingprotocolsthatareusedanditdoesreduceconcurrency.|Asaresultoftheoverheadandreducedconcurrency,systemsdoofferweakerisolationlevels.|IntheStructured Query Languagestandard,therearethreelevels:readuncommitted,readcommitted,andrepeatableread.|Andtheseisolationlevelshaveloweroverheadandallowhigherconcurrencybutofcourseatacostwhichislowerconsistencyguarantees.|I'velistedthethreealternativeisolationlevelsfromtheweakertothestrongerandtocompletethepictureatthebottomwehaveafourthonewhichisserializable,whichiswhatwe'vebeentalkingaboutalready.|Beforeweproceedtolearnaboutthedifferentisolation,letmementionacoupleofthings:Firstofall,theIsolationlevelisperatransaction.|Soeachclientcouldsetdifferentisolationlevelsforeachofitstransactions,ifitwishes.|Secondofall,isolationlevelsareintheeyeofthebeholder,andletmeshowyouwhatImeanbythat.|Soeachclientsubmitstransactiontothedatabaseandmightsettheisolationlevelforthattransaction.|Thatisolationlevelonlyaffectsthattransactionitself.|Itdoesnotaffectthebehaviorofanyothertransactionsthatarerunningconcurrently.|So,forexample,ourclientontheleftmightsetitstransactiontobearepeatableread,whileourclientontherightwillsetit'stransactiontoreaduncommittedandthosepropertieswillbeguaranteedforeachofthosetransactionsandwon'taffecttheother.|Bytheway,theisolationlevelsreallyarespecifictoreads.|Theyspecifywhatvaluesmightbeseeninthetransaction,aswe'llseewhenwegetintothedetails.|Solet'sstartbydefiningaconceptcalleddirtyreads.|Adataiteminthedatabaseisdirtyifit'sbeenwrittenbyatransactionthathasnotyetcommitted.|Soforexample,herearetwotransactions,I'llcallthemT1andT2,andbythewaythroughouttherestofthisvideoI'mgoingtoputtransactionsinboxes,andyoucanassumeimplicitlythatthereisacommitattheendofeachbox.|I'mnotgoingtowriteiteachtime.|SoourfirsttransactionisupdatingStandford'senrollment,adding1000toit,andoursecondtransactionisreadingtheaverageenrollmentinthecollegetable.|We'reusingourusualdatabaseofstudentsapplyingtocolleges.|Soafterthisenrollment,Standford'senrollmenthas1,000addedtoit,butbeforethetransactioncommitsatthatpointintimethevalueiswhat'sknownasdirty.|Ifoursecondtransactionherereadsthisvaluethenitmightbereadingavaluethatneveractuallyexistsinthedatabase.|Andwhyisthat,becausebeforethistransactioncommitstherecouldbeasystemfailureandthetransactioncouldberolledbackaswedescribedbeforeandallofit'schangesundone.|Meanwhile,however,thesecondtransactionmayhavereadthatvaluebeforeitwasundone.|Here'sanotherexamplenowwehavethreetransactionsT1,T2,T3ourfirsttransactionismodifyingtheGPAofstudent'swho'shighschoolsizeissufficientlylarge.|OursecondtransactionisfindingtheGPAofstudentnumber123.|Andourthirdtransactionismodifyingthehighschoolsizeofstudent234.|SoifthisGPAhereintransactionT2isreadbeforethecommitoftransactionT1,thenthatwouldbeadirtyvaluefortheGPA.|Again,becauseofthisfirsttransaction,doesn'tcommit,thenthatvaluewillberolledback.|There'sasecondcasewherewemighthavedirtydataread,inthistriooftransactionsandthat'sthesizehighschoolhere.|Becausenoticethatherewe'remodifyingahighschoolsize,soifthissizeofhighschoolisreadbeforethecommitpointofthethirdtransaction,thatwouldalsobeadirtydataitem.|Oneclarificationaboutdirtyreads,isthatthereisnosuchthingasadirtyreadwithinthesametransaction.|InT3forexample,afterwe'vemodifiedthesizehighschool,wemightreadthesizehighschoollaterinthesametransactionandthat'snotconsideredadirtyread.|Soareadisonlydirtywhenitreadsauncommittedvaluethatwasmodifiedbyadifferenttransaction.|Sohere'sourfirstisolationlevel,andit'sourweakestone.|It'scalledReadI'mCommitted,andwhatissaysisthatatransactionthathasthisisolationlevelmayperformdirtyreads.|Itmayreadvaluesthathavebeenmodifiedbyadifferenttransactionandnotyetcommitted.|Soletstakealookatanexample.|It'soursameexample.|We'vedroppedthethirdtransaction,soourfirsttransactionismodifyingGPAsinthestudenttableandoursecondtransactionisreadingaverageofthoseGPAs.|Soifthesetransactionsareserializable,thenit'llbethebehavior'sguaranteedtobeequivalenttoeitherT1followedbyT2orT2followedbyT1.|SoeitherthesecondtransactionwillseealltheGPAsbeforetheywereupdated,oritwillseealltheGPAsaftertheywereupdated.|Asareminderwedon'tknowwhichorderthesewilloccurin.|Onlythatthebehaviorwillbeequivalenttooneofthoseorders.|Nowlet'ssupposeweaddtooursecondtransactionaspecificationthatithasisolationlevelreaduncommitted.|Andbytheway,thisverylongsentenceishowwespecifytheisolationlevelintheStructured Query Languagestandard.|Nowwhenwedon'tspecifyanisolationlevel,aswehaven'there,thedefaultisserializable.|Althoughinmostofourexamples,itwon'tactuallymatterwhatthefirsttransaction'sisolationlevelis,aswe'llsee.|We'regoingtobefocusingonthedatathat'sreadinthesecondtransactionandtypicallywritteninthefirsttransaction.|Okay,solet'sseewhat'sgoingonhere.|AgainthisisT1andT2andourfirsttransactionisupdatingtheGPAs.|Andnowwe'vesaidinoursecondthatit'sokayforthisaveragetoreaddirtyvalues,inotherwords,toseeuncommittedGPAmodifications.|Inthatcase,astheaverageiscomputed,itcouldbecomputedrightinthemiddleofthesetofmodificationsbeingperformedbyT1.|Inthatcase,wecertainlydon'thaveserializablebehavior.|Wedon'thaveT1followedbyT2,sinceT2isreadingsomevaluesthatareinthemiddleofT1,andsimilarlywedon'thaveT2followedbyT1.|Itmightbethatforourparticularapplication,wejustdon'tcarethatmuchabouthavingexactconsistency.|Itmaybethatwedon'tmindifouraverageiscomputedwithsomeoldvaluesandsomenewvalues,wemightnotevenmindifwecomputeinouraverageanincreasedGPAthatendsupbeingundonewhenatransactionrollsback.|Soifwe'rejustlookingforaroughapproximateGPAwecanusethisisolationlevel,andwe'llhaveincreasedconcurrencydecreasedoverheadbetterperformanceoverallwiththeunderstandingthatitwillhavereducedconsistencyguarantees.|Let'sgoonestepuptothenextisolationlevelwhichiscalled"readcommitted".|Asyoucanprobablyguessthisonespecifiesthattransactionsmaynotperformdirtyreads.|Theymayonlyreaddatavalueswhoseupdatesbyothertransactionshavebeencommittedtothedatabase.|Nowthisisolationlevelisstrongerbutitstilldoesn'tguaranteeglobalserializability.|Let'stakealookthroughanexample.|Ourfirsttransaction,T1,isthesameone,modifyingtheGPAforstudentsfromlargehighschools.|Oursecondtransactionistheonewherewearegoingresettheisolationlevel.|Inthiscasetoreadcommitted.|Anditisgoingtoperformtwostatements.|OneofthemisgoingtoreadtheaverageGPAfromthestudenttable,andtheotherisgoingtoreadthemaximumGPAfromthestudenttable.|Solet'slookatonebehaviorthat'sconsistentwithisolationlevel,butwewillseeisnotserializable.|Let'ssupposethatthisaverageGPAisreadbeforetransactionT1,butthemaxGPAiscomputedaftertransactionT1.|Sotheaveragewilltake,willnottakeintoaccounttheincreasesbutthemaxwilltakeaccount,willtakeintoaccounttheincreases.|So,let'sseeifthisisequivalenttoanyserialorder.|IsitequivalenttoT1followedbyT2?|Wellit'scertainlynotbecauseT2'sfirststatementisreadingthestateofthetablebeforeT1andnotthestateofthetableafterward,althoughC2secondstatementisreadingthestateofthetableafterward.|Similarlyit'snotequivalenttoT2followedbyT1becauseT2isreadinginitssecondstatementthestateofthedatabaseafterT1.|Sothere'snoequivalentserialorder.|Butagain,perhapsthat'snotneededfortheparticularapplication.|AndbyusingReadCommittedwedogetsomewhatmoreperformancethenwewouldhaveifwewereserializable.|OurnextisolationleveliscalledRepeatableRead.|Andit'sourstrongestonebeforewegettoSerializable.|InRepeatableRead,atransactionmaynotperformdirtyreadsjustlikeinreadcommitted.|Andfurthermore,thereisanadditionalconstraintthatifanitemisreadmultipletimes,itcan'tchangevalue.|Youmightrememberinourpreviousexample,wereadtheGPAmultipletimes,anditdidchangevalue.|SoifwewereusingRepeatableReadfortheconsistencylevelthere,thenthebehaviorthatIdescribedcouldn'toccur.|So,evenwiththisstrongercondition,westilldon'thaveaguaranteeofglobalserializability,andwe'llagainseethatthroughanexample.|Ourexamplesaregettingalittlemorecomplicated,here.|SowehaveourtwotransactionsT1,T2,ourfirsttransactionisstillmodifyingtheGPA(Itookawaytheconditionaboutthehighschoolsize,justtokeepthingssimple)andoursecondstatementinourfirsttransactionismodifyingthehighschoolsizeofthestudentwithID123.|SowefirstmodifiedGPA'sandthenahighschoolsize.|Inoursecondtransaction,andthat'stheonewe'resettingasRepeatableread,wearegoingtoreadtheaverageGPA,asweusuallydo,andthistimewearegoingtoreadtheaverageofthehighschoolsizes.|Incidentally,ourfirsttransactionisserializable,astheyalwaysarebydefault.|Let'slookatabehaviorwherethefirststatementreadingtheaverageGPAisexecutedbeforetransactionT1,orseesthevaluesbeforeT1,whileoursecondstatement,thehighschoolsize,seesthevaluesaftertransactionT1.|Solet'scheckourconditions.|Wearenotperformingdirtyreads,becausethefirstreadhereisofthecommittedvaluebeforeT1andthesecondreadisthecommittedvalueafterT1andfurthermore,anyitemsthatarereadmultipletimeshavenothadtheirvaluechangedbecauseweareactuallynotreadinganyvaluesmultipletimes.|Sotheexecutionofthefirststatementhere,beforeT1andthesecondoneafterislegalintherepeatablereadisolationlevel.|Yetwe'restillnotserializable.|We'renotequivalenttoT1beforeT2becauseagainthisStatementofT2isgoing-sorry-thefirststatementofT2isgoingbeforeT1orseeingthestatebeforeT1andwe'renotequivalenttoT2followedbyT1becausethesecondstatementofT2isseeingthestateafterT1.|Nowthereisanothersituationwithrepeatablereadthat'squiteimportanttounderstand.|Wesaidthatatransactioncan'tperformdirtyreads,anditcan't.|Wealsosaidthatwhenanitemthat'sreadmultipletimescan'tchangevalue.|ButthefactisthatRepeatableReaddoesallowarelationtochangevalueifit'sreadmultipletimesthroughwhat'sknownasphantomtuples.|Letmeexplainthroughanexample.|Let'ssupposeourfirsttransactioninsertsahundrednewstudentsintothedatabase.|Andthat'srunconcurrentlywithoursecondtransaction,whichisrightattherepeatablereadisolationlevelandnowwe'rejustgoingtoreadtheaverageGPAandwe'regoingtofollowthatwiththemaxGPAsimilartooneofourearlierexamples.|Now,repeatablereadactuallydoesallowbehaviorwherethisaverageiscomputedbeforeT1andthismaxiscomputedatafterT1.|SothejustificationbehindthatisprettymuchthatwhenwedothesecondreadoftheGPA,thetuplesthatwe'rereadingforasecondtimedostillhavethesamevalue.|Sowearereadingthosesomenewtuplesthatwereinsertedandinfactifthismaxwereanaverageinsteadofmaxwemightget2differentanswersfortheaverage,evenwithRepeatableReadattheisolationlevel.|Butthat'swhatitallowsandthesehundredtuplesherearewhatareknowasthephantomtuples.|Theysortofemergedduringexecutionoutofnowhere.|Now,Iwouldhavetosaythatmyopinionisthatthisbehaviorwithintherepeatablereadisolationlevel,althoughit'spartofthestandard,isreallyineffectofthewayrepeatablereadisimplementedusingLocks.|Whenavalueisreadonce,it'slockedandcan'tbemodified,butwhenweinsertnewtuples,theyaren'tinsertedwithlockssotheycanreadinasecondreadofthesamerelation.|Don'tworryabouttheimplementationdetails,butdoworryaboutphantomtuplesbecauseifyou'reusingtherepeatablereadisolationlevel,youdoneedtoknowthatinsertionscanbemadebyanothertransaction,evenbetweentwoentirereadingsofatable.|Nowontheotherhand,ifwhatwedoinourfirsttransactionisdeletethehundredtuplesinsteadofinsertthem,inthatcaseweactuallycannotgetthebehaviorwherethefirststatementisbeforeandthesecondstatementisafter.|Becauseoncethese,theaveragevaluehasbeenreadofthisGPA,thisdeletionwillnotbeallowedbecause,againkindofanimplementation,butthosevaluesarelocked.|Andsointhiscase,thesecondreadofthatsamerelationwouldn'tbeallowed.|Soinsummarywemayhavephantomtuplesupherebetweentworeadsofthesamerelationinarepeatablereadtransaction,butwewon'thavetuplesdisappearfromtherelationinbetweentworeadsofit.|So,thatcompletesourthreeisolationslevels,inadditiontoserializablewehadattheweakestread-uncommitted,thenread-committed,andthenrepeatableread.|Ididwanttomentionthatwecanalsosettransactionstoberead-only.|That'ssortoforthogonaltosettingtheisolationlevel,whatitdoesisithelpsthesystemoptimizeperformance.|So,forexample,inourtransaction,wherewewerejustreadingtheaverageGPAandthemaxGPA,wecansetanisolationlevel,andthenwecanalsotellthesystemthatit'sgoingtobeareadonlytransaction.|Thatmeansthatwearenotgoingtoperformanymodificationstothedatabasewithinthetransaction.|Thesystemcanusethatasahinttofigureouthisprotocolstoguaranteetherightisolationlevel,butitmightnothaveasmuchoverheadasifthetransactionhadthepossibilityofperformingmodificationsaswellasperformingreads.|OK,sothebehavioroftransactionscanberatherconfusingandit'sveryimportanttogetitrightorsurprisingthingsmighthappen.|ButIthinkwecansummarizeitprettywellwiththistablehere.|We'regoingherefromtheweakesttothestrongestandwecanclassifythebehavioroftransactionsbasedonagainwhathappenswithreading.|Cantheyreaduncommittedvalues?|Cantheyhavenon-repeatablereads,wherewereadavalueandthenreadadifferentonelaterinthesametransaction,andcantherebephantomtuplesinsertedduringthetransaction?|Ifwesetourisolationleveltoserializable,thenwecannothavedirtyreads,wecannothavenon-repeatablereadsandwecannothavephantoms.|Ifwegoonestepweakerforalittlemoreperformance,anduserepeatableread,thenwestillwon'thavedirtyreads,westillwon'thavenon-repeatablereads,butwemighthavephantomtuples.|MovingupwithReadCommitted,westillwon'thavedirtyreadsbutwemighthavenon-repeatablereads.|Sowemightreadavaluethat'scommittedbothtimeswereadithoweveratransactionwrotethevalueinbetweenthosetworeadssoit'sdifferenteachtimeandwemayhavephantomsaswell.|Finallyreaduncommittedistheabsoluteweakest,notmanyguaranteesatall.|Wemighthavedirtyreads,wemighthavenotrepeatablereads,andwemighthavephantoms.|Sotowrapuptransactionscompletelythestandarddefaultisserializablebehavior,andwespecifiedexactlywhatthatmeans.|Weakerisolationlevelsallowustoincreaseconcurrency,decreaseoverheadsooverhaulwillgetanincreasedperformance,butwehaveweakerconsistencyguarantees.|Ishouldmentionthatsomeprominentdatabasesystemshaveactuallychosentohaverepeatablereadastheirdefault.|OracleandMySQLareexamplesofthat.|So,inthosesystemsit'sassumedthatmostapplicationswillbewillingtosacrificealittlebinary digitinconsistencyinordertogethigherperformance.|And,finally,theisolationlevelissetforeachtransactionandisintheeyeofthebeholder,meaningthatthattransaction'sreadsmustconformtoitsownisolationlevelbutwon'taffectanyconcurrenttransaction'sisolationlevel.|IhopeI'vegottenthepointacrossthattransactionsareoneofthemostimportantconceptsindatabasesystems.|Theyarewhatallowmultipleclients,maybethousands,tensofthousandsofclients,tooperateonadatabase,allatthesametimewithoutconcernthattheactionstheyperformonthedatawillaffecteachotherinunpredictableways.|Andfurthermore,transactionsarewhatallowdatabasesystemstorecoverwhenthere'sanunexpectedcrashintoaconsistentspace.|Inthisvideo,we'llbeintroducingtheconceptsofconstraintsandtriggers.|Latervideoswillhavedemos.|We'reconsideringconstraintsandtriggersinthecontextofrelationaldatabases.|TheStructured Query Languagestandarddoesincludestandardizedconstructsforconstraintsandtriggers,although,thisisanareawheredeployedsystems,doveryconsiderablyinhowmuchtheycoverandhowtheycoverit.|Constraintsarealsoknownasanintegrityconstraints,andtheyconstraintheallowablestatesofthedatabase.|Triggersarealittledifferent.|Triggersmonitorchangestothedatabaseandwhenthey'reactivatedtheycheckconditionsoverthedataandpossiblyautomaticallyinitiateactions.|Sowecanthinkofconstraintsasasortofstaticconceptovertheallowablestateswheretriggersaremoredynamic.|Let'stalkalittlemoreaboutintegrityconstraintsandthenwe'llmovetotriggers.|So,theideaofintegrityconstraintsisthatwewanttoimposerestrictionsonthealloweddataofthedatabase.|Now,whenwecreateaschema,wesaythetypesoftheattributes,we'realreadyimposingstructuralandtyperestrictions.|But,integrityconstraintstendtobemoresemantic--theycapturerestrictionsthathavetodowiththeapplication.|So,let'slookatabunchofexamples.|Andtheseareinthecontextofourstudentsandcollegedatabase.|SoasimpleexamplemightsaythatwhenwehaveaGPAvalue,theGPAmustbe,say,greaterthanzeroandlessthanorequalto4.0.|Anotherexamplemightsaythatwhenwehavetheenrollment,forourcolleges,theenrollmentmustbelessthan,say,fiftythousand.|Well,actuallyforsomeuniversitiesitmightbemorelike75,000.|WemighthavethedecisionattributeinourapplicationtableiseitherthevalueyesorYforyesorthevalueNfornoormaybenullisallowed,thatcouldbeaconstraint.|Again,eachoftheseareconstrainingthedatathatcouldbeinthedatabasebeyondthetypestructurethat'salreadybeendefined.|Here'salittlemorecomplicatedone.|Maybewe'llwantaconstraintthatsays"NodecisionshavebeenmadeonComputer Scienceapplications."|SoifourmajorequalsComputer Science,then,thisisasortoflogicalimplication,thenourdecisionisstillequaltonull.|Orhere'sanevenmorecomplicatedone.|Let'ssaythatwewanttoenforcethatstudentswhocomefromsmallhighschoolsarenotadmittedtosuperlargecollegesbecauseitjustwouldn'tbeagoodideaforthem.|Wemightsayifthesizeofthehighschoolislessthantwohundredthenifthey'readmitted,well,let'ssaythey'renotadmittedtoacollegewheretheenrollmentisgreaterthan30,000,let'ssay.|Ofcoursewewouldn'tdothatinrealitybut,thisjustgivesyouanideaofthefairlycomplicatedexpressionswecanwriteasconstraintstolimitwhattheallowabledataisinthedatabase.|So,whydowewanttouseconstraints?|Well,there'sseveralreasons.|Actually,oneverypracticalreasonisjusttocatchdataentryerrors.|So,ifwehaveconstraintsthatjustsaythatthevaluesofthedataareinthereasonablerange,forexample,ourGPA'sorourenrollments,thenifsomebodytriestoenterdatathatviolatestheconstraintstheyprobablywerejustmakingamistake,itwasprobablyanerrorandthatcanbecaughtautomaticallybytheconstraintenforcementsysteminthedatabasesystem.|So,asimilarexampleiscorrectnesscriteria.|So,dataentryerrorswouldbetypicallyforinserts,wherecorrectnesscriteriamightbeforupdates.|So,ifwe'remodifyingthedatabase,forexample,weupdatedGPAoranenrollment,ifwe'recheckingourconstraints,thatwillmakesurethatourupdatesarecorrect-theydon'thaveerrors.|Anotheruseofconstraintsistoenforceconsistency.|Sowemighthavecopiesofdatainthedatabaseindifferentplacesorsomedatathatreliesonotherdataandsowhenwehaveofthatsituation,consistencywecouldhaveconstraintsthatspecifytheconsistencyrequirementsandarecheckedautomaticallyandfinallyaverydifferentuseofconstraint,istotellthesystemaboutthedata.|So,specifically,wemighthavekeyconstraintsthatsayvaluesareuniqueorwemightagainhaveconsistencyrestraintsthatthesystemcanusetobothstorethedatainacertainfashionthatmadeitmoreefficientandalsoforhowitprocessesqueries,queryprocessing.|Soletmegiveabroadclassificationofthetypesofintegrityconstraintsthataresupportedindatabasesystems.|Andthisroughlyfromsortofsimplesttothemostcomplicated.|So,acommontypeofconstraintissimplyanon-nullconstraint.|Thevaluescannottakeonnull,thatvaluescannottakeonnull.|Asecondtypeiskeyconstraints,we'veseenthosealready.|So,acolumnorsetofcolumnsmusthaveuniquevaluesineachtuple.|Averyimportanttypeofconstraintiscalledreferentialintegrityand,we'reactuallygoingtotreatthatinit'sownvideo.|It'softensometimesknownasforeignkeyconstraints,becauseitisaveryfrequentlyusedandimportanttype.|Nextwehavewhatareknownasattribute-basedconstraints,andtheseareconstraintsthatarespecifiedalongwithanattributeconstrainingthevalueoftheparticularattribute.|Asimilartypeofconstraintisatuple-basedconstraint,butit'sassociatedwitheachtuple,soitcanconstrainhowthevaluesinatuple--butindifferentattributes--relatetoeachother.|And,finally,there'sanotioncalledgeneralassertions,whereweprettymuchusetheentireStructured Query Languagequerylanguagetospecifyconstraintsoverthedatabaseacrosstablesandwithintables.|Nowlet'stalkabouthowconstraintsaredeclaredandenforced.|There'stwodifferenttimesthatwecandeclareconstraints.|Oneiswiththeoriginalschema.|So,atthetimewecreatetables,wecanassociateconstraintswiththosetablesorwiththeentiredatabase.|Ifwedoitthisway,thentheconstraintsaretypicallycheckedafterbulkloading.|So,aswediscussedinpreviousvideosthewayadatabaseisoftensetupistheschemeasdeclaredandtheinitialsetofdatamaybeenoughfileandthenit'sbothloadedinthedatabasesowedidclearconstraintsthenafterthedataisloadedthesystemwillchecktheconstraintsandiftheydon'tholdanerrorwillberaised.|Nowanotherpossibilityisthatwedecidedonceadatabaseisalreadyinoperationthatwehavesomeconstraintswe'dliketoenforce.|Maybetheapplicationischangeormaybewejustrealizethatthereiscertainconstraintsonthedata,inthatcasewhathappensistheconstraintischeckedonthecurrentstateofthedatabaseatthetimeit'sdeclared.|Nowthistalksaboutcheckingconstraintsonasinglestateofthedatabasebutofcourseifthedatabaseismodifiedwehavetocontinuetocheckconstraints.|So,theideaisthatonceaconstraintisinplaceandiftheholdsonthedatabasetheneverytimethedatabaseismodifiedtheconstraintstobechecked.|Nowofcoursewhatwereallyonlywanttocheckisdangerousmodifications,sowehaveaconstraintontheGPAwedon'tneedtocheckchangestotheenrollments.|Ifwehaveconstraintsononetablewecertainlydon'tneedtocheckupdatesonanothertableormodifications.|So,partofagoodconstraintcheckingsystemwillonlycheckconstraintsafterthosemodificationsthatcanpossiblycausetheconstrainttobecomeviolated.|Ontheotherhand,thesystemdoeshavetoinsurethataftereverymodification,theconstraintholds.|There'salsoanotherconceptknownasdeferredconstraintchecking.|Anddeferredconstraintcheckingsaysthatandwemightwanttodoawholebunchofmodificationsthatduringthemodificationsviolatetheconstraint,butoncewearedonewithallofthem,thentheconstraintswillholdagain.|And,inthatcase,insteadofcheckingaftereverymodification,whatweactuallycheckisaftereverytransaction.|So,we'lltalkabouttransactionsinaseparatevideo.|But,theconceptoftransactionsisthat,youcangroupabunchofmodificationstogetherandthey'llbeexecutedasaunit.|Andthatunitisusedforotherpurposesaswell:formanagingconcurrencyandforrecovery,but,intermsofconstraints,itcanalsobetheunitofmodificationthat'susedforconstraints.|Checkit.|Again,ifweperformamodificationthatviolatestheconstraint,typicallythesystemwillraiseanerrorandwillundothemodificationthatviolatedtheconstraint,sothatthedatabasestaysinastatethat'sconsistentwithrespecttoitsconstraints.|Now,let'sintroducetriggers.|AsImentionedearlier,triggersareamoredynamicconceptthanconstraints.|Constraintstalkabouteachstateofthedatabase,wheretriggerstalkabouthowthedatabaseevolves.|Andtheycaninfactthemselvestriggeractionthatcausethedatabasetofurtherevolve.|Triggersaresometimesknownaseventconditionactionroles,becausethebasicstructureofatriggersayswhensomeeventoccurs--andthat'stypicallyamodificationtothedatabaseofsometype--checkaconditionoverthedatabase.|Sometimesthisconditionwillbecheckingtheviolationofaconstraint,butitcanbemoregeneralthanthat.|Andiftheconditioniftheconditionistruethenperformanaction.|Solet'slookatsomeexamplesofwhatwemightusetriggersforinourcollegeapplication.|Sowemighthaveatriggerthatsays,iftheenrollmentismodifiedtoexceedsaythirtyfivethousandthenlet'sinitiateanactionandnowthisisnotalogicalimplicationbutatriggeringofanactionthatrejectsallapplications.|So,wecancodethatinatriggerandit'salittledifferentandaconstraint.|Wemightwriteanothertriggerthatsaysifweinsertanapplicationthathasa,withaGPA,say,greaterthan3.95,then,again,thisisnotimplication,but,triggeringanaction,wemightacceptautomaticallythatapplicant.|Asanotherexample,let'ssaythatweinsertaorlet'ssayweupdatethesizehighschooltobegreaterthan,say,seventhousand,seemsprettyunlikely,thenthat'sprobablyanerrorandwecouldchangethevalue,say,to'Wrong'.|Actuallyonethingthattriggercanoftendoingthisactionissimplyraiseanerrorandwecanseethislastoneiseffectivelyenforcingaconstraintthatthesizeschoolshouldbelessthanorequalto7000.|Wesawanumberofreasonsthatwemightwanttouseconstraints,nowlet'stalkaboutwhywemightwanttousetriggers.|Actuallytheoriginalmotivationfortriggerswastomovelogicthatwasappearinginapplicationsintothedatabasesystemitself.|Forexample,ifourapplicationisdoingalloftheworktomonitoreachchangetothedatabase,andthatmakeadditionalchangesbasedonthatmonitoring,whynotputthatfunctionalityinsidethedatabasesystemintheformoftriggers?|Thatmakesitmoremodularanditinsuresthatallthemonitoringautomaticallyoccursnomatterwhichapplicationisrunningonthedatabase.|Inadditiontomovingmonitoringlogicinsidethedatabasesystem,averycommonuseoftriggersissimplytoenforceconstraints.|Nowyoumightwonderwhywouldpeoplenotsimplyusetheconstraintsysteminsteadofwritingtriggers.|TherealityisthateventhoughtheStructured Query Languagestandardisveryexpressiveintermsofconstraints,especiallywhenyouconsiderthegeneralassertionfeature,nodatabasesystemimplementstheentirestandard.|Mostoftheconstraintcheckingfeaturesaresomewhatlimited.|Ontheotherhand,thetriggerfeaturesarequiteexpressive.|So,there'sanumberofconstraints,alargeclassofconstraints,thatcan'tbeexpressedusingtheconstraintfeature,butcanbeexpressedusingtriggers.|Soexpressivenessisoneofthereasons.|Theotheristhatusingtriggersyoucannotonlymonitorconstraints,butyoucanactuallyhaveconstraintrepairlogic.|Sowhenyouuseconstraintsystems,exceptforonespecificcasehavingtodowithreferentialintegritythatwe'llsee.|Whenyouuseconstraintsystemstypicallyiftheconstraintisviolatedanerrorisraisedontheotherhandifyouuseatrigger,triggercandetecttheconstraintisviolatedanditcanlaunchanactionthatfixestheconstraint,sothat'sagooduseoftriggers.|Here'saquickpreviewofwhattriggerslooklikeinStructured Query Language,we'llgointomuchmoredetailinalatervideoaswellashavedemonstrationsoftriggersinarunningsystem.|Againtriggersareknownasunconditionalactionrulesandwecanseeherethespecificationofevents,whicharemodificationstothedatabase.|Wecanseeherethecondition,that'swritteninaStructured Query Languagelikelanguageandfinallyiftheconditionistruetheactionisexecuted.|Toconcludeconstraintsandtriggersareaboutmonitoringthestateofthedatabase.|Constraintsspecifyallowabledatabasestates,whiletriggerscancheckconditionsandautomaticallyinitiateactions.|Inlatervideos,we'llgointosubstantiallymoredetail,andwe'llhavesomedemonstrationsoftheconstraintandtriggerfeaturesindeployeddatabasesystems.|inthisvideo,we'llbegivingademoofconstraintofseveraltypes,asareminderconstraintsalsoknownasintegrityconstraintsimposerestrictionsontheallowablestatesofadatabase,beyondthosethatareimposedbytheschemathat'sbeendefinedandthetypesoftheattributes.|Wehaveanumberofdifferenttypesofconstraints,wehavenonnullconstraintswhichspecifiedthataparticularattributecannothavenovalues,wehavekeyconstraintsthattalkaboutuniquenessincolumnsorsetsofcolumns,wehaveattributebaseandtuplebaseconstraintswhichspecify,arestrictionsonthevaluesandattributesorthevaluesacrossattributesinparticulartuplesandfinallywehavegeneralinsertionswhicharequitepowerful,theyallowyoutospecifyconstraintsacrossanentiredatabase.|Aswe'llseeinthedemo,notalloftheseconstrainttypesarefullyimplemented.|TherearesomelimitsontheattributebaseandtuplebaseconstraintsinsystemsascomparedtotheStructured Query Languagestandardandgeneralassertionshavenotbeenimplementedyetinanydatabasesystem,butwewillgiveexampleswhattheylooklike,hadtheybeenimplemented.|Averyimportanttypeofconstraint,isreferentialintegrityorforeignkeyconstraintsandthosewillbecoveredinthenextvideo.|Forademonstrationofconstraintswe'llbereturningtothesamesimplecollegeadmissionsdatabasethatweuseforourStructured Query Languagedemos,wehavethreetablesonewithafewcolleges,onewithanumberofstudentsandfinallyatablethathasinformationaboutstudentsapplyingtocolleges.|Let'sstartbycreatingatablewithanon-nullconstraint.|Sonon-nullisaprettysimpletypeofconstraint.|IfwedecidethatourGPAvaluesinourdatabasemustnottakeonthenullvaluewhenwecreatethetablewejustaddthekeywordsnotnullinthedeclarationwiththatattribute.|Let'srunthecreationofthetable,letmementionrightupfrontwe'regoingtobeseeingalotofthiswordaffected,thismisspellingherewhichgetsonmynervebutI'mnotgoingtomentionitagain.|Okay,solet'sdosomeinsertionsandupdatesjusttoexperimentwithanotnullconstraint.|We'llstartbyassertingthreetuples,thefirstonehasnonullvaluesatall,thesecondonehasanullvalueforthehighschoolsizewhichshouldbeallowed,andthethirdonehasanullvaluefortheGPAwhichshouldnotbeallowed.|Let'srunthesethreeinsertcommandstogetherandweseeinfactthefirsttwosucceededwherethethirdonegeneratedanerror.|Ifwegoandlookatthetable,we'llseethatindeedwegotourfirsttwotuplesincludingthenullforthehighschoolsizebuttherewasnothirdtupleinserted.|Nowwe'lltryacoupleofupdatecommands.|BothofthemaregoingtosettheGPAtonull,thefirstoneforthestudentwithID123andthesecondforthestudentwithID456.|Ifwelookatourdata,weseethatwedohaveastudentwithID123,sowhenwetrytoupdatethatGPAtonull,weshouldgetanerror.|Butwedon'thaveastudentwhoseIDis456,soeventhoughwe'regoingtorunacommandthattriestosetGPAstonull,becausethere'snomatchingdata,nodatawillattempttobeupdatedandwewon'tgetanerror.|Let'srunthequery,thetwoupdates,andweseeindeedthatthefirstonecausedtheconstraintviolationandthesecondonedidnot.|Nowlet'stakealookatkeyconstraints.|I'vedroppedthepreviousversionofthestudenttableandnowwewillcreateanewonewherewe'redeclaringthestudentIDtobewhat'scalledaprimarykey.|Asyoumayremember,akeyconstraintspecifiesthatthevaluesinthecolumnthat'sdeclaredasakeymustbeunique.|Solet'sgoaheadandcreatethetableandnowlet'sexperimentwithinsertingandupdatingsomedata.|We'llattempttoinsertthreestudents:firstone,123Amy;second,234Bobandthirdone,123Craig.|Sincethethirdinsertwillgenerateakeyviolationbecausetherewillbetwocopiesof123intheIDcolumn,thatoneshouldgenerateanerror.|Werunthequeries,theinserts,andindeedthefirsttwoarefineandthethirdonehasakeyerror.|Ifwegoandlookatthedataitself,we'llseethatthefirsttwoareinsertedandthethirdonewasn't.|Nowlet'stakealookatupdates.|Thefirstupdateisverysimple.|IttriestosetBob'sIDto123.|SinceAmyalreadyhasID12threethatshouldgenerateanderrorandwhenweruntheupdatecommandindeeditdoes.|Nowwe'regoingtodosomethingalittlebinary digittrickier.|We'regonnarunanupdatecommandthatsubtracts111fromeachstudentID,nowyoumightwonderwhydidIchoose111,let'stakealook,ifwesubtract111fromBob'sID;two,three,fourwillturnintoone,two,threeandwillhaveakeyviolation,ontheotherhandifthecommandfirstupdatesAmy'sstudentIDto12,thenwewon'thaveakeyviolationwhenBob'sinturnedintotwothree,intoonetwothree.|Sowhetherwegetakeyviolationinthiscasecoulddependonwhatorderthesystemchoosestoexecutetheupdate.|Solet'sjustrunitandlet'sseewhathappens.|Well,thingslookgood.|Wedidn'tgetanerror.|Let'sgolookbackandrefreshthetableandweseeindeedthatbothoftheupdatesucceededwithoutaviolation,sonowlet'ssettheasthestudentIDbacktowhattheywerebyadding111,let'srunitseewhathappens,wellthistimewegotanerror.|Sowegotaconstraintviolationerror,akeyviolation,andnothingwasupdated.|That'spresumablybecausethesystemagainupdatedAmy'sIDfirstandthatgeneratedanerrorwiththeonetwothreeforAmy.|Sothissortofdemonstratesitoneitcanbeprettytrickywhenkeyviolationsorothertypesofconstraintviolationsaredetectedandwhentheyaren't,nowwedidmentionearlierthatthere'sanotionofforconstraintcheckingsoifanapplicationhaveknowledgethatitwouldratherhaveconstraintscheckedafterabunchofchangesratherthaninthemiddle,theforconstraintcheckingcanbeuseforthatpurposeandthisdemowe'redoingimmediateconstraintchecking.|YoumighthavenoticedinthepreviousexamplethatIusethetermprimarykeywhenIdeclaredthestudentIDasakey.|IntheStructured Query Languagestandardandineverydatabasesystemonlyoneprimarykeyisallowedpertable,that'swhyit'scalledprimary,andoftenthetablewillbeorganizedbasedonthatkey,makingitefficienttodolookupsonthat,forvaluesforthatparticularkey.|Soifwedecidedwewantedtodeclaretwoprimarykeysinourtable,thestudentIDandthestudentname,wewouldgetanerror,nowthat'snottosaywe'renotallowtohavemultiplekeysinatable,infactwecanhaveasmanyaswewant,onlyoneofthemcanbedeclaredasprimarybutwecandeclareanynumberofattributesorsetsofattributestobeuniqueandthat'sagaindeclaringakeyconstraint,itsayswecanonlyhaveone,wemusthaveuniquevaluesinthatcolumn,solet'screateourtablewiththestudentnamenowalsoakeyalongwiththestudentIDandwe'lldoafewupdatesjusttocheckthat.|Sowe'llattempttoinsertfivestudents,1-2-3Amy,2-3-4Bob,sofarsogood.|Whenwetry3,4,5AmyweshouldgetanerrorbecausewehavenowdeclaredthatthenamemustbeakeyaswellasthestudentIDsowewon'tbeallowedtohave2Amy.|4,5,6doorshouldbegood.|5,6,7Amyshouldagaingenerateanerror,weranthequeryandindeedwegettwoerrors.|Sofarweseenonlykeysthatareoneattributebutasyouknowwecanhavekeysthatspansseveralattributes,that'snottosaythateachattributeisthekeyindividuallybutratherthecombinationofvaluesforalloftheattributesmustbeuniqueineachtuple.|Solet'ssupposethatourcollegenameisnotuniqueonitsownbutcollegenameandstatetogetherareexpectedtobeunique,nowsyntacticallywecan'tputtheprimarykeystatementwiththeattributeanymorebecauseitinvolvesmultipleattributes,sothesyntaxistolisttheattributesfirstintheCreateTablecommand,thenusethekeywordsprimarykeyandputthelistofattributesconstitutingthekeyinparentheses.|Solet'screatethetable.|Nowlet'sinsertsomedata.|I'vetriedtopickacollegenamethat'skindofgenericMason,Idon'tknowifI'vesucceededbutwe'lltrytoanswertheMasoncollegeinCalifornia,aMasoncollegeinNewYorkthoseshouldsucceedbecausethetwocolumnstogetherneedtobeuniquebutnottheindividualcolumnandthenweshouldgetanerrorwhenwetrytogenerateathirdtuplewithMasonCalifornia.|Werunthequery,weruntheinsertsandindeedwedo.|Nowletsusemulti-attributekeystodeclaresomeinterestingconstraints.|We'regoingtocreateourapplytableandwe'regoingtohavetwokeyconstraints.|ThefirstonesaysthatthecombinationofstudentIDandcollegenamemustbeuniqueineachtuple.|Whatthat'sreallysayingisthateachstudentcanapplytoeachcollegeonlyonetime.|We'realsogoingtosaythatthecombinationofstudentIDandmajormustbeuniqueineachtuple.|Thatmeansthateachstudentcanapplytoeachmajoronlyonce.|Now,astudentcanstillapplytoseveralcollegesandseveralmajors,butonlyonetimeforeach.|Solet'screatethetableandthenlet'stryinsertingsomedata.|We'llinsertquiteanumberoftuplesandletstakealookatwhatweexpecttohappen.|Ourfirsttuplesays123appliestoStanfordandComputer Scienceandthen123alsoappliestoBerkeleyandEE,noproblem.|123triestoapplyagaintoStanfordandthatshouldbeanerrorbecausethat'sthesecondinstanceofthecombinationof123Stanford.|Ontheotherhand,234shouldbeabletoapplytoStanford.|123comesbackandwantstogotoMassachusetts Institute of TechnologybuttriesonceagaintomajorinEE.|Thatshouldgenerateanerrorbecausethecombinationof123andEEalreadyappearsinoursecondtuple.|Andfinally123appliestoMassachusetts Institute of Technologybutinbiologyandthatshouldworkjustfine.|Sowe'llrunthequeryandwe'llfindindeedthefirsttwotuplesandthefourthandthesixthwerefinebutthethirdtuplegeneratedanerrorbecauseofthesecondapplicationtoStanfordandthefifthbecauseofthesecondapplicationtoEE.|Let'sgotakealookatthedata.|Andhereweseeintheapplyrelationthatwedidindeedinsertthefourtuples,butnotthetwotuplesthatgeneratedthekeyerror.|Nowwe'lltryasneakyupdatecommand.|We'lltrytotakeourfourthtuple,andwe'llidentifyitbyhavingthecollegenameequaltoMassachusetts Institute of Technology,andwe'lltrytobesneakyandchangethethebiologymajortoComputer Science.|Thatwillthenviolatetheconstraintoftheuniquenessof123Computer Sciencesoifallgoeswellthatupdatewillbedisallow,hereistheupdatecommand,settingthemajortoComputer SciencewiththecollegenameisMassachusetts Institute of Technology,rerunthecommandandindeeditgeneratesanerror.|Thelastthingwe'llshowinthisexampleishowNULLvaluesworkwithkeys,sowe'lltrytoinserttwotuplesagainusing1,2,3,whereboththecollegenameandthemajorarenull.|So,asareminder,thefirstandsecondattributesneedtobeuniqueinthefirstandthirdattributesneedtobeunique,soifNULLscountsforkeyssoitwillgenerateanerror,whatwe'llseeisthatweactuallydon'tgetanerrorandweinfactdohavethedatainthetablewiththeNULLvalues,sotheStructured Query LanguagestandardandmostdatabasesystemsdoallowrepeatedNULLvaluesevenincolumnthataredeclaredasunique,forprimarykeydeclaredcolumnsmostsystemsthoughnotall,donotpermitrepeatedNULLvaluesinthem.|Thatcompletesourdemonstrationofkeyconstraints,nowlet'slookatattributebasecheckconstraints.|Letscreateourtableagainwithfourstudentsandthistimewe'lladdtwoconstraintstotwooftheattributes.|FortheGPAwe'regoingtoaddthekeywordcheckandaconditionthatlookskindalikethewhereclauseintheStructured Query Languagequery.|ThisconditionspecifiesthatGPAsmustbelessthanorequalto4.0andgreaterthanzero.|We'llalsoputacheckconstraintonthehighschoolsize,sayingthatthesizeofthehighschoolmustbelessthanfivethousand.|Sotheseareexamplesof,sortof,sanitychecks,thataremostlyuseforcatchingdataentryerrors,sayingthattheattributevaluesmustbewithintheexpectedrange.|Letscreatethetableandnowwe'lltakealookatsomedata.|Thistimewe'llinserttwotuples.|Itwillbeprettyeasytoseehowtheseconstraintswork.|ThefirstoneinsertsAmywithareasonableGPAandareasonablehighschoolsize;thesecondoneinsertsBobwithareasonablehighschoolsizebuthisGPAlooksalittleoutofwhack.|Werunthequeryandthefirstrowisinsertedbutthesecondoneisn't.|WetakealookatthedataandweseethatAmyhasbeeninserted.|Nowtotesttheconstraintsonthesizeofhighschool,we'lltrytorunanupdatecommandthatmultipliesallhighschoolsizesbysix.|Here'sthecommand,andwhenwerunit,wegetanerror.|Soattributebasedconstraintsallowustoassociateaconditionwithaspecificattributeandthatconditionischeckedwheneverweinsertatupleorupdateatupletomakesurethatallofthevaluesinthatattributesatisfytheconstraint.|Aslightlymoregeneralnotionistuplebasedconstraints.|Tuplebasedconstraintsarealsocheckedwheneveratupleisinsertedorupdated,butthey'reallowedtotalkaboutrelationshipsbetweendifferentvaluesineachtuple.|Andbecausewedon'tassociatethemwithaspecificattribute,thecheckitselfisputattheendofthedeclarationofofthetable.|So,westartbydeclaringalloftheattributesandthenafterwardsweputthekeywordcheckagain,andthentheconditioninsideparentheses.|Nowthisconditionmaylookatfirstalittlebinary digitoddtoyou.|ItsaysthatforeachapplytupleeitherthedecisionisnullorthecollegenameisnotStanfordorthemajorisnotComputer Science.|Whydon'tyouthinkaboutthatforasecondandthinkaboutwhatitmightbesaying.|Nowifyou'regoodinBooleanLogic,youmighthavewrittenthisdownusinglogicalexpressionsandusesomeofDeMorgan'slawsandturnedyouror'sandnot'sintoimplications.|Ifnot,I'lljusttellyouthatwhatthisissayingisthattherearenopeoplewhohaveappliedtoStanfordandbeenadmittedtoComputer ScienceatStanford.|Specifically,eithertheyhaven'tbeenadmittedorthecollegeisnotStanfordorthemajorisnotComputer Science.|We'llcreatethetableandthenwe'llexperimentwithsomedata.|Firstwe'lltrytoinsertthreetuples.|ThefirstonehasastudentapplyingtoStanfordComputer Sciencebutnotbeingadmitted,secondtheyapplytoComputer SciencebutitsaysMassachusetts Institute of TechnologyandtheyareadmittedandthenfinallywillgenerateaconstraintviolationbyhavingthestudentapplytoStanfordComputer Scienceandbeadmitted.|Werunthequeryand,asexpectedthefirsttwotuplesareinsertedandthethirdgeneratesaviolation.|Nowlet'strysomeupdatestatements.|SowehaveastudentwhoappliedtoStanfordComputer Scienceandwasnotadmitted.|AndwithastudentwhoappliedtoMITCSandwasadmitted.|Sofirstwe'lltrytotakethatStandfordstudentandchangethedecisiontoyes,that'snotgoingtowork.|Sothenwe'lltrytakingthestudentsadmissiontoMassachusetts Institute of TechnologyandconvertingthattobeanadmissiontoStanfordandthatshouldn'tworkeither.|Wetryallofthoseandneitherofthemsucceedandbothcasesaretuplebasedconstraintlesscheckandthecheckconditionwasviolated.|BeforeIdomylastsetofexamples,Ididwanttoexplainonethingincaseyou'retryingtheseconstraintsathome.|TheconstraintsthatI'veshownsofarwereperfectlywellinSQLiteandinpostrisks.|InmyStructured Query Languageasofthetimeofthisvideothecheckconstraintsboththeattributebasedandtuplebasedcheckconstraintsareacceptedsyntactically[sp?]|bytheMySQLsystem,butthey'renotenforced.|Soitcanbeabinary digitdeceptivebecauseyoumaycreatethetablesexactlyasI'vedoneinmyStructured Query Language,butthenyouwillbeallowedtoinsertenoughdataandviolatetheconstraints.|SoagainIrecommendfortryingcheckconstraintsfornowSQLiteorPostgres.|Ifyou'vebeenashrewdobserverofwhatwe'vedonesofar,itmighthaveoccurredtoyouthatwehadsomeredundancy.|Specifically,theattributebasecheckconstraintsthatwe'veshowedcanbeusedtoenforcesomeothertypesofconstraints.|Veryspecificallyifwewanttohaveanotnullconstraintwecanjustwritenotnull.|That'sabuiltintypeofconstraint.|Butthat'sequivalenttoaddinganattributebasedcheckconstraintthatfortheGPAforexamplechecksthattheGPAisnotnull.|AsareminderisnotnullisakeywordintheStructured Query Languagelanguage.|Let'screatethistableandlet'strytoinsertatuplewithanullvalue.|WehavestudentAmyagainwithanullGPAandthatgeneratesanerror.|Alittlemorechallengingandinterestingistotrytoimplementkeyconstraintsusingattributebasedcheckconstraints.|Sohere'sanattemptatdoingso.|Let'sjustconsideraverysimpletable.|We'llcallitTanditwillhaveoneattributeA.|Andwe'lltrytowriteacheckconstraintthatspecifiesthatAisakeyforT.So,hereismyattemptatdoingso.|IdeclaretheattributeandtheninatmycheckIsaythatthevalueofAisnotinselectAfromT.InotherwordsthevalueofthatorsayattemptingtoinsertorupdateisuniqueintableT.WellfirstI'mgonnatellyouthatI'mnotallowedtoexecutethat,there'svariousreasonsthatIcan'texecuteit.|OnesimpleoneisthatI'mtryingtodeclareatableTandrefertoitbeforeithasbeendeclared.|Anotherissuewithdeclaringitisthesubqueryinthecheckconstraint,we'lltalkaboutthatinamoment.|There'sactuallyathirdproblemwiththisconstraint,whichisweneedtothinkaboutwhenit'sbeingchecked.|IfwesayfirstattempttoinsertthevalueAandthenchecktheconstraint,thentheconstraintwillbeviolatedbasedontheexistenceofitself.|Sothisisclearlynotgoingtowork.|Thereisinfactadifferentexpressionthatmightworkifitweren'tforacoupleofotherobstacles.|Here'sanexpressionthatdoesn'thavetheproblemofwhetherwecheckitbeforeorafterweinsertA.|ThisisanexpressionofakeyConstraintinawayyoumightnothavethoughtof.|WhatthissaysisthatthenumberofdistinctvaluesforanattributeAmustbeequaltothenumberoftuplesinthetable.|InotherwordseverytuplehasadistinctvalueforA.|Nowtherewasonesmallissueherewhichisnullvaluesbecause,aswementioned,uniquekeyconstraintsallowmultipleinstancesofnull.|But,ifwedon'tworryaboutnullsthenthisisexpressionreallyisadifferentwayofsayingthatAisakey.|Werunthequeryanditdoesn'tallowit.|Againwehavethesameproblemthatwe'rereferringtotableTwithinthecheckconstraintthatwe'reputtinginthedefinitionoftableT.Bytheway,thatcanbeovercome.|Somesystemsdoallowconstraintstobedeclaredoraddedtotablesafterthetablehasbeenspecified.|Sothatwouldgoaway.|ButnosystemsthatIknowofallowsubqueriesandespeciallynotaggregationwithincheckconstraints.|Let'spursuealittlefurtherthequestionofsubqueriesandcheckconstraints.|Thekeyexample'salittlebinary digitcontrivedbecauseofcoursewecandeclarekeyconstraintsdirectly.|Butinsomecasesareverynaturalconstraintthatwemightwanttoexpressacheckconstraintusingsubquery.|AndI'vesetupasituationrighthere.|WecreateourstudenttableasusualbutwhenwecreateourapplytablewewanttohaveaconstraintthatsaysthatanystudentIDthatappearsintheapplytableisavalidstudent.|Inotherwords,thereisastudentcoupledwiththatstudentID.|Now,wecanwritethatasacheckconstraint.|ThisissyntacticallyvalidintheStructured Query Languagestandard.|WespecifythatthestudentIDhereintheapplytableisinthesetofstudentIDsinthestudenttablebutcurrentlynoStructured Query Languagesystemactuallysupportssubqueriesandcheckconstraints.|Nowforthis,thecivictypeofconstraintithappenstofallintoaclassthatisknownasreferentialintegritywherewesaythatthisstudentIDisreferencingastudentintheother,isreferencingthestudentidinthestudenttableandthereforeanystudentidandapplymustalsoexistinthestudentandinanothervideowewillreferentialintegrityinsomedetail.|But,noteverycheckconstraintwithasubqueryfallsintheclassofreferentialintegrityconstraints.|TheexampleIgaveforkeysdoesn'tandneitherdoestheonehere.|Now,thisisadmittedlyalittlecontrived.|Butwhatthissaysisthateverycollege'senrollmentmustbebiggerthananyhighschoolandsowewritethatbywritingthecheckconstraintinthecollegetablethattheenrollmentisgreaterthanthemaximumhighschoolsizefromthestudenttable.|Now,again,nosystemcurrentlywillsupportthis.|However,itisintheStructured Query Languagestandard.|NowonethingIwanttomentionaboutcheckconstraintswithsubqueriesisthattheycanbekindofdeceptive.|Andwecantakealookattheapplytableagain.|Supposingthiswasinfactsupportedbyasystem.|ItwouldcheckwheneverweinsertedatupleintoapplyoritupdatedastudentIDinapplythattheconstraintholds.|Butwhatitwillnotcheckiswhenthingschangeinstudent.|SowecouldwritethisconstraintandeverytimewedoaninsertorupdateandapplyitcouldbeverifiedbutsomebodycouldgoandchangethestudenttableanddeleteastudentIDandthenwhatwefeelastheconstrainthereisnolongeractuallyholding.|Soitcanbetrickytousethosesubqueries.|Again,whenwedoreferentialintegrityasinthisexample,thereferentialintegritysystemwilltakecareofmakingsuretheconstraintholds.|Butwhenwehaveanexampleliketheonewiththeenrollments,ifwesaychangethehighschoolsizeinthestudenttable,itwouldnotactivatethisconstraintcheckingthat'sspecifiedwiththecollegetable.|ThelasttypeofconstraintIamgoingtoshowaregeneralassertions.|GeneralassertionsareverypowerfulandtheyareintheStructured Query Languagestandard,butunfortunatelytheycurrentlyarenotsupportedbyanydatabasesystem.|ThefirstassertionI'mgoingtowriteiscomingbacktotheissueoftryingtodeclareortryingtoenforceakeyconstraintwithoutusingthebuilt-infacilities.|Letmejustwritethecommandhere.|Itsayswe'regoingtocreateaassertioncalledkey.|Noticethatthisassertionisnotassociatedwithaspecifictable.|AlthoughthisassertiononlytalksabouttableTAssertionscanrefertoanynumberoftablesinthedatabase.|Thewayanassertionworksiswecreateanassertionandwegiveitaname,andthereasonforthisissowecandeleteitlaterifwewish.|Thenthekeywordcheckappears.|Andthenwewriteacondition.|Andtheconditionscanbequitecomplicated.|Theassertionissayingthatthiscondition,writteninSQL-likelanguagemustalwaysbetrueonthedatabase.|SotheparticularconditionthatI'veputinthisfirstexampleisaconditionweusetocheckwhetherattributeAisakeyintableT.ItsaysthatthenumberofdistinctvaluesinattributeAmustbeequaltothenumbertuplesinT.NowIcantrytorunthis,butIguaranteeyouthatit'snotsupported.|Let'slookatsomeotherexampleassertionswemightwriteiftheyweresupported.|Here'sanexamplethatimplementsthisreferentialintegritythatIwasdescribingearlier.|ThisreferentialintegrityconstraintissayingthatthestudentIDsintheapplytablemustalsoexistinthestudenttable.|Nowwhenwewriteanassertionofthatform,wetendtooftenwriteitinthenegativeform,specificallywesaythatit'snotthecasethatsomethingbadhappens.|It'snotthecasethatthere'ssometupleinapplywherethestudentIDisnotinthestudenttable.|Youcantryonyourowntowritethisinamorepositivefashion,butyou'llactuallyfindthatusingStructured Query Languageconstructsit'snotpossible.|It'sactuallyverycommonforassertionstospecifythebadthinginasubqueryandthenwritenotexists.|Asafinalexample,let'ssupposethatwerequirethattheaverageGPAofstudentswhoareacceptedtocollegeisgreaterthan3.|0.|WecanwritethatasanassertionprettymuchexactlyasIjustdescribedit.|WetaketheaverageGPAofstudentswheretheirIDisamongtheIDsintheapplyrelationwherethedecisionwasyes,andourassertionstatesthatthataveragemustbegreaterthan3.0SosofarI'vedescribedhowassertionsarecreated.|Letmejustbrieflymentionhowtheyarecheckedorhowtheywouldbecheckediftheywereimplemented.|Anysystemthatimplementsthisverygeneralformofassertionmustdetermineeverypossiblechangetothedatabasethatcouldviolatetheassertion.|Inthiscase,modifyingaGPA,modifyingastudentID,insertingordeletingfromstudentsorapplycouldallpotentiallyviolatetheconstraint.|Andinthatcase,aftereachofthosetypesofmodificationstothedatabase,thesystemwouldneedtochecktheconstraint,makesurethatit'sstillsatisfied,andifnot,generateanerroranddisallowthedatabasechange.|SoI'veonlytalkedaboutcreatingassertions.|Letmejusttalkverybrieflyabouthowasystemwouldenforcegeneralassertionsofthisformifitsupportedthem.|Whatthesystemneedstodo,ismonitoreverypossiblechangetothedatabasethatcouldcausetheassertiontobecomeviolated.|Sowetakealookatthisparticularassertion,itcouldbecomeviolatedifwechangedthestudentGPA.|Ifweinsertedastudent,evenifwedeletedastudent,orifweinsertedanapplicationthatwasnowhavingadecisionofyes,orupdatedtheapplicationstatus.|Soallofthosechangeshavetobemonitoredbythesystem,theconstrainthastobecheckedafterthechange,andiftheconstraintisnolongersatisfied,anerrorisgenerated,andthechangeisundone.|Thatconcludesourdiscussionofconstraintswiththeexceptionofreferentialintegritywhichiscoveredinaseparatevideo,andtherelatedtopicoftriggers,whichisalsocoveredinaseparatevideo.|Thisvideointroducesaveryimportanttypeofconstraintknownasreferentialintegrity.|Asareminder,integrityconstraintsinadatabaserestricttheallowabledatabeyondwhat'salreadyrestrictedbythestructureandtypesofthedatabase.|Nowthetermreferentialintegrityreferstointegrityofreferencesthatappearinthedatabase.|Inarelationaldatabase,areferencefromonecoupletoanotheroccursthroughspecifyingvalues,andintegrity,referentialintegritysaysthatthosevaluesarevalid.|It'ssortofequivalenttohavingnodanglingpointersifweusedpointersinthedatabase;we'llseeanumberofexamples.|Solet'slookatoursimpleexampledatabasewiththestudents,collegesandstudentsapplyingtocolleges,thatwe'vebeenusingforallourdemos.|Let'ssupposeforexample,thatwehadastudent,123,whohadappliedtoStanford,forsomemajor,let'ssayComputer Science,withadecisionofyes.|Whenwehavethistuple,thevalueintheSIDfieldhereof123presumablyreferstoavaluehereofanactualstudent.|Somaybe123isstudentMarywithsomeGPAinsomehighschool.|Andfurthermore,theStanfordvalueintheCnameorcollegenameattributeispresumablyreferringtothecollegenameinthecollegetable.|SowewouldexpecttohaveaStanfordvaluehere.|Referentialintegritytalksaboutthesevalueshere,referencingthecorrespondingvaluesintheothertables.|SpecificallyifwehavereferentialintegrityfromaattributeAsayofarelationRtoanattributeBofanotherrelationS.Whatthat'ssayingisthateveryvaluethatappearsintheAcolumnofrelationRmusthavesomecorrespondingvalueintheBcolumnofrelationS.Soifwetakealookatourexample,wewouldsaythenthatwewouldhavereferentialintegrityfromtheSIDcolumnofapply,totheSIDcolumnofstudents.|Wewouldexpecteveryvaluethatappearsinthiscolumntoalsohaveavalueintheothercolumn,andsimilarlyweallhavereferentialintegrityfromthecollegenameattributebeenappliedtothecollegenameattribute,incollege.|Againwewanteveryvaluethatappearsinthiscolumn,toalsoappearinthiscolumn.|Nowwemighthaveaviolation,forexample,ifwehada,say,555applyingtoStanfordforsomemajorandsomedecision.|Ifwehaveno555overinthestudenttable,thenthisherewouldbeconsideredareferentialintegrityviolation.|Similarlywemighthave123,whichisvalidbecausewehavea123studenthere,butif123isapplyingtoYaleandwedon'thaveYaleoverhere,thenagainwehaveareferentialintegrityviolation.|Nowletmementionthatreferentialintegrityisdirectional,sowetalkabout,thisSIDhere,referencingtheSIDinthestudenttable.|Wecouldhavereferentialintegrityintheotherdirection,butthat'ssayingsomethingdifferent.|Thatwouldbesayingthateverystudentmustapplysomewhere,everyvalueofherstudentIDmustappearintheapplytable.|Andthisparticularexample,weprobablywouldnothavethatbethecase,wewouldprobablybeabletohavestudentswhohadn'tyetappliedanywhere,orcollegeswherenoonehadappliedyet.|Andthemostsensibledirectionforthisreferentialintegrityinthiscaseisfromtheapplytothestudentandtheapplytothecollege.|Butagain,wecouldhaveitinbothdirectionsifwesowished.|Nowjustafewmoredetailsofreferentialintegrityconstraints.|Thereferencingattribute,inthiscase,thereferencingattributeisA,isoftencalledtheforeignkey.|Andinfact,referentialintegrityisoftenreferredtoasforeignkeyconstraints.|AndevenintheStructured Query Languagesyntax,we'llseethatthetermforeignkeyisused.|Second,whenwehaveareferencedattribute,inthiscasenowwe'retalkingaboutattributeB,sowehaveR.AtoS.B,thereferencedattributeisusuallyrequiredtobetheprimarykeyforthetable,forit'stable,oratleastspecifiedasunique.|Andthat'smoreaboutefficientimplementationthananythingelse.|ButitisarequirementintheStructured Query Languagestandard,andinmostsystems.|Third,itispossibletohaveforeignkeysthatconsistofmultipleattributes,justlikekeysthemselvescanbemultipleattributes.|Let'ssayforexamplethatinourcollegerelation,thecollegenametogetherwiththestate,formakey,notthecollegenameindividually.|Ifthatwerethecasethenourapplytablewouldpresumablyhaveonemorecolumnthatspecifiedthestatesoweknewwhichcollegeastudentwasapplyingto.|Andinthiscasewewouldhavethesetwoattributestogetherastheforeignkeyreferencingthecollegenameandstatetogetherinthecollegetable.|Andwe'llseeanexampleofmultikey,multiattributeforeignkeyconstraintsinourdemo.|Nowlet'stalkabouttheenforcementofreferentialintegrityconstraints.|First,let'sthinkaboutwhatoperationscanoccurtothedatabasetoviolateaconstraint.|It'snoteverypossiblemodification.|Soagain,let'ssupposewehaveR.AreferencingS.B.|So,forexample,herewehaveapplyreferencingstudentsandwehaveapplyreferencingcollege.|Socertainlyifweinsertatupleintothereferencingrelation,soifweinsertedatupleintotheapplyrelationthatcouldpotentiallyviolatethereferentialintegrityifthevalue,sayanSIDorCname,didn'thavematchingvaluesinthereferencerelations.|Sortofconversely,ifwedeletefromareferencerelation,saywedeleteastudent,thenthatcouldcauseaviolationbecausesaywehavethe123valuehereandtheappapplytuplethatwasreferringto123afterthisisgonewouldthenhaveeffectivelyadanglingpointer.|Andofcourse,ifweupdatedthereferencingvalueeitherofthesecolumnsthatcouldcauseaviolationifthenewvaluedidn'texistinthereferencetable,orifweupdatethereferencedvaluesthatcouldalsocauseaviolation.|IntheStructured Query Languagestandardandinallimplementations,ifwehaveaninsertionintothereferencingtableoranupdatetothereferencingtablethatcausesaviolationtotheintegrityconstraint,thereferentialintegrityconstraint,thenanerrorisgenerated,andthatmodificationisnotallowed,justliketheviolationofothertypesofconstraints.|Forthereferencetable,however,tableSinourcasetablestudentandtablecollege.|Iftherearemodificationsthatviolatetheconstraint,ifthereferentialintegritywasdefinedinitiallywithsomespecialoptionsthenit'spossibleforthedatabasesystemtoautomaticallymodifythereferencingtablesothattheconstraintisnotviolated.|Solet'stalkaboutthatinalittlemoredetail.|Let'sstartbytalkingaboutdeletionsfromthereferencedtable.|Solet'ssayswehaveourstudent123here,maybe123hasappliedacoupleofplaces,andthenwehaveourstudent123hereinthestudenttable.|Sorightnowreferentialintegrityisgood.|Everything'sokay.|Butlet'ssupposethatwedeletethetuplewith123.|Sothere'sactuallythreepossiblethingsthatcanhappen,dependingonhowwesetupthereferentialintegrityconstraintinthefirstplace.|Sothedefaultbehavioriswhat'scalledrestrict,sorestrictisactuallyakeyword,butthat'sthedefault,anditsaysthatifwedoadeletiontothereferencetableandaconstraintbecomesviolatedthenwegenerateaairjustlikeIsaidbeforeandthemodificationisdisallowed.|Thetwootheroptionsarealittlebinary digitmoreinteresting.|Oneofthemiscalledsetnull.|Andwhatsetnullsaysisifwedeleteatupleinareferencetable,thenwedon'tgenerateanerror.|Rather,wetakethereferencingtuples,inthiscasethesetwotupleswith123,andwetaketheirSIDsandwereplacethoseSIDswithNULL.|Andthisisconsideredacceptablefromareferentialintegritypointofviewtohavenullsintheforeignkeycolumn,sothatwilloccurautomatically.|Thethirdpossibilityiswhat'scalledcascade,solet'ssetupalittlemoredatalet'ssaywehave234,who'sappliedtoStanford,andwehaveStanfordoverhere,andnowlet'ssaythatweagaindeletethistuple,sothatwouldleaveuswithareferentialintegrityconstraintviolationherewiththeStanfordvalue.|Sowhatcascadesaysfortheondeletecase,isthatifwedeletethistuplethenwe'llsimplydeleteanytuplethathasareferencingvalue,sothistuplewillbedeletedaswell.|NowthereasoniscalledCascadeisbecausesometimesyoucanactuallysetupawholechainofreferentialintegrityconstraints,sowehaveapplyreferencingcollegeherebutmaybewe'vehadsomeotherreferencingplyandmaybeevenanothertablereferencingthatone,andifwesaydeletedatuplefromcollegethatcausedustodeleteatuplefromaply,iftherewasatupleupherereferencingthatwemightgetadeletethereandthenafurtherdelete,andthensoon.|Typically,cascadingwillonlygoonestep,butwe'llseeanexampleinourdemo,wherewe'llsetitupwhereacascadewillgosomedistance.|Now,updateshaveasimilarthreeoptions.|Let'seraseallthisstuffhere.|Let'sagainsetupsomeexampledata.|Solet'ssayourstudent123wasappliedtoStanfordandwehave1"23"overhere.|Ifwetriedtoupdate,saythis"123"tobethevalue"456",therestrictcommandwouldsaythat'snotallowedbecausethatwouldleaveuswithastegwhenpointerandwillgenerateanerror.|Thesetnullcommandwillsimilartothedeleteifthisischangedtofour,five,sixSetany123valuestonull.|Sointhiscasewechange123to456inthestudent.|Andthenwewouldchange123overheretonull.|Probablythemostinterestingcaseisthecascadecasefortheupdate.|Cascadesaysthatifweupdateareferencevaluethenwe'llmakethesameupdatetothereferencingvalue.|So,let'ssaywehaveStanfordoverhereinfactwehavetoifwehavethevaluethereferentialintegrityconstraintbeingcorrect,andnowlet'ssaythatsomebodycomesalongandsays,"IthinkStanfordisspelledwrong.|It'sactuallyStanford,well,that'sactuallyacommonmispellingforStanford.|Thefirstonewascorrect.|Butifsomeonemakesthischange,ifwehavethecascadeoptionforthereferentialintegrityconstraintsbetweenapplyCnameandcollegeCnamethenthatupdatewillbepropagatedtoanyreferencingvalues.|SointhatcaseautomaticallythisStanfordandanyotherStanfordsintheapplytablewillbeupdatedautomaticallytoStanford.|Nowlet'stakealookatreferentialintegrityinaction.|Let'screateourthreetables.|WecreatethecollegetablewiththecollegenameasprimarykeyandthestudenttablewiththestudentIDasprimarykey.|Thatallowsustohavereferentialintegrityconstraintsintheapplytablethatreferencethosetwoattributes.|Whenwecreatethetableapply,nowwe'regoingtospecifytheattributes,andthhekeyword"references"saysthatwe'resettingupareferentialintegrityconstraintfromattribute"StudentID"tothe"StudentID"attributeofthestudenttable.|Andsimilarly,weextendthedeclarationofthe"CollegeName"attributetohaveareferentialintegrityconstrainttothe"CollegeName"attributeofthecollegetable.|We'llgoaheadandcreatethosetables.|Now,let'strytopopulateourtables.|Ifwemakeamistake,wetrytoputourapplyvaluesinfirst,butthere'snodatainthestudenttableorthecollegetable.|So,whenwetrytoinsert,forexample,student123applyingtoStanford,we'llgetareferentialintegrityviolationbecausethere'snostudent123,andthere'snocollegeStandford,andsimilarlyforstudent234applyingtoBerkeley.|So,weseetheerrorsandwhatweneedtodoisfirstinsertthetuplesforthestudentsandthecollegesandtheninserttheappliedtuplesafterwards.|Solet'sinsertthetwostudents,1,2,3andtwo,three,four,andthetwocollegesStanfordandBerkeley,noproblemdoingthat.|Andnowwe'llgoahead,andagain,inserttheapplytuples,andthistimeeverythingshouldworkjustfine,anditdoes.|Inadditiontoinsertsintothereferencingtable,wealsohavetoworryaboutupdates.|So,asareminderlet'stakealookatthestudentsthatwehave.|Wehavestudents123and234andintheapplywehavestudents123and234eachapplyingtoonecollege.|Nowwe'regoingtoupdateourappliedtuplethathasstudentID123.|OurfirstupdatetriestosetthestudentIDto345,butwe'llgetareferentialintegrityviolationbecausethere'snostudentwithID345.|Oursecondupdatewillbemoresuccessful.|Itwillupdate123'sapplicationtohavestudentID234.|We'llgoaheadandexecutetheupdate.|Andweseethatthesecondonedidsucceed.|Sofar,we'velookedatmodificationstothereferencingtablebutwealsohavetoworryaboutmodificationsforthereferencedtables.|Inourcasethat'sthestudenttableandthecollegetable.|Forexample,let'ssupposewetrytodeletefromthecollegetablewherethecollegenameisStanford.|Ifwetrytodeletethatcouplewe'llgetanerrorbecausewedohaveanappliedcouplethathasavalueStamfordandisthereforereferencingthecouplewe'retryingtodelete.|Similarlytriedtodeletesomestudentcouples.|Let'sgobackandlookatourapplyrelation,andwenowseethatbothofthestudentIDsinapplyare"234",soitshouldbeoktodeletethestudentcouplewith123,nothingisreferencingit.|ButitshouldnotbeokaytodeletethecouplewithstudentID234andindeedwhenwerunthecommandweseethatthefirstonegeneratedanerrorandthesecondonesucceeded.|Howaboutupdatingareferencedtable.|Let'ssaythatwedecidewe'dratherhaveBerkeleycalledBezerklySowetrytoupdatethatcollegename,butwhenwerunthecommand,wegetanerrorbecausewedohaveanapplytuplethat'sreferencingthevalueasBerkeley.|Andfinally,althoughwe'vebeentalkingaboutdatalevelmodifications,referentialintegrityconstraintsalsoplacerestrictionsondroppingtables.|Forexample,ifwetrytriedtodropthestudenttable,wewouldagaingetareferentialintegrityconstraintbecausethatwouldleavedataintheapplytablereferencingnon-existentdatainwhatwouldnowbeanon-existingtable.|Youcanseethattheerrorssaysthatyoucannotdropatablestudentbecauseotherobjectsarecurrentlydependingonit.|Sowhenwehavereferentialintegrityconstraints,ifwewantedtodropthetables,we'dhavetofirstdroptheappliedtableandthendropthetablethatit'sreferencing.|Nowwe'regoingtosetuptheapplytabletoexperimentwithsomeoftheautomaticmechanismsforhandlingreferentialintegrityviolations.|Specifically,westillhavethesamereferentialintegrityconstraintsfromstudentidtothestudenttableandfromcollegenamestothecollegetable,butforthestudentIDreferentialintegrityconstraintwe'reandwe'regoingtospecifythatifastudentisdeleted,thenwe'regoingtosetanyreferencingvaluesto"null",andwedothatwiththekeywords"ondelete"whichtellsuswhattodowhenthere'sadeletetothereferencedtable,weusethesetnulloption.|Forthecollegenamereferencewe'regoingtospecifythatifthecollegeisupdatedinthecollegetableandthatsaysonupdatewe'llusethecascadeoption.|Asareminderwhatthatdoesisthatifwechangethecollegenamethenwe'llpropagatethatchangetoanycollegenamesthatreferenceitintheapplytable.|NowIcouldhavespecifiedtwomoreoptions.|IcouldhavespecifiedanonupdateoptionforthestudentIDandanondeleteoptionforthecollegename,sotherecouldbefouralltogether.|BecauseIleftthoseoutthosebothwillusethedefaultwhichistherestrictoptionwhichsaysifyouperformamodificationthatgeneratesareferentialintegrityviolationthenanerrorwillbegeneratedandthemodificationwillnotbeperformed,justaswesawinthepreviousexamples.|Solet'sgoaheadandlet'screatethetableandthenlet'sexperimentwithsomemodifications.|Let'sstartbyaddingacouplemorestudentstoourstudenttable.|Sothen,ifwetakealook,ourappliedtableiscurrentlyemptybecausewejustcreatedit,ourcollegetablehasStanfordandBerkely,andourstudenttablenowhasthreetuples,studentIDs"123","234",and"235".|We'llinsertfivetuplesintotheapplytable,andallofthemaregoingtobevalidwithrespecttoreferentialintegrity.|We'reonlygoingtoinsertstudentsthatare"123","234",or"345",andthey'reonlygoingtoapplytoStanfordorBerkeley.|So,we'veinsertedthosevalues,andnowwe'llperformsomemodificationstoseewhathappens.|We'regoingtodelete,fromthestudenttable,allstudentswhoseIDisgreaterthan200.|Goingbackandlookingatthattable,we'llseethatstudent"234"and"345"aregoingtobedeleted.|Nowremember,wespecifiedondeletesetnullfortheapplyreferentialintegrityconstraints.|Specifically,whenwelookatourapplytablethereferencestothestudentsthatareabouttobedeletedshouldbeautomaticallysettonullwhenwerunthedeletecommand.|So,we'llgoahead.|We'llperformthedeletion.|We'lltakealookattheapplytablewhenweWeseethatthosevalueshaveindeedbeensettonull,andifwetakealookatthestudenttable,we'llseethatweonlyhavestudent123left.|Now,let'stestourcascadedupdate.|Asareminder,whenwesetupthecollegenamereferentialintegrityconstraint,wesaidthatifweupdatethecollegenameinthecollegetable,weshouldpropogatethoseupdatesusingcascadetoanyreferencesintheappliedtable.|So,we'reonceagaingoingtoattempttochangethenameofBerkelytoBezerkly.|Thistimeitshouldallowustodoit,anditshouldchangeanyapplicationstoBerkelytonowspecifyBerzerkly.|So,we'llgoahead,andrunthecommand,andwe'lllookattheapply,andwewillsee,oncewerefresh,thatindeedBerkeleyhasnowbeenchangedtoBezerkly.|Thisexampleisadoozy.|It'sgoingtoshowawholebunchoffeaturesthatwehaven'tseeninpreviousexamples.|We'regonnauseasimpletableTwithjustthreeattributesA,BandC,andwe'regoingtosaythatAandBtogetherareaprimarykeyforthetable.|Intheexample,we'regoingtodemonstratereferentialintegritywithinasingletable,sointra-tablereferentialintegrity.|We'regoingtodemonstratereferentialintegrityinvolvingmultiplewe'llattributeforeignkeysandprimarykeysandwe'regoingtodemonstratearealcascadingwherewe'regoingtohaveacascadeddeletethat'sgoingtopropagateacrossnumerouscouples.|Sotypicallyonethinksofreferentialintegrityashavingareferencingtableandthenthereferencedvalueexistsinadifferenttablebutthere'snothingwrongwithhavingreferentialintegritywithinasingletable.|Forexample,intheoneattributecaseImighthaveattributeBwhereeveryvalueinBmustalsoappearinvalueAandthatwouldbeareferentialintegrityconstraintwithinthetable.|Inthiscasethings,areslightlymorecomplicatedbecauseI'musingpairsofattributesformyreferentialintegrityconstraint.|Specifically,I'mgoingtohaveattributesBandCtogetherreferenceattributesAandBtogether.|Syntactically,todeclareamultiattributereferentialintegrityconstraintinatabledefinition,IhavetoputitattheendbecauseIcan'tattachittoasingleattribute.|JustlikeIdowhenIhave,say,multi-attributekeyswhicharealsodemonstratedhere.|Thesyntaxisattheendofthetabledefinition.|I'dsaythatI'mgoingtohaveforeignkeyconstraintandattributesBandCtogetherhaveareferentialintegrityconstrainttoattributesAandBofthesametableThen,inaddition,I'mgoingtospecify,"ondeletecascade".|Thatmeans,ifIdeleteanattribute,ifIdeleteatuple,thenanyothertuplethat'sreferencingtheABvaluesofthattuplewithit'sBCvalueswillautomaticallybedeleted.|So,let'srunthetablecreation,insertourdata,andthen,let'stakealookatthetableandpredictwhat'sgoingtohappenwhenweactuallydeleteatuple.|So,here'sthecontentsoftableTaftertheinsertions.|So,weseethatAandBtogetherdoformakey.|AlloftheABpairsareunique,andfurthermore,everyBCpairhasacorrespondingABvalueinthesametable.|So,everytupleexceptthefirst,theBCpair,referencestheABpairoftheprecedingtuple.|So,wehave'1-1'herereferencing'1-1'intupleone.|ourtwooneherereferencesthetwooneintabletwoandsoon.|Soourreferentialintegrityconstraintsareintactforthistable.|Whatwe'regoingtodeletethefirsttupplebyrunningacommandthatsaysdeletethetupplewhoseAvalueisone.|Whenwedeletetuppleonebecausewehavethecascadeddeleteset-upwewillneedtodeleteanytuplewhosereferencevaluesareoneone.|Sothatwillbecoupletwo.|Soafterdeletingcoupleonethereferentialintegrityconstraintenforcementwilldeletecoupletwo.|WhencoupletwoisdeletedthetwoonevaluewillbegoneSotuple3whichreferencestuple2willbedeleted,thentuple4whichreferences3willbedeleted,andsoonuntiltheentiretableisempty.|Sohere'sourdeletecommandtodeletethefirsttuple.|Werunthecommand.|Wegobackandwelookatthetable,andwhenwerefresh,weseethatthetableisindeedempty.|Thatconcludesourdemonstrationofreferentialintegrityconstraints.|Referentialintegrityisactuallyextremelycommonindeploymentsofrelationaldatabases.|Thenaturalwaytodesignarelationalschemaoftenhasvaluesincolumnsofonetablereferringtovaluesofcolumnsofanother,andbysettingupreferentialintegrityconstraintsthesystemitselfwillmonitorthedatabaseandmakesurethatitalwaysremainsconsistent.|Inthisvideo,we'llintroducetheconceptoftriggers.|Inaseparatevideo,we'llgiveanextensivedemonstrationoftriggersinarunningsystem.|Asareminder,triggersareeventconditionactionrules.|Theyspecifythatwheneveracertaintypeofeventoccursinthedatabase,checktheconditionoverthedatabaseandifit'strueexecuteanactionautomatically.|Thereareacoupleofreasonsthattriggersareused,fairlyextensivelyactuallyindatabaseapplications.|Oneofthemistomovelogicthatmonitorsthedatabasefromtheapplicationsintothedatabasesystemitself.|Thatallowsthemonitoringtobedonemoreefficiently,andit'salsomoremodular,soitdoesn'thavetoberepeatedineveryapplication.|Asecondandprobablythemostcommonuseoftriggersissimplytoenforceintegrityconstraints.|Andyoumightwonderwhyarethoseconstraintsnotenforcedbytheconstraintsystem.|Well,onereasonisthatsomeconstraintsystemsarelimitedandwecanenforcemoreexpressiveintegrityconstraintsusingtriggersandsecondofalltriggerscandoautomaticrepairofconstraintswhentheyareviolated,byspecifyingtherepairastheactionportionofthetrigger.|Idowanttomentionthatimplementationsoftriggersvarysignificantlyacrossthedifferentdatabasesystems.|Inthisintroductoryvideo,we'llbetalkingabouttheStructured Query Languagestandardfortriggers.|Butinourdemonstration,we'llbeusingthetriggersassupportedbySQLite.|So,herewehavethesyntaxofcreatingatriggerusingtheStructured Query Languagestandard.|Thesecondlineistheeventportionofthetrigger.|Itsaysthatthetriggershouldbeactivatedeitherbefore,orafter,orinsteadofspecificevents,andthespecificeventsthatcanbespecifiedareinsertonaTableT,ordeleteonatableT,orupdatetwoparticularcolumnsonatableT.Andactually,thecolumnsthemselvesareoptional.|UpdateupcolumnsontableT.Let'sskipthereferencingvariablesclauseforamoment,andgoontotheforeachrow.|So,foreachrowisanoptionalclausethatstatesthatthetriggershouldbeactivatedonceforeachmodifiedtuple.|Letmeexplain,whatthedealishere.|So,whenwerun,say,adeletecommandonthedatabase;thatdeletecommandmightdelete,say,tentuples.|Ifwespecifyforeachrowinourtrigger,then,wewillrunthetriggertentimes,onceforeachdeletedtuple.|Ontheotherhand,ifforeachrowisnotpresent,thenwewillexecutethetriggeroncefortheentirestatement.|Now,onetrickythingisthatnomatterwhat,thetriggerisactivatedattheendofthestatement.|Butitstrigger,it'sactivatedeithertentimes,forthetendeletedtuplesoronceifforeachrowisnotpresent.|Now,let'stalkaboutthereferencingvariables.|I'mgoingtowritethemdownhere.|Theideaofreferencingvariablesisthattheygiveusawaytoreferencethedatathatwasmodifiedthatcausedthetriggertobeactivated.|So,wecanhave,inthereferencingvariables,thesearekeywords,oldrowas.|Andthenwecangiveanametotheoldrow.|Wecanhavenewrowas,andagainname,andwecanalsohaveoldtableasanameandnewtable.|Andthere'sawholebunchofthingstoexplainhereSo,it'spossibletohaveuptoallfouroftheseonasingletrigger,buttherearecertainrestrictions,andletmeexplain.|Firstofall,ifwehaveatriggerthatisbasedoninsertions,thenwecanonlyrefertonewdata.|Thatwouldbethenewinserteddata.|Ifwehaveatriggeractivatedbydeletions,thenwecanonlyrefertotheoldvariablesforthedeleteddata.|Ifwehavethecaseofupdate,thenwecanrefertobotholdandnew,andwewillgetthepreviousversionoftheupdatedvalues,andthenewversionofthosevalues.|So,wecanonlyhavebotholdandnewinthecasewhenourtriggerisactivatedbyanupdate.|Now,let'stalkaboutaboutrowversustable.|So,ifwehavearow-leveltrigger,asareminder,thatwillbetriggeredonceforeachmodifiedtuple,butaftertheentirestatementhasrun.|So,letstake,forexample,arowleveldelete.|Inthecaseofdeletes,wecanonlyhaveold,butwecouldhaveforarowleveltrigger,boththeoldrowandtheoldtable.|Theoldrowwouldrefertothespecifictuplethatthetriggerisactivatedfor.|Andagain,ifwedeletedtenrowsanditwillbeactivatedtentimes,onceforeachdeletedtupel.|Whiletheoldtablewillrefertoalltenoftheupdated,ofthedeletedtuples.|Now,there'softenalotofconfusionwiththeoldtable.|It'snotreferringtotheoldstateofthedatabase,it'sreferringspecificallytothesetoftuplesthatwereinthiscasedeleted.|Ifourtuple,ifourtriggerisnotforeachrow,ifit'sastatementleveltrigger,thenwecannotrefertotherowlevelvariables,butweonlyhavethetablelevelvariables.|So,toreiterate,ifwehad,say,aninsertthatwasrow-level,thenwecouldhavebothnewrowandnewtable.|Ifwehaveastatement-levelinsert,wecanonlyhavenewtable.|Ifwehavearow-leveldelete,thenwecanhavebotholdrowandoldtable,butifit'sastatement-leveldelete,thenwecanonlyhaveoldtable.|Finally,ifwehavearow-levelupdate,then,wecanhaveallfourofthese.|Butifwehaveastatement-levelupdate,then,wewouldonlyhavetheoldtableandthenewtable.|Justtoclarify,whenIsayrow-levelImeanthatforeachrowispresent,andwhenIsaystatement-level,Imeanthatforeachrowisnotpresent.|OK.|So,nowwecoveredthethoseclauses.|Fortunately,thelasttwoarealittlebinary digiteasier.|Theconditionhereis,it'slikeaStructured Query Languagewearcondition.|It'sgoingtotesttheconditiononthedatabase,andiftheconditionistrue,then,theactionwillbeperformed.|Actually,whatthisisreallylikeislikeageneralassertion.|Wesawtherewerecertainwaysofdescribingconditionsthatareonentiredatabases,andwewillseeanumberofexamples.|Andfinally,lastofalltheaction,intheStructured Query Languagestandard,theactionisaStructured Query Languagestatement.|Insystems,somesystemswillhaveasetofsimplestatementsandabegin-endbracket.|Somewillhavestoredprocedures.|Sothisisacasewherethesystemsdovaryquiteabinary digit.|We'llbeusingStructured Query Languagelight,whichhas,asit'saction,beginandendwithanynumberofStructured Query Languagestatementswithinit.|Well,thatallseemsverycomplicatedandtherearequiteafewcomplicationswithtriggers,butinmanycasesthey'rerelativelystraightforward,andIthinkthenextthingwe'lldo,justtorelaxforamoment,istakealookatafairlysimpleexample.|Inthisexample,we'regoingtoimplementreferentialintegrityaswediscussedinthepreviousvideo.|Let'ssaythatwehaveatableRwhoseattributeAreferencesattributeBoftableSandwewanttoimplementcascadeddelete.|Asareminder,whatthatmeansis,ifwedeletefromtable's'thenany'a'valuesthatreferencethedeletedBvalueswillthemselvesalsobedeleted.|Ok,solet'sspecifythatinatrigger,it'sreallyquitesimple.|Wegivethetriggerwesayafterwedeleteon's',sothistriggerwillbeactivatedwheneverwedeletefrom's'.|We'regoingtomakeitarowleveltriggerSothatmeanswe'regoingtoactivatethetriggeronceforeachdeletedrow.|We'regoingtosetupthatdeletedrowtobecalledO.|Andfinallythere'snoconditionssowheneverwehaveadeletefromS,theninouraction,we'regoingtodeletefromRalltupleswheretheAvalueequalstheBvalueofthedeletedcouplefromS.Sothatshouldallbeprettyeasytounderstand.|Justasonelittlechangelet'stakealookatwritingthesametriggerasastatementlevelinsteadofarowrow-leveltrigger.|SonowI'vetakenawayforeachrow,andlet'slookatwhatchangesweneedtomake.|Well,firstofall,wedon'thaveoldrowanymore,asImentioned,foronstatementleveltriggersweonlyhaveoldtables.|Sonowwe'regoingtosetupavariablecalledOTthat'sreferencingoldtablesandrememberthisisgoingtothesetofdeletedcouples.|It'snottheoldvalueofthetable,butjustthevalueofthetuplesthathavebeendeleted.|Theotherthingweneedtochangeistheactionofthetrigger.|Insteadofmatchingonetupleatatime,wejustlookfortuplesinRwheretheAvalueisamongtheBvaluesthatweredeletedfromSandwedeletethosecouplesfromare.|Andthatworksexactlythesameastherowlevelversionofthetrigger.|Nowyoumightwonderwhichversionyoushoulduse,wellit'sturnsoutsomesystemsdon'tsupportbothsystemsandyoudon'thaveachoice.|Forthisparticularexample,probablythestatementleveltriggerwouldbemoreefficient.|Sinceitonlyactivatesthetriggeronce,andtakescareofallthereferentialintegritycascadeddeletesinonefellswoop.|Sothisexampleshowsthattriggerscanbequitenatural.|ButtherearealotofcomplexitiesasIalludedtointheoriginalslidethatshowedthefulltriggersyntax.|Sojusttogothroughsomeofthetrickierissues,wetalkedalreadyabinary digitaboutrowlevelversusstatementlevel.|Andtheuseofthedifferentnewandoldrow,andnewandoldtable.|Withtriggersthatexecuteafterthemodification,thisisfairlyunderstandable.|Butthingscangetmorecomplicatedwhenwehaveorinsteadofthemodificationthatcausesthetriggertobeactivated.|Secondly,wecanhavemultipletriggersactivatedatthisSametime,itsprettysimple.|WhatifIdeclaredtwoseparatetriggersthatareactivatedbydeletessayonaparticulartable.|Thewehavetoaskwhichoneisgoingtogofirst,andmaybethebehaviorwilldifferdependingonwhichonegoesfirst.|Sothat'ssomethingthatneedstobethoughtaboutwhenonedefinestriggers,andunderstandshowthey'regoingtobehavewhenthedatabaseismodified.|AnotherpossibilitythatwehavetoconsiderisnotwhentriggersareactivatedatthesametimeButwhentriggersactivateeachotherinachainingeffect,soImighthaveatriggerthat'sactivatedanditperformsanactionthatthedatabasemodificationthatactivatesanothertriggerwhichinturncanactivateothertriggers.|Wecanalsohavetriggersthattriggerthemselvespotentially.|Wecanhavecycleswell,whenatrigger,triggersitself,it'sacycle.|Butwecanalsohavet-1thattriggerst-2thattriggerst-3thattriggerst-1again,thenweneedtoworryaboutissuesisliketermination,bothforcyclesandself-triggering.|Wecanalsohaveacasewhereatriggerhasmultipleactions,andeachoneofthoseactionsindividuallyactivatesothertriggers.|So,westartgettinganestedbehaviorinthetriggeractivation.|Soagain,alloftheseneedtobebothdefinedcarefullyandunderstoodcarefullywhenonecreatestriggers,sothatoneknowshowonewillbehaveinpractice.|Anotherissuethat'sreallymoreabouttriggerdesignisexactlyhowtowriteone'striggerswhenconditionsareinvolved.|Sometimesit'spossibletoputaconditioneitheraspartoftheactionoraspartofthewhenclauseinatrigger.|Now,certaintriggerlanguagesarelimitedinwhattheycansayonthewhen,andthen,againwewouldn'thaveachoice.|Butsometimeswedohavechoice,anditcouldeffectactuallytheefficiencyoftriggerexecution,dependingwhereweputthecondition.|Finally,I'llmentionagainthatimplementationsdovarysignificantlyespeciallyacrossthesetrickyissues.|Now,mostoftheseissuesareactuallygoingtobediscussedfurtherinthedemo.|ButthedemothatI'mgoingtogiveisgoingtouseSequelLite,whichonlyhasrow-leveltriggers,soletmegiveonemoreexamplethattalksaboutthedifferencebetweenrow-levelandstatement-leveltriggers,sinceIwon'tbeabletoshowthatinthedemo.|Thisexampleiscompletelycontrivedtoshowafewissues.|Let'ssupposethatwehaveatableTandithastwoattributes.|AttributeKisakeyforthetable,andattributeVisavalue.|Andwe'regoingtohaveatriggerthat'sgoingtobeactivatedwhenweperforminsertionsonT.Andlet'ssupposethatweperformalargenumberofinsertionsoratleastafewinsertionsandit'sgoingtobearoleleveltrigger.|Sowe'regoingtoexecutethetriggeronceforeachrowthat'sinserted.|So,asareminder,whenwehavearow-leveltrigger,wecanreferbothtothespecifictuplethat'sbeingprocessedforoneactivationofthetrigger,andwecanalsorefertotheentiresetofchangesthatweremadebythemodificationcommandthatcausedthetriggertobeactivated.|Sointhistriggerwe'regoingtouseNRtorefertothecurrentinsertedrowthatweareprocessingandNew Technologytorefertotheentiresetofinsertedrows.|Okay,sowhatisthistriggerdoing?|It'sgoingtoprocessoneinsertedrowatatime.|Andwhenitprocessesthatrow,it'sgoingtocheckwhetherthecurrentaveragevalueof'v'intable'T',sothat'sthecurrentaveragevalue,islessthantheaverageoftheinsertedrows.|NowonethingIwanttosayisthatthisvalueisstable,soevenifwemodifyT,New Technologydoesn'tchange.|New Technologyisalwayssettothesetofinsertedtuples,ok?|SowecheckwhetherT'saverageislessthantheNew Technologyaverage,andifitis,thenwe'regoingtomodifytheupdatethatmodifiedthetuplethatwasinserted.|Sowe'regoingtoupdateTandwe'regoingtosetthevaluetobeV+10forthetuplethatwe'recurrentlyprocessing,inotherwords,thetuplewhosekeyisinnewrow.|Ok,thisisreally,reallytricky.|I'mtryingtodemonstrateabunchofthingshere.|Sojustlet'sbackoffandthinkagainforaminuteaboutwhathappened.|Weinsertedawholebunchoftuples.|Afterweinsertedthosetuples,wefirstdeterminedwhattheaveragevalueoftheinsertedtuples.|That'sthisaveragevaluehere.|Let'ssayit's25.|Thenwe'regoingtoforeachinsertedtuple,check,isthecurrentaverageandT,lessthan25.|Ifitis,we'regoingtoupdatethattuplethatwasinsertedtobe10greater,andthat'sgoingtobeendofthatactivation.|Sothere'sacoupleofthingsthatIwantedtopointoutspecificallywiththistrigger.|Oneisthatthereisnostatement-levelequivalentofthistrigger.|Ifwetrytowritethiswithoutthefoureachrow,wecannevergetthesamebehaviorbecausewhatwe'redoingislookingateachrowoneatatimeanddecidingwhethertoincreaseitsvalue.|Sowemightincreasethevalueforsomesubsetoftherows,butnotallofthem,anditwouldnotbepossibletodothatwithastatementleveltrigger.|Thesecondthingthatthistriggersshowsisthepotentialtohaveanon-deterministicfinalstate.|Becausewe'regonnaagainincreasethevalueoftheinsertedtuplesuntiltheaverageexceedsacertainthresholdandthenwe'llstopinupdatingthosevaluesorincreasingthosevalues.|Sothesubsetoftupleswhosevaluesareincreased,isdeterminedbytheorderinwhichthetriggerprocessesthesetofinsertedcouples.|Ok,sothistriggerisreallyreallycomplicated.|Nowofcoursenobodyisgoingtoeverwriteatriggerthatlooksexactlylikethis.|Partofthepointwastoshowabunchofdifferentfeatures,andshowabunchofdifferentsubtleties.|Specificallyinthecontextofrowlevelversusstatementlevel,becausewearen'tabletomakethatcontrastwiththedemonstrationthatwe'regoingtogive.|So,toconclude,triggersareeventconditionactionrulesthatareusedusedtomovemonitoringlogicfromtheapplicationtothedatabase,andtoenforcecomplexconstraints,potentiallywithautomaticrepair,andtheimplementationsvarysignificantly.|Nowlet'sseetriggersinaction.|We'regoingtocoveranumberoffeaturesinthedemonstration,whichisgoingtobeintwoparts.|We'llcoverbeforeandaftertriggers,withbothinsert,deleteandupdatetriggeringevents.|Wewillnotbecoveringinsteadoftriggers,whichareusedprimarilyforviews,andsowillbecoveredinthematerialonviews.|We'llshowaccesstonewandolddataforthemodifieddatathatcausesatriggertobeactivated.|We'llshowtriggerconditionsandtriggeractions.|We'llshowsometriggersthatarebeingusedtoenforceconstraints.|We'llshowatriggerchaining,wheretheexecutionofonetriggeractivatesanothertrigger.|Andwe'llshowtriggersthatactivatethemselvesandcyclicbehavioroftriggers,conflictswhenmultipletriggersareactivatedatthesametime,andfinally,nestedtriggerinvocations,whenatriggerhasseveralactionswhichthemselvesactivateothertriggers.|ThevideointroducingtriggersusedtheStructured Query Languagestandard.|Itsohappensthatnodatabasesystemimplementstheexactstandard,andinfactsomesystemsdeviateconsiderablyfromthestandard,notonlyinthesyntaxforspecifyingtriggers,butalsothebehavior,meaningonehastobeverycarefultounderstandthetriggersystemthatoneisusing.|Intermsoftheprimaryopensourcesystemsatthetimeofthisvideo,Postgreshasthemostexpressivetriggersystem.|SQLiteisalittlebinary digitlessexpressive.|AndMySQLisconsiderablymorerestrictivethantheothertwo.|Let'slookatsomedetails.|Intermsofexpressivenessandbehavior,Postgresistheclosesttothestandard.|Itreallydoesimplementthefullstandard.|Ithasrowlevelandstatementleveltriggers,accesstooldandnewrowsandtables.|Unfortunately,itusesitsowncumbersomeandsomewhatawkwardsyntaxmakingitnotverysuitableforourdemonstration.|SQLiteimplementsrowleveltriggersonly.|Anditalsohasimmediateactivationwhichisadeviationinbehaviorfromthestandard.|Aswediscussedintheintroduction,thestandardfortriggersisthatifwehaveamodificationstatementthatmakesmanychanges.|Regardless,ofwhetherwehavearowlevelorstatementleveltrigger,weexecutetriggersattheendofthestatement.|WhereasinSQLitewehaverowleveltriggersonlyandthereaftereachrowlevelchangetothedatabase.|AsaresultSQLitealsodoesnothaveaccesstonewtableoroldtableLikeSQLite,MySQLalsohasonlyrowleveltriggers,andtheyareactivatedimmediately,insteadofattheendofthestatement.|Theyalsodon'thaveaccesstooldandnewtable.|TherearetwoothersignificantlimitationsinMySQL.|OneofthemisthatMySQLonlypermitsonetriggerpereventtype.|Soforexample,onlyonetriggerforanyinsertingintoaparticulartable,ordeletingfromatable.|Furthermore,there'slimitedtriggertrainingallowedinMySQL.|Now,thesefeaturesifwewanttocallthemthat.|DoyoumeanthatthetriggersinMySQLarequiteunderstandableinhowtheybehave,becausethey'refairlyrestrictedinwhattheycando,andspecificallyinhowtheycaninteract.|Forourdemo,we'llbeusingSQLiteAndletmementionafewthingsaboutthesyntax.|Sincethere'srowleveltriggersonlyforeachrow,althoughit'saallowedtobespecifiedinthetrigger,isimplicitifit'snotpresent.|AsImentioned,there'snoaccesstooldtableornewtable,andsoasaresult,SQLitehasnoreferencingclauseinsteadprebuyingthesevariables,oldandnew,twooldrowandnewrow,we'llseethatclearlyinthedemo.|Finally,theactioninSQLitetriggersisabeginendblock,withanynumberofStructured Query Languagestatements.|Thedemoisintwoparts,andinthispartofthedemowe'llbeinthefirstfivefeatures,theotherthreewillbecoveredinthesecondpart.|Inthefirstpartofthedemo,we'llbeusingourusualsimplecollegeadmissionsdatabase,withthecollegetable,studenttableandstudentsapplyingtocolleges.|Wewillbestartingwithourusualdatabase,ourfourcolleges,oursetofstudents,andoursetofcouplesofstudentsapplyingtocolleges.|Theideaisthatwe'llbecreatingseveraldifferenttriggersandthenwe'llbemodifyingthedatabase,andseehowthosetriggersbehave.|Here'sourfirsttrigger.|Letmementionthattheparticularinterfacewe'reusingdoesnotallowustoexecutecreatetriggercommandsfromthiswindow,sowe'llactuallybeexecutingthedemandseparately.|Ourfirsttriggerwillinterceptinsertionsintothestudenttable,andwe'llchecktheGPA.|IftheinsertedGPA,theGPAoftheinsertedstudent,isgreaterthan3.3,orlessthanorequalto3.6,thatstudentwillbeautomaticallyapplyingtoStanfordforageologymajorandapplyingtoMassachusetts Institute of Technologyforabiologymajor.|Let'slookalittlecloseratthetaxwegivethetriggeraname.|Wespecifythetriggeringevent.|Inthiscaseitsinsertionsonstudent.|Nextwehavetheoptionofspecifyingforeachrow.|NowasareminderintheSQLitesystem,onlytheforeachrowoptionisimplemented.|Soevenifweactuallyleftthisclauseout,itwouldbealowleveltrigger.|Furthermore,SQLitedoesnothaveareferencingclause.|SointheStructured Query Languagestandardthere'sthenewrow,oldrow,newtable,andoldtable,whichcanbeboundtovariablesinthereferencingclause.|InSQLiteonlynewrowandoldrowaresupported,andtherefore,they'reboundautomaticallytothepredefinedvariablesnewandold.|Nowremembernewandoldgivesusawaytoaccessthedatathatwasmodified,thatcausedthetriggertobeactivated.|Inthecaseofaninsertionthereisonlynewdatabetheinsertedrow.|Ifwehadanupdate,we'dhavebothnewandoldavailabletous,forthemodifiedrow.|Andifwehadadelete,we'dhaveonlyold.|We'llseethatinlaterexamples.|Inthisparticularexamplewe'regoingtousenew,inourtriggercondition,toreferencetheinsertionthatcausedthetriggertobeactivated.|WecheckifthatInsertatuple,haveaGPAwithintherangewe'relookingfor.|Ifitdoes,thenwegoaheadandthetriggerwillgoaheadandexecutetheaction.|Theactionwillinserttwonewtuplesintotheapplytableanditwillagainusethenewvariabletoaccesstheinsertedtuplewe'reworkingon,soitwillgetthatSIDfortheinsertedtuple.|InsertthattogetherwithStanford,Geologyandanulldecisionintoapply.|AndsimilarlyhavethatnewstudentidapplyingtoMassachusetts Institute of Technology,Biologywithanulldecision.|We'vecreatedthetrigger.|Sonowlet'stryinsertingsomenewstudentsintoourdatabase.|Specificallywe'llinsert111KevinwhoseGPAisintherangethatwe'relookingforforautomaticapplicationand222LauriewhoseGPAisoutsideofthatrange.|Let'sgoaheadandinsertthosetuplesandlet'stakealookatourdata.|Whenwelookatourstudenttable,weseethatKevinandLauriehavebeeninserted.|Nowlet'stakealookatapply.|Hereweseethatstudent111,andthatwasKevinwiththe3.5GPA,hasautomaticallybeeninsertedtoapplytoStanfordinGeology,Massachusetts Institute of Technologyinbiology,andAsareminderanemptycellindicatesanullvalue.|Soourtriggerwasactivatedbythoseinsertions,anditperformedinsertionsintoapplyforKevinbutagainnotforLauriebecauseherGPAdidnotsatisfythetriggercondition.|Nowlet'smakeamoredramaticdatabasemodificationtotestoutourtrigger.|We'regoingtoessentiallycopytheentirestudenttableintoitself.|Sowe'regoingtodoublethesizeofthestudenttable.|We'regoingtotakeeachtupleandwe'regoingtoaddanewtuplethat'sgoingtobeidenticalexceptwe'regoingtoincrementthestudentIDinordertogenerateauniqueID.|Sowhenweinsertallofthesetuplesintothestudenttableagain,allofthosewhoseGPAisintherangebetween3.3and3.6shouldhaveanautomatictupleintoinsertedintotheapply,actuallytwotuplesinsertedintotheapplytablehavingthemapplytoStanfordandMassachusetts Institute of Technology.|So,here'stheinsertcommand,we'regoingtoinsertintostudenttheresultofaquery.|That'sareminderofhowwedothatfrompreviousvideos.|Ourquerywillselectfromthestudent,allfourattributesexceptthatitwillincrementtheID.|Soagain,thiswilldoublethesizeofthestudenttable.|Copyingeverytuple,butwithanewstudentID.|Solet'sgoaheadandperformtheinsertions,andnowlet'slookatthestudenttable.|So,we'llrefresh,andweseethatthetablehasdoubledinsizeandagainweincrementedtheIDs.|Whatwe'remostinterestedin,ofcourseiswhathappensintheapplytable.|AndnowweshouldhaveabunchofnewapplicationstoStanfordandMassachusetts Institute of Technology,andindeedwedo,andifwelookedback,we'dseethateachoftheseIDscorrespondstoastudentwhoseGPI,isintherangetosatisfytheconditionofthetrigger.|We'llleaveallthesetuplesin.|We'regoingtoactuallyusetheminlatertriggersthatwe'regoingtosee.|Thistriggerisverysimilar,maybeidenticaltoonethatwesawintheintroductoryvideo.|Thistriggersimulatesthebehaviorofcascade,delete,whenwehaveareferentialintegrityconstraintfromthestudentIDintheapplytable,tothestudentIDinthestudenttable.|Veryspecifically,it,it'sactivatedwhenwehavethelesionsfromstudentandagainI'mincludingforeachrowandI'lldoitineverytriggereventhoughifIleftitoutitthebehaviorwouldbethesame.|Soforeachit'sdeletedfromStudent,ithasnoconditionsoitalwaysexecutestheactionandtheactionsays"lookandapplyforanystudentIDwhoseIDisequaltothedeletedone".|Andnowandagainwe'reusingthisreservedkeyword"old"asareminderthat'sautomaticallyboundtooldrow,andsoitwillmindtothetuplethat'sbeingdeletedthatactivatedthetrigger.|We'llfindanyapplyrecordsthatrefertothedeletedstudentID,andwe'lldeletethoseapplyrecordsaswell.|Sofirstlet'stakealookatourstudenttablebecausewhatwe'regoingtodoisdeletefromthistableeverystudentwhoseIDisgreaterthan500,soquiteanumberofthesestudentsaregoingtobedeleted,andthenwe'regoingtoseethattheapplicationsofthosestudents,andthere'squitealargeapplicationsgreaterthan500willbedeletedautomaticallybythetrigger.|Sohere'sthesimpledeletioncommand,toremoveallstudentswhoseIDisgreaterthan500.|We'llrunthecommand,andlet'sgotakealook.|OK.|Sowegotoourstudenttableandwesee,indeed,thatalotofstudentshavebeendeletedthosewithIDsgreaterthatfivehundredwegotoourapplytableandweseesimilarlybutautomaticallyalloftheapplyrecordswiththestudentIDgreaterthan500havebeendeletedaswell.|Nowlet'screateatriggerthatsimulatesacascadedupdate,againforreferentialintegrity.|Solet'ssupposewearetryingtoimplementusingtriggersreferentialintegrity,fromtheCnamethatappearsinapplytotheCnamethatappearsincollege.|Andwhenweupdatecollegeanamewe'regoingtopropagatethoseupdatestoanyapplyrecordsthatrefertothat.|Solet'stakealookatthetrigger.|Thisisourfirsttriggerthat'sactivatedbyupdatecommands.|SotheeventTriggeringevent,there'sanupdateonthecollegetable,andveryspecificallywe'vespecifiedtheattributeC-name.|AndifweleftoutC-name,thenanyupdatetocollegewouldactivatethistrigger.|ButbyputtinginCname,it'salittlemorespecificandmoreefficient.|Againforeachrow,whichwouldbeimplicitifweleftitout.|Andthenlet'stakealookSowhatouractiondoes.|Similartotheother,theprevioustrigger,wedon'thaveacondition.|Weupdate,weruntheactionautomatically.|Asareminder,wehavenownewandoldvariablessinceitisanupdate.|Soeachactivationofthistriggerwillbeforonerow.|Newwillgiveusthenewvalueofthatrow.|Oldwillgiveustheoldvalueofthatrow.|Soouractionisgoingtoupdatetheapplytable.|It'sgoingtofindcollegenamesthatrefertotheoldcollegename,andit'sgoingtochangethemtorefertothenewcollegename.|SoIwouldsaythisisactuallyaveryintuitivetrigger,easytounderstand,toperformcascadedupdate.|Solet'smodifytwoofthecollegenamesinourdatabase.|We'llchangeStanfordtoTheFarm,andforthoseofyouwhoaren'taware,TheFarmisactuallyacommonnicknameforStanford.|Andwe'llchangeBerkeleytoBezerkleyandI'llletyoudrawyourownconclusionsonthatone.|Solet'sgoaheadwiththeupdate.|Andlet'stakealookatourdatanow.|Andthistimewe'lljustgostraighttotheapplyrelation.|We'llrefreshandwe'llseethatourreferencestoBerkeleyhavebeenchangedautomaticallytoBezerkleyandStanfordtoTheFarm.|AndagainIdidnotrunanupdatecommandontheapplytable.|Ionlyrantheupdatecommandonthecollegetable,whichhasalsochanged.|Andthenthetriggerwasactivatedandpropagatedtheupdatetotheapplyrecords.|Soourprevioustwotriggerssimulatedintegrityconstraints.|Thenexttwotriggerswe'regoingtowritearegoingtosimulatekeyconstraints.|Specificallywearegoingtosaythatthecollegenameneedstobeuniquewithinthecollegetable.|Sowe'regoingtowritetriggersthatinterceptbothinsertsandupdatesforthecollegetable.|Andiftheytrytocreateorupdateacollegename,thatcreatesaduplicate.|We'regoingtodisallowthatcommandbyraisinganerror.|Oneotherdifferencebetweenourprevioustriggersisthatthesearegoingtobeactivatedbeforetheinsert,ratherthanaftertheinsert.|Solet'stakealook.|Wehaveatriggerthat'sactivatedbeforeinsertsoncollegeandtheydohaveacondition.|Whatitlooksforisanothercollegethathasthesamecollegenameastheonewe'retryingtoinsert.|Sothatwouldbeakeyviolationifweattempttoinsertacollegenamethatalreadyexists.|Intheactionwe'reusingaSQLite-specificconstructRaiseIgnore,soraiseisanerrorraisecommand,andignoresayssimplyignoretheupdatesthat'sunderway.|Sowhenwetrytoinsertaduplicatecollege,thetriggerwillbeactivatedandraysignorewillsaydisallowthatinsert.|Nowweactuallyhaveasecondtrigger,hiddenunderneathhere.|Thistriggerhandlesupdatestothecollegetable.|Whenacollegenameisupdatedsimilartotheinsertionitcheckswhetherthere'salreadyacollegewiththeproposednewcollegename.|Andifitis,itagainusestheRaise/Ignorecommand.|Now,bothofthesetriggerswerespecifiedbeforethemodificationandthat'snecessaryinordertousethisparticularcondition.|Ifwehadspecifiedafterthemodificationasourtypeoftriggeringeventthentheconditionwouldhavetochecksomethingdifferent,itwouldhavetocheckifwecreatedduplicatecollegenames,butagain,we'reusingthebeforeversionherewhichisquitenatural,andtheRaise/Ignorecommandalsoworksintandemwiththebefore.|Becausewhatitsaysistoabandonthemodificationthat'sunderway.|NowIwillmentionthattheraisingoferrorsintriggeractionisquitesystemspecific.|SowhatI'mshowingyouissimplytheSQLiteversionthatwewoulduseinthecaseofabeforetrigger.|Sonowlet'smakesomeattemptedmodificationstoCollege.|Asareminderwe'vealreadychangedStanfordtoTheFarmandBerkeleytoBezerkeley.|Soinourfirsttwoinsertionattempts,we'lltrytoinsertStanfordintoourcollegetableandthatshouldactuallyworkbecausewechangedthenameStanfordtothefarm.|We'llalsotrytoinsertanothercoupleforMassachusetts Institute of TechnologyandthatshouldnotworkbecausethatshouldactivatethetriggeranddetectthatMassachusetts Institute of Technologywouldbeaduplicateifitwereinserted.|We'llrunthecommandswedon'tgetanyerrors,it'snotraisinganerror.|Asaremindertheraiseignorecommandsimplystopsthecommandthat'sunderway.|Sowe'lltakealookatourcollegetableandweseethatthenewStanfordcouplewasinsertedsuccessfullybuttheattempttoinsertaMassachusetts Institute of Technologycouplewasrebuffedbyourtrigger.|Nowletstrysomeupdatesasareminderwehadonetriggerthatinterceptedinsertsandanotherthatinterceptedupdates.|Let'strytochangeBezerkeleybacktoBerkeley.|Werunthat.|Wegotocollege.|Andweseethatitdidinfactchangebacknoproblembecauseit'snotcreatingakeyviolation.|Nowlet'strychangingthefarmbacktoStanford.|We'llrunthat.|Again,wewon'tgetanerrorbutwhenwegoandlookatthecollegetable,we'llseethatthefarmisstillthere.|Becausewe'veinsertedthenewStanfordtuple,thetriggerinterceptedourupdate,anddidn'tallowittobechangedbecauseitwould'vecausedaduplicatevalue.|So,frustratedbythat,let'schangethefarmtoStanfordagainourfavoritemisspellingoftheuniversity.|We'llrunthecommand.|We'lltakealook.|Andindeed,thefarmhasnowbeenchangedtoStanford,becauseit'snotcreatingaduplicatevalue.|Incidentallytherewereafewthingshappeningbehindthesceneswhilewewereexperimentingwiththosekeytriggers.|Don'tforgetwedefineatriggerthatinterceptsupdatesonthecollegenameandpropagatesthemtotheapplytable.|Sowhilewewerechangingthosecollegenamestoexperimentwiththekeytriggerswewerealsomodifyingtheapplytable.|Let'sgoseewhathappenedtothattable.|WegohereandwelookatapplyandweseeourBerkeleystudentsarestillBerkeley.|Whileweweren'tlookingtheychangetoBezerkeleyandbacktoBerkeley.|OurStandfordstudentschangetothefarm,andthentheychangetoStandford.|So,inordertonotoffendmysense.|abilities.|I'llbedeletingthosestudents,thoseapplyrecordsbeforeweproceed.|Nowlet'stakealookatatriggerthatdoesalittlemorethanenforceaconstraint.|Whatthistriggerisgoingtodoismonitorapplicationstocolleges,andwhenthenumberofapplicationstoacollegeexceeds10,it'sgoingtorenamethatcollegetohavethecollegenameandthendash-done,indicatingthatwe'redonewiththecollege.|Specifically,itwillbetriggeredbyinsertionstoapply,sincethat'swhatgoingtoincreasethenumberofapplications.|Andwhenthere'saninsertion,it'sgoingtocountthenumberof"apply"recordsthathaveappliedtothatcollege.|Nowthisisanafter-trigger,soitwillincludetheonewe'veinserted,and"new"isgoingtoagainrefertotheinsertedcouple,sowewillcountthenumberofappliedrecordstothatparticularcollegeandseeifitexceedsten.|Ifisdoes,it'sgoingtoupdatethecollegecorrespondingtotheonethat'sbeingappliedtoandwe'lldothatagainbylookingatthenewcollegename.|Andit'sgoingtotakethatcollegerecord.|Andit'sgoingtosetitsnametobethecurrentname,andthisisaconcatenationoperator,withthestringdone.|Oncewerunit,you'llwe'llseeexactlyhowitworks.|Anotherthingwe'llbedemonstratinginthisexampleistriggerchaining,wheretheactivationofonetriggeractivatesanactionthatactivatesanothertrigger.|AndletmeremindyouofthefirsttriggerwecreatedwherewhenweinsertedstudentswithacertainGPA,weautomaticallyinsertedapplyrecordsforthosestudentstoStanfordandMassachusetts Institute of Technology.|SowhatI'mgoingtoactuallydoratherthaninsertapplyrecordsdirectlytoexperimentwiththistrigger,I'mgoingtoinsertstudentrecords.|ThosestudentrecordsiftheyhavetherightGPAwillactivatethistriggerwhichwillautomaticallyinsertintoapply.|Andthenthoseinsertionswillactivateourapplytrigger,whichwillchecktoseeifthecollegenowhasmorethantenapplicants.|Asareminder,ourtriggerthatdoesautomaticinsertionsofapplicationswe'llbehavingstudentsapplyingtoStanfordandMassachusetts Institute of Technology.|SowehavenostudentswhohavecurrentlyappliedtoStanford,that'sbecauseIdeletedthosemisspellingStanfordandthatleftuswithnone;butthat'sfine,thatwillHelpustestourtrigger.|Let'sseehowmanystudentswehavewhohaveappliedtoMassachusetts Institute of Technology.|Wecurrentlyhave.|FivewhohaveappliedtoMassachusetts Institute of Technology.|Finallylet'sseehowmanyexistingstudentswehavewithaGPAthat'sinrangeforautomaticapplicationandthereasonI'mcheckingthatisbecauseI'mgoingtoinsertcopiesofthosestudentsthatwillactivatemytriggerandshowthetriggerchain.|SoIcurrentlyhavesixstudentswithGPAsinrange,soifIcopythosesixstudentsasnewinsertionsthenwe'llbeaddingsixapplicationstoMassachusetts Institute of Technology.|ThatwillbringustoatotalofelevenandsixapplicationstoStanfordbringingustoatotalofsix.|Soifallgoeswellwiththetriggerchainingandeverythingelse,whenwe,afterweweinsertthosesixnewstudents,weshouldgetnewapplyrecordsthatwillcauseMassachusetts Institute of Technologytobedonebecauseit'sexceededthethresholdoften,butStanfordnottobedone.|Solet'sseeifthatallworksoutasweexpect.|Somyinsertioncommandisgoingtocompletelyreplicatethestudenttable.|It'sgoingtomakeoneadditionalcopyofeverystudent.|andasareminderthatwillcop-,thatwillinsertsixnewstudentswhoseGPAisinrangeforautomaticapplication.|Solet'sgoaheadandruntheinsertcommandandlet'sgostraighttoourcollegesandseewhathappens.|Indeed,Massachusetts Institute of TechnologyisnowlabeledasdonebutStanfordhasn'tchanged.|Andlet'slookatourapplytabletounderstandwhathappened,soallofthecouplesactuallystartingherewereinsertedinthisroundoftriggeractivation,soweaddedsixstudents.|SixofthemhadGPA'sinrange.|Thatgaveustwelveapplications,oneeachtoStanford,andMassachusetts Institute of Technology.|Theseotherapplicationswereleftoverfrombefore.|ThenthefactthatMassachusetts Institute of TechnologywentovertenapplicationsmeantMassachusetts Institute of Technologywasrelabeledasdoneandtherewasabinary digitmoretriggerchainingthathappened.|Don'tforgetourupdatepropagationtrigger,whichisstillthere.|ThatonetookMassachusetts Institute of Technologydonewhenitwasmodified,andsentitbacktomodifythevaluesofMassachusetts Institute of Technologyandtheapplytable.|Thismightbeagoodexample.|foryoutodownloadandplaywithyourselforre-runthevideojusttoentirelyunderstandwhat'sgoingon.|Now,let'sseeifwecancoaxStanfordtobedoneaswell.|So,howmanystudentsdowehavewhoappliedtoStanford?|Six.|Thosearethesixapplicationsthatoccurredasaresultofthemostrecenttriggerfirings.|AndhowmanystudentsdowehavewithaGPAinrange?|Wellwehave12ofthem.|Wehavethe6thatwehadoriginally,andthenwecopiedeachoneofthoseoverinourpreviousexample.|So,now,ifweonceagaincopyourstudenttable,insertintostudentanentirecopy,thenwe'llbeinsertingtwelvestudentswithGPA'sinrange.|Those12studentswillautomaticallyapplytoStanfordandBerkeley.|ThatshouldputStanfordoverthethresholdoftenandchangeit'snametoStanford-doneLet'sgoaheadandexecutethecommandandthenlet'stakealookatthecollegetableandseewherethingsstand.|Indeed,nowStanfordisdone.|Let'salsotakealookattheapplytablebecausethere'ssomequiteinterestingthingsgoingonhere.|So,weseeallofourtupleswithMassachusetts Institute of TechnologydoneandStanforddoneandlet'sjustrememberwhathappened.|Weinserttupleswithastudent.|ThosetuplesarecausingautomaticinsertionstoStanfordandMassachusetts Institute of Technology.|However,whenStanfordorMassachusetts Institute of Technologywentoverthreshold,over10applications,thenthenamewasmodifiedinthecollegetabletobeMIT-doneorStandford-done.|Thatmodificationinthecollegetableactivatedourupdatepropagationtrigger,whichthenhadthechangeinthecollegetablepropagatetothechangeintheapplytable.|Butthen,atsomepointalongtheway,weseethatwestophavingMIT-doneandStanford-doneandwerevertbacktoMassachusetts Institute of TechnologyandStanford.|Well,whyisthat?|That'sbecausewhenweinserttheMITsandStanfordsautomaticallyandwegobackandcounthowmanythereareforMassachusetts Institute of TechnologyandStanfordafterwe'vechangedthisto-done,we'rebacktozero.|Ifwekeptgoingandthenwehitthethresholdagainof10,thenwewouldseethatStandford-doneandMIT-donechangeaswell.|Sorry.|ThatStandfordandMassachusetts Institute of TechnologychangebacktoStandford-doneandMIT-done.|Sothisisverycomplicated.|AgainwhatI'mreallytryingtodemonstratehereiswell,ofcourse,justthebasicbehavioroftriggersbutalsothecomplexity.|Whentriggerstriggerothertriggersthatfurthertriggerothertriggersandback.|Andwe'llbeseeingmoreofthatintheseconddemonstrationvideo.|ButIdidwanttoillustrateithere.|Andthere'sonemorepointthatIwanttomakewhichisthat,asImentioned,in<spanclass="STtranscriptContent"name="119200"id="STtranscriptContent57"contenteditable="true"style="margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0px;padding-top:0px;padding-right:0px;padding-bottom:0px;padding-left:0px;border-top-width:0px;border-right-width:0px;border-bottom-width:0px;border-left-width:0px;border-style:initial;border-color:initial;font-weight:inherit;font-style:normal;font-size:11px;font-family:verdana;vertical-align:baseline;border-top-style:none;border-right-style:none;border-bottom-style:none;border-left-style:none;border-width:initial;border-color:initial;line-height:15px;text-align:left;text-transform:none;text-decoration:none;-webkit-box-shadow:none;box-shadow:none;text-rendering:auto;cursor:pointer;-webkit-transition-property:background;-webkit-transition-duration:0.2s;-webkit-transition-timing-function:linear;-webkit-transition-delay:initial;background-image:in,triggers,rollleveltriggersareactivatedimmediatelyaftereachrowlevelchange.|ThatisdifferentfromtheStructured Query Languagestandard.|IntheStructured Query Languagestandard,evenarow-leveltriggerwillbeactivatedaftertheentirestatement.|Andthat'swhatforexample,Postgresdoes.|ButinSQLitewe'reactivatingimmediately.|Andactuallythisparticularbehavior,ifyouthinkaboutit,wouldbesomewhatdifferentifwewereactivatingthetriggersattheendoftheentirecommand.|Evenifwearedoingitonerowatatime.|Againverycomplicatedstuff.|Youmightwanttopauseandjustthinkabouthowthisworks,orevenbetterexperimentyourself.|Let'sgobacktoasimplertrigger.|Thisoneinterceptsinsertionsonstudentbeforetheyoccur,anditchecksifthehighschoolsizeisinrange.|Ifthehighschoolsizeisbelow100orgreaterthan5,000we'regoingtoassumethat'sanerror,andwe'regoingtoraiseourignore.|Again,that'saSQLitespecificsyntaxthatsays,"Don'tperformthemodificationthat'sunderway."|Nowthatoccursbeforeinsertsonstudents.|Wealsohaveatrigger,don'tforget,thatincursafterinsertsonstudentsandthatonecheckswhetherthestudent'sGPAisinaparticularrange,andinsertsthestudentintotheapplytable.|Andwe'refinetoexperimentalittlebinary digitwithhowthesetwotriggersinteract.|Now,I'vedeletedallthedatafromtheexistingdata,fromthestudentandtheapplytables,justtosimplifylookingatwhathappenswiththesetriggers.|Nowlet'stryinsertingsomestudents.|AllthreeoftheproposedinsertionshaveGPAsthatareinrangeforautomaticapplication.|However,thesecondandthirdstudentshavehighschoolsizethatareoutofrange.|Sowhenwerunthe3inserts,hopefully,thetriggerwilldisallowthesecondandthirdinsertforthehighschoolbeingoutofrangeandthefirsttriggerwillactivateautomaticapplicationsforNancy.|Actually,youknowwhat?|There'salittlehintdownhere,whathappened.|WecanseethatthefirstinsertionoccurredThird.|Andthesecondandthirdzerorowswereaffected.|Sowecanalreadyseethatitdidwhatweexpected,butlet'sgotakealookatthedataandmakesurethatitdid.|Soifwerefreshtheapplywe'llseethatinfacttherewasoneapplicationtoStanfordandoneatMassachusetts Institute of Technologyfor444let'smakesurethat'sourstudent.|ThatwasNancyandtheothertwostudentsthatweattemptedtoinsertwerenotinsertedintostudentandtheyhadnoapplyrecordinsertedeither.|Nowlet'schangethisonetoanaftertrigger.|We'restillgoingtoenforcethesameconstraintsthathighschoolsneedtobebetween100and5000,butwe'regoingtochecktheconstraintaftercoupleshavebeeninserted.|Inthatcaseit'snotsufficienttojustignoretheoperationthat'sunderway,becausethecouplesbeeninsertedalready.|Whatwe'lldoinsteadiswe'llmanuallydeletethetuplethatcausedtheviolation,we'lldeletefromstudentthestudentthatwasjustinserted.|Nowwehavetwotriggersthatareactivatedatexactlythesametime.|Theonethatchecksthisconstraintandtheonethatdoesautomaticapplications.|Let'sseewhathappenswhenweperformsomeinsertionsWe'llinserttwostudents.|Again,bothofthemhaveGPAsthatareinrangeforautomaticapplication.|However,thesecondstudent'ssizeofhighschoolisoutofrange.|It's10,000.|Sobothstudentswillbeinserted,butthenourtriggerthatcheckstheconstraintonhighschoolsizewill,wehope,deleteRita.|Solet'sgoaheadandexecute,andnowlet'stakealookatourdata.|We'llrefresh,andweseethatasexpected,Quincywasinsertedwithnoproblem.|Ritawasinfactinserted,butthenourtriggerwasactivatedandshewasdeleted.|Nowlet'stakealookattheapplytable.|A-ha!|SoRita'sapplicationsarethere.|Andifwelookcloselyatthetriggers,andwerecommendyoudothat,youwillseethatbothofthemareactivatedbytheinsertsatthesametime.|NowoneofthemisgoingtodeleteRita,buttheotheroneisgoingtoprocesstheinsertandinsertRitaintotheapplytable.|Asagrandfinale,we'lljustshowtwotriggersthatarealittlebinary digitmorecomplicatedandmorerealistic.|Andyoumaywanttopausethevideotolookattheseclosely,becauseI'mnotgoingtogointothemingreatdetail.|ThefirsttriggerautomaticallyacceptsstudentstoBerkeleyiftheyhaveahighenoughGPAandtheycamefromalargeenoughhighschool.|Soitwillinterceptinsertionsintotheapply.|Itwillcheckifthoseconditionsaresatisfiedandhavetousesub-queriesheretofindthestudent'sGPAandtofindthestudent'shighschoolsize.|Again,Iurgeyoutopausethevideoandtakealooktomakesureyouunderstandwhat'shappening.|Ifthisstudentsatisfiestheconditions,thentheirapplyrecordissettoadecisionof"Yes"andweapplythatapplyrecordbymatchingthestudentIDandthecollegename.|Onceagain,I'vedeletedallexistingstudentsandapplyrecordsjusttokeepthedemonstrationsimple.|We'regoingtoinserttwostudents,AmyandBob.|TheybothhavehighGPAs,butonlyBob'shighschoolsizeisbigenoughtogranthimautomaticadmissiontoBerkeley.|Thenwe'regoingtohaveourfirststudentAmyappliedtoBerkeleyandoursecondstudent,Bob,appliedtobothBerkeleyandStanford.|Andwe'llseethatBobisgoingtoautomaticallybeadmittedtoBerkeley.|Sowe'verunthequery,andwetakealookatapply,andweseethatwehaveinsertedthethreeapplyrecords,butonlythesecondone,andthat'sBob'sapplicationtoBerkeley,hadadecisionthatwasmodified.|AndourlasttriggerisalsomorecomplexandIguesssortofrealistic.|Whatthistriggermonitorsisenrollmentsofcollegesandatthepointthatanenrollmentofacollegeisincreasedpastthethresholdof16,000,thensomeactionwillbetakenonitsapplication.|Anybodywho'sappliedtoEEatthatcollegewillbedeletedfromtheapplicationtableandallremainingapplications,wherethedecisionshavebeenyes,aregoingtohavethedecisionssettoundecided.|Onethingthatisinterestingaboutthistriggerisitdoesmonitorthedynamicbehaviorofthedatabaseandlookforathresholdtobepassed.|Andthat'ssomethingthattriggerscandothatsimplycannotbedonewithconstraints.|Someofourothertriggers,manyofthemasyousaw,weremoreeffectivelymonitoringstaticconstraints.|Wesetthethresholdat16,000.|WeseethatStandfordhas15,000students,andtheothersaren'tveryclosetothethreshold.|Forthistrigger,I'vealsorepopulatedourdatabasesowehaveawholebunchofapplyrecords.|Solet'sgoaheadandmakeanupdateandseewhathappens.|We'regoingtoincreaseallcollegeenrollmentsby2,000.|ThatwillcauseStanfordtopassthethresholdof16,000anditshouldactivatethetriggerandchangetheapplytable.|Whenwegolookattheapplytable,weseethat,indeed,theelectricalengineeringmajorshavedisappearedandalloftheotherapplicationstoStanford,thatwereformerlyyes,havenowbeensettoundecided.|Thatconcludesthefirsthalfofourdemonstrationoftriggers.|Inthenextvideo,we'llbeexploringevenfurthertheinterestinginteractionsthattriggerscanhaveandhowtheybehave.|Seeyouthen.|Ifyoumadeitthroughthatlongfirstpartofthedemooftriggers,hereweareinparttwo.|Asareminder,ourintroductionvideoabouttriggersusedtheStructured Query Languagestandard,butnodatabasesystemactuallyimplementsthestandardandmostsystemsdeviateconsiderably.|Postgresistheclosestandisthemostexpressivewithtriggers.|However,ithasakindofcumbersomesyntaxsowe'renotusingitforourdemos.|SQLitefollowspostsrisks,andisalsoquiteexpressive.|MySQLisconsiderablylessexpressive.|MostlywithsomelimitationsithasandhowtriggerscaninteractsoagainweareusingSQLiteforourdemoandjustafewofthedifferencesfromthestandard.|Ithasroleleveltriggersonlynostatementleveltriggersandanimmediateactivationsemantics.|Foreachrow,canbespecifiedintriggers,butifit'snotthere,it'sstillarowleveltrigger.|Itdoesn'thaveoldtablesornewtablessinceithasimmediateactivationsemanticsonly.|Anditdoesn'thaveareferencingclause,thevariablesoldandnewareautomaticallyboundineverytriggertowhatwouldbeoldrowandnewrowifithadareferencingclause.|Andfinally,theactionpartofSQLitetriggersareStructured Query Languagestatementsembeddedinbeginandendblocks.|Overall,here'sthelonglistoffeaturesthatarecoveredinourtwo-partdemo.|Wecoveredthefirstfivefeaturesinpartone,soinparttwo,we'llbetalkingaboutself-triggeringtriggers;we'llbetalkingabouttriggersthathavecyclicbehavior,conflicts--thatmeanswhenwehavemultipletriggerstriggeredatthesametime--andfinally,nestedtriggerinvocationswhentheactionpartofatriggertriggersadditionaltriggers.|And,finallywe'llalsoaddtotheademo,ademonstrationofSQLiterow-levelimmediateactivation.|Andagain,thatdoesn'tfollowthestandard.|Itsabinary digitsubtle,butletmereviewit.|IntheStructured Query Languagestandardalltriggersareactivatedattheendofthecommands,eveniftheymodifymultiplerows.|WhereasinSQLiteandalsoinMySQL,triggersareactivatedimmediatelyaftereachrow-levelmodification.|Thetablesthatweuseforthisdemoareverysimplebecausewewanttofocusspecificallyontriggerbehavior,sowe'lljustbeusingfourtables,eachwithasingleattribute.|Let'sgotothedemo.|Ourfirsttriggerisasimpleonethatdemonstratestriggerstriggeringthemselves.|It'sactivatedwhenwehaveaninsertiononT1.|IthasnoconditionandafterthatinsertionitinsertsanadditionalrowintoT1thatcontainsthevaluethatwasinsertedplusone.|Solet'sgoaheadandinsertarowandseewhathappened.|ThefirsttupleinT-1,theone,isthetuplethatweinsertedwithourcommand.|Thesecondtuple,thetwowasinsertedautomaticallybythetrigger.|However,weexpectedadditionaltriggeractivationstoinsertadditionaltuples.|ItturnsoutthatSQLite,asadefault,doesn'tallowatriggertobeactivatedmorethanonceinatriggerprocessingsession,presumablytopreventinfinitebehavior.|Butifwe'dlike,wecantoggleavariableintheSQLitesessioncalledrecursivetriggers.|Ifweturnrecursivetriggerson,thenthatcheckingisturnedoffandtriggerscanbeactivatedarbitrarilymanytimesduringatriggerprocessingsession.|Nowwithrecursivetriggerson,thistriggerwouldinfactactivateitselfindefinitelyinsertingmoreandmoretuplesintoT-1.|Actuallywhatwouldhappeniseventuallyanerror.|isgenerated.|Butwecanmodifythetriggerinordertoputinalimit.|Specifically,we'lladdaconditiontothetriggerthatsayswe'llonlyperformtheactionwhenthenumberoftuplesinT1islessthanten.|Sowhatweexpectnowiswhenwestartbyinsertingatuple,we'llinsertone,two,three,four,five,andsoon,butwhenthesizereachesten,theconditionwillnotbesatisfied.|Theactionwon'tbeexecutedandtriggerprocessingstops.|IdeletedthetwotuplesfromT1,sonowlet'sonceagainstartbyinsertingasingletuplewithavalueoneandlet'sseewhathappened.|WetakealookattableT1werefreshandweseethatindeedtentupleswereinsertedthefirstoneweinserted,alltherestbyselftriggeringofoursingletriggerandwhenitgottothesizeoften,triggeringterminatedbecausetheconditionpartofthetriggerwasnotsatisfied.|Nowlet'sgeneralizetheideatothreetriggersthattriggereachotherinacycle.|ThefirsttriggerisgoingtobeactivatedbyinsertsonT1andwhenthereisaninsertonT1itwillinsertintotableT2thesametupleexceptincrementedbyone.|ThatwillactivatetriggerR2,whichistriggeredbyinsertionsonT2.|WhenT2is,whenR2isactivated,itwilllikewiseinsertintotableT3.|AgainthevaluethatwasinsertedintoT2incrementedby1ThentriggerT3willbeactivatedbythoseinsertionsontoT3anditwillgobackandinsertbackintotableT1,againincrementingvalue.|Solet'sstartasusualbyinsertingintothefirsttable,thevalueoneandlet'sseewhathappened.|NowletmementionthatbeforeIstartedthisexampleIturnedtherecursivetriggersflagoff.|So,hereisouroriginalTuple1.|ThatactivatedatriggeranditinsertedtwointoTableT2.|Wecangoaheadandseethat.|That,inturn,activatedatriggerthatinsertedathreeintoTableT3,andthenwegobacktoTableT1andthefourwasinserted.|ButbecauseSQLitehasasadefault,thelimitationthateachtriggerisactivatedonlyonceinatrigger-processingsession,atthatpointtriggerprocessingterminated.|Nowwe'regoingtodothesamethingthatwedidlasttime.|We'regoingtoturnrecursivetriggerson,againusingthiscommandforourSQLitesessionandthenwe'regoingtomodifyourtriggerstoputinaterminationcondition.|Soweonlyneedtoputtheterminationconditioninonetriggerandwe'llputitinthethirdtriggerandthistimewe'llallowitgoalittlefarther,sothethirdtriggerwilladdaconditionthatwhenthesizeofthefirsttable,T1islessthan100,thenthetriggerwillgoaheadandexecuteitsaction,butwhenthesizeofT1exceeds100,thenitwon'tandthatwillbreakthecycleandtriggerprocessingwillterminate.|Asalwaysletsstartthingsoffbyinsertingthetuple1intotableT1.|SowhenwelookattableT1,weseeouroriginalinsertion.|This1inserteda2intotableT2,whichthencauseda3tobeinsertedintableT3,andthenbacktoafourbeinginsertedintoTableT-1.|AndthattriggeredafivebeinginsertedintoT-2andsoon.|Sowecanseethetriggerbehavior.|NowwedidputinalimitationsowhenwegolookatthesizeofT1,we'llseethatitgottoexactly100andthenwhenthesizeofT1exceeded100,thethirdtrigger'sconditionwasnotsatisfiedandthatcausedtheactionnottobeexecutedwhichbroughteverythingtoahalt.|Okay,that'senoughofcycles.|Nowlet'stakealookatasituationwhere.|Wehavetwotriggersactivatedatexactlythesametimeandtheyperformupdatestoexactlythesameportionofthedatabase.|BothofourtriggersareactivatedbyinsertionsintotableT1.|Andwe'regonnaagainstarttriggerprocessingbyinsertingonetuplewiththevalue1.|Thefirsttriggerhasnocondition.|ItupdatesthecontentsofT1tosetallthevaluesto2.|Thesecondtriggercheckstoseeifthereexistsa2intableT1,andifsoitsetsthevaluesto3.|So,thesetwotriggersaredesignedspecificallysowecanseewhichonegoesfirst.|IftriggerR1goesfirstitwillsetthevalueto2.|Theconditionpartofour2willbetrueanditwillthen,inturn,thensetthevalueto3.|However,iftriggerR2goesfirst,itwillnotfinda2intableT1,soit'sactuallywillnotbeexecutedandwillthenourtriggerR1willgonextandwewillsetthevalueto2.|Okaysolet'sgoaheadanddoourinsertionwiththesetwotriggersdefinedandseewhathappens.|Weinsertthevalue,wetakealookatT1,andwediscoverthatwehavethevalueof2.|Sowhatdoesthattellus?|ThatactuallytellsusthattriggerR2wentfirst.|Weperformedourinsertion.|Itlookedtoseeiftherewasatwointhetable.|Therewasn'tbecausetherewasjustaone.|Itdidn'texecuteitsaction.|ThentriggerR1wentanditmodifiedthevaluetobetwo.|Sothat'sinteresting:thesecondtriggerwentfirst.|Soasanexperiment,let'stryreversingtheorderinwhichthetriggersaredefined.|We'llcreatetriggerR2firstandR1second.|I'vedeletedthetuplethatwasinT1,soonceagainwe'llinsertaT1togetthingsstarted,wegotakealookandnowweseeindeedthatwehavethevaluethree.|Goingbacktolookatourtriggers,avaluethreemeansthattriggerR1wentfirst,itsetthevaluetotwo,thatmadetriggerR2'sconditiontrueandthenitsetthevaluetothree.|Sointerestingly,inSQLite,whenyouhavetriggersthatareactivatedatthesametime,itappearsthatthetriggerthatwascreatedsecondistheonethatisgoingtogofirst.|Nowlet'sexperimentwithnestedinvocationoftriggers.|Tomakethingsexciting,thistimeI'mgoingstartbyinsertingazerointotableT1insteadofaone.|Andwe'regonnabeusingallfourofourtables,T1throughT4withthreetriggers.|ThefirsttriggerisgoingtobeactivatedbytheinsertionintoT1.|Anditwillsimplyinsertatuple1intotableT2andatuple1intotableT3.|Whatwe'regoingtosee,andwhatwe'respecificallyexperimentingwith,isthatthefirstinsertionwill,infact,activatetriggersbeforethesecondinsertionisperformed.|ThefirstinsertionintoT2willactivateoursecondtriggerinsertsonT2andthistriggerwillinturninsertintotablesT3andT4,anditwillinsertthevaluestoo.|Sothiswilloccurinasomewhatnestedfashion,andinfactinthisaction,we'llseethefirstcommandwillbeexecutedanditwill,inanestedfashion,activateourtriggerR3,whichwillinsertsimplyintotableT4thevaluethree.|Solet'sgetstartedand,again,asImentioned,forexcitementwe'llbeinsertingazerothistimeandlet'sgoseewhathappenedtoourtables.|SotableT1hasjustthezerothatweinserted,asexpected.|TableT2hasjustasingletuplewiththevalueonewhichisexactlywhatweexpected,thistriggerisonlyactivatedonce.|Nowlet'stakealookattableT3.|TableT3hasa2anda1andthey'reinthatorderAndwhatthattellsusisthatthisinsertionhereactivatedbytriggerr2happenedbeforethisinsertionherefromtriggerr1andthatthisiswhatdemonstratesthenestedinvocationofthetriggersandjusttolookatthelasttablewewillseesomethingsimilarinT4.|Weagaincanseenestedinvocationbecausethetwooccursafterthefirstinsertionofthreeandthenwehavethefinalinsertionofthree.|Sothisisabinary digitcomplicated.|Youmightwanttolookatthevideoagainororevenbetteryet,downloadthetriggersandtrythemyourself.|OurlastexampleisdesignedspecificallytodemonstratetheimmediateactivationofthelowleveltriggersimplementedinSQLitespecificallyI'vepopulatedtableT1alreadywithfourtupleswiththevalueoneandwhatmytriggerisgoingtodowhenIinsertadditionalvaluesintoT1isthisinsertintotableT2theaveragevalueinT1.|WhatI'mgoingtodoisinsertabatchoftuplesintoT1,infactI'mgoingtoinsertfourtupleswithavalueoftwo.|SowhenI'mdone,I'llhavefour1sandfour2sintableT1.|IftriggersfollowedtheStructured Query Languagesemanticsofbeingactivatedtheveryendoftheentirestatement.|Sotheentirebatchofinserts,thentheaveragevaluesthatweinsertintoT2,wouldreflecttheaverageofthefour1sandthefour2s,soitwouldbethevalue1.5.|However,whatSQLitedoesisactivatesthetriggeraftereachtuple-levelinsertion.|So,asweinsertthe2s,oneatatimeanaveragewillbeinsertedintotableT-two,andthefirstaveragewillreflecthaveone2intableT1,thesecondwillreflecthavingtwo2sintableT1,andsoon.|Ithinkyou'llgettheideawhenIshowwhathappens.|SohereisthecommandI'mgoingtousetoinsertthefour2sintotableT1.|I'mgoingtoinsertintoT1,theresultofthissubquerywhichtakeseveryvalueandadds1.|Solet'sgoaheadanddoit.|Andlet'stakealookattableT1.|Andweseenowthatindeedwehavethefouronesandthefourtwos.|SotherealstoryistoldwhenwelookattableT2.|Andhereweseeindeedthatwedonotgetfouraveragesthatare1.5,whichiswhatwewouldhavegottenwiththeStructured Query Languagestandardsemantics.|Insteadwesawthatforeachtwothatwasinserted,weinsertedtheaverageintotableT2,reflectingthenumberoftwosthatwereinthetablesofar.|Again,fairlycomplicated,youmightwanttowatchthisexampleasecondtimeordownloaditandtryitathome.|Sothatconcludesourratherlongcoverageoftriggers.|We'veseenthatitcanactuallybequitecomplicatedwhentriggersinteractwithupdatesonthedatabase,whentheyperformupdates,andespeciallywhentheyinteractwitheachother.|Nowtherealityisthatalotoftimesthattriggersareusedinapplicationsisforverysimplepurposes.|Wemighthaveacoupleoftriggersthatareenforcingsimpleconstraints.|Theydon'tinteractwitheachotherandtheydon'tinteractwiththedatabaseincomplicatedways.|AndI'veshownafewofthosetriggersearlyon.|However,Ididwanttomakeapointthatwhentriggersareusedformorecomplicatedpurposes,whentheyinteractwitheachotherandwiththedatabaseincomplicatedways,itisimportanttobeverycarefultofullyunderstandhowtheybehave.|Thissequenceofvideosintroducestheveryimportanceconceptcalledviews.|Inthisvideo,we'lltalkaboutdefiningandusingviews.|Andthen,we'llgiveademonstration.|Thenextsequenceofvideos,we'lltalkaboutmodifyingviews,andthen,we'llalsotalkaboutmaterializedviews.|Viewsarebasedonathreelevelvisionofdatabases,whichareknownasthephysicallayer,theconceptuallayer,andthelogicallayer.|Atthebottomlevel,wehavetheactualdatastoredonadisk.|So,here'smypictureofadisk,andthen,wehavediskpages.|Andonthosepagesisstoredtheactualdata.|So,that'sthephysicallayer.|Thenextlayerup,knownastheconceptuallayer,istheabstractionofthedataonthesediskintorelations.|Andthat'swhatwehavebeentalkingaboutforalotofourvideos.|Whatweareintroducingnowiswhat'sknownasthelogicallayer.|Andthat'safurtherabstractionaboverelationsintowhatareknownasviews.|Aswe'llsee,aviewisdefinedasaqueryoverrelation.|So,it'sstillintherelationaldatamodel.|So,weshowedoneviewthatisqueryovertworelationshere,wecouldhaveaviewthat'squeryoverviewsandmaybeviewstogetherwithrelations.|It'saquitegeneralconcept.|So,untilnow,we'veseenapplicationsandusersofthoseapplicationsoperatingontherelationsattheconceptuallevel.|Butusersandapplicationscanalsooperateonviewsatthelogicallevel.|So,whydoweintroducethisadditionallevelontopofthisconceptuallayerwhichisthelayerofrelation?|Certainlyweunderstandwhywewanttouserelationsandnottalkaboutpageslikethisbutwhat'sthebenefitofaddingviewsontopofrelations.|Wellonebenefitisthatitallowsustohidesomedatafromsomeuserswhenthegranularityofwhichwewanttohidedatadoesn'tcorrespondexactlytorelations.|Anotheristhatitmightmakecertainquerieseasierandmorenaturalwhenwequeryovertheviewsratherthandirectlyovertherelations.|Andthethirdreasonismodularityofdatabaseaccessbecausewecanthinkoftheseviewsasmodulesgivingusaccesstoportionsofthedatabase.|Again,whenthatgranularitythatwewantdoesn'tcorrespondpreciselytorelations.|OnethingthatIshouldmentionisthatrealapplicationsdotendtouselotsofviews,lotsandlotsofviews,sothebiggertheapplicationis,themoreneedtheremightbeformodularity,foreaseofcertainqueriesorforhidingdataandviewsarethemechanismtoachievethosegoals.|Solet'stalkabouthowviewsaredefinedandused.|It'sactuallyaprettysimpleconcept.|Todefineaview,whichwe'llcallV,wespecifyaqueryof,we'lljustsay,"Viewquery,"inaquerylanguage,typicallyinStructured Query Languageoverasetofexistingtables.|Aswe'llseethosecouldevenbeused.|Theschemaoftheviewthen,wecanthinkofitlikeatable,istheschemaoftheresultofthatquery.|Nowlet'ssaywewanttorunaqueryQOverourdatabase.|Thisisnottheviewquery.|ThisisjustsomeadhocqueryoverourdatabaseandwewanttoreferenceVinthatquery.|So,wecanonceVisdefine,referenceitjustlikeit'satableandconceptuallywhatwecanthinkofisVbeing,sayatemporarytablethatisassignedtotheresultofrunningthequeryoverthecurrentinstancesofR1throughRN,sowe'venowpopulatedVlikeitisatableandthenweevaluateQandwecansimplyrefertoVasweevaluateQ.|Sothat'swhathappensconceptually.|Now,inrealitywhathappensisthequeryQthatreferencesVisactuallyrewrittentousethetablesR1throughNthatareinthedefinitionofV.InsteadofreferencingVandwe'llseethatinourdemoandasImentioned,theRIs,thesetablesthatarereferencedintheviewdefinitioncanthemselvesbeviewsaswesawinourdiagramearlierwiththosepurplesquares.|Thesyntaxfor.|Creatingaviewinsqlisverysimple.|Weusethekeywordscreateview,wegivetheviewaname,andthenwespecifythequeryforthatview,andthatquerywouldbeinstandardsql.|NowasIsaid,theschemafortheviewedthatwillbecomeknownasthename,istheschemaoftheresultofthisquery.|Ifwewanttoactuallynametheschemasorenametheattributesintheresultsofthequery,thenthereisanalternativesyntaxthatactuallyliststheattributenamesfortheview.|Oncethiscommandhasbeenexecutedfromthispointon,wecanusenewnameasit'saregulartableinthedatabase.|Solet'smoveaheadnowtothedemo.|Inthedemo,wewillbeusingourstandard,simplecollegeadmissionsdatabase.|Asareminderincaseit'sbeenawhileoryou'renewtoourvideos,it'sadatabasewiththreetables.|Onewithinformationaboutcollegesthathaveacollegenamestatementenrollment.|Onewithinformationaboutstudentsandfinallyrecordsshowingthatstudentshaveappliedtocolleges.|Asusual,wehaveourfourcolleges;Stanford,Berkeley,Massachusetts Institute of TechnologyandCornell.|Wehaveabunchofstudentswiththeirname,GPA,andthesizeoftheirhighschool,andfinallywehavestudentswhohaveappliedtocollegesforaspecificmajorandthere'sadecisionoftheirapplication.|Solet'screateourfirstview.|OurviewiscalledComputer ScienceAcceptanditcontainstheIDsandcollegenamesofstudentswhohaveappliedtomajorinComputer Science,andthedecisionwasyes.|Soit'stheIDsandnamesofstudentswhohavebeenacceptedtoaComputer Sciencemajor.|Weexecutethecommandthatcreatestheview,andnowwecantakealookattheview.|Wegotoourviewmanager,andweseeComputer ScienceAccept,andwedouble-click,andherearethecontentsoftheview.|Noweventhoughitlookslikeit,thisviewisactuallynotstored.|Whenweasktoseethecontentsoftheview,orasweseemomentarily,runaquerythatusestheview,thatcommandorqueryisrewrittenbasedontheviewdefinitionthatwegave.|Sonowlet'srunaquerythatusestheviewasifit'satable.|OurqueryisgoingtofindstudentswhowereacceptedtocomputerscienceatStanfordandhaveaGPAlessthan3.8.|Sohere'sourquerywritteninStructured Query Language,andwecanseehereintheFromclause,wearereferringtoComputer ScienceAcceptasifit'satable.|Sowe'lljointhestudentrelationwiththeComputer ScienceAcceptrelation.|We'llmakesurethatthecollegeisStanfordandtheGPAislessthanthreepointeight.|WerunthequeryandweseethatHelenistheonlystudentwhosatisfiesthecriteria.|Sowhatactuallyhappenswhenwerunthisquerythatreferstoaview?|FirstnowI'mgoingtotalkaboutwhathappensconceptually,andthenI'mgoingtotalkaboutwhatthesystemactuallydoes.|Soconceptuallywecanthinkofthequeryreferencingtheviewastriggeringaprocesswherewecreateanactualtablewiththecontentsoftheview,andthenwerunourqueryoverthattable.|So,I'vedemonstratedthathere.|WecreatedtemporarytableT,andthatquerycontainsexactlyourviewdefinition.|SothiswasthedefinitionofourviewComputer ScienceAccept.|Thenwetakethequerythatwewanttorun,thiswasourquery,andwereplacethereferencetotheviewwiththereferencetothetemporarytableTotherwiseeverythingisexactlythesame.|We'llrunthatqueryandthenwe'lldropourtemporarytable.|So,ifweexecuteallofthis,againwewillseeourresultisHelen.|whathappensunderneathinmostsystemsisthatthequerythatwewriteisactuallyrewrittennottoreferenceaviewortoreferenceatemporarytable,butactuallytoreferencethewhatareknownasbasetables,theonesthatareusedintheviewdefinition.|Solet'stakealookatthatprocess.|Soherewe'vetakenourreferencetotheviewComputer ScienceAcceptandwe'vecreatedasub-queryinthefromclause.|IhopeyourememberthatfromtheStructured Query Languagevideos.|Sowe'vejusttakenthedefinitionoftheview.|It'srighthere.|We'veputitintoasub-query,we'venameditComputer ScienceAccept,andthentherestofthequerycanremainthesame.|Sothisisactuallyconvenient,averyusefulfeaturewhereweusethesub-queriesinthefromclause.|Sowe'llrunthequery,andonceagainweseeHelen.|Well,believeitornot,thisisnotexactlywhatthesystemtendstodoeither.|Thisisaveryeasyandconvenientrewrite,butunfortunately,underlyingdatabasesystemsdon'talwaysexecutequeriesthathavesub-queriesinthefromclauseinthemostefficientway.|Soasophisticatedsystemwillactuallydoarewriteintoasimplerquery.|Therewritingprocessismorecomplicated.|Thequeryendsupbeingsimpler.|Andhere'sthatquery.|It'sactuallyasimplequeryoverthestudentandtheapplyrelationsbasedonthedefinitionofourview,wherewe'refindingherefromthefirstpartofourwearcomesfromtheviewdefinitionthemajorhastobeComputer Scienceandthedecisionisyes.|Thenwehavethejointconditionthatcomesfromthequeryandthelasttwoconditionsarealsofromourquery.|Soyoumightwanttolookbackandthinkaboutitbutthisisexactlywhatwewereaskingforwhenweweredefiningtheviewandthenrunningaqueryoverthatview.|Sowhenwerunthis,weshouldonceagaingetHelen,andwedo.|Ofcourseisthatasauseryoudon'thavetoworryaboutanyofthis.|Youjustdefinetheviewsandyouusethem,andit'suptothesystemtohaveanefficientandcorrectimplementation.|AsImentionedintheintroductionwecandefineviewsthatreferenceotherviewsandthat'swhatI'vedoneinthisexample.|ThisexamplefindsstudentswhoareacceptedtocomputerscienceatBerkeley,andtheycomefromahighschoolthat'sgreaterthan500.|SoI'mcallingtheviewCS-Berk,andtheviewisajoinofthestudentrelationwithourComputer Scienceacceptview.|It'sgoingtojoinbasedontheIDs.|So,theacceptviewisalreadygoingtobefindingstudentswhoareacceptedoutofcollegeforcomputerscienceandthenwe'regoingtoconstrainittothosewhoareacceptedtoBerkeleyandfromahighschoolsizegreaterthan500.|So,werunthiscommand,butthisdoesn'tshowustheresult,itjustcreatestheview.|Nowwegotoourviewmanagerandweseethatwehavetwoviews,andtheBerkeleyviewfindsthatthereweretwostudentswhowereacceptedtoBerkeley.|Theycomefromalargehighschool,orhighschoolgreaterthan500,althoughwe'restillreturningtheirGPAintheview.|SonowthattheviewCS-Berkhasbeendefined,wecanrunaqueryonCS-Berk.|Solet'sfindthosestudentswhohavebeenacceptedtoBerkeley.|OrcomputersciencewithahighschoolsizegreaterthanfivehundredandthathaveaGPAgreaterthanthreepointeight,andweseethatthat'sAmy.|Sothisisabeautifullysimplequery.|Butwhat'shappeningunderneathisalittlebinary digitcomplicatedbecausethisisdefinedoveroneview,whichitselfisdefinedoverothertables.|Sotherewriteprocessinthiscaseisakindofrecursiveprocessofexpansion.|Let'stakealookatwhatthequerywouldlooklikerewritten.|SonowthatsimplereferencetotheviewComputer ScienceBurkehas.|It'sbeenreplacedbythiswholesectionhere,lines2through5.|Andyoucanseesortofthe2layerprocess.|Attheouterlayerwehave.|ThedefinitionofComputer ScienceBurkewhichitselfreferredtoComputer Scienceaccept.|So,wehadinofComputer ScienceBurke,notthisexpansionherebutjustComputer Scienceaccept.|AndthenwehadtheadditionaljointconditionandthereferencetoitbeingBerkeleyandthesizeHighSchoolandthenthisComputer Scienceacceptedselfisexpandedtoitsviewdefinition.|Sonowwhenwerunthequeryweshouldstillgetthesameresultandwedo.|I'mnotgoingtoshowitherebutthisquerycouldsimilarlyhaveaflattenedrewriteintoajoinaswesawwhenwesawtheexpansionofComputer Scienceaccept.|SonowwehavetheviewComputer Scienceberkthat'sdefinedovertheviewComputer Scienceaccept.|WhathappensifwetrytodroptheviewComputer Scienceaccept?|Wegetanerrorhere.|Wecan'tdroptheviewbecauseotherobjectsdependonit.|Sothat'saniceerror.|That'sfromthePostGristsystem.|Unfortunately,ifweusedoneoftheothertwosystems,Structured Query LanguageLightorMyStructured Query Language,whatwouldactuallyhappenisitwouldallowustodroptheviewandthenwhenweattemptedtorefertoComputer Scienceberk,atthatpointwewouldgetanerror.|BecausewhenitdidtherewritingprocessitwoulddiscoverthatComputer Scienceacceptnolongerexists.|Nowlet'screatewhathappenstobeoneofmyfavoritetypesofviews.|We'regoingtotakeourthreetablesinthedatabaseandwe'regoingtojointhemtogethersothatwehaveallofourinformationtogetherinonetable.|Sowe'regoingtoapplyourjoinconditionstogetthecollegescoordinatedwiththeapplicationsandthestudents,andthenwe'regoingtotakealloftheattributesinvolved.|Solet'srunthatview.|We'llcallitmegaandlet'stakealookatwhatwehaveinmega.|Hereitis.|Sothisisalloftheinformationinourthreetablesjoinedtogetherandwe'llseethatmakesqueriesquiteconvenient.|Now,letmeremindyouthatthisinformation,theviewcontents,arenotactuallystored.|So,thisisatoydatabase;itwouldn'tbeabigdealtostoreithere.|Butifwehaveaverylargedatabase,whereit'scrazytothinkaboutactuallystoringthejoinofeverythingtogether,thatdoesn'tmeanwecannotcreatetheview,becausetheviewisjustalogicalconcept,andagaincaneasequerying,aswe'llseenow.|Oncewehaveourmegaviewwedon'tneedtothinkaboutjoins.|Wesimplystatetheconditionsthatwewantinthedatainourqueryresults.|So,forexample,ifwewanttofindhighGPAapplicationstoaComputer Sciencemajoratlargecolleges.|Wejustusemegainourclauseandgiveourconditions,highGPA,Computer Sciencemajor,highenrollmentandwerunthequeryandhere'sourresult.|Andincidentallyifyou'reworriedabouttherewriteofthatquery,it'sactuallynobigdeal.|Thatone'sgoingtorewriteinitsflattenedversiontoadjoinofthethreetableswiththejoinconditionsandthentheconditionsthatwespecified.|Andagain,ifwerunthisquery,we'llgetthesameresult.|Sothatcompletesourdemonstrationofdefiningviewsandusingviewsinqueries.|Asyoucancanseeit'saprettystraightforwardandconvenientconceptfortheapplicationdeveloperandareusedverycommonlyformodularizingapplicationsformakingquerieseasierto,toformulateandforauthorizationpurposes.|Thisseriesofvideoscoversthetopicofmodifyingviews.|Now,Ihavetoadmitthattheamountofcoverageisabinary digitdisproportionatecomparedtodefiningandusingviews.|Commonly,peopleonlydefineviewsandusethemanddon'ttrytomodifytheminapplications,butwhenviewsaremodifiedtheissuesbecomeabinary digittricky.|So,itisimportanttocoverthetopic.|First,areminderofwhypeopleuseviews.|Theyusethemtohidedatafromsomeusers,soforauthorizationpurposestheymakesomequerieseasier,theyhelpyoumodularizeyourdatabaseapplications,and,asI'vesaidseveraltimes,ourrealapplicationsdouselotsandlotsofviews.|Now,queryingviewsisrelativelystraightforward,aswe'veseen.|Onceaviewhasbeendefinedandgivenaname,sayV,then,inourqueriesoverthedatabase,wecanreferenceVasifitwerearegulartable.|WhathappensunderneathisthatwhenwereferenceVinaquery,it'srewrittentousethetablesoverwhichVwasdefined,andwe'llcallthosethebasetables.|Thosecanactuallyberegulartablesortheycanbeotherviews.|Now,whataboutmodifyingviews?|Onceaviewhasbeendefined,canwemodifyitjustlikeit'sanytableinthedatabase?|Well,inonewaythatdoesn'tmakesensebecauseVisn'tstored,soit'snotatablethatwecangoinandupdate,inserttupples,modifytupples,ordeletetupples.|But,inanotherway,itabsolutelyhastomakesense,becausetheideaofviewsisthatsomeusersorapplicationdevelopersareseeingthoseviewsastheironlyviewofthedatabase.|Wesawthatthree-levelideaofdatabases.|Wehavethephysicallayer,thedisc,theconceptuallayer,therelation,andthenthelogicallayerwhichagain,someapplicationsseeastheiraccesstothedatabase.|Well,oursolutionisactuallyparalleltowhatwedowithqueries.|WhenwehaveamodificationcommandthatinvolvesaviewV,we'llrewritethatmodificationcommandtomodifyinsteadthebasetablesoverwhichVisdefined.|Ifthosebasetableshappentobeviewsthemselvesthatwehavearecursiveprocessofrewritingthosemodificationstofurthergodownto,untilwegettothebasetablesthatareactuallythetablesstoredinthedatabase.|Somaybethisisnobigdeal.|Wesawinourdemothatmodifyingqueriesthatreferenceviewsintoqueriesthatreferencethebasetablesisarelativelystraight-forwardprocess.|Well,Iamgoingtosayrightupfront,it'snotquiteasstraight-forwardwhenwearetalkingaboutmodifications.|Solet'sdrawapicturetoseewhat'sgoingon.|Let'ssaywehaveourviewVhere,andVisdefinedbasedonaqueryoveritsbasetables.|Andfornow,let'sjustassumethatthosearestoredactualrelations.|Soit'sdefinedoverrelationsR1toRN.|NowsomeonecomesalongandtheywanttomodifyV.NowVisjustalogicalconceptbut,theuserthinksofVasatable,sotheywriteamodificationcommandsothatwouldbesay,insert,delete,orupdatecommandusingStructured Query Languagelanguage.|Andthey'reimaginingthatVisastoredtable,sothey'reimaginingthattheresultofthatmodificationcommandisgoingtobeanewtableVprime.|Whatneedstohappenisdownhereatthebottom,thatmodification,thatimaginarymodificationtoV,hastobetranslatedtoactualmodificationsonthebasetablesR1throughRN.|Sonow,wemodifyoneormoreofthebasetablestoR1primethroughRNprime.|AndnowtheideaisthatourimaginaryVprimethenisthesamequery.|It'stheresultofthissamequery,V'sdefinitionoverthenewvalue,thenewR1primethroughRNprime,theupdatedbasetables.|So,ifwecanalwaysfigureouthowtotranslatethismodificationuphereintothemodificationsdownheresothatthesquarediagramholdssothattheresultingmodificationsheregiveustheeffectwewantedupstairs,then,we'reingoodshape.|So,thequestioniscanwealwaysperformthistranslation,themodifications,sothesquarediagramholds.|Andtheansweris,actuallyusually,yes.|Usuallythereisatranslationthatworksforus,andwe'llseesomeexamplesofthatinourdemos.|Theproblemactuallyisthatthere'softenmanysuchtranslations,andsowedon'tknowactuallywhichonetheuserintended.|Soletmegiveanextremelysimpleexample.|Let'ssupposethatourrelation,R,hastwoattributes,AandB,andourview,V,isdefinedastheprojectiononAofR.Let'ssaythatourcurrentcontentsofrelationarejustonetupletotuple1-2.|Inthatcase,thecurrentcontentsofviewVarejustthetuple1.|Nowlet'ssaytheusercomesalong,it'sauserwhoisoperatingonthedatabasethroughviewV,andtheysayinsertintoviewVpleasethetuplethree.|Soweneedtotranslatethatinsertion,whichisuphere,intoinsertionorsomemodificationonthebasetablessothattheviewwill,whenwe'redone,containthetuplesoneandthree.|Well,wecancertainlydothat.|Theproblemis,whatexactlydoweinsert?|Wecouldinsertforexample3-1.|Wecouldinsert3-2andsoon.|Sothere'sactuallyaninfinitenumberoftranslationsthatwillcreatethetuplethreeintheview.|Here'sanevenmoreextremeexample.|Let'ssupposewehavearelationwithoneattributeandourviewbetheaveragevalueofthat.|Soif,forexample,ourrelationhasthevalues135,thentheaverageatthispointwouldbethree.|Nowlet'ssaythattheusercomesalongandsaysletmeupdatethataverage.|I'mgonnasetthataveragetobeseven.|Wellhowdoweupdatethebasedatasothatitsaverageisnowseven.|Well,asyoucanimagine,therearemany,many,many,actuallyaninfinitenumber,ofwaystoupdatethebasedatasothattheviewaveragewouldnowbeseven.|Sothat'sthecruxoftheproblem.|Howdowedecidewhichmodificationstomaketothebasetablessothatwegetthedesiredmodificationtotheview?|Correctnessisnotsohardtoachievebutresolvingambiguitycanbe.|Existingsystemshaveactuallytakenafairlydifferentapproachastothisproblem.|Again,tospecifytheproblemwehavemodificationsspecifiedonaviewV.Weneedtorewritethosetomodifythebasetablessothatwhenwehaveourviewofovernewbasetablesthatreflectsthedesirednewstateoftheview.|Oneapproachisthattheviewcreatoractuallyspecifiesthatrewritingprocess.|Sotheywillsay,youknow,whensomebodytriestoinsertintotheview,here'swhatweneedtodoonthebasetables,iftheytrytodeletehere'swhatwedo,andupdatehere'swhatwedo.|Sothepositiveofthisapproachisthatallmodificationscanbehandled,becausetheviewcreatorisgoingtospecifyexactlywhathappensinthecaseofthosemodifications.|Thedownsideisthatthere'snoguaranteeofcorrectness,meaningthere'snoguaranteethatthatsquarediagramisadheredto,andwe'llseeexamplesinourdemoofwhereit'snot,oreventhatthetranslationsaremeaningful.|Sowe'rerelyingontheviewcreatortocreatecorrectandmeaningfultranslationsexplicitly.|Thesecondapproachistorestricttheviewsandmodificationsthatareallowedsothatthesystemcanautomaticallyperformthetranslationintomodificationsonthebasetablesthatarecorrect,meaningfulandandunambiguous.|Sotheplusnow,ofcourse,isthere'snouserinterventionandtheresultisgoingtobecorrect.|Thedownsideisthattherestrictionsontheviewandthemodificationcombinationsarefairlysignificant,aswe'llsee.|So,thefirstapproachisactuallyenabledbyatypeoftriggerthat'sknownas,"insteadof."|Ialludedtothosetriggersbrieflyinthetriggervideobuthereiswhereweareactuallygoingtoseetheminaction.|Inpostgres,there'saconceptcalled"Rules,"that'sverysimilar.|Thesecondapproachisactuallytheonethat'sadoptedbytheStructured Query LanguageStandard,andtheStructured Query LanguageStandardgivesaveryrigorouslimitationsonwhatviewscanbemodified.|Systemsvaryinwhattheyimplement.|Mostofthemareactuallyalittlebinary digitmoreflexiblethanthestandard,andwe'llseethatinupcomingdemosaswell.|Inthisvideo,whichwillmostlybelivedemo,we'lltalkaboutmodifyingviewsthroughtriggers.|Asareminder,oncewe'vedefinedaview,saycalledV,we'dliketobeabletorunmodificationcommandsoverVasifitwerearegulartable.|NowsinceVisnotaregulartable.|It'sjustaviewdefinitionwhathappensisthatthemodificationcommandsagainstVarerewrittentomodifythebasetablesoverwhichVisdefinedandaswetalkedaboutpreviouslyunlikewithqueriesoverviews,wecan't,ingeneral,automatetheprocessofrewritingofmodificationsonviewsintomodificationsonthebasetables.|Aswediscussedintheintroductoryvideo,therearetwobasicapproachestodealingwiththefactthatthetranslationcan'tbeautomated.|Oneistohaveinterventionbytheviewcreatorwheretherewritingprocessisspecifiedaspartofcreatingaviewifwewanttoallowtheviewtohavemodificationsagainstit,andtheotheristorestricttheallowedviewsandmodificationssothatthethetranslationcanbeautomated.|Inthisvideo,we'retalkingaboutthefirstcaseandspecificallywe'regoingtoseehowinsteadof.|triggers.|Aspecialtypeoftriggercanbeusedtospecifytherewritingprocesstoenablemodificationsagainstviews.|We'llbeusingourstandardsimplecollegeadmissionsdatabaseforthedemonstrationwherewehaveourusualthreetables:thecollegetable,thestudenttableandthetablecontaininginformationaboutstudentsapplyingtocolleges.|Solet'sturntothedemo.|Asusual,we'llstartwithourfourcolleges:Stanford,Berkeley,Massachusetts Institute of Technology,andCornell,ourbunchofstudentsand,finally,therecordsshowingourstudentsapplyingtocollegesforaspecificmajorandadecisionforthatapplication.|Someoftheviewsweuseinthisdemoaregoingtobethesameviewsthatweusedinourdemoshowinghowwedefineandqueryoverviewsandnowwearegoingtofocusingontheabilitytorunmodificationcommandsagainstviews.|Ourfirstviewsisoneofthoseit'scalledComputer ScienceacceptandasbeforeitcontainsthestudentIDandthecollegenamewherethestudenthasappliedtomajorinComputer Scienceatthatcollegeandthedecisionisyes.We'venowcreatedtheviewandwecantakealookatitscontentsandwe'llseethatwehaveafewstudentswhohavebeenacceptedtoComputer Scienceatafewcolleges.|Nowwhatwe'dliketodoisrunadeletecommandagainsttheview.|Let'ssaythatwewanttodeletestudent123,thetworecordsofstudent123beingacceptedtomajorinComputer Science.|Sowewouldrunthatcommand,likethisverysimple.|DeletefromComputer ScienceacceptorstudentIDequalsone,two,three.|ButwhenwerunthecommandwegetanerrorbecauseStructured Query Languagelightdoesnotallowustomodifyviews.|Sohere'sthetriggerthatwe'regoingtocreatetoenabledeletioncommandstoberunontheComputer Scienceacceptview.|Thistriggerisgoingtointerceptthosedeletionsandit'sgoingtotranslatethemintodeletionsonthebasedataoverwhichComputer Scienceacceptisdefined.|Solet'stakealookatwhatwe'dliketohappen.|Ifauseraskstodeletesomedatafromtheviewandagainlet'sgobackandlookatourview.|IftheuserwantstodeleteonetwothreeStanfordfromtheviewthenwhatwewanttobedeletingistheapplyrecordsthatgaveusthesetupplesintheview.|Solet'sgotakealookattheapplyrelationhereandwe'llseethatthiswasthefirstrecordherewherethestudentappliedtoC.S.|atStanfordandthedecisionisyesandthe3rdrecordwherethisperson123appliedtoBerkeleyandC.S.|isyes.|Wedon'twanttodeletetheotherrecordsforthestudent,123becausethoseweren'tcontributingtoourComputer Scienceacceptview.|Sowe'dliketotranslatethatdeletionontheviewintoadeletionoverapplysuchthatthenewvalueoftheviewnolongerhasthosefirsttwotupplesforstudent123.|Solet'sseehowthat'simplementedbyourtrigger.|Nowtheoneimportantthingtoknowthathappens,andthisistheonerealcontributionthesystemmakestowhatwe'redoingheretoenableviewmodifications,isthatwedohaveaccess,twoofthedeletedtupples.|Sothistrigger,it'sactuallyarowleveltrigger,soit'sgoingtoberunonceforeachdeletedrow;andwhenwerunthetrigger,Wewillhavethisspecialvariable"old"thatcontainsthecontentsoftherowthattheuserisaskingtodelete.|Sointheactionportionofthetrigger,thatwecanrefertothevariableoldtothestudentIDandcollegenamethatareintheacceptviewasifwewerereallydeletingthattupplefromtheviewsoagainletmereintegratethesystemisgoingtobindtovariableoldthetupplestobedeletedfromtheviewusingtheschemeofthevieweventhoughthosetupplesaren'tphysicallyinexistence.|Andwe'llusethevaluefromthosetotranslatetothedeletionwewanttoperformontheapplytable.|Veryspecifically,fortheComputer Scienceacceptview,ifwehaveastudentID-collegenamecombinationtobedeletedfromtheview,thenwhatwe'dliketodeletefromtheapplytableisthetupplethathasthatstudentID,thatcollagename,amajorofComputer Scienceandadecision,yes.|Sothepersonwhowritesthistriggerwhichispresumablythepersonwhocreatedtheviewisgoingtousethecombinationofwhatwasdefinedintheview,majorequalsComputer Scienceindecisionequals,yescombineswiththevaluegettingtobedeletedfromComputer Scienceaccept.|Ihopethatmakessomeamountofsense.|Sonowthatwe'vecreatedthistriggerlet'sgobackandlet'strytoperformourdeletionoperationagainthistimeitlookslikewehadsuccesssoletsgoaheadandseewhathappened.|Wegotoourviewmanager.|Weseeindeedthosecoupletupplesaregone.|Nowrememberthistableisn'tactuallystoredthiswhenwelookattheview,itsactuallyrunningtheviewqueryagainstthedata.|So,whenwelookattheapplytableweshouldalsofindthat'sthereallyimportantthingthatthetuplescorrespondingto123beingacceptedtoComputer Scienceareindeedgone.|Andit'sthedeletionofthesetuplesfromapplythatcausesthetuplestobedeletedfromtheviewandthatwasthedeletiononapplywasbecauseweinstalledthistriggerthatinterceptedthedeletionontheviewandTranslatedtothedeletionsonthebasetables.|Sothatworkedoutprettywellnowsupposethatwewanttoenableupdatecommandsonourview.|Let'ssaywewanttochangeThisstudent345'sacceptancetoComputer ScienceatCornelltobeanacceptancetoComputer ScienceatCarnegieMelonUniversityinstead.|Sohere'stheupdatecommandwerunit'sverysimplewefindstudentID345andwechangethecollegenametoCMUandwe'reupdatingtheviewComputer Scienceaccept.|OfcoursewhenwerunthisweagainanerrorbecauseSQLitewon'tallowustoperformanupdatecommandonaviewexceptifwehaveaspecialinsteadoftriggerthatinterceptsthatcommandandtranslatesit.|So,that'swhatwe'lldonextiscreateatrigger.|So,here'sthetrigger,butwhatI'mgoingtodemonstratewiththistriggeristhatnothingisforcingthetriggerwritertoactuallydotherightthingwhenamodificationistranslatedtothebasetables.|So,wearegoingtointerceptupdatestotheComputer Scienceacceptview.|andinfact,youmightrememberfromtriggersthatwecanbeevenmorespecificwithupdatetriggersandsaywhichcolumnisupdated.|So,thisparticulartriggerisonlygoingtoupdate,isonlygoingtointerceptcommandsthataretryingtoupdatethecollegenamecolumnoftheComputer Scienceacceptview.|Andthen,it'sgoingtotranslatethemtoupdatetheapplytable.|Now,whatwehavewhenthistriggerisrun,andagainit'srunonceforeachrovingupdated,iswehaveoldandnewthatareboundtotheoldvalueoftheupdatedviewtupleandthenewvalueoftheupdatedviewtuple.|Andonlythecollegenamewillhavechangedinthiscase.|So,we'regoingtoupdatetheapplytherelation.|Wearegoingtosetcollegenametobethenewcollegenameandthat'sgoingtobeforthetuplewherewehavetheoldstudentIDandtheoldcollegenamethatfindsthetupletoupdatehoweverwhoeverwrotethisgotalittlewackoinsteadofwritingtheconditionthatit'sapplicationstoComputer Sciencewherethedecisionisyes,they'vemadeitapplicationstoEEwherethedecisionisno.|But,nothingpreventsusfromwritingthistriggerwhichperformsthisincorrecttranslation.|So,nowthatthetriggerisinstalledwecanrunourupdatecommand,beforewedothatletsgolookagainandremindourselveswhatwehave,wehave345hasappliedtoCornellandwe'retryingtochangethattobeCarnegie-Mellon.|Andinourapplyrelationwehave345hasappliedtoCornellofComputer Scienceyesthat'swhy345isintheview.|345alsobythewayhasalsoappliedtoCornellofferEEandthedecisiononthatonewasno.|Sobacktoourupdatecommand.|Nowwe'llrunthecommandandnowthatwehaveourtriggerinstalled,thecommandsucceeds.|Andlet'sgoseewhat'shappenedtoourdatabase.|HereweareinComputer Scienceacceptandnothinghaschanged.|345hasstillappliedtoCornell.|WewantedittobeCMU,butwewrotethewrongtrigger,soitdidthewrongthing.|Andspecificallyifwegolookatapply,nowweseethatthisrecordhere,thisapplyrecordhasactuallybeenupdated.|So,ourtriggerwentinandmodifiedthatCornelltobeCMUbecauseitmatchedthemajorbeingEEandthedecisionbeingno.|SoagainwhatI'memphasizinghereisthatitisimportanttowritethecorrecttranslationandnothinginthesystemischeckingthatthatisthecorrecttranslation.|Ofcourse,thecorrecttranslationwouldbeifwewroteComputer Sciencehereanddecisionequalsyes.|Thatwouldbethecorrect....oops,decisionequalsyes.|Herewouldbethecorrecttriggerthatwe'dliketoinstalltomanageupdatesonthecollegenameoftheComputer Scienceacceptview.|SofarwehavebeenlookingattheComputer Scienceacceptviewandwe'velookedatdeletionsandupdates.|Nowwearegoingtolookatinsertionsandwe'lllookatasomewhatdifferentview.|ThisisaviewoftheIDs,collegenamesandmajorsofstudentswhohaveappliedtomajorineitherComputer ScienceorEE.|Nowlet'stakealookattheContentsofourviewinCSEEandweseethatwehavequiteanumberofstudentswhohaveappliedtomajorinEEorComputer Scienceandthecollegestowhichthey'veapplied.|Nowlet'ssupposewewanttoinsertanewtuppleintothisview.|Sowewantstudent111tohaveappliedtoBerkeleyinComputer Science.|Werunthecommandandofcoursewe'regoingtogetanerrorbecausewehaven'tyetinstalledthetriggerthatinterceptsinsertionsintotheviewcalledCSEE.|Sohere'sthetriggerandthisone'sprettystraightforward.|Itsaysinsteadofinsertingontheview,andagainthesystemwillprovidetoustheuser'sintendedinsertionontheviewinthevariablecallednew,aspartofthetrigger,soinsteadofinsertingintotheview,we'llinsertintotheapplytablethestudentID,thecollegename,themajorandthenwe'llputinnullforthedecision.|Withthattriggerinstalledwecannowgobacktoandourinsertandperformitandlookatthecontentsofourview.|Sohere'sournewtupplethatwewantedinserttheviewand,again,thisisnotastarttable,thisisjustaresultofaqueryoverapplied,butit'sthereaswewantedittobe.|Andifwetakealookattheappliedtablewe'llseethat111wasinsertedwithBerkeleyComputer Scienceandanullvalueforthedecision.|Butnowlet'sseewherethingscangowrong.|Ourtriggerwasblissfullysimple,butwhatifweputherethat222isgoingtoapplytoBerkeleyinBiology.|AndwetrytoinsertthattupleintoourviewcalledCSEEthatissupposetobeComputer ScienceandEmajors.|Soletsgoaheadandrunthatinsertion.|Andeverythingwentfine;let'stakealookatourdata.|Well,here'sourviewandnothingchangedourattemptedinsertionapparentlydidn'thappen.|Well,hereisourinsertionweinsertedabiologymajor,sowhatinsomesensethat'sgoodwedon'twantourbiologymajortoshowupinourview.|Ontheotherhand,ourinsertiontriggerwasactivatedandifwegoaheadandlookatthedata,specificallytheapplyrelation,we'llseethatwedidgetatuppleinsertintoapply.|Thattupplejustdidn'tshowupinourviewbecauseitdidn'tsatisfythecondition.|Sopresumablywedon'twantuserstobeabletowritinsertioncommandsagainstaviewthataffecttheunderlyingdatabasebutdon'tgetreflectedintheviewbecausetheyshouldn'tbeintheviewinthefirstplace.|Soweneedtowriteabettertriggertohandleinsertionsintothisparticularview.|Sowearegoingtodropthetriggerthatwewroteandcreateanewone,andandthisoneisgoingtousethe"when"clauseoftriggers;it'sthefirsttimeweuseditinthisdemo,andit'sgoingtocheckthatthetupplethattheuserisattemptingtoinsertintotheviewhasamajorthat'sComputer Scienceorthat'sinEE.|Iftheattemptedinsertdoesn'thaveComputer ScienceorEEasamajorthenthetriggerwon'tdoanything.|Butifdoes,thenitwillinsertintoapply,thestudentID,nameandmajor.|Nowthatwe'vefixedupourtrigger,let'sgobacktoourinsertioncommand.|We'vealreadydonedamagewithstudent222.|Solet'strystudent333thistime.|Let'sattempttoinsertthestudentandthenlet'sseewhathappened.|Ifwegototheview,thatstudentisnotintheview,whichisagoodthingbecauseit'sabiologymajor.|Butmostimportantlywehopethatnothinghappenedtotheapplytableandjusttobesure,wehaverefreshed,andweseethatindeednothinggotinserted.|So,that'sthecasethatwewouldlike.|Imean,maybewe'dlikeanerrormessagetobegenerated,butcertainlyiftheuserattemptstoinsertintotheviewatuplethatdoesn'tbelongintheviewwouldn'tlikethedatabasetobealtered.|Now,let'ssupposeinsteadthatstudent333askstomajorinEE.|Nowwhenwerunthecommand,weshouldseeinourviewthatthestudenthasshownupandindeedtheyhave.|So,thatinsertionwasinterceptedandtheunderlyingmodificationwasmadetotheapplytablesothattheviewnowhasstudent333andifwegolookatapplywe'llseeagainthat333successfullywasinsertedtoapply.|So,nowinsertionsintoComputer ScienceEEaredoingtherightthing.|So,we'veseenexamplesoftriggerstointerceptnowupdatesandinsertionstoviewsanddotherightthingofmodifyingtheunderlyingbasetablessothattheviewgetsthedesiredmodification.|Thenextphaseofthevideoisjustgoingtoshowafewexamplesquicklywherewe'lldefineviewsthathaveambiguousmodificationsinfactwherewemightnotevenwanttoallowuserstomodifythecontentsoftheviewatall,soourfirstviewdemonstratesthatwhenaviewincludesaggregation,it'sprobablynotsensibletoallowuserstomodifyit.|Thisviewfindsforeachhighschoolsize,theaverageGPAofhighschoolstudentswhowenttoahighschoolofthatsize.|Sowe'llcreatetheview.|We'llgoandtakealookandlet'sseewhatitcontains.|Soherearethecontentsofthatview.|IthasthedifferentsizedhighschoolsrepresentedinourdatabaseandtheaverageGPAofstudentswhowenttoahighschoolofthatsize.|Sodoesitmakesense.|forausertomodifythisview?|Imean,maybewouldauserwanttowriteacommandthatsaysupdatetheviewandsettheaverageGPAto3.6orthehighschoolsizeas200?|Sogoingbackandlookinghere,wewannachangethisaverageofGPA3.6.|HowwouldwehavearuleformodifyingtheunderlyingdatatochangetheaverageGPA?|Itreallyisn'tverysensibleandmakinginsertionsanddeletionstothisview,wellmaybewetranslatedeletionstotranslate,todeleteeverystudentwhowenttoahighschoolofthatsize,butthat'sprobablynotwhatwewant.|Sofundamentally,whenaviewincludesaggregation,itusuallydoesnotmakesensetoallowuserstoperformmodificationsonthatview.|Aggregationviewsaremostusefuljustforrunningqueries.|Here'sanevensimplerviewwherewemaynotwanttomakemodifications.|Thisviewjustlistsallthemajorsthatarerepresentedinourapplyrelation.|Sowe'llcreatetheviewandtakealookatitandweseethatwehavesevendifferentmajorsinourrelation.|NowwoulditmakesenseforausertosayIwanttoaddanewmajortothatviewsoI'dliketohavestudentswhohaveappliedtothechemistrymajor?|Wellcertainlylookingattheviewitwillbenobigdealtoputchemistryinhere,butwouldbetheunderlyingchangetothedatabase?|What,who,youknow,whowouldbethestudentthat'sapplytothatmajorandatwhatcollege?|Sointhiscasewhatmakesitnotverysensibletoupdatethisview,ismostlythatwe'rejusttakingonecolumnoutofourtableandalsothatwe'reeliminatingduplicatesfromthatcolumn,sotothinkhowtotranslatethistotheunderlyingbasedata,we'dhavetoaddalotofofnewvaluesforcolumnsjustbeginwithandmaybetherewouldbemultipletuplescontributingtoanewtupleintheapplyrelation.|Again,youknow,wemightallowdeletions,wecouldpotentiallysayifdeleteamajorthenwedeleteeveryapplicationtothemajor.|Butthat'snotbewhat'sintendedbycreatingtheview.|Sowhenwehaveprojectionsontofewcolumnsorwehavethedistinctkeyword.|That'sanotherexamplewherewemaynotwanttoallowuserstoperformmodificationstotheview.|Andhere'sourthirdlastexamplealongtheselines,thisone'sactuallythemostcomplicatedone.|Theviewthatwe'recreatingnowcalledthenon-uniqueisgoingtogiveusallstudenttupleswherethere'ssomeotherstudentwhohadthesameGPAandthesamehighschoolandit'sadifferentstudent.|SoyoumaywanttorefreshyourStructured Query Languagetoremindyourselfhowthisworks.|Let'sgoaheadandcreatetheviewandtakealookatwhat'sinit.|HerewefindthattherearethreestudentswhoweresomeotherstudenthasthesameGPAandsizehighschool.|Infact,allthreehavethesameGPAandsizehighschoolwhichisnotsurprisinginoursmalldataset.|Solet'ssupposetheuserdecidestheydon'twantAmyinthisview.|Sotheytrytowriterunthecommanddeletefromthenon-uniqueviewwherethestudentnameisAmy.|SowhatdeletionsshouldbeperformedorwhatmodificationshouldbeperformedtotheunderlyingdatainordertogetAmyoutoftheview?|WellofcoursewecoulddeleteAmyherselfandthatmightbethemostsensible.|ButifwedeletedDorishereandtheotherAmy-IforgottopointoutthesearetwodifferentAmy's,thisone's654-ifwedeletedDoloresandtheotherAmy,thenthisAmywouldbedeletedfromtheviewtoo.|Sothere'ssomethingalittlesubtlegoingononthisparticularexample.|Weareaskingtodeletefromaviewthatjustselectsfromstudents,soyoumightthinkthereisaone-to-onemappingsolet'sjustdeletethestudentsthatwereaskingtohavetakenoutoftheview.|Butbecausethesubqueryreferencesthesamerelationastheouterquery,theleadingtupplereferenceintheouterqueryalsoaffectstheresultsubquerywhichcanfeedbackintowhat'sintheouterquery.|So,it'sthisinteractionbetweenthetworeferencesofthetablethatmakesitprettytrickytofigureouthowamodificationtotheviewshouldbemappedtothemodificationtothebasetable.|Sowe'veseenthreeexamplesofwhereitdoesn'tmakealotofsincetoallowuserstowritemodificationscommandsagainsttheview.|Andthosearebasedonconstructsintheviewdefinition.|Andactuallywe'regonnaseethosesameconstructspopupwhenwetalkaboutwhattheStructured Query LanguagestandardssaysaboutviewsthatareallowedtobemodifiedbutIdowanttoremindyouthatinthisvideowe'retalkingaboutwritingtriggersthatenablemodificationstoviews.|AndsoreallyforalltheviewsthatIshowedyouwecouldchoosetowritetriggersthatinterceptthemodificationsandperform.|somemodificationsonthebasetable,butprobablythattranslationwouldnotmakealotofsense,andthat'sthepointI'mtryingtomake.|Notthatyoucan'tdoitwhenyouhavethepowerofwritinginsteadoftriggers,butyouprobablydon'twanttodoitbecauseitprobablydoesn'tmakesenseintheapplication.|Nowlet'sreturntoviewsthatwedowanttoallowittobemodifiableandsowe'regoingtoenablethatthroughinsteadoftriggers,andthenextexampleismorecomplexbecauseitinvolvesajoinoftwotables.|ThisviewiscalledBerkanditreturnsstudentID'sandmajorswherethestudenthasappliedforthatmajoratBerkeley.|We'llcreatetheview,we'lltakealookatitscontentsandwe'llseethatwehavetwostudentswhohaveappliedtoBerkeley,onetomajorinBiologyandonetomajorinComputerScience.|Someofourstudentshavegottendeletedfromourdatabasealongthewaythroughourexamples,bytheway.|Solet'ssaythatwewanttoenableinsertionsintothisview.|Sowewanttobeabletoinsertapairthat'sastudentIDandamajorandtheninsertintoourunderlyingtablesinsomefashionsothatthattupleisnowintheviewSowhatwe'regoingtodoisassumethatwhensomeonewantstoinsertintothisview,theyareinsertingforanexistingstudent.|I'mgoingtoactuallycheckthat'sthecase.|Soifwehaveanexistingstudentandwe'reinsertingintotheviewthenallweneedtodoisaddatupletotheapplyrelationthatsaysthattheyareapplyingtoBerkeleyforthemajorthat'sspecifiedintheinsertionwe'veaskedforontheview.|Sowewillwritethatasatrigger.|Sohereisatrigger...itsaysinsteadofinsertingontheBerkrelation,foreachrow,againwe'llgetoneinstanceofthetriggerforeachinsertedrow.|We'llcheckfirstofallthatthestudentIDoftheinsertedtuple,andagainnewisboundtotheinsertedtuple,thestudent,thetuple,theuserwantstoinsertintoviewBerk.|We'llcheckthatthatstudentdoesexistinthestudentrelation.|Iftheydon'texistinthestudentrelationwe'rejustnotgoingtodoanythingwiththerequestedinsert.|IftheyalreadyexistinthestudentrelationthenwecaninsertintoapplythestudentID,Berkeleybecauseweknowthisistheviewforstudentswhoappliedto,forapplicationstoBerkeley,themajorthey'reapplyingfor,andnullforthedecision.|Soinsteadofdemonstratingjustasingletuplebeinginserted,I'mgoingtodosomethingalittlemorecomplicatedandasktoinsertawholebunchoftuplesintoBerk,andwe'regoingtoseethateachofthosetuplesisgoingtoresultinaninsertionintotheapplytableunderneathandofcourse,thedesiredinsertionintotheview.|SothewaythatI'mgoingtogenerateabatchoftuplestobeinsertedisintotheviewistorunasubquery.|Andasubquery'sgonnatakeallstudentID'sthatarenotintheapplytableforBerkeley,sostudentswhohavenotyetappliedtoBerkeleyandwe'regoingtoforeachoneaskthatweinsertintotheviewthatstudentandapsychologymajorapplicationtoBerkeley.|SoletsfirsttakealookatourapplytabletoseewhoisgoingtobeapplyingtoBerkeleyforpsychology.|So,wehavetwo,three,fourwhohasappliedtoBerkeleyalreadyandnine,eight,seven,andtheirinourview.|Bythewayifyourwonderingwhythesethreestudentsdownheredidn'tappearinourview,it'sbecausethesewereinsertedasanartifactofourdemoandweneverinsertedmatchingstudenttuples.|Sothesearen'tgoingtoparticipateinthejoint.|Sowejusthavetwostudentsinourjoint.|Alltherestofthestudentsherewhohaven'tappliedtoBerkeleyarenowgoingtoapplytoBerkeleyinpsychologyasaresultofusrunningthatinsertcommandthat'sgonnabeinterceptedbyourtrigger.|Sohere'sthetrigger,here'stheinsertcommand,letsgoaheadandruntheinsertandnowlet'stakealookandseewhathappened.|WegotoBerkeleyandwedoseeindeedawholebunchofpsychologymajorsnowinourviewandofcoursethat'sbecauseweshouldhaveawholebunchofpsychologymajorsnowinourapplyrelation,andheretheyare.|Sobacktoourview,whatifwenowwanttoenableuserstodeletefromtheview.|We'regoingtoagainassumethattheintentionisnottodeletethestudent,thestudentIDtableisgonnastaystable.|Andwhatwe'regoingtodoiswe'regonnadeletethecorrespondingapplications.|Sohere'sthetriggertodothatit'sactivatedbydeletionsontheBERKviewandthesystemagainwillbindinthedesireddeletedtupplesfromtheviewtothereservedvariableold.|Sotheactionthetriggerwilldeletefromapplywherethestudentidmatchestheonetobedeleted,thecollegenameisBerkeleybecausethat'swhatwe'relookingforthatdoesn'tcomefromthedeletedtuplethat'snotpresentintheviewbutweknowthat'saconditionfromtheviewdefinition,andthemajorhastomatchthedesireddeletedmajor.|Sowe'llasktodeletefromBerkeleyalltherecordswerethemajorisComputer Science.|Soletsgoaheadfirstandtakealookattheviewandweseethatwehavejustone,sowe'llexpectthistupletobedeletedfromtheview.|Butthat'sgoingtohappenbecausewearegoingtodeletethecorrespondingapplyrecordunderneath.|Sowegoaheadandexecutethedeletion.|We'lltakealookfirstattheview.|MakesurethatComputer Scienceisgoneanditisandthenwe'llgolookatitinapply.|WeforgottolookatitinfirstplacebutIthinkitwasstudent987.|Andnow987hasnolongerappliedtoBerkeley.|Andfinallylet'senableupdatestoourBerkviewupdatethestudentID.|Butwe'llallowupdatestothemajor.|Sowe'llhaveastudentthatappliedtoBerkeleyinsay,psychology,decidetheywanttomajoronsomethingelse.|Sohere'sthetrigger.|AndthisoneisgoingtointerceptupdatestothemajoronBerkeley,soitwon'tinterceptupdatestothestudentID.|Andagainnowwe'llhavetheoldandnewvaluesboundtotheoldandnewimaginarytupplesofBerk.|It'sgoingtoupdatetheapplyrelation.|It'sgoingtofindtherecordwherewehavethestudentIDandourupdate.|Thiscouldbeoldstudentidornewstudentidsinceit'svalueisn'tchanging.|SowefindthestudentidwecareabouttheirapplicationtoBerkeleyfortheoldmajorandwe'llchangethattobeapplyingtothenewmajor.|Solet'stakeallthosepsychologymajorsandlet'sturnthemintophysicsmajors.|Sowiththisoneupdatecommandwe'llbeaskingtoupdatemostofthetupplesintheBerkview,eachtuppleoneatatimewillbeinterceptedbyourtriggeranditwillmodifytheapplytableforthecorrespondingrecordandturnthepsychologymajorintophysics.|We'llrunthecommand.|andwe'lltakealookatwhathappened.|Here'sourviewandweseeindeedthatallthePsychologymajorshaveturnedintoPhysicsmajors.|Andofcourse,that'saresultofthemodificationstotheunderlinedtableapplywhereagainwe'veseenallthepsychologyischangedtophysics.|NowbacktoourviewIsaidweweren'tgoingtoallowmodificationstothestudentIDandthetriggerthatwewroteonlyinterceptedmodificationstothemajor.|Solet'sseewhathappensifwetrytomodifythestudentID.|Here'sacommandthattriestoset321to123inourBerkview.|Andifwerunthequery,thenwedogetanerrorbecausewedidn'timplementanytranslationformodificationstothatcolumn.|Thelastportionofourdemonstrationisgoingtodemonstratetheinteractionofviewmodificationsandconstraints.|SoI'mgoingtodropmyapplytablecreateanewversionofitwhereweaddtothedecisioncolumnaconstraintthatthecolumnisnotallowedtobenull.|NowletmeremindyouofaviewwecreatedalongtimeagocalledCSEEthattookthestudent'scollegesandmajorswherethestudenthadappliedtomajorinComputer ScienceorEE.|Andletslookspecificallyatthetriggerthatwecreatedtohandleinsertionsintothisview.|Soyoumightremember,oryoumightnot,thatwefirstcreatedanincorrecttrigger.|Buthereistheonethatwehaveactivated.|Andtheimportantthingtonoticeisthatitinterceptsinsertionsintotheview,andthenitinsertsintoapplyatuplethatcontainsthestudentID,thecollegenameandthemajor,andthenputsnullforthedecision.|Andthisiswhereourtroublesaregoingtooccurbecausewe'venowcreatedaversionofapplythatdoesn'tallownullforadecision.|Solet'stryinsertingintoourCSEEview.|ThevalueisonetothreeBerkeleyinComputer Scienceandthatwilltranslatetoaninsertiontoapplyofthesamevaluesandnullforadecision.|Weruntheinsertionandwegettheconstraintviolation.|Sowhathappenedistheinsertionintotheviewwasinterceptedbythetrigger,translatedtoaninsertiontoapplybutthatinsertiongeneratedaviolationagainstourNOTNULLconstraintonthedecisioncolumn.|Soit'sdoingtherightthing,butwe'llneverbeabletoinsertintotheCSEEviewnow,becausewe'realwaysgoingtoattempttoinsertmorevalues.|Soifwewanttohavethatnotlowconstraintontheapplyrelation,we'llhavetomodifymodifyourtranslationforCSEEsoitdoesn'tgeneratethenullvalues.|Andhereisasecondexamplealongthesamelines.|We'regoingtodropapplyagainandcreateanewversionofapply.|Thistimewe'regoingallownullvaluesanddecisions.|Sowe'vetakenawaythatnullconstraintbutwe'veaddedakeyconstrainttoapplysayingthatthecombinationofstudentID,collegename,andmajormustbeunique.|Soastudentcan'tapplytwicetothesamecollegeforthesamemajor.|So,becausewe'vecreatedanewapplyrelationit'sstartingoutempty.|But,let'sinsertsometuplesbutwe'regoingtoinsertintotheapplyrelationviatheCSEEviewanditstrigger.|Sowe'llinsertstudent123applyingtoBerkeleyforComputer ScienceandBerkeleyforEE.|Andagainwe'reinsertingtheseintotheview.|We'llrunthat.|We'lltakealookatourviewandwe'llseethat,whereisit,herewego,CSEEhasthosetwotuplesthatweinserted.|Ofcoursethoseareinterceptedbythetriggerandcreatedinsertionsintoapply.|Andhere'stheapplyrelationwhichlooksexactlythesamebutwithadecisionasnull.|Now,whatwe'regoingtodonextisactuallyinsertintooneofourotherviews.|Idon'tknowifyouremembertheBerkeleyviewbutthatwastheIDsandmajorsofstudentswhohadappliedtoBerkeleyandlet'sgotakealookatwhathappenswhenwetrytoinsertintotheBerkeleyview.|Here'sthetriggerthatwewrotetohandleinsertionsintoBerkeley.|Whenthestudentthatwe'retryingtoinsertdoesexist,thenwe'llinsertarecordintoapplyhavingthatstudentapplytoBerkeleyforthemajorthat'sspecifiedintheinsertionandanulldecision,whichagainisfinenowbecauseweremovedthatnonnullconstraint.|So,we'regoingtotrytoinsertintoBerkeleyStudent123majoringinEEandwe'regoingtoseethat'sactuallygoingtoviolateourkeyconstraint.|So,let'sgoaheadandwegetanon-uniqueconstraintbecausethatattemptedtoinsertintotheapplytable.|Let'sgolookatthattableandattemptedtoinsertintoapply123BerkeleyEE,andthatwouldhaveviolatedtheconstraintthatwecanonlyhaveonetupleforastudentidcard.|Collegenameandmajorcombination.|So,again,ourattempttoinsertintotheviewwastranslated,that'stheearlierinsert.|Sorry,ourattempttoinsertintotheBerkeleyviewwastranslatedintoaninsertiontoapplythatviolatedtheconstraint.|Andasagrandfinale,let'stryanupdateonourBerkview.|So,let'ssupposethatwewantstudentone,two,threetomajorinComputer ScienceinbothapplicationstoBerkeleyandthatwillgenerateanupdatetotheunderlyingapplytable,thatshouldviolateourconstraint.|Justasareminder,let'stakealookatwhathappenswhenwetrytorunanupdatecommandonthemajoroftheBerkview.|Here'sourtriggerthatwewroteawhileago.|ItinterceptsupdatestoBerkandittranslatesthemtoupdatetheapplyrelation,findtheappropriaterecordwhereit'sanapplicationtoBerkeleymatchingtheoldmajorandthestudentIDanditchangesittothenewmajor.|So,we'regoingtotrytoupdateaBERK.|We'regoingtrytoset,let'sfindithere,we'regoingtotrysetthemajorequalsComputer ScienceforstudentID123.|So,ifwetakealookatwhatisgoingtotrytotheapplyrelation.|It'sgoingtotrytosetthesemajorsbothtoComputer Scienceandthatwillgiveus,again,akeyconstraintviolation.|Solet'sgoaheadandtrytorunthecommandagainstBurk,it'lltranslatetoanupdateonapplyandthatupdatewon'tbeallowed.|SothatcompletesourdemonstrationofenablingviewmodificationsusingtriggerssothisdemonstrationwasallrunontheSQLitesystem.|TheSQLiteSystemdoesnotallowanymodificationscommandsonviewsdirectly,sowesaweverytimewetriedthat,wegotanerror.|AndtheonlywaythatausercanrunmodificationsoverviewsisifwehaveinplacethespecialINSTEADOFtriggersthatinterceptthemodificationsthatareattemptedontheviewsandtranslatesthosetomodificationsonthebasetable.|Now,thesystem,whenitdoesprocessthetriggers,generatesforthemodificationontheviewswhatthedatawouldbeintermstobindingthosemodificationtotheoldandnewvariablesthatareavailableintriggers.|Buttherestoftheprocessisuptotheusertowritetheactionsthatwilltakeplacewhentheuserattemptstodoamodificationonaviewandaswesawtherearenochecksinplacetomakesuretheuserwritescorrectmodificationsthatresultinviewupdates.|However,whentheuserdoesthingscorrectlyitcanallworkinaverypowerfulandcorrectfashion.|Thisvideowillbeademoofautomaticviewmodifications.|Asareminder,whenwe'vedefinedaviewcalledV,we'dliketoissuemodificationcommandsagainstVasifitwereanytable.|SinceVisjustalogicalconceptandnotastoredtable,themodificationshavetoberewrittentomodifythebasetablesoverwhichVisdefined.|Wesawinanearliervideothatunlikequeriesoverviews,modificationsoverviewscannotbeautomatedinthegeneralcase.|We'vediscussedthattherearetwodifferentstrategiestodealingwithmodificationstoviewsandspecificallyhowthey'rerewrittentomodifybasetables.|Oneistohavetherewritingprocessspecifiedexplicitlywhenaviewiscreated.|Theotherpossibilityistorestricttheallowedviewdefinitionsandmodificationsoverthoseviewssothatthetranslationcanbeautomatic.|Thesecondstrategyisthetopicofthisvideo.|Now,intheStructured Query Languagestandard,thereisadefinitionforrestrictionstoviewsandmodificationsforwhatareknownasupdatableviews.|Therestrictionsareonthedefinitionsandtheyapplytoinserts,deletesandupdatesalltogether.|WhatImeanbythatisthataviewiseitherupdatableorit'snot.|TheStructured Query Languagestandardspecifiesfourrestrictions.|ThefirstonesaysthattheviewmustbedefinedasaselectstatementonasingletableT.Thatmeansitcannotbeajoiningview.|Secondofall,whentheirattributesfromTthatarenotintheview,inotherwords,they'reattributesthatdon'tappearintheselectclauseoftheview,thoseattributesofthetableTmustbeallowedtobenullortheymusthaveadefaultvaluedefinedforthem.|Third,subqueriesintheviewmustnotrefertothetableTbutsubqueriesareallowedtorefertoothertablesandfinallytheviewisnotallowedtohavegroupbyoraggregation.|Inourdemo,weuseourstandardsimplecollegeadmissionsdatabasewithacollegetable,studenttableandapplytable.|Wehave,asusual,ourfourcolleges,ourbunchofstudents,andourstudentsapplyingtocollegesforaparticularmajor.|IwantedtomentionthatthisdemoisbeingrunintheMySQLsystem.|MySQLamongthethreesystemswe'reusingistheonlyonethatallowsautomaticviewmodifications.|SQLiteandpostgresbothsupportviewmodificationsthroughtriggersorrulesaswesawinourothervideo.|Theviewsinthisdemomaylookfamiliartherearemoreofthesameviewsthatweusedintheoriginalvideoondefiningandusingviews.|Forexample,ourfirstviewistheComputer ScienceAcceptviewthatfindsstudentsIDsandcollegenameswherethestudenthasappliedtomajorinComputer Scienceatthatcollegeandthedecisionwasyes.|We'llgoaheadandcreatetheviewandthentakealookatthecontentsoftheview,andweseethatwehaveafewstudentshere.|Nowlet'ssaywewanttodeletestudentID123fromtheview.|Sowewoulddeletethefirsttwotuplesoftheview.|Sohere'sthecommandthatsaysthedeletefromtheviewwherethestudentIDis123.|BecauseourviewdefinitionsatisfiestherequirementsforanupdatableviewintheMySQLsystem,wecansimplyrunthecommand,andthesystemwilltakecareofmodifyingtheunderlyingbasetablesothatwegettheeffectofthisdeletion.|Soletsgotakealookatourview.|And,we'llseethat123areindeedgoneandifwelookatourapplytable,weseethattupleswhere123hasappliedtoComputer Sciencearedeletedaswell.|Sothesystemautomaticallytranslatedthedeletecommandovertheviewintodeletecommandsonthebasetablewiththepropereffect.|Atthispoint,letmementionthatMySQLisactuallyalittlebinary digitmoregenerousabouttheviewsandmodificationsthatitallowsthantheStructured Query LanguageStandardrequiresandwe'llseesomeexampleslaterthatmakethatveryclear.|Nowlet'stakealookatinsertionsintoviews.|We'llcreateourviewcalledCSEEthatcontainstheID,collegenameandmajorofstudentswhohaveappliedinmajorineitherComputer ScienceorEE.|We'llcreatetheview,takeaquicklookatitandwe'llseethatwehavequiteafewstudents.|Nowlet'ssupposethatwewanttoinsertastudentintoCSEE.|ThestudentwithID111applyingtoBerkeleyforaComputer Science.|Sowe'llgoaheadandexecutethecommandandagainbecausewehaveautomaticviewtranslation,thesystemwilltranslatethatintoanappropriateunderlyinginsertionintoabasetable.|Let'sfirsttakealookattheviewandwe'llseethatwehaveindeed111BerkeleyComputer Scienceandthenwecantakealookattheapplytable,andwewillseethatthesystemapplyinsertedthecorrespondingtupleintoapplywithanullvalue.|Ofcourseletmeremindyounoinsertionshappeningtotheview.|Theviewisreallyjustalogicalconcept.|Sowhenwetakealookatthecontentsview,we'reactuallyrunningaqueryovertheapplytable.|We,bytheway,beingthesystem.|Ittakescareofthatforus.|Nowlet'sseeacoupleofexampleswherethingsseemtogowrongbutdon'tworrywe'llseeafixtothemafterward.|Let'ssupposethatwewanttoinsertintoourCSEEviewnotAACSorEEmajor,butapsychologymajor.|Sowe'llinsertstudent222toapplytoBerkeleyinpsychology.|We'llruntheinsertionanditseemstohaveworkedfine,solet'sseewhathappens.|WellwelookatCSEEandobviouslythestudentisnottherebecausethey'remajoringinpsychology.|Ifwetakealookattheapplyrelation,we'llseethattherewasinfactaninsertion.|Sothisdoesn'tlookgoodbecausewedon'twantthesystemtoautomaticallybeinsertingdataintothebasetablesthatisn'tappearingintheviewandwhatwewantedwasaninsertionintotheview.|Let'sseeasecondexampleofthisform.|We'llgobacktoouracceptviewwhichisstudentsandcollegeswherethestudentappliedtoaComputer Scienceandthedecisionwasyes.|Andasareminderhere'swhatwehave.|Afewtuplesofthestudentidandthecollegename.|Solet'ssaywewantedtoinsertintoComputer Scienceacceptthevalue333Berkeley.|So,wewouldwantthattupleinComputer ScienceAcceptbasedonthedefinitionofComputer ScienceAccept.|WeoughttoknowthatwecouldactuallyinsertintotheapplyrelationthetwovaluesthatwerespecifiedherealongwithComputer Scienceandyesbecausethisistheonlytwomissingvaluesintheapplyrelation.|Let'sgoaheadandexecutetheinsertionandseewhathappened.|Wegotoourviewmanager,welookatComputer Scienceaccept,there'snosignof333,butlet'stakealookatapplyandweseethatthesystemactuallydidapply,didinsert333Berkeleyintotheapplyrelation,that'sthetranslation,butitwasn'tsmartenoughtoputComputer Scienceandyesinhere,soagain,wehaveakindofdisappearinginsertion.|Notreallywhatwewanttohappenwhenwetrytoinsertintotheview.|So,Imentionedthatwedohaveafixforthat.|Wecanaddtoourviewdefinitionssomethingcalledwithcheckoption.|Andlet'scallthisComputer ScienceAcceptTwo.|Whenweaddwithcheckoption,whenthesystemautomaticallypreformsatranslation;itactuallycheckstomakesurethatthetranslationproperlyinsertedthedataintotheview.|Solet'sgoaheadandcreatethisviewandthenlet'sperformourinsertionagain.|Solet'stryinsertingatupleintoComputer ScienceAcceptTwotheversionoftheviewwiththecheckoptionandwegetanerrorbecausethesystemwilldetectthatthetranslatedinsertionintotheapplyrelationwouldnotproduceatuplethatappearsintheview.|WecansimilarlycreateacorrectedversionofourCSEEview,whereweaddthecheckoption.|We'llcallititCSEE2.|Nowlet'strytwoinsertsintoCSEE2,onewherethestudentismajoringinpsychology,andthatshouldgenerateanerrorandonewherethestudentismajoringinComputer Scienceandthatshouldbeanokayinsertion.|We'llgoaheadandexecutethereasweseewherethefirstonegeneratedanerrorandtheseconddidn't,sotogoaheadnowandtakealookatCSEE2andwe'llseethatstudent444isinthatviewandactuallythatstudentisalsogoingtobeintheCSEEviewbecausetheresultofthecorrectinsertionwastheinsertionofstudent444intotheapplytableunderneath.|Nowlet'stakealookatafewviewsthataren'tallowedtobemodified.|ThefirstonefindstheaverageGPAofstudentsbasedontheirhighschoolsize.|Solet'sgoaheadandcreatetheview.|We'lltakealookatit.|Andwe'llseethatitcontainsforeachhighschoolsize,theaverageGPAofstudentswhoattendedthishighschoolofthatsize.|Nowlet'ssupposethatwedecidewewanttodeletefromthatviewthetupleswherethehighschoolsizeislessthanfivehundred.|Wegoaheadandrunthatandweseethatit'snotupdatableaccordingtooursystem.|Andifyouthinkaboutit,itreallydoesn'tmakesensetotrytodeletetuplefromthisviewbecausewhatwouldyoudelete?|Isupposeyoucoulddeleteallthestudentswhowenttoahighschoolofthatsizebutthatdoesn'tseemtobewhattheuserwouldprobablybeintendingtohappen.|SimilarlywecouldtrytoinsertatupleintohighschoolGPAandagainwe'llgetanerrorandagainitjustdoesn'tmakesince.|HowwouldweinsertatuplewithanaverageGPA.|Whatstudentswouldweinsert?|Somefabricatedstudentsfromsmallhighschools?|Justagain,doesn'tmakealotofsensesothesystemdisallowsthoseupdates.|Sothepreviousexamplewasn'tupdatable,primarilyduetotheaggregation.|Here'sanotherexamplethatalsoisnotupdatable.|Herewe'retakingjustthemajorsfromtheapplyrelation,generatingalistofthem.|Solet'stakealookatwhattheviewwouldcontainandweseeit'sagain,alistofmajors.|Wehaveastudentherewithanullmajor.|Nowwoulditmakesensetoinsertordeletefromthisview?|Well,insertingcertainlynot.|We'dhavetofabricatethestudentwho'sapplyingtothatmajor.|Deletingcouldmakemoresenseifwewantedtodeletealltheapplytuplesforaparticularmajor,butprobablythat'snotwhattheuserintended.|Soifwetryto,forexample,addachemistrymajorwewouldgetanerror.|Andifwedecided,forexample,todeleteComputer Sciencemajorwe'dagaingetanerror.|Sothisviewisconsiderednon-updatablebytheunderlyingStructured Query Languagesystemandbythe,thisismyStructured Query Languagethatwe'rerunning,butalsobytheStructured Query Languagestandard.|Sooneoftheotherconditionswesawforaviewtobeupdate-ableisthatitdoesn'thaveauseoftheouterrelationalsoinasub-query.|AndsoI'vecreatedaviewherethatviolatesthatconstraint.|Thissayslet'sfindstudentswheresomeotherstudenthasthesameGPAandthesamehighschoolsizeandwe'llcallthatviewNon-Unique.|Sowe'vegotthestudentintheouterquery,thestudentintheinnerquery,we'llgoaheadandcreatetheview.|Wecantakealookattheview,andherewe'llseethatwehavethreestudentswheresomeotherstudenthasthesameGPAandhighschoolsize,andthey'reallthesameGPAandhighschoolsizeitturnsoutinoursmalldatabase,andlet'sthinkaboutit.|Woulditmakesensetobeabletomodifythisview.|Well,ifwewantedto,forexample,deletethetwoAmytuples,theunderlyingsystemcoulddeletetheAmysthatwouldactuallyhavetheeffectofdeletingDorisifyouthinkaboutit;ortheycoulddeletethefirstAmyandDorisandthatwoulddeletetheotherAmy.|Sothere'squiteafewunderlyingmodificationsthatcouldperformthemodificationwe'retryingtoperform(bytheway,here'sthatmodification).|So,ifwetrytorunthedeletecommandandittakestheAmy'soutoftheview.|Again,it'snotallowed,that'sbecausethere'snoobvioustranslation.|There'smanypossibletranslationsintheunderlyingbasetablesandagaintheStructured Query Languagestandarddisallowssubqueriesreferencingthesametableastheouterquerybecauseoftheambiguityofmodificationsonthistypeofview.|Nowthat'snottosaythatsubqueriesaren'tallowedatallinviewsthatcanbemodifiedandhere'sanexamplewherewehaveasubqueryandtheviewisallowedtobemodified.|Thisisaviewofalltheinformationaboutstudentswhenthestudenthasappliedsomewhereforamajorthat'slikethemajorthat'sabiologymajor,sowe'reusingaSQL-likepredicateheretomatchthemajor.|Solet'sgoaheadandcreatetheview.|We'lltakealookatitandwe'llseeherethatwehavethreestudentswhohaveappliedtosomebiology-typemajor.|Let'ssaythatwewantedtodeletethefirsttuplefromtheview,thetuplewiththestudentnameBob.|Sowewantedtorunthiscommandhere.|Ifwetakealookattheviewdefinition,wecanseethatwhatwouldmakesensehere,becauseweareselectingstudents,istoactuallydeletethestudenttupleforBob,andthatiswhatthesystemwilldo.|Therewouldbeotherpossibilities,likedeletingtheapplytuple,sothereisambiguityhere,butthedecisionintheMySQLsystemandintheStructured Query Languagestandardisthatifyouhaveanouterquerythat'sreferencingasingletable,whichisarequirementintheStructured Query Languagestandard,thenadeletionfromtheviewisgoingtoresultinadeletionfromthatonetable.|Sowe'llgoaheadandwe'llrunthedelete.|Weseethatithappened.|We'lltakealookatBIO,we'llseethatthefirsttupleisgone,butwhat'smostimportantistotakealookatthestudenttable,andwe'llseethatBobisgonefromthestudenttable.|NowitisthefactthatBob'sapplytuppleactuallyisstillpresent.|BobwasID234,applyingtoBerkeleyinbiology.|Ifwehavesetupourdatabaseproperlywe'dprobablyhaveareferentialandintegrityconstraintfromapplytostudent.|Andthenthedeletiontostudentwouldhaveeithergeneratedanerrororgeneratedacascadeddelete.|Butwedidn'tsetupthosereferentialintegrityconstraintsinthisdemosoonlythestudenttupleforBobwasdeletedasaresultoftheviewmodificationcommand.|Nowcomingbacktoourbioview.|Whatifwedecidedweactuallywantedtoperfromaninsertionintotheview.|Let'stakealookatwhatwehaveandlet'ssupposewewanttoinsertanotherstudentwhoisapplyingtobiologybutremembertheviewisdefinedoverthe,herewego,I'msorry,overthestudenttable.|Sothatwillresultinaninsertionintothestudenttablejustlikethedeletionresultedinadeletionfromthestudenttable.|Solet'ssaywewanttoinsertanewstudent,Karen.|Here'sherinformation.|Andwewanttoinsertherintothebioview.|Solet'sgoaheadandrunthecommand.|Anditseemstohavebeensuccessful.|But,let'stakealookattheviewandthereisnosignofKaren.|Well,whyistherenosign?|Becauseallitdidwasinsertatupleintothestudenttable.|Herewego,that'sthebasictranslationandthere'snotuplesforKarenintheapplytable.|Wecertainlydidn'tfabricatesomeapplicationtosomemajorthatmatchesbiology,sothisisagainanexamplewherewecanhavetheunderlyingmodificationnotproduceatupleintheview.|But,itwilleffecttheactualdatabase.|Soagainwecanusethatcheckoptiontomakesurethatdoesn'thappen.|We'llcreateanewviewcalledBioTwoandthisonehasthecheckoption.|Let'sgoahead.|Andnowlet'sseewhathappenswhenwetrytoinsertintobio2,sowe'llinsertanothertupleandthistimewegetafailurebecausethiscan'ttranslateautomaticallyintoaninsertionthatwouldactuallyhavetheeffectthatwewantontheview.|Sowesawthatwecoulddeletefromtheviewwithnoproblem,butwecan'tinsertintotheview.|So,youmightwonderwhydon'twealwaysincludethewithcheckoptionwhenwecreateviews.|Andcertainly,Iwouldsaythat'saprettygoodidea,butitwillhaveaneffectonefficiency.|So,ifonecanguaranteethatalloftheupdatesthataremadetotheviewaregoingtohavethedesiredeffectwhentheyaretranslated,thenthecheckoptioncanbeleftout,butifthere'sanyquestionit'sagoodideatoincludeit.|Sonowlet'stakealookataviewthatinvolvesajoin.|ThisviewgathersinformationaboutstudentswhohaveappliedtoStanford.|Wecanalsoseethatintheviewdefinition,we'regivingnamestoattributesintheview.|Ifwedon'tspecifythesenamesexplicitlyasinallofourpreviousexamples,itjusttakesthenamesfromtheschemaoftheselectstatementdefiningtheview.|Now,thatactuallywouldn'tbeallowedinthiscasebecausewehavetwoattributescalledSID.|Sowhatwe'regoingtodois,we'regoingtocallthestudentIDthatcomesfromthestudentrelation,SID.|Theonethatcomesfromtheapplyrelation,we'llcallAID.|Thosearealwaysgoingtobeequalaswe'llsee,buttheyaregoingtohavesomeinterestingeffectswhenwemodifytheview.|Therewillbesomemeaningtohavingtwodifferentattributes,alsohavethestudentnamethatcomesfromthestudenttable,andthemajorthatcomesfromtheapplytable.|Let'sgoaheadandcreatetheviewandwe'lltakealookatit'scontents.|WecanseethatwehaveasetofstudentswhohaveappliedtoStanford.|Nowletstalkaboutburningmodificationcommandsagainstthisview.|LetssaythatwewantedtochangeourtwostudentswhohaveappliedtomajorinComputer Science.|TheyhavetheirnamesnotbeHelenandIrene,butbeComputer ScienceMajorinstead.|Ofcoursewewouldn'twanttodothat,butit'sgoodforillustrativepurposes.|Sohere'sthecommandandagainwe'reupdatingthroughtheviewsowe'resayingupdatetheSTANviewtosetthestudentnametobeComputer Sciencemajorifthey'veappliedtomajorinComputer Science.|We'llgoaheadandrunthat.|Andlet'stakealookatourview.|NowweseethatHelenandIrenearenolongera"HelenandIrene,"butthey'reratherbothcalled"Computer ScienceMajor."|Now,we'lltakealookatwhattheupdatetranslatedto.|So,we'llgotakealookatourstudentsandwe'llseethat,what,whoareHelenandIrenearenowchangedtoComputer Sciencemajor.|Sohowdidthesystemknowtotranslatethatmodificationtothestudenttable,giventhattheviewisdefinedovertwotables.|Well,we'reupdatingthestudentnameandthestudentnamecomesfromtheStudenttable,sothesystemwillbasicallymaptheattributesthatarebeingmodifiedtotheunderlyingtablewheretheattributecamefromandthenitwillperformthecorrespondingmodificationtothatunderlyingtable.|Nowthatapproachcanintroducesomeproblems.|Let'ssaythatwedecidewe'regoingtheupdatetheAIDattributeinourview.|IfweupdatetheAIDattribute,thesystemwilltranslatethatintoamodificationtotheApplyrelation,butthenwe'llseethatthetupleswillnolongerproperlyjoin.|Solet'sseethatthroughanexample.|Sohere'sourviewandlet'sdecidewe'lltakeourfirsttupleandwe'regoingtoupdateit'sAIDtonotbe123anymorebuttobe666.|Sohere'sthecommandthatdoesthat.|Wegoaheadandrunitandlet'sseewhathappened.|Inourview,werefreshandwefindthatthattupleisgone.|Wedidnotgetthe123updatedto666,andthat'sbecausedowninourApplytablewehavethatmodificationandwecanseeit'sthefirsttupletobemodifiedtobe666,butinourstudenttable,thatstudentisstill123,soit'sanotheroneoftheseexampleswhereastheunderlyingtableswereupdatedasaresultofaskingforanupdatetotheview,butwedidn'tgettheeffectontheviewwewanted.|Bynowyou'veprobablyfiguredoutwhatwe'regoingtodoisaddacheckoptiontoourviewtomakesurethatbadbehaviorcan'toccur.|So,hereisthesameviewwiththecheckoption.|We'llcallthisview,Stan2,andthenwe'lltrytodoasimilarupdatetoStan2thatwedidbefore,we'lltrytoupdateStan2tosettheAIDto777wegoaheadandrunthat,andasexpectedthecheckoptionfailsanditdoesn'tallowtheupdate.|Nowlet'sgobacktoouroriginalviewwithoutthecheckoptionandlet'sseeifwe'reallowedtoperforminsertionsintotheview.|Sofirstlet'sremindourselvesofthecontentsoftheview.|Here'swhatwehavenow.|AndI'mgoingtotryandinsertintothisviewatupleandI'mjustgoingtospecifythestudentIDandthename,andlet'sseewhathappens.|InStructured Query LanguagewhenIinsertatuple,ifIonlywanttospecifysomeoftheattributesIcanlistthemintheinsertioncommand,givevolumesforthoseandthenwewillputnullfortheothervalues.|SoletsseeifthesystemallowsustoinsertintoSTAN.|Well,itseemedto.|Andlet'sseewhathappened.|Here'sourSTANview.|Andwerefreshanditlookslikenothinghappened.|Let'slookunderneathatourapplytuple,andwedon'tseeany777shappeningthere.|Butifwetakealookatourstudenttuple,infact777Lancedidappear.|So,letstrysomethingsimilaronourviewthathasthecheckoption.|Sonowlet'stryinserting888Maryintotheviewwhenwehavethecheckoptionandweseethatitfailsinthatcase,whichwewouldnotwant,presumably.|ButwhatifwefirstinsertedintoapplyatupleforMaryapplyingtoStanfordandthenwetrytoinsertMaryintotheview?|Now,everythinglooksgood,andlet'sgotakealookattheviewfirst.|Here'sMaryandshewasproperlyinsertedintotheviewapplyingtoHistoryatStanford,andAndifwetakealookatstudent,Maryhasbeeninsertedthereaswell.|Andit'snoproblemhavingthenullvaluesherebecausetheyweren'tinvolvedinourviewsandthoseattributesareallowedtobenullintheunderlyingtables.|Nowlet'strysomethingsimilarwithNancy.|BeforewetrytoinsertNancyintoourview,andagainthisisSTAN2withthecheckoption,we'llinsertatupleforNancyintotheapplyrelation.|But,wearegoingtoinsertanapplicationtoMassachusetts Institute of Technology,nottoStanford.|Sohopefullywe'llgetthefirstinsertionbutthecheckoptionfailsbecausewhenwetrytoinsertNancyintothestudenttableasaresultoftheviewratherthanthesystemtriestoinsertNancy.|Nancywilljoinher,butnotapplyingtoStanford,onlyapplyingtoMassachusetts Institute of Technology.|Andthelastthingthatwe'lldoisattempttoperformadeletionfromtheStanfordview.|Let'ssaywewanttodeletethestudentwithID678.|Sothefirsttuplefromtheview.|Sohere'sourcommandandwhenwerunthecommand,weseethatwegetanerror.|Wecannotdeletefromthejoinview.|SotheMySQLsystemhasdecidednottoimplementdeletionsfromjoinedviews,andinthatcaseit'sbecauseagain,it'squiteambiguoushowthatwouldbetranslated.|AdeletionfromtheSTANviewcouldbeachievedbydeletingfromthestudenttableorfromtheappliedtableorfrombothandbecauseofthatambiguitythesystemdoesn'tallowit.|Whenwehadaviewthatwasdefinedoveronetableevenwithasubqueryitwassortofmoreclearthatadeletionfromtheviewshoulddeletefromthatouterreferencetable.|Thatcompletesourdemonstrationofautomaticviewmodification.|WesawthatintheMySQLsystemwhenwecreateviewsandaskedtowritemodificationcommandsontheviews,dependingonthetypeofviewandthetypeofmodification,thatmodificationmaybetranslatedautomaticallyintoamodificationontheunderlyingbasetables.|Now,ifwedon'tincludethecheckoption,sometimesthattranslationwillresultinmodificationstothebasetablesthatdon'thavethepropereffectofmodifyingtheview.|Ifweincludethecheckoption,thenthesystemwillguaranteethatthemodificationsitmakestothebasetablesdoresultinamodificationtotheview.|MySQLisalittlemoregenerousinwhatviewsitallowstobemodifiedoverwhattheStructured Query Languagestandardspecifies.|Forexample,MySQLdoesallowjoinedviewswithcertainmodifications.|Also,intheStructured Query Languagestandard,everyviewiseitherconsideredupdatableornot.|Ifaviewisupdatable,anyofthemodificationscanbeperformedonit,insertions,deletionsorupdates.|InMySQLsinceit'sabinary digitmoregenerousaboutwhatviewscanbemodified,it'salsoalittlebinary digitmorefine-grained.|So,wecanhaveviewsthathavecertaintypesofupdatesallowed,forexampleinsertionsandupdates,whileothertypesmightnotbeallowed,forexampledeletions.|thisvideocoversthetopicofmaterializedviews.|Asareminderthereasonthatweuseviewsindatabasesystemsistohidedatafromuserstomakesomequerieseasierormorenaturaltoexpress.|Andtomodularizeouraccesstothedatabase.|Andrealapplicationsdotendtouselots,andlots,andlotsofviews.|Sothoseviewsareforvirtualviews.|Virtualviewsarewhatwe'vebeentalkingaboutinourpreviousvideos,I'mnotactuallysureIusedthatterminology.|Avirtualviewistheusualtypeofviewwherewedefineitasaqueryofthedatabase.|Wedon'tactuallycreateatablefortheview.|Queriesandmodificationsarerewrittenbasedontheviewdefinition.|Nowthere'salsoanotionofamaterializedviewobviouslyforthisvideoandmaterializedviewsgiveusthesameadvantagesofvirtualviewsbutoneadditionaladvantagewhichisperhapsthemostimportantone,whichistoimprovequeryperformanceoverthedatabase.|Soagainasaquickreminderaboutvirtualviews,wedefineaview"V"say,bygivingaquerytospecifytheviewoversomerelationsorevenotherviews.|Theschemaoftheviewistheschemaoftheresultofthequery.|Whenwehaveaqueryqueue,sothisisauserquery,thatreferencestheviewVthenconceptually,notactually,wecanimaginethatthereisatablecalledV.Weruntheviewqueryoverthecurrentstateoftherelations.|WeputtheresultinV.AndthenwecanevaluatetheuserqueryqueuewhichreferstoV.Nowinrealitywhathappens,aswealreadymentioned,isthattheuserqueryqueueisrewrittenbasedontheviewdefinition,tojustusethebasetables.|Nowlet'stalkaboutwhathappenstomaterializedviews.|Again,exactlythesame,wedefineaview.|Wegiveitaname,sayV.Andwedefineitasaqueryoverasetoftableorotherviews,thenthesystemactuallycreatesaphysicaltableVwiththeschemaofthequeryresult.|Next,theviewqueryisexecutedoverthecurrentstateofthedatabaseandtheresultsareputphysicallyinthattableV.NowqueriescanrefertoVasifitsatabletablebecauseitactuallyisatablestoredinadatabase.|Thisallsoundsgreat;ofcourse,therearesomedownsides.|ThefirstdownsideisthatVcouldbeverylarge.|Whenwetalkedaboutvirtualviews.|Weshowedsomeexampleswherewecouldcreateaviewthatwasjustenormous-muchlargerthancouldeverbestoredinthedatabasebutbecausetheviewwasonlyalogicalconcept,itwasn'taproblem.|Whenusersranqueriesovertheview,they'dtypicallyhaveselectionconditionssoyou'dneverbematerializingthatverylargeview.|Inmaterializedviews,obviouslyyou'recreatingtheviewandsoitisaproblemiftheviewisextremelylarge.|So,that'soneofthedownsides.|Theotherdownsideisthatweneedtoworryiftheviewisstored.|Whathappenswhenwehavemodificationstothosetables,overwhichVisdefined.|WeneedtoactuallymodifythestoredtableV,eithermakeschangestoitbasedonthechangestothebasetablesorcompletelyrecomputetheview.|Let'smovenowtoanexample.|Andwe'lluseourusualsampledatabaseshownhereatthebottomoftheslide.|Let'screateamaterializedview.|We'llgiveitthenameCACS.|It'sforComputer ScienceapplicantstoCaliforniacolleges,sothisisathreewayjoinoverallofourrelationsandit'sgoingtoselectthecollegenameandstudentnamewhenthestudenthasappliedtothecollege,thecollegeisinCalifornia,andthestudentisapplyingtomajorinComputer Science.|SooncethiscommandisissuedthesystemwillactuallycreateatablecalledCACSandnowthegoodnewswecanCACSinanyquerywewantasifit'satable,becauseitis.|Nowthedownsideisthatthebasedataoverwhichtheviewisdefinedismodifiedwehavetoworrythatourviewisinvalidthatit'sbecomeoutofsyncwithwiththebasedata.|Solet'sthinkaboutwhatmodificationscouldoccurtothedatabasethatwouldcausetheviewtobecomeinvalid.|Wellwehavetoworryaboutthethreerelationsthatarereferencedintheview,thatisthecollegerelation,thestudentrelation,andtheapplyrelation,andforthecollegerelation,wellinsertscouldchangetheresultsoftheview.|Wecouldhaveanewcollege.|Itseemsunlikely,wecouldhaveanewcollegethatthestudentwillhavealreadyappliedtoinCalifornia,forC.S.|certainlydeletescanaffecttheview,andthenupdatestoanyoftheattributesthatarementionedintheview,andforthecollege,thatwouldbethecollegenameandthestate.|Forthestudenttable,againinsertstostudentcouldaffecttheviewifwealreadyhaveanappliedtupleandacollegetuplethatitmatches.|Deleteswouldcertainlyaffecttheview,andagain,updates,andinthiscase,theattributesthatarereferencedfromthestudenttablearethestudentnameandthestudentID.|Andfinallyapply,again,thatisthemostlikelyonethatwouldhavemodificationthatwouldaffecttheview,inserts,deletesandagainupdatesandherethesetofattributesthatarerelevantarethethecollegename,thestudentid,andthemajor.|Now,ifthereiscertainconstraintsonthedatabase,referentialintegrityconstraintsforexample,itmightbethatsomeoftheseoperationscouldn'taffecttheview.|Forexample,wemightnotbeabletoinsertacollegewherethere'salreadyanapplicationforthatcollegeorinsertastudentlikewise.|Wemightnotbeabletodeleteacollegeifthere'sapplicationsreferencingit.|Soifthereareadditionalconstraintsthatthesystemisawareof,itmightbeabletoeliminatesomeofthesemodifications.|Butregardless,manymodificationswillhavetobemonitoredtomakesurethattheviewismodifiedtostayinsyncwiththebasedata.|Bytheway,ifthisfeelsalittlebinary digitfamiliartoyou,whenwetalkedaboutgeneralassertionsoverthedatabase,thatwasoneofthetypesofconstraintsthatwecouldspecify.|Wewentthroughasimilarexercisewhereifassertionsweredefinedasclearlyasoverthedatabaseandwelookedatwhatoperationscouldoccur,whatmodificationstothedatabaseneededtobemonitoredtoseeifanassertionmightbeinvalidated.|Reallyanassertioncanalmostbethoughtofasamaterializedviewoverthedatabase.|Andifyoulookbackatthatvideo,Ithinkyou'llseetherereallyisacorrespondencebetweenthosetwoconcepts.|So,justtoreiteratethesystem[xxmaterializedviewsstored,mustmonitorallthemodificationsthatmightinvalidatetheview.|Whenthereisamodification,eithertheviewcanbecompletelyrecomputedorsometimesthere'scleveralgorithmscalledincrementalmaintenancealgorithmsthatcanjustmakesmallmodificationstotheviewbasedonthemodificationsthatweremadetothebasedata.|Sowe'vetalkedaboutqueriesovermaterializedviews.|Verysimplebecausetheviewsactuallystoredinthedatabase.|Nowwhataboutmodificationsonmaterializedviews?|Wellthere'sgoodnewsandbadnews.|Thegoodnewsisthatsincethetableisstoredifauserissuesamodificationcommandandinsert,delete,orupdatecommand,thesystemcanjustperformthatcommanddirectlyonthetable.|Thebadnewsisthebasetablestillneedtostayinsyncwiththeview.|Soreallytheexactsameissuesthatwetalkedaboutwithvirtualviewsaboutamodificationthattheuserwishestoexecuteontheviewbeingpropagatedtothebasetables,occurheretheonlydifferenceisthatwe'reactuallymodifyingtheviewaswellasmodifyingthebasetablessoI'mgoingtodrawthatsamesquarediagramthatwesawforvirtualviewstoexplainagaintheissuewithmodificationsonviews,sowehaveourviewVandbasedonourviewqueries,viewqueryQ.|Thatviewisdefinedoverdownhereoursetofrelationsthatcouldbebasedtablecouldbeotherviews.|Nowtheonlydifferencewithvirtualviewsisthatbasedontheviewquery.|InthiscaseVisactuallystoredinthedatabase,soit'sthererelationsarealsointhedatabaseofcourse.|NowtheusercomesalongandtheusersaysI'dliketoperformamodificationcommandonVcouldbeaninsert,delete,orupdate.|Andasaresult,wecanactuallyrunthatmodification,sinceVisstored,sowegetsomenewversionofV,prime.|Nowwhatthesystemhastodo,ifitcan,isperformmodificationsdownhereonthebasetables,andthatwouldbeproducingthenR1primethroughRNprime.|Andwhatwewantisthesemodificationsdownheretobesuchthattheviewquerywhenexecutedonthe,ourprimesdownherewouldproducealsov-prime.|It'sprobablybettertomakethatarrowupwardsinsteadofdownwards.|InanycaseIhopethatyougettheideathatwestillneedtostayinsync,andthetranslationofthesemodificationshere,aswesawinvirtualviews,havevariousissues,sometimesthere'snogood,meaningfultranslation.|Sometimestherearemanytranslations,andit'shardtoknowwhichoneistherightone.|So,again,theexactsameissuesarise.|We'renotgoingtotalkabouttheseissuesatlengthinthisvideo.|Idowanttomentionactually,thatmoreoftenwithmaterializedviewsthenwithvirtualviewssometimepeoplejustsay"I'mnotgoingtoallowtheviewtobeupdated.|Materializedviewsareoftenusedspecificallyforperformanceonqueries,andsouserswillbeallowedtoquerytheview,butwillnotbeallowedtomodifytheview.|NowthenexttopicIwanttoaddressishowadatabasedesignerpickswhichmaterializedviewstocreate.|SoforvirtualviewsweremostlyusedasextralayerofabstractionbasedonmodularaccesstothedatabaseorauthorizationconcernsbutasImentionedacoupleoftimesalready,materializedviewsarealsousedforincreasedperformanceandthatmakestheprocessofpickingwhichonestocreatefairlyinteresting.|Soifwethinkaboutthebenefitsofamaterializedviewfromanefficiencystandpoint,anumberoffactorsplayintowhetheramaterializedviewisgoingtogiveusincreasedperformance,betterefficiency.|Oneofthemisjusttheoverallsizeofthedatabase,oneisthecomplexityoftheview.|Ifwehavetheview,wedon'thavetore-executethequerySo,ifit'sacomplexquery,itmightbehelpfulnottobere-executingitoverandover.|Thenthere'sthequestionofhowmanyqueriesaregoingtobeissuedonthedatabasethatusetheview,ifwe'regoingtoquerytheviewonlyonceortwice,it'sprobablynotworthstoringitandkeepingituptodate.|Theotherquestion,thenishowmanyorhowoftentherearegoingtobemodificationstothebasedatathataffecttheview,becausewheneverwemodifythebasedatabutthisaffectingoftheviewmeanswehavetodoextraworktokeeptheviewup-to-date.|Ialsoalludedtothisnotionofincrementalmaintenance.|Incrementalmaintenancesaysthatwecantakemodificationstothebasedataandpropagatethemintotheviewwithoutfullyrecomputingtheview.|Fullrecomputationcanbeaveryexpensiveprocess.|So,ifwehaveaworkloadwhereweoccasionallycouldusetheviewforqueriesbutwe'reconstantlyupdatingthedatabaseandhavingtodofullrecomputation,clearlyit'snotgoingtobeworthwhiletocreatethematerializedview.|Overall,ifwethinkaboutthetradeoffswe'relookingathere,atahighlevelit'swhat'sknownasaqueryupdatetradeoff,thisactuallyoccursinvariousplacesindatabasedesignandapplications.|Sohowoftenarewegoingtoquerythedatabasewherewegetincreasedperformanceonourqueriesversushowoftenwe'regonnagettoupdatethedatabasewhereupdatesaregonnacostusinperformance.|Sotheideaisthentoanalyzetheworkloadoverthedatabasealsobasedonthesefactorslikethesizeofthedataandthecomplexityoftheviewanddecidewhetherwearegoingtogetmoreadvantagebyincreasingthequeriesandthat'snotoffsetbythedisadvantagesoftheupdates.|Bythewaydoesthissoundfamiliartoyouatall,thisqueryupdatetradeoffdecisionofwhethertomakethisextrastructurethatspeedsupqueries,butslowsdownupdates?|Probablyifyou'rethinking,you'llrealizethatindexes,orwhenwetalkedaboutthem,haveexactlythesametradeoffstoconsider.|Whenwebuildanindex,arewegoingtospeedupqueriesbutwearegoingtoslowdownupdates.|Andactuallymaterializeviewsinacertainwaygeneralizetheconceptofindexes.|Andinfactthatbringsustoournextandlasttopicwhichisthetopicofautomaticallyrewritinguserqueriestousematerializedviews.|Andthisagainissimilartoindexes.|Sowhenwebuildanindexinadatabase,foradatabase,whenwerunaquerywedon'tactuallyseethatthequeryisdecidingtousetheindex.|Webuildtheindexanditwillspeedupthequeriesbecausethesystemitselfwillmakethatdecisiontousetheindex.|Sophisticateddatabasesystems,thesedaysarealsostartingtobeabletolookatwhatmaterializedviewsarepresentinadatabaseandautomaticallyrewritequeriestousethoseviewswithouttheuserbeingawareofthat;thesamequeryanswerwillbegiven,itwillbegivenfasterbasedontheuseofanexistingmaterializedview.|So,asasimpleexampleofthat,let'ssupposewehaveamaterializedviewwiththestudentid,collegenameandmajorofstudentswhohaveappliedtoacollegeinCalifornia.|Thisissimilartobutnotidenticaltotheviewthatweshowedearlier.|Sothisisgoingtobeastoredtablealwaysuptodate.|Andthisviewisavailabletobeusedbythesystemifitcanspeedupauserquery.|Soausermaycomealongwiththisquerydownhereandwhat'sthisquerydoing?|It'sfindingstudents.|Thistimewe'relookingattheIDandtheGPAofstudentswhohaveappliedtoaCaliforniacollege,andtheywanttomajorinC.S.|atthatcollege,andtheyhaveaGPAover3.5.|Sothisqueryhasbeenissuedoverjustthebasetables,butwe'llseehowthesystemmightdecidethatifithasatitsdisposalthismaterializedviewuphere,itcouldmodifythequerytousethematerializedviewanditwillgetbetterperformancebecausethismaterializedviewhasalreadydonesomeoftheworkthatwouldbedoneifweexecutedthequerydownherefromscratch.|Sohere'swhatthesystemcandointherewrite,itcantakethiscollegerelationoutaltogether.|Thatreferencetocollegeisgonnabetakencareofinourviewandlet'schangethisapplyheretobetheCaliforniaapplyview,insteadoftheapplyrelationitself.|Withthecollegetablegonewedon'tneedthatfirstjoinedconditionanymoreandwealsodon'tneedtocheckthatthecollegeisinCalifornia,that'stakencareofinourview.|Theremainderofthequerywithapply,replacedbyCaliforniaapply,willgiveusexactlythesameresult,andpresumablyitwilldoitmuchfaster,againbecausesomeoftheworkinexecutingthequeryandevaluatingtheconditionshasalreadybeendonewhentheviewwascreated.|Soyoucanimagine,actually,averycomplicatedandinterestingproblemforthedatabasesystemitself.|Ithaslotsofmaterializedviews,letsaystoredinthedatabaseV1,V2allthewaytoV,youknow,1,000,andalongcomesauserqueryQ,mightbeacomplicatedquery,andthesystemwantstodeterminewhetheranyoftheseviewscouldbeusedtohelpQhavebetterperformance.|Andsometimesthatperformanceimprovementcanbereally,reallysignificant.|Againdependingonthecomplexityoftheview,thesizeofthedatabase.|Theconverseproblemisaproblemoffiguringoutwhichviewswewanttodesigntohelpourqueriesandagainthat'saveryinterestingproblemaswell.|Unfortunately,manytimesthatproblemislefttothehumandoingdatabasedesignalthoughtherearesometoolsbeingdevelopedrightnowaswespeaktohelpuserswiththatdesignproblem.|Soinsummary,materializedviewsprovidethesameadvantagesasvirtualviewsintermsoftheiruseforauthorization,formodularityofapplications.|Theyhavetheadditionalfeaturethattheyimprovequeryperformanceaslongastheworkloadisappropriateanddoesn'timposetoomuchofaburdenwhentheunderlyingbasedataismodified.|Designingtherightvirtualviewsforanapplicationisachallengingprocess,it'salsochallengingforsystemstousetheviewsproperly,butwhentheydotherecanbereallydramaticperformanceimprovements.|Thisvideocoversdatabaseauthorization.|Aswe'llseeitsarelativelystraightforwardtopic,butitisaveryimportantone.|Authorizationhastodowithfirstmakingsurethatusersonlyseethedatathatthey'resupposedtosee.|Andsecond,guardingthedatabasefrombeingmodifiedbymalicioususers.|Now,onethingthatwe'renotcoveringinthisvideoaresystemorprogrammingsecurityissues,suchasStructured Query Languageinjectionerrors,whatwearefocusingonissecurityofthedataaccessitself.|Sothewaydatabaseauthorizationworkisthatusersofthedatabasehavespecificprivileges,andthentheycanonlyoperateondataforwhichthey'reauthorizedthroughthoseprivileges.|Soit'ssimilartofilesystem,forexample,privilegesandauthorization,exceptthatitisspecifictothedatabaseconstructs,databasecontents,andtendstobemorefinegrainedaccessthanweseewithfilesystems.|Specifically,fordatabasesthatprivilegesthatarepossibleareonaparticularrelationtoselectthedataforthatrelationormaybejustselectthespecificattributes,sothat'sreadprivileges.|Asfaraswriteprivilegesormodifications,wecansetuptheprivilegetoinsertanon-relationoreveninsertspecificattributesonlyofarelation.|MostStructured Query Languageimplementationsdoallowyoutoinsertdatawithonlyspecificattributesspecified.|Wecanhaveprivilegestoupdatearelationorupdatespecificattributes,andfinallytheprivilegetodeletefromarelation.|Solet'sgostraighttosomeexamples.|We'llbeusingthestandardcollegeadmissionsampledatabasethatwe'veusedinothervideos.|Theschemaisshownhereatthebottom.|Let'ssupposewehaveauserwhowantstoissuetheupdatecommandshown.|TheywanttofindstudentswhoseGPAisgreaterthan3.9,andifthosestudentshaveappliedanywhere,theywanttoupdatetheapplicationrecordandsetthedecisiontobeyes.|So,let'slookatwhatprivilegeswouldbeneededbytheusertoexecutethiscommand.|So,clearly,we'regoingtohavetohavesomeprivilegesontheApplyrelationandsomeprivilegesontheStudentrelation.|IntheApplyrelation,they'regoingtoneedtobeabletoupdatethedecisionattribute,butthere'snootherupdateprivilegesthatareneeded.|IntermsofselectprivilegesorreadingtheApplyrelation,theonlyattributethat'sbeingreadhereisthestudentIDso,that'swhattheyneed.Forthestudentrelation,they'regoingtoneedtoreadtheGPA,aswellasthestudentID,sotheprivilegeneededthereistheselectprivilegeoverthestudentIDandtheGPA.|Sowiththissetofprivilegestheuserwouldbeallowedtoexecutethisoperation.|Inournextexample,supposetheuserwantstodeleteallstudentswhohaven'tappliedanywhere.|Sothey'redeletingfromthestudentrelationwherethestudentIDisnotinthesetofstudentIDsintheappliedrelation.|So,forthisoneagain,they'llneedprivilegesonthestudentrelationandontheapplyrelation.|Onthestudentrelation,theuserwouldneedthedeleteprivilegeanddeleteneverhasattributesassociatedwithitbecauseyouarealwaysdeletingentiretuples.|Theonlytuplethat'sactually,theonlyattributethat'sactuallybeingreadfromthestudentrelationistheStudentID.|So,theuserwouldalsoneedtheselectprivilegeonStudentID.|And,thenintheappliedArelation,againonlythestudentIDisbeingread.|SotheuserwouldneedtheselectprivilegeonapplyofthestudentID.|Andwiththesetheuserwillbepermittedtoexecutethisoperation.|Sofarsogood,butnowlet'sintroducealittletwist.|Let'ssupposethatwehaveauserthatwewanttoauthorizetoaccessinformationinthestudentrelation,butonlyforstudentswhohaveappliedtoStanford.|Howcanwepossiblydothat?|Whydon'tyougivethatathought.|Well,I'llgiveyoutheanswerrightaway.|Thewaywedothatisactuallybyusingviews.|SowecancreateaviewthatgivesusthestudentinformationforStanfordapplicantsonly.|Thenwecangrantusersprivilegesontheview,ratherthandirectlyontherelations.|Sohere'sourview.|Itsayswe'llfindallstudentswheretheirstudentisintheIDsofthestudentswhohaveappliedtoStanfordandwe'llcallthatviewSS,forStanfordstudents.|NowwecangiveaparticularusertheselectprivilegeonSS.|Andthatallowsthemtoselectthedatathat'sintheview,butnotseeanyofthedataoutsideoftheview.|Specifically,theywon'tbeabletoseestudentinformationifthestudentsdidn'tapplytoStanford.|Let'stakealookatasecondexamplethatinvolvesviews.|Let'ssupposethatwewanttoauthorizeausertodeleteapplications,but,onlyapplicationsthataretoBerkeley.|So,again,we'llsetupaview.|Thisone'salittlesimpler.|It'sjusttheviewoftheapp,oftherecordsoftheapplyrelationwherethecollegenameisBerkeley.|Andwe'llcalltheviewBA.|AndthenwhatwewanttogranttotheuseristheabilitytodeletethedeleteprivilegefromtheBAview.|Nowinthiscasewedoneedtohavethatviewbeupdatablebythesystemthat'ssupportingit.|So,inourvideoaboutviews,wediscussthisissue.|ThosearetheonlyexamplesI'mgoingtogivefornow,butIdowanttoemphasizethatviewsarequiteimportantforcustomizingauthorizationtospecificuserneeds.|Andinfactauthorizationisoneofthemostimportantusesofviewsindatabasesystems.|Nowlet'slookhowprivilegesareobtained.|Whenarelationiscreated,thecreatorofthatrelationbecomestheowneroftherelation.|Andtheowneroftherelationhasallprivileges,andfurthermore,maygrantprivilegestootherusers.|Sothere'sagrantstatementintheStructured Query Languagestandardanditlookslikethis.|Wegrantprivilegesonaparticularrelationtooneormoreusersandwehavetheoptionofallowingthoseuserstofurthergrantprivilegestoothers.|Specifically,theprivilegesthemselvesaretheonesthatwedefinedearlier.|Andwecanhaveacomma-separatedlistofthem.|Soforexample,wecouldsayheresomethinglike"selectstudentID,comma,delete,"andthatwouldgivethosetwoprivileges.|Theusersarealistofactualusernamesonthedatabase.|There'salsotheuser,pre-defineduser,called"public"andthatwouldgranttheauthorizationtoanyuserofthedatabase.|Andfinally,thegrantoptionallowstheuserswhoaregettingtheprivilegestograntthesameorlesserprivilegestootherusers.|NowwhatdoImeanbylesser?|Wellit'sprettysimple.|Ifwehave,sayselectandattributesABC.|thenalesserprivilegewouldbesomethinglikeselectAandB.|Now,howabouttherevokingofprivileges.|Thisgetsalittlemoreinteresting.|Sothecommandis"revokeprivileges."|Again,itwouldbealistofprivilegesonaparticularrelationfromusers,andagainthatwouldbealistofusernameswiththepossibilityofthespecialnamepublicandthentherearetwooptionforrevokingprivileges,calledcascadeandrestrict.|Andtheymayhavetodowithwhathappenswhenprivilegesarebeingrevokedfromauserwhowasgrantedtheabilitytograntprivilegestoothers.|So,let'stakealookpictoriallyatwhatcanhappen.|Let'ssupposethatwehaveauserwhohasaprivilegetosayselectonaparticularrelation,R,andwe'lldrawthatistherootofagraph.|Andlet'ssupposethat'ssayuserU1.|Andlet'ssupposethatusergrantstouserU2thesameprivileges,selecton'R'andlet'ssupposethat'swiththegrantoptionandthisisuser'U2.'|SouserU2isallowedtofurthergrantprivilegestootherusers.|Andthosemayfurthergrantprivilegestoothers.|Andwemaygetabigsub-treehere.|Nowlet'ssupposeuserU1decidestorevoketheprivilegethatwasgrantedtouserU2.|Sowhatcastitsays,isifthereisrevocationofthatformthenitwillcascadedownthetree.|Soifyoutoofurthergrantedprivileges,thenthosewouldberevokedandsowouldanyprivilegesdownbelow,sothisentiresubtreeiseffectivelyremovedallofthoseprivileges,however,wehavetobealittlebinary digitcareful,becauseit'spossiblethatsayU2wasgrantedtheselectprivilegebyaseparateuser,Iguesswe'llcallthisoneU3,whoalsograntedexactlythesameprivilege,andinthatcase,ifU1doestherevoke,wedon'twanttorevokeU2'sprivilege,becauseU2gotitfromanothersource.|Sotechnicallywhatcascadesaysisthat,whenwerevokeaprivilege,werevokeanyprivilegestransitivelywhentheyweren'talsograntedbyanothersource.|So,whatyourseeinghereisactuallycalledagrantdiagramandI'mnotgivingyouallthedetailsofgrantdiagrams,but,youcanseebasically,whattheydo.|And,theirusedistoproperlycascadetherevokingofprivileges.|Soagain,thecascadeoptionandtherevokecommandsaystoalsorevokeanyprivilegesthatweregrantedfromtheonesbeingrevokedtransitively,unlesstheywerealsograntedformanothersource.|Whattherestrictoptionsaysisthattherevokecommandisnotallowedtoexecuteifcascadewouldrevokeanyotherprivileges.|Soifwehaveanyofthosetransitivecases,soifwedohavethetransitivecasesandwewanttouserestrictandwehavetomanuallyrevokethoseprivilegeseffectivelybottom-upthroughthatgraphthatwesay.|Incidentallyrestrictisthedefaultintherevokecommand.|So,ifneitheroftheseoptionsarespecified,then,restrictistheonethatwillbeenforced.|Lastly,letmetalkalittlebinary digitaboutwhereprivilegesactuallyresideinreality.|Sowehaveourdatathat'sbeingmanagedbyadatabasesystem,andtypicallywe'llhaveapplicationdeveloperswhoareworkingdirectlywiththedatabasesystem,oftendevelopingmodulesthatwillbeinvokedbytheendusers.|Sothoseapplicationdevelopershavetohaveprivilegesonthedatabasetocreatethemodules.|Butthenwehavethesoftwarethatsitsabovethedatabasesystemthatisusedbyendusersandtheenduserstypicallydon'thaveprivilegesthemselves.|Theymighthaveseparateprivilegesprivilegestoaccessthemodulesbutthey'renotgoingtobeusingtheprivilegesystemofthedatabasesystem.|Andsimiliarly,theremaybeevenmoresoftwarelayeredontopofthesoftwarethattheapplicationdeveloperbuilds.|Andagainthatsoftwareitselfwouldn'tbehavingdatabaseprivilegesbutmighthaveanauthorizationsystemforthesoftwarethatit'saccessing.|Tosummarize,databasebaseauthorizationisimportant.|Itmakessurethatusersonlyseethedatathatthey'reauthorizedtosee.|Itguardsthedatabaseagainstbeingmodifiedbymalicioususers.|There'saprivilegedsystemsimilartofilesystemprivilegesbutspecifictodatabaseconstructsanduserscanonlyoperateonthedataforwhichthey'reauthorizedviatheirprivileges.|There'sagrantstatementandarevokestatementintheStructured Query Languagestandardforgrantingprivilegesandrevokingprivileges.|Andagainwhenarelationiscreatedtheowneroftherelationstartswithallprivileges,sothat'swherethegrantingwouldbegin.|Andfinally,forhavingprivilegesthatgobeyondsimpletableleveloperations,viewsareaveryimportantconstructandinfactauthorizationisoneofthemostimportantusesofdatabaseviews.|Inthisvideo,we'llshowhowrecursionhasbeenaddedtotheStructured Query Languagelanguage.|We'llshowtheWITHstatementwhichisaregularpartofStructured Query Language.|Andthenwe'llshowhowWITHcanbeusedtowriterecursivequeries.|We'lldescribeafewexamplesthatcan'tbewrittenwithoutrecursioninStructured Query Language,andtheninafollow-upvideo,we'llgiveademothatwillshowtheexamplesinaction.|SoStructured Query Languageisnotwhatisknownasaturingcompletelanguage.|Forthoseofyouwhoarefamiliarwiththeideaofturingcompleteness,itsaysthatprettymuchanycomputationcanbeperformedbyalanguage,andthat'ssimplynottrueinStructured Query Language.|SoStructured Query Languagehassomenicefeatures,it'ssimple,convenient,declarative--meaningwedon'thavetosayhowtoexecutequeries,justwhatwewantoutofthequeries.|We'vetalkedaboutthatmanytimesthroughoutthesevideos.|WefindthatStructured Query Languageisexpressiveenoughformostalldatabasequerieswewanttodo,exceptforonetype.|Andthat'sthetypethatinvolvesunboundedcomputations.|ThebasicStructured Query Languagelanguagedoesnothavefeaturesthatallowustodothose.|And,I'llmotivatethosewithafewexamples.|I'lljustsayupfront,thatwhenunboundedcomputationsneedtobeperformed,useadatabase.|Typically,there'ssomeprogramminginaprogramminglanguage,thatwillbeaccessingthedatabaseoverandover,todothosecomputations.|Butwe'realsogoingtoseethatStructured Query Languagehasaddedanotionofrecursionthatallowsustoperformunboundedcomputations.|So,ineachofmyexamplesI'mgoingtogivearelationalschemaandthenaquerywe'dliketowriteoverthatschemabutwewillseethatwecan't.|Thefirstisasimpleancestorscomputation.|So,forexample,wemighthavethatSueisaparentofMaryandmaybeBobisalsoaparentofMary.|AndmaybeFredisaparentofBobandJaneisalsoaparentofBob,andsoon.|Sowe'rejustlistingtheparent-childrelationshipsinourrelationcalledparentof.|Andthenourgoalistousethatrelationtocompute,say,allofMary'sancestors.|SowecancertainlywriteaStructured Query LanguagequerythatfindsMary'sparents.|I'llletyoudothatasanexercise.|It'sverystraightforward.|WecanevenwriteaquerytofindMary'sgrandparents.|Aquerytodothat,andagainI'mnotgonnawriteithere,wouldinvolvetwoinstancesofparentof,soyou'dbejoiningparentofwithitself.|WewrotequeriesofthatformwhenwewereworkingwithbasicStructured Query Languageinourvideos.|Andyouknowwecouldevenfindthegreatgrandparentsbyusingsay,threeinstancesinjoiningthem.|TheproblemisthatwemightnotknowinadvancehowmanystepstherearetogetallofMary'sancestors.|Andeachoneofthosestepsdoesinvolveaninstanceofparentofandadjoin,sothisquerycannotbeexecutedusingstandardStructured Query Language.|Here'soursecondexample.|Alittlemorecomplicated.|Itinvolvesthreerelations.|Andtheyrepresentacompanyhierarchy.|We'regoingtohavemanager-employeerelationships.|We'regoingtohaveprojectsandwe'regoingtohavesalaries.|So,ourfirstrelation,employee,justgivesusthesalaryofeachemployee.|Oursecondonegivesusthemanagerrelationshipandwhatthisissayingissay,thattheemployeewithID123isamanager.|I'lldrawitlikeatreehereoftwo,three,four,who,himself,mightmanageafewotheremployeesand,soon.|So,wehaveahierarchicalstructureofthemanagementinthecompany.|Andyou'llsee,youcanalreadyprobablyrecognizethatthisissimilartotheparentrelationshipthatwehadinourpreviousexample.|Andfinallywehaveasetofprojectsthatgivesthenameoftheproject,andthemanagerofthatproject.|Andthequerythatwewouldliketorunoverthisdatabaseistofindthetotalsalarycostofagivenproject.|Let'ssayprojectX.|Soforexampleif123happenstobethemanagerofprojectX,thenthetotalsalaryclasswouldbe123'ssalaryplus234'sandsoondownthehierarchy.|SoI'mnotevengoingtotrytowriteaStructured Query Languagequeryhere.|Againyoucandothatasanexercise,ifweknewpreciselyhowdeepthetreewasbelowthemanagerofprojectX.|Thenwecouldagainusetheseselfjoins,thatwouldbeonthemanagerrelationthistime,tofindalltheemployeesthatareinthatsub-treeofprojectXandadduptheirsalaries.|Butifwedon'tknowthedepthofthathierarchy,thenit'simpossibleforustowriteaStructured Query Languagequerythatgoestoarbitrarydepthtoaddupthecosts.|Bytheway,letmementionthatoneofthereasonsI'mnotbotheringtowritetheexactStructured Query LanguagerightnowasImotivatetheseexamplesisthatwearegoingtoseetheSQLsshortlywhenwedothelivedemo.|Andthethirdexampleandmypersonalfavoriteisfindingairlineflightsfromastartingpointtoanendingpointatthecheapestcost.|Solet'ssaywehavearelationherethatlistsallflights,thestartoftheflight,theendoftheflight,theairlineandthecostoftheflight,andwe'reinterestedinflyingfrompointAtopointB.|NowifIhappentobeaveryconservativetraveler,andIdon'twanttochangeplanesmorethantwicethenI'mingoodshapeandIcouldstillwritethisusingStructured Query Language,becauseI'dbeonlywillingtotake3flights,andIcouldjustjointhreeinstancesoftheflightrelation,matchingthedestinationofaflightwiththeoriginofthenextone,andthenaddingupthecosts,andfindingthecheapestone.|It'snotatrivialStructured Query Languagequerytowrite.|Again,I'llleaveyouthatasanexercise.|Andbytheway,Ioftengivethatveryqueryasanexerciseinmyclass.|Butwhenwedon'tknowthenumberofflightswewanttotake,soifweareaveryfrugaltravelerwhosewillingtospendarbitraryamountsoftimetogetthecheapestflight,thenwecan'twithregularStructured Query LanguagewriteaquerythatexploresarbitrarynumbersofflightstofindsthecheapestwaytogetfrompointAtopointB.|Soasyou'veprobablysurmised,allthreeoftheseexamplesaregoingtobeexpressibleoncewehaverecursionintheStructured Query Languagelanguage.|SonextI'llintroducethewithconstructinStructured Query Language.|Thewithconstructisactuallypresentevenwithoutrecursion,butitistheconstructthatwasusedtoaddrecursiontothelanguage.|SohereisthewidthstatementinStructured Query Language.|Wegivethekeyword"with",andthenwelistoneormorenewrelationnames.|So,R1-RNwouldberelationsthatdon'texistinthedatabaseandeachoneofthoseistiedtoaquery.|Sowhatwe'reeffectivelysayingisthatR1isgoingtocontaintheresultsofqueryoneortwooftheresultsofquerytwoandsoon.|Oncewe'vesetthatup,thenthefinalpartofthewithisafinalquerythatcaninvolveanytablesinadatabaseandcanalsoinvolvethesenewtablesR1throughRN.|Insomeways,youcanthinkofthewithstatementassettinguptemporaryviews.|SoitsetsupaviewforeachoneoftheseR'sthenrunsaqueryinvolvingtheviews,andthentheviewsgoaway.|Orifyouwanttothinkofthemasmaterializedviews,youcouldthinkoftheseasassignmentstatementswherewehavetheas.|SowecreatethetableR1,weputthedatain,andthenwerunthequery.|Inrealitymostsystemsimplementthewithstatementlikeforgeneralizedvirtualviewsandthey'llrewritethequerydownheretobeexpressedoverthetablesthatareusedinthesequeries.|We'llbeseeingexamplesofthewithstatementwhenwegettoourdemo,itwillofcoursebetherecursivewithstatement.|Justonemorenotationalpoint,justlikeaswithviews,whatnormallyhappensistheschemaofoneoftheseRsisinheritedastheschemathat'stheresultofthequerythat'sassociatedwiththeR.Butiftheuser,Imeanthedesigner,theonewritingthe"with"statement,wishestohaveadifferentschema,differentnamesfortheattributes,thosecanbespecifiedexplicitly,andthenthosewouldbeusedinthisquerywhenR1isreferenced.|Sonowhere'sthefunpart.|Wecanspecifyrecursiveasakeywordafter"with"andthatlet'suswriterecursivequeriesinthisfirstportionofthe"with"statement.|Veryspecifically,inqueryonehere,weanactuallyreferencerelationR1whichistherelationwe'redefiningwithQuery1,inarecursivefashion.|InQuery2,wecanreferenceR2.|Wecanactuallyalsohaveamutualrecursion,whichI'mgoingtofocusoninaseparatevideo.|But,thatwouldbesaying,notthisexactly.|ThatwouldbesayingQuery2couldreferenceR1andQuery1wouldreferenceR2,butagain,we'llbetalkingaboutthatinaseparatevideo.|Fornow,we'lljusttalkaboutrecursionwithineachspecificationofoneoftheseRs.|Bytheway,onethingthatIwantedtomentionisasortofsyntacticinconsistency.|TheStructured Query Languagestandardactuallysaysthatthisrecursivemodifierheregoeswiththerelationspecification.|SoifR1isrecursivewewouldsayrecursiveR1,ifRNwasrecursivewe'dsayrecursiveRN.|Theimplementationthatwe'regoingtobeusingwhichisthepostgresimplementation,actuallysaysthatrecursivemodifiesthewith.|SowhenyousaywithrecursivethenanyoftheRI'sareallowedtoberecursive.|Nowletmeshowwhatthetypicalformisofoneoftheserecursivespecificationsinthewithstatement.|SothisexampleI'mgivinghasjustoneRspecifiedinthewithstatementandthenthequeryatthebottom.|Again,thisisthefinalresultoftherecursivewithstatement,involvesRandpossiblyothertablesofthedatabase.|Thetypicalwaytodefinearecursivequeryistohaveabasequeryandthatwouldbeovernon,overtablesotherthanRsonotRinthisbasequery.|Sortoftogettherecursionstarted,andthenRwillbetheresultofthatbasequerytogetherwiththerecursivequery.|SoherewewillreferenceR.AndtheideaisthattheresultofR,theRthat'sseenwhenwerunthequerydownhere,iswhat'sknownasthefixedpointofrunningthisunionoverandoveragainuntilweaddnoadditionaltuplestoR.OneotherthingthatIwantedtomentionisthatthisformoftherecursion,thisideaherethatwehavethebasequeryandaunionwiththerecursivequeryisnotenforcedintheStructured Query Languagestandard.|TheStructured Query LanguagestandardmerelysaysthatwecanspecifyRhereandthenanyqueryinsidetheparenthesisthatreferenceR.Although,thereareanumberofrestrictions,thisdivisionintoabasequeryandrecursivequeryisn'trequired.|We'llbetalkingaboutsomeofthoserestrictionslateon,actuallyinaseparatevideo.|Intheimplementationthatwe'reusing,theimplementation,itactuallydoesrequirethisformwhereyouhaveabasequery,union,andrecursivequery,butthat'snotreallyaproblembecauseallnaturalrecursivequeries,atleasttheonesI'veseenandfortheexampleswe'regoingtolookat,dotakethisform.|AndonelastthingIwanttomentionisabouttheUNIONoperator.|FirstareminderthatinStructured Query LanguagewhenwesayUNION,asopposedtoUNIONALL,we'retalkingaboutduplicateeliminatingunion,thatmeansthatwhenweaddatupletoourunionthat'salreadythere,wedon'tactuallyaddatuple.|Andthat'sreallykeytothisnotionofreachingafixedpointorwiththerecursionterminating,becausewemightberunningtherecursivequerythatoverandovergivesusadditionaltuples,butifthosearealltuplesthatwealreadyhaveinR,thenwewon'tactuallybeaddinganythingnew,becausetheunioneliminatesduplicates,andthatwilltellusourrecursionisdone.|Asyoucanimagine,ifIwroteUNIONALLinstead,then,I'mcontinuouslyaddingnewtuplesandmyrecursionwilltypicallynotterminate,soit'snotcommon,maybenever,toseeUNIONALLusedinrecursion,butrathertheduplicateeliminatingUNIONoperator.|Sonowthatwe'veseenanumberofexamplesthatneedrecursion,andwe'veseenhowrecursionhasbeenintroducedintoStructured Query Language,thenextvideowillgiveademoofthesequeriesinaction.|ThisvideogivesalivedemonstrationoftherecursiveconstructsinStructured Query Languagethatweintroducedinthepreviousvideo.|Asareminder,recursionhasbeenintroducedintosequalaspartofthewithstatementwherewecansetuprelationsthataredefinedbyqueriesthatthemselvesrefertotherelationbeingdefined,andfinallywehaveaquerythatcaninvolvetherecursivelydefinedrelationsaswellasotherrelationsorothertablesinthedatabase.|Thetypicalexpressionwithinawithstatementforarecursivelydefinedrelationwouldbetohaveabasequerythatdoesn'tdependonRandthenarecursivequerythatdoesdependonR.Wegavethreeexamplesintheintroductoryvideoandthosearethesameexamplesthatwe'llbedemonstratedshortly.|Thefirstonewastocomputeancestorswhenwehaveonlyaparentrelationandthefamilytreecouldbearbitrarilydeep.|Oursecondexamplewasacasewherewehaveanarbitrarilydeepcompanyhierarchyandwewanttocomputethetotalsalarycostofaprojectstartingatthatproject'smanagerandsummingthesalaryoftheentiresub-tree.|andourthirdexamplewasaboutairplaneflights.|WherewewanttofindthecheapestwaytoflyfrompointAtopointB.|Andwe'rewillingtochangeplanesasmanykinds,aswemightneedtoinordertobringdownthecost.|Wesawthatalloftheseexamples,involved,basicallyanotionoftransitofclosurecomputedasarecursivelydefinedrelation.|Thelastportionofourdemo,afterweseethesethreequeriessolvedusingrecursion,willintroduceonemoretwist,whichiswhathappenswhenweintroducecycles.|SointheAirlineexample.|We'llsetupacasewhereyoucanflyfromonecitytoanotheroneandback.|Whichisofcoursetrueinreality,andwe'llseewhathappenswhenwetrytoanswerourqueryinthatsetting.|I'vestartedbycreatingatablecalledParentof.|Withparentchildrelationships.|Sowehave,AliceCarol,BobCarol,CarolDave,andsoon.|Youmightactuallywanttowritethisdownonapieceofpapertoseewhattheactualtreelookslike,butthequerywewanttorunistofindallofMary'sancestorssowe'regoingto,ofcourse,haveEveasaparent,andDaveasaparent.|AndthenDave'sparentisCarol,andCarol'sparentisBob,andsoon.|We'llgetmostofthedatainourdatabaseinourquery.|Sohereisthequery,ourfirstexampleofourrecursivequery.|Letmesayrightoff,thatevenmorethananythingelse,we'vedoneinthesevideos,Iamgoingtoencourageyoutodownloadthescriptandtakeacloselookatthequery,andpreferableactuallyrunthequeriesandplaywiththemonthePostgressystem.|AndweareusingforthisdemoPostgres,asSQLiteandMySQLdonotsupportforththeWithRecursivestatementatthispointintime.|So,anywayhere'sourqueryanditistheformthatwedescribedintheintroduction,it'sawidth-statementwithrecursivethat'sgoingtosetuparecursiverelationcalledancestor,sothisiswhatwewerecalling"r"earlier.|ThisisourancestorwithaschemaAdministrative Domainforancestoranddescendant.|Ourfinalquery,onceancestorisallsetup,isverysimple,itjustsays,takethe'A'attributefromancestor,whereadescendantisMarysothatwillgiveusMary'sdefendant.|Ofcoursewhat'sinterestingiswhat'srighthere,insidetheseparansbecausethisourrecursivequery.|Anditdoestaketheformwedescribedofhavingabasequery,thatisthefirstline,andthentherecursivequerywithaunionbetweenthem.|Sowe'regoingtostartbysayingthatwheneverwehaveaparentchildrelationshipthat'salsoanancestorrelationship.|Sowe'regoingtotakefromourparentoftable.|Theparentandchild,andwehavetorenamethemasAandD,andthatsaysthatparentchildrenareanancestor.|Whatelseinanancestor?|Wellifwehaveatupleanancestor,anancestorandadescendant,andthatdescendantistheparentofaanotherperson,thentheAandtheancestor,togetherwiththechildfromtheparentof,isalsoanancestorrelationship.|Sothisisakindofdoingthejoin.|Notjust"kindof",it'sactuallyjoiningourancestorasitsbeingcreatedandextendingthatrelationshipbyjoiningwithanotherinstanceofparent.|Soyoucankindofthinkofgoingdowntheancestortreeaddingrelationshipsaswegodown.|Again,Ireallycan'tencourageyouenoughtodownloadthisqueryandplaywithityourselftofullyunderstandwhat'sgoingon.|Let'sgoaheadandrunit.|It'sgoingtoberatheranticlimatic.|WhenwerunitwedodiscoverthatthesefivepeopleareMary'sancestors,andifyou'vedrawnthelittletreeofthedatayoucanverifythat,that'sthecorrectanswer.|Let'splayaroundalittlebinary digit.|Letmetryafewotherpeople'sancestors.|Let'stryFrank.|Wedon'tseeFrankherebecauseFrankactuallyhappenstobeachildofMary's,soweshouldgetevenmoreancestorswhenwerunthisone,especiallyMaryshouldbeincluded,andinfact,sheis,theresheis,andtheseareFrank'sancestors.|Let'stryGeorge,IthinkGeorgewassomewhereinthemiddleofthetreethere.|Yes,Georgehasthreeancestors,andfinallylet'stryBob.|Bobisattherootsoweshouldgetanemptyresultandwedo,becauseagainBobhasnoancestorsinourdatabase.|Nowletstakealookatoursecondexample.|Thatwastheonewherewehadahierarchyofmanagementchaininacompany,andthenwewereinterestedincomputingthetotalsalarycostofaproject,soI'vesetupourthreetables.|ThefirstoneistheEmployeetable,itjustgivestheIDsoftheemployeesandthesalaryofeachemployee.|ThesecondtableistheManagerrelationship.|So,again,youmightwanttodrawthelittletreeherealthoughit'sprettysimplethistime.|123isattherootofourlittlemanagementstructure,as234asasubordinate.|234hastwosubordinates,345and456and345isanotherone.|Soit'sonlyathreeleveltree.|Ofcourseifweknewitwasonlythreelevelswewouldn'tneedrecursionatall.|Butwe'regoingtowriteaquerythatwillworkforarbitrarynumbersoflevels.|Sothat'sourmanagementstructure.|Andfinally,ourthirdtable,theProjecttablesaysthatemployee123isthemanagerofprojectX,sowhatwewanttodoisfindthemanagerofprojectYinthehierarchy,andthentakethatmanager'ssalaryalongwiththesalary'sofallthemanager'ssubordinatesrecursivelydowntothemanagementstructure,andofcoursethat'severybodyininourlittledatabase.|Again,Ican'tencourageyoutodownloadthescriptandrunitforyourself.|Sohere'sourquerytofindthetotalsalaryofprojectxandI'mactuallygoingtogiveacoupleofdifferentwaysofrunningthisforyou.|Thewaywe'vedoneitthefirsttimeistoeffectivelyexpandthemanagementstructureintoarelationcalledsuperior.|Sothat'sreallyprettymuchdoingtheancestorcomputation,whichbythewayisatransitiveclosure.|Ishouldhavementionedthatearlierforthoseofyoufamiliarwithtransitiveclosures.|It'sbasicallythatoperation.|Sowe'regoingtocomputethesesuperiorssothatwe'llhaveeverymanagerandemployeerelationshipwithamanagerisarbitrarilyabovetheemployee.|Andthenoncewehavethatsuperiorrelationshipcomputed,thenwewriteaactuallyafairlycomplicatedquery,sothisisthefinalqueryofourwithstatement.|Andthisonesayswe'vegotthisrecursiverelationsuperior.|We'regoingtothesalariesfromtheemployeerelationwheretheIDiseitherthemanageroftheprojectX,sothat'sthefirsthalfhere,oranemployee,that'smanagedbythemanager,ofprojectX.|Okay.|Nowthisdownhere,Ijustwanttoemphasizethisisnotrecursive,itjustsohappenstohavethatsamestructureofunion,butthereisnothingrecursivehappeningdownhere.|SothisisjustaregularStructured Query Languagequery.|Oncewehavethesuperiorrelation,that'sthetransitiveclosureofthemanagerrelation.|Solet'stakealookatsuperior.|Superior,herethisisrecursivewiththeunion,saysthatifwehaveamanagerandthat'stheMIDandEID.|Thenifsomebodyismanagingsomeoneelsethentheyaretheirsuperior.|Noticebytheway,Ididn'tspecifyaschemahere,sotheschemaisimplicitlygoingtobeM-I-D-E-I-D.|Sowe'regoingtoputmanagerrelationshipsin.|Andthen,ifwehaveasuperiorrelationship,soifwehaveanMIDmanaginganEIDintheSrelationshipthenwecanaddonemorelevel,becausewejoinwiththemanagerssayingthatifSisasuperiorofYandwhyisthemanagerofZbeenX'ssuperiorofZ.|Thisparallelsexactlywhatwedidwiththeancestorcomputationinthepreviousexample.|Again,it'sgoingtoberatheranti-climactictorunthequery,butlet'sdoit.|And,wefindoutthatfourhundredisthetotalsalarycostofProjectXwhenwecountthemanagerofprojectXtogetherwithallofthepeopleunderneaththatmanagerinthehierarchicalstructure.|Sowhenwethinkofrecursionweoftenthinkoftransitiveclosureorexpandinghierarchiesaswe'vedonewithourexamplessofar.|Butifwestepbackforasecondwecanseethatthereisaquiteabinary digitsimplerwaytoexpressthequerythatfindsthesalaryburdenofprojectX.|Nownotonlyisthisactuallynicertolookat,it'sprobablymuchmoreefficient,dependingonhowsmartthequeryprocessoris.|Inourpreviousexample,ifthequeryprocessorexecutesthequeryinastraightforwardway,itwouldcomputethissuperiorrelationshipfortheabsoluteentirecompanyhierarchybeforeitfiguredoutwhichofthosepeoplewereinvolvedinprojectX.|Now,areallygoodqueryprocessormightactuallyfigureouttofoldinaprojectXbut,notnecessarily.|Here'sanexampleandhere'sanewformulationofthequery.|We'reactuallygoingtotieXspecificallytoourrecursion.|Whatwe'regoingtocomputeinourrecursiveWithstatementhere.|Sothisisthetemporaryrelationwe'recomputingisarelationcontainingjustalistoftheIDsoftheemployeeswhoareinvolvedinprojectX.|OncewehavealltheemployeesinvolvedinprojectX,thequerydownhereistrivial.|WejustfindthoseemployeeswhoareamongtheXemployeesandwesumuptheirsalaries.|So,let'stakealookattherecursivedefinitionhereandagain,it'stakingtheusualformofabasequery,unionandrecursivequery...andhere'swhatwedo.|Well,obviouslythemanagerofprojectXisoneoftheIDsinvolvedinprojectX.|Soherewefindintheproject,theprojectnametextandwetakethemanagerofthatprojectandweputthatperson'sIDintoXemps.|That'sthefirstIDthat'sgoingtogointhere.|That'sgoingtoseedtherecursion.|That'sagainthebasequery.|Thenweaddinourrecursivestepanyemployeewhoismanagedbyanybodywho'sintheXemployees.|So,we'lltakeourmanagerrelationship,ourXemployeesrelationshipandiftheemployee'smanagerisanX,thenthatemployeeisalsoinvolvedinX.|SoweseedtherecursionwiththemanagerofprojectXandthenwejustrecursivelygodownthetreeaddingalloftheemployeesthatareunderneathonebyone.|Wedon'thavetoknowthedepthofthetreebecausetherecursionwillcontinueuntilnobodyelseisadded.|IguessIshouldhavementionedthatearlierinmyearlierexamples.|Againtherecursionsortofaddsadataoverandoveragainuntilthere'snothingnewtoadd,andthat'swhenitterminates.|Solet'sgoaheadandrunthequery.|Anti-climaticagain,butwegetthesameanswer400asthesalarycostofProjectX.|NowweusethesameformofquerytofindthetotalsalarycostoftwoprojectsYandZ.|Andthatwillalsodemonstratehavingtworelationsthataredefinedinthewidthrecursivecommand.|SoIhaveaddedprojectYandZtoourprojecttable,andthey'rebothmanagedbyemployeeswhoarealreadyinthedatabase,sothey'realittlelowerdownthehierarchy.|Weshouldexpectthoseprojectshavelowertotalcost.|That'sforprojectX,whosemanagerwasattherootofourhierarchy.|Sohere'sourquery,it'sabigone;we'regoingtodefineYMandZMexactlyaswedefinedXampsinthepreviousexample.|SoYampsisatableofarecursivelydefinedrelation,temporary,that'sgonnacontainalistofIDsofthepeople,theemployeesthatareinvolvedinProjectY.|SowearegoingtoputthemanagerofProjectYasourbasequery,andthenwe'regoingtoaddtoitintherecursionalloftheemployeeswhoaremanagedbysomeonewho'sintheYMs.|AndZM'sexactlythesame.|WestartthemanagerofprojectZ,andthenweaddtoit,allofthepeoplearemanagedtransitivelydownthetreebysomeonewho'sintheZM'srelation.|Andthenourfinalquerydownhereforthestatementisaunionoftwoqueries.|ThefirstonegetsthetotalsalaryforYanditlabelsitasYtotal.|SoittakesalltheIdsthatareintheYtableandfromtheemployeetablegettheirsalariesandsumsthemup.|AndsimilarlytheZtotal.|Sonowwe'llrunthisquery,itwillbeslightlylessisanti-climactic.|Wedohavenowtwotuplesinourresult.|WeseethatthetotalsalaryforYis300inthetotalsalariesforZis70.|Andifyoucheck,cross-checkthisresultagainstthedatayou'llseethattheseareindeedthetotalsalarieswhenwetakethemanagerswespecifiedforprojectsYandZ.|Andfinallyourlastandmostfunexample.|TheonetofindhowtoflyfrompointAtopointbewhenallwe'reconcernedaboutiscost,andwedon'tcarehowmanytimeswehavetochangeplanes.|So,here'sthelittleflightstableI'vesetup,andIusedAandBsowecanliterallyflyfrompointAtopointB.|Allofourintermediatedestinationsareactuallyrealairportcodes,andI'veputinsomeairlines,althoughthey'renotactuallygoingtobeusedinourquery.|AndthenI'veputinthecostoftheflights.|Youmightwanttodrawyourselfalittlegraphsoyoucanseewhat'sgoingon,andwecanflyfromAtoChicagofor200,fromChicagotoBforanother100,orwecangofromAtoPhoenixandthenPhoenixtoLasVegas.|toLasVegastooh-oh,Idon'trememberwhatthisis.|CMH,Detroit,Cincinnati,somewhereinthemidwest.|AndfromtheretopointB,orwecantakeanon-stopfromAtoBongoodoldJetBluefor195.|Soclearlywe'renevergoingtobegoingthroughChicagoforatotalof300withthatJetBlueflight.|butI'vesetupthedata,asyou'reprobablynotsurprised,sothatthislongroutethroughPhoenixandLasVegasandsomewhereinthemidwestis,infact,gonnabeourcheapestwaytogo.|Sonowlet'stakealookattherecursivequerythat'sgoingtofindusourrootfrompointAtopointB,oratleastfindusthecheapestwaytogetfrompointAtopointB.|SothefirstqueryI'mgoingtoshowactuallygivesusallthedifferentcostsofgettingfromAtoB,justsowecanseethoseenumeratedforus,andthenwe'llmodifythequerytogiveusthecheapestcost.|Sohere'stherecursivequeryandwe'regoingtousearecursivelydefinedrelationcalledroot.|Androotsaysthatwecangetfromanorigintoadestinationforaparticulartotalcost.|OK?|So,weagaininourrecursionhavethebasequeryandtherecursivequery.|Thisisexactlywhatyou'dimagine.|WecancertainlygetfrompointXtopointYforatotalcost,ifwecantakeadirectflightfrompointXtopointYforagivencost.|Sothat'sourbasequery,westartoutwithallofthedirectflightsinourrouterelation.|AndthenwestartaddingroutesbydoingtheJOINofaroutewithaadditionalflight.|Sobasicallywhatthisjoinheresays,"IfIcangetfromtheorigininaroutetothedestinationandthenthatdestinationistheoriginofanotherflight,thenIcanaddthatflight.|Icanstartwithmyoriginalorigin,finaldestinationandthecostofthatisgoingtobethetotalthatIalreadyhad.|Plusthecostofthenewflightandthat'smynewtotal.|Soagain,thisisanothertransitivecloserlikerecursion.|It'sverysimilartotheancestorrecursion.|Verysimilartoexpandingthecompanyhierarchy.|Theonlyrealdifferencehereisthatwe'realsoaccumulatingthesecostsaswedotherecursion.|Sooncewe'vedonethisrecursionthenwehaveacompletespecificationofalltherootswithinourflightsdatabase,alloftheway'swecangetfromAtoBandthetotalcost.|NowonethingIshouldsayisthisisnotactuallygivingusthewaysofgettingfromoneplacetoanother.|Ifwewantedtoaccumulatetheactualroutethatwetakesotheflightsandthecostsandtheairlinesandsoon,wehavetokindofuseastructuredstructureinsideourdatabasetoaccumulatethose.|TherearewaysofdoingthatbutI'mnotgoingtodemonstratethathere.|I'mjustgoingtodemonstratetheisaccusedofrecursionandcomputingthetotalcost.|OK,solet'sgoaheadandrunthisquerysowe'vecomputedalloftheroutes,andthenwe'rejustgonnastartbyfindingtheroutesfromAtoBandwhatthetotalcostofthoseare.|Sowe'llrunthequeryandwe'llfindoutthattherearethreewaysofgettingfromAtoB.|ThefirstonehappenstobethatdirectJetBlueflightfor195.|ThesecondwastheflightthroughChicagoforatotalcostof300.|Youcangobackandlookatthedataandverifythese.|Andthethirdonewasthatcomplicatedroutingwherewestoppedseveraltimes,butwesavealotofmoney,welltwentydollarsoverthedirectflight,bygoingthroughthosecitiesbecausethetotalsub-costis175.|I'llleaveituptoyouwhetherit'sworthtwentydollarstostopseveraltimesversusthedirectflight.|SonowsincemyactualspecificationofwhatIwantedtoknowwasthecheapestwaytogothenIjustsaymintotalinsteadofinmyfinalqueryandIrunthatandmyansweristhat175isthecheapestwaytogetfromAtoB.|NowhereisanalternativeformulationofthesamequeryThatessentiallyparallelsthealternativethatwelookedatwithourprojectcrosswherewebuiltinprojectXintoourrecursionthatsimplifiedtherecursioninthatcase.|Inthiscaseit'snotsimpler,butitcouldpotentiallybemoreefficient.|We'regoingtobuildinthefactthatwe'restartingfromoriginAsoinsteadoffindingallrootsfromanypointtoanyotherpointinourrecursionandthenfindingtherootsfromAtoB,let'screatearelationrecursivelythatsays,"StartingfrompointA,Icangettoaparticulardestinationforaparticulartotalcost.|SothisisgoingtobuilduprootsstartingfromAthebasequeryisgoingto,ofcourse,startbylookingatdirectflightswheretheoriginisAandisgoingtoputthedestinationandthecostintoourrelationcalledfromA.|SothatstartswiththatfirstgivesusdirectstartfromAwherewecangetonthedirect,wherewecangetto,andhowmuchitwillcostus,andthenourrecursionisgoingtoaddflightstothatone.|Again,itreallyparallelswhatwedidwiththeProjectX.|Ourrecursionisgoingtosay,okweknowwecangeta,fromparticular,wecangettoaparticularplacefrompointAforacertaincostandthat'sourdestination.|Ifweadd1moreflightsotheoriginofthatflightisthedestinationofwherewecangetthenthatwillalsobeadestinationthatwecangettofrompointAandwe'lljustaddthecostoftheadditionalflighton.|Onemoretimeastrongsuggestionthatyoudownloadandtrythesethingsforyourself.|OncewefoundalltheplaceswecangetfromAthenwe'llusethattofigureoutthecheapestwaytogettoPointB.|Butlet'sjuststartbyrunningtheWithstatementwhereallwedoisseetheplaceswecangettofromAandthetotalcostofgettingthere.|Soherewego.|AndwecangettoChicago,PhoenixorwecangettoBacoupleofdifferentways,threedifferentwaysactuallyaswealreadyknow.|WecanalsogettoLasVegasandthismysteriousCMHIwishIrememberedwhatitwere.|Sonowifwe'reinterestedinfindingthecheapestwaytogetfromAtoBthenWe'lladdwherethedestinationequalsBonhereandwe'lladdtheminimumtotalcostandhopefullythatwillbeourgoodold175andindeeditis.|Bythewaywecandothesamebasicideabutbackwards.|InsteadoffindingalltheplacesthatwecangetfromcityAhowaboutifwefindalltheplacesfromwhichwecangettocityB.|Sohere'sthequerythatdoesthat.|ToBisgoingtobeourrecursivelydefinerelationthat'sgoingtogiveustheorigin,theplacefromwhichwecangettoBandthetotalcostofgettingtoBfromthatplace.|Soagain,thestructureisexactlyparallel.|WestartoutwithourbasequerysayingifwehaveadirectflighttoBthenwecangetfromtheoriginofthatdirectflightatthecostoftheflighttoBandwethenrecursivelyaddflightsonthatyoucanthinkofifyourgoingfromlefttorightaddingflightsfromtheleft.|SoifweknowwecangetfromaplacetoBandthenwecangofrom...takeadirectflightfromsomewhereelsetothatplaceAndwecangetfromthatsomewhereelsetobe.|Anywaysowedothatagainbyjoiningsowe'regoingtotakeouroriginfromwhichwecangettoBwe'regoingtofindflightthattakeustothatorigin,we'regoingtoaddthecostofthatflightandthatgivesusanewwaytogettoB.|AndthenletmestartbyjustwritingthequerythatalloftheplacesfromwhichwecangettoBandthecostofgettingthere.|We'llrunthequery.|AndwecanseethatwecangettoBfrompointAin3differentwaysandfromourothercitiesinourdatabaseaswell.|Similarly,towhatwedidpreviously,ifwe'reparticularlyinterestedingettingfromAtoB,whoops,let'smakethatouroriginthenweaddwhereoriginequalsaandifwewanttheminimumitwouldbeourminimumtotalagainparallelingexactlywhatwedidbefore.|Werunitandgoodold175comesout.|Nowwe'regoingtohavesomerealfunbecauseIaddedanotherflighttoourdatabase,andthisflighttakesusfromColumbus,InowknowitsColumbus,toPhoenixandcreatesaloopinourflights.|SothatmeansthatwecanflyfromAtoBnexttoLasVegas,toColumbus,backtoPhoenixandthentoLasVegasandColumbusagain.|So,we'regoingtohavearbitrarily,actuallyunbounded,actuallyinfinite,lengthroutesthatwecantakenow.|Now,obviouslythoseroutesaren'tgoingtoeverbethecheapestwaybecauseaswetakethoserootsit'sgoingtogetmoreandmoreexpensive,noneofthemarenegativecostspayingustotakeflights.|Butifwejustdoournaiverecursionwherewegenerateallofourrootsbeforewetakealookatourfinalquerythenwe'regoingtobegeneratinganinfinitenumberofroots.|Sohere'souroriginalenquiry,thefirstonewewrote,wherewewerejustfindingallofthecostsofgettingfromAtoBbycomputingalloftherootsintheentiredatabaseandthenlookingatthosefromAtoB.|Nowwithouradditionalflightthatcreatesaloopwerunthiscommandandnothinghappens.|Actuallyifwewaitlongenoughwe'regoingtogetanerror.|Well,okaywewaitedforawhile.|appearsthattheuserinterfacewe'reusingisn'tgoingtoshowustheerror.|Butifyoutryrunningthisinpostriskcommandlineinterface,Iassureyouifyouwaitlongenough,eventuallyitwilltellyouthattherecursioneffectivelyoverflowed.|Soitistryingtocomputethisunboundednumberofroutesintherecursivepartofthewithstatementandneverevengetstothequerythatwewanttoexecute.|OK,here'smyfirstattemptatfixingtheproblem.|Weknowthatwe'renevergoingtowanttotakeaarbitrarilylongroute.|We'renevergoingtowanttogoaroundacyclelotsoftimesasourcheapestwaytogetfrompointAtopointBsowhatI'vedonehere,andI'mnotgoingtogointothisingreatdetail,butIhaveaddedaconditionintherecursionthatsays"I'monlygoingtoaddanewroute,anewrouteintomyrecursivelydefinedroutetablewhenthetotalcostofthatroute,andthat'sdefinedasthecostplustotalherewhenweadded,islessthenallofthewayswecanalreadygetfromthatplace,tothatorigintothatdestination.|Soinotherwords,I'monlygoingtoaddcheaperroutesthantheonesthatarealreadythere.|Andbytheway,iftherearenoroutesalreadyfromtheorigintothedestinationthenthiswillbesatisfiedandwewilladdthatfirstroute,thenafterthatonlyaddingcheaperones.|Solet'stryrunningthisqueryandseewhathappens.|Well,wegotanerror.|Nowthisisnotaruntimeexecutionerror.|Thisisactuallyanerrorthatsayswe'renotallowedtorefertoourrecursivelydefinedrelationinasubquerywithinourrecursion.|TheStructured Query Languagestandardactuallymightallowthisparticularuse,butIdon'tknowthatanyimplementationactuallyhandlesit.|Itcanbefairlydifficulttohandleacasewhereyouhavetherecursivelydefinedrelationinasubqueryaswellasintheouterqueryhere.|Sothat'sobviouslynotgoingtosolveourproblem.|Nowthere'sactuallyafeatureofBasicStructured Query Languagethatcanhelpusherewithourproblem.|There'ssomethingcalledLimit.|Weactuallydidn'tdiscussthisintheStructured Query Languagevideos,butthatsaysjustgiveusthisnumberofresults.|Solet'ssaythatwe'regoingtohaveourrecursionherefortheroots,butdownherewe'regoingtosayIonlyneedupto20resultsforhowIgetfrompointAtopointB.|Andtheposarysystemactuallymakesuseofthelimitcommandinthefinalquerytorestricttherecursion.|It'sanicefeature,anditwasaddedspecificallyforthisproblemofpossiblyinfiniterecursionswhereweactuallydon'twantittobeinfinitebecauseweonlyneedafinitenumberofanswers.|Okay,so,let'sgowiththathereandwe'llseethatAh,great.|Everythingworkedwell.|WegotourrootsfromAtoB.|AndIdohave20roots,Imean,sothey'regettingveryexpensive.|DownhereI'mgoingtogoaroundandaroundthemidwestwhilelotsandlotsoftimesbutthatdidthelimittherecursionitdidstopunlikeourquerywherewedidn'thavethelimitanditjustwentonindefinitely.|Sothatlooksprettygood,withoneunfortunateproblem,whichisifwestillwanttheminimum,we'regoingtoagaingetainfiniteexecution.|Sotheoldresultisstillsittingherebutnowthesystemischunkingonbecausethelimithereisappliedtothismintothenumberoftupimittherecursion,we'realwaysgoingtogetonlyonetupleinourresult.|Soevenifwesaidlimitonehere,we'dstillgettheinfinitebehavior,sowehaven'tquitesolvedourproblem.|Okay,so,here'swhatwe'regoingtodo.|Aesthetically,maybeit'snottheabsolutelybestsolutionbutI'mgoingtoarguethatit'saprettyreasonableone.|Wetriedlimitingourrecursiontoonlyaddnewroutesthatwerecheaperthanexistingroutestoandfromthesameplace.|Weweren'tallowedtodothatsyntacticallytherecursivewithstatementdidn'tallowthesubquerywiththerecursivelydefinedrelationinit.|Sowe'regoingtodoadifferentchangeherewherewe'renotgoingtoaddnewrootstoourflightwhenthelengthoftheroot,inotherwordsthenumberofflightscontributingtothatroot,isgreaterthanorequaltoten.|Sohowdowedothat?|We'regoingtoaddtoourrecursivelydefinedrelationroutetheorigin,destinationandtotalcostofthat.|Andthenwearegoingtoaddthelength.|Andsothat'sgoingtoputineachroottupple,howmanyflightswereinvolvedintheroot.|Solet'sseehowwedothatwithourrecursion.|Westillhavethebasecasehereandtherecursivelydefinedunion.|Inourbasecase,we'regoingtobeaddingtoourroutethenon-stopflights,sowe'llhaveexactlywhatthoughtwehadbefore,andthenwe'llhavetheconstantonetosaythatthisnon-stopflightisjustoneflight.|Thenwhenwedoourrecursion,we'rejoiningourrouterelationthatwe'rebuildingupbyextendingitwithanadditionalflightexactlyasbefore,butthereistwochangeshere.|Oneofthemisthatwe'regoingtocomputeournewlengthbyaddingonetotheexistinglengthoftherootforournewrootbecausewe'readdingoneflight.|Andthenwe'reonlygoingtoaddtupplestotherootrelationwhenthelengthoftheroutethatwe'readdingislessthanten.|Sonowlet'sseewhathappens.|I'mgoingtostartagainbylookingatallofthecostsofgettingfrompointAtopointBandthenwe'lltaketolookatfindingtheleast.|So,we'llgoaheadandexecutethequeryandweseethatwehave,one,two,three,four,fivewaysofgettingfromAtoB,wherethelengthofthenumberofflightsinvolvedislessthanorequalto10.|Weseeourfriendshere.|Thiswasthenonstopflight.|ThiswastheonethroughBoston.|Here'sourfavoriteoneandthere'safewmoresothesearegoingtogothroughthatcycleacoupleoftimes.|Butoncewegettothelengthoften,we'renotgoingtoaddanymore,sowe'vegotterminationandifwewanttochangeittofindtheminimumcostflight,thenit'sjustthemintotalasbefore,andwe'llfindgoodold175.|Nowwhat'sunaestheticaboutthis,isthatwe'reactuallylimitingtheamountofrecursion.|So,thewholepointofwritingrecursivequeriesiswhenwedon'tknowtheminimumnumberofcomputationsthatweneedtodotogetouranswer.|Somaybeitwouldsohappentoturnoutthatmorethantenflightswererequiredtogetthecheapestand,ifthatwasthecase,thenwewouldn'tgetourrightanswer.|Ofcourse,wecouldchangeittoahundredandwe'dstillgettheoneseventyfive.|And,youknow,honestlywecouldchangeitto10,000andyoucan'tseeithappeningherebutitisactuallyrecomputingthat175evenwhenIputin10,000.|Icanevendoa100,000andstillgoingtoworkforme.|So,ifwepresumethatnobodywantstotakemorethana100,000flightsinordertogetfromPointAtoPointBinthecheapestfashionthen,thiswouldbeareasonablewaytoboundtherecursionandgettheanswerthatwewant.|Eveninthepresenceofcyclesinourrelation.|Inthisvideowe'llbeexploringsomefurtherissuesinvolvedinrecursionintheStructured Query Languagelanguage.|FirstareminderofhowStructured Query Languageimplementsrecursion.|There'sawithstatementinStructured Query Languagethatcanbespecifiedtohaverecursivelydefinedrelationsinit.|Wesaywithrecursive,andthenwedefineasetofrelations,wherethequerytofindrelationcouldinvolvetherelationitself,sothat'swhererecursionpopsin.|Andthen,attheendthefinalresultisaquerythatmightinvolvethoserecursivelydefinedrelationsaswellasothertablesinthedatabase.|Aswesawinthepreviousvideoanddemo,it'sverycommonforrecursivelydefinedrelationsinthewithstatementtotakethestructureofhavingabasequerythatdoesn'tinvolveR,therecursivelydefinerelation,unionedwiththerecursivequeryandwesawmanyexamplesofthatform.|ThefirstthingIwanttotalkaboutinthisvideoiswhat'scalledlinearrecursion.|LinearrecursionspecifiesthatintherecursivedefinitionofR,andagainlet'sassumeittakesthisformofthebasequeryunionandtherecursivequery.|Intherecursivequery,ThereisonlyonereferencetotherecursivelydefinedrelationR.Solet'stakealookatanexampletounderstandlinearrecursionandnonlinearrecursion.|thefirstexampleweusedwhenweintroducedrecursionwasfindingancestorrelationshipsfromabasetablethatjusthasparentchildrelationshipssoabasictransitofclosureoperationandthequerywewantedtorunwastofindallofMary'sancestors.|Andhere'sthequerythatwewrote.|Itdoestaketheformofhavingabasequeryhere.|Whichsaysifwehaveaparentrelationshipthat'salsoanancestorrelationship.|Andthentherecursionoccursinthesecondpartoftheunionwherewejointherecursivelydefinedancestorrelationship,ancestorrelation,withparentssothatweextendtheancestorswithonemoregeneration.|Nowthisquerydoeshavelinearrecursionbecauseweonlyhaveoneinstancehereoftherecursivelydefinedrelation,ancestor.|Solet'stakealookatwhathappensunderneathwhenthisqueryisexecuted.|Westartwithourparenttable.|Andhereitiswithaparentandchildandlet'ssupposewehavesay,SueandJohn,andJohnandMaryforexample,inourparenttable.|Theninwhat'seffectivelythefirstiteration,thebasequeryhereisrunthatcopiestheparenttabletotheancestortable.|SonowwehaveSueandJohn,andJohnandMary,andanythingelsethatwehadintheparenttableintheancestortable.|Astheiterationcontinueswe'reeffectivelyjoiningtheparenttableandtheancestortabletogetadditionaltuplesintheancestortable.|Forexample,weseethatSueandJohn,theSueandJohntuplehere,wouldjoinwiththeJohnandMarytuple,andthatwouldgiveusSueandMaryintheancestortable.|Theiterationcontinuesuntiltherearenonewtuplestoaddtotheancestortable.|Andthenwe'redonewithourrecursivelydefinedrelation,andwecangoaheadandexecutethefinalqueryinthewithstatement.|Andagain,oftenwhenIsaywe,Ireallymeanwethesystem.|Allofthis,isofcourse,beingperformedbythesystemasitexecutestherecursivelydefinedwithstatement.|Now,let'stakealookatanon-linearexpressionofthesamequery.|Andhereitis.|Whatweseehereisthattheprimarychangeisrightinhere.|Insteadofjoiningtheparentwiththeancestorintherecursivehalf,we'regoingtojointwoinstancesoftheancestorrelation.|Andlet'sseewhathappensduringexecutionwhenthisishowweexpressourrecursion.|Soweagainstartbycopyingthecontentsoftheparenttableintotheancestortableaspartofthebasequery.|AndI'vealreadyshownthathere.|But,now,insteadofduringiterationjoiningtheparenttablewiththeancestortable.|We'reactuallygoingtojointheancestortablewithitselftogeneratenewtuples.|Forexample,wewilljointhefirsttwotuplesinancestorwitheachother,Sue-JohnandJohn-Mary,inordertoobtainwhatwasthesametupleweobtainedwiththelinearrecursion,whichwouldbethetuplewithSueandMary.|Justaquickreminder,Iintendedtosaythisearlier,butit'sthefactthatwehavethesetworeferencestoancestorintherecursionhere,thatmakesitnon-linear.|OKsowhat'sthedealwiththesetwoqueries?|Whymightwepreferoneformofthequeryovertheother?|Andtakemywordforit,bytheway,wedogetequivalentresultstothequeryinitslinearandnon-linearversions.|Well,here'ssomeprosandconstonon-linearversuslinear.|Forthisparticularqueryandactuallyingeneral,whenwecanexpressaquerybothways.|Firstofallthere'ssomeplusestothenon-linearsothequerylookscleaner.|Ifyougobackandlookatthe2queriesthenon-linearversionissortofmoresymmetric,alittleshortereventoexpress,thanthelinearversion.|Secondofall,thenonlinearversionactuallyconvergesfastertothefixedpoint,tothefinalstate,thanthelinearversion.|AndI'mgoingtoshowthatalittlebinary digitabstractlybecauseitisactuallyfairlyimportant.|SoI'mgoingtocreatethisabstractexample,parent-childrelation,whichisgoingtobecompletelylinear,justforillustrativepurposes.|Sowehavethispersonherewho'stheparentofthepersonhere,who'stheparentofapersonhere,andsoon.|We'regoingtomakeiteightlevelsdeep.|Sothisisanabstractionofour"aparent"table,andnowlet'sseehowancestorsarecomputed.|Sointhefirststepwe'lladdoneancestortupleforeachtupleintheparentrelation,sothepurplearethetuplesthatareaddedtoancestor.|Thenintheseconditerationwe'regoingtojointhosewiththemselves.|I'msorry,we'regoingtojointheancestortupleswithparenttuplessoeachancestortuplecouldbeextendedbyone.|Sothat'sgoingtogiveusallpairsoftuples.|I'msorry,it'salreadygettingabinary digitcrowdedhere,butIthinkthatyouwillgettheidea.|Onthenextiterationwe'regoingtoagaintakeourancestortupleandextendthembyone,byjoiningthemwithparent.|Soafterthesecondwe'llhavealltripleshere,soallgreat-grandparentrelationships.|OK,andthat'sabigmess.|Butyoucanreallyseewhat'sgoingon.|Eachtimeweiterate,wegetonemoregenerationaddedintotheancestors.|Andnowlet'sthinkaboutwhathappenswhenweusethenon-linearversion.|Whereafterthefirststep,wejoinancestorwithitselfinsteadofancestorwithparent.|Soasbeforeonthefirststep,andnowI'mgoingtomakethesered,theancestorrelationwillcontainexactlythesameastheparents.|Andthesecondstepisthesameaswell,we'regoingtojoinancestorwithitselfbut,sinceeachoneofancestorisonlytheparentrelationship,we'reagain,goingtogetallpairsinthesecondstepoftheiteration.|Thedifferencebeginsinthethirdstep.|Nowwe'rejoiningancestorwithitself.|Sowewillbejoiningthesetwo-stepancestorswiththesingleones,justlikebefore,togetallthethrees.|Butwewillalsobejoiningtwoswithtwos.|Inotherwordswewilljoininggrandparentrelationshipswithgrandparentrelationships.|Andwewillbegettinginthatsameiterationthefours.|Soasyoucansee,thenonlinearversiondoesconvergefaster.|Nowthisexampleisverysmallsoit'snotasblatantlyobvious.|Butthelinearversionisgoingtotakealinearnumberofiterationsinordertoconvergetothefinalrecursivelydefinedrelationcontents.|Whereaswhenweusethenon-linearversion,it'sactuallylogarithmic.|Soforalargedatabaseitcanbeconsiderablyfaster.|Sowhataboutthedownsidesofnon-linearrecursion?|Well,themajordownsideisthatit'shardertoimplementorcertainlyhardertoimplementefficiently.|AndasaresultofthatactuallytheStructured Query Languagestandardonlyrequireslinearrecursion.|Andthepostgressystemthatwe'vebeenusingalsoonlysupportslinearrecursion.|Sobacktothebasicformofourwithrecursivestatementinordertointroduceadifferenttopic,whichisthetopicofmutualrecursion.|Mutualrecursion,asIalludedtointhepreviousvideo,isthecasewhereoneofourrecursivelydefinedrelationsdoesnotrefertoitselfbutrathertoadifferentrecursivelydefinedrelation.|Andthatonerefersbacktothefirstone.|Orwecouldevenhavealoopofthreeorfourormore.|So,theideaisthatwecan'tlookattheseindividuallytoseetherecursionbuttogethertheyarerecursiveandtheyhavetokindofbecomputedintandem.|So,theexampleI'mgoingtousehereiswhat'sknownashubsandauthorities.|Hubsandauthoritieswasanalgorithmforwebsearchingactually.|Forannotatingwebnodesforthepurposesofsearching.|WasdevelopedaroundthesametimeasGoogle'spagerank,Iguesswecanseewhichonewonout.|Buthubsandauthoritiesactuallyquiteinterestingjustinwhatitdoes.|LetmegoaheadanddefinethemeaningofHudsonauthorities,andthenshowhowmutualrecursioninStructured Query LanguagecanbeusedtocomputetheHudsonauthoritiesinadatabasethatcontainsalink,astructure,agraphbasically.|Sohere'salittlegraphandwe'regoingtoassumethateachnodehasanumber,say,associatedwithit,andthatwehavearelationcalled"link",thatjusttellsustheedgesofthegraph,sothesourcenodeandthedestinationnode.|Soinagraph,we'regoingtodesignatesomeofthenodesashubnodesandsomeofthenodesasauthoritynodes.|Andwearegoingtodefineahubnodetobeanodethatpointstoatleastsomenumber,let'ssaythreeauthoritynodes.|Andsimilarly,we'regoingtosayanauthoritynodeisanodethat'spointedtoby,let'ssayatleastthreeagain,hubnotes.|Andbythewaythisnumbersthreeandthreedon'thavetobethesame.|AndanotherthingIwantedtomentionisinagraphsayrepresentingtheweb,wewouldn'texpectalargefractionofthenotestobehubsinauthorities,manywouldbenormalnotes.|But,again,thisjustforillustrativepurposes,butitalsoservestoteachyouaboutthehubsinauthoritiesconcept,whichiskindofinteresting.|Nowyoucanseealreadyhowmutualrecursionisgoingtofitintothepicture.|Buthowarewegonnagetstarted?|Theonlywayyoucanactuallygetstartedistohavesomenodesthatarepredesignatedashubsandauthorities.|Forexample,ifwepredesignatedasauthoritiesthesethreemiddlenodeshere,thenwecouldcomputethefactthatnodeoneisahub.|So,we'llalsoassumethatwehavetwomorerelationsinourdatabase.|Oneofthemgivesusasetofnotespredesignatedashugsandtheotherasetofnotespredesignatedasauthorities.|Andourjobistowriteaquerythatcomputesallofthehubandauthoritynodesbasedonthismutuallyrecursivedefinitionhere.|Sohereisthequerythatdoesit.|Bytheway,youhavecertainlynoticedthatI'mnotdoingalivedemooftherecursivequeriesinthisparticularvideo.|NonlinearrecursionisnotsupportedinthePostgressystem,andit'salsonotpartofthAQLstandard.|MutualrecursioninlimitedformsispartoftheStructured Query Languagestandardbutit'salsocurrentlynotsupportedinPostgres,soI'veusedtheniceinterfaceisheretogetthecoloringofourqueries.|Butthesequeriescurrentlydon'trunonthesystemsthatwe'reusing.|OK,sobacktoouractualqueryhere.|So,thisisaquerytocomputehubsandauthoritiesgiventhatwehaveastartingsetofhubnodesandastartingsetofauthoritynodes.|And,thenwehavethelinkrelationthatgivesusthestructureofourgraph.|Sowe'regoingtocomputetorelations.|Thehubrelationswiththenodesthatarehubs.|Theauthoritiesrelationofthenodesthatareauthorities,andtheyaregoingtohavemutualrecursionbetweenthem.|So,let'stakealookfirstatthehubsandwe'llseethatthestructureofthequeriesforhubsandauthoritiesisvery,verysimilar.|Sothebasecaseforthehubsisthatthenodesthatareinthehubstartrelationareinthehubrelation,ofcourse.|Andthentherecursivequeryhereisalittlebinary digitcomplex.|Sowhatwe'regoingtofindislinks,elementsinourlinkrelation,wherethedestinationisanauthorityandsowe'regoingtofindallofthesourcesthatpointtoanauthority.|We'regoingtogroupbythesource,soweconsidereachnode,oneatatime.|Andthenwecounthowmanytimesitappearsinthelinkpointingtoanauthority.|So,thisisgoingtogiveusanodesthatpointtogreaterthanorequaltothreeauthoritieswhichwasourdefinitionofhubs.|Nowhereofcoursewe'rereferringtoauthoritywhichitselfisarecursivelydefinedrelation.|Theauthorityrelationisverysimilar,asIsaidwestartwithourbasecaseofaddingnodesthatareintheauthoritystartrelation.|And,thenweconsiderdestinationsinsteadofsourcesinourlinkrelationsuchthatthereareatleastthreesourcesthatarehubsandthat'swhatwe'vegotdownhere.|So,thisisgoingtogiveuselementsthatarepointedtobygreaterthanorequaltothreehubs.|Andhereofcourseweareusinghub,whichisalsoarecursivelydefinedrelation.|Soyoucanthinkofthesetwoasworkingintandem.|Youcanthinkofthesystemassortofiterativelyaddingtothehubsandtheauthoritiesuntilthere'snothingmoretoaddtoeitherone.|Nowonethingthatthisdefinitionofhubsofauthoritiesandthiscomputationallows,isforanodetobebothahubandanauthority.|Andthereisnothingwrongwiththatifthestructureofthegraphyieldsthatresult.|But,let'ssupposewedon'twantnodestobeallowedtobebothhubsandauthorities.|Wewanteverynodetobeeitheroneortheother.|Thatwillrequireustomodifyourquery.|Tonotaddnodestobecomehubsifthey'realreadyauthorities.|Ortohavenodesbecomeauthoritiesifthey'realreadyhubs.|Solet'sgoaheadandmodifythequerytoincorporatethatadditionalconstraint.|So,here'sthequeryand,bytheway,justareminderthatyoucandownloadthesequeriesfromourwebsiteeventhoughyoucan'trunthematthispointintime.|Thedifferenceinthisqueryfromthepreviousoneisoneadditionalconditioninthedefinitionofhubsrighthere,sayingI'mnotgoingtoaddanode,asourcenodetothehubs,ifit'salreadyintheauthoritiesandsimilarlyI'veaddedonemoreconditionhereinauthoritiesthatI'mnotgoingtoaddanodetoauthoritiesifit'salreadyahub.|Nowlet'ssupposewehavethefollowinggraphstructure.|Wehaveanodeherethathasn'tbeenlabeledasahuborauthorityyet.|Andlet'ssupposethatthisnodeispointedtobythreenodesthathavealreadybeendesignatedashubnodes.|Andfurthermore,thisnodepointstothreenodesthathavealreadybeendesignatedasauthorities.|Sobyourdefinition,thisnodecouldbeahubbecauseitpointstothreeauthoritiesanditcouldalsobeanauthoritybecauseitispointedtobythreehubs.|Butthequerywe'vegivennowisnotgoingtoallowustolabelthisnodeasbothahubandauthority.|Andjusttobeclearinthepreviousquerywewouldhaveputthisnodeinboththehubrelationandtheauthorityrelationbut,now,we'renotgoingtobeabletodothatbecauseoftheseconditionsrightdownhere.|So,actually,whetherthisnodeendsupasahuboranauthoritydependsoneffectivelywhichoneofthesearmsofourwithstatementgetsexecutedfirst.|Ifwefirstconsiderthepossibilityofthenodebeingahub,thenitwillbeputinthehubrelationandthenitwon'tbeallowedtobeputintheauthorityrelation.|Ontheotherhand,ifwefirstmakeanauthority,thenwhenwelookforcomputingthehubrelation,itwouldn'tbeallowedtobeahub.|Soyoucanthinkofthisasasortofnon-deterministicbehaviororifyou'reintotheorythere'sanon-uniquefixedpointoftherecursion,andthisisconsideredasanotgoodthing.|Generally,databasepeople,whentheyrunqueries,wouldliketohaveoneanswerallthetime.|Theyliketohavedeterministicanswersfortheirqueries,soactuallythistypeofmutualrecursionisnotallowedintheStructured Query Languagestandardandtherealcruxoftheproblemhereisthatonerecursivelydefinedrelationisdependingnegativelyonanotherone.|Sothisnegativedependenceiswhatcausestheproblem.|Andactuallywecanhaveanegativedependenceevenwithoutmutualrecursion.|Wecoulddefinearelationthatsortofdependsnegativelyonitselfinasub-queryandthatwouldn'tbeallowedeither.|Sothatcompletestheexampleofhubsauthoritiesandagain,whatwe'retryingtoshowfirstofall,ismutualrecursionwhichcanbequitepowerful.|And,secondofall,therestrictionthatwecan'thavenegativesubqueriesacrossrecursivelydefinedrelations.|ThelastthingthatIwantedtomentioninthisvideo,it'snotinthetitleofthevideosincewearefocusingmostlyonnonlinearandmutualrecursionisrecursionwithaggregation.|Andletmejustshowasimpleabstractexample.|SowehavearelationPthatjustcontainsoneattributewecanassumethatit'sintegers.|Andwe'regoingtotryinourwithrecursivestatementtocomputerrecursivelydefinerelationcalledRthatcontainsthetuplesinP,togetherwiththesumofthevaluesintheattributeofP,IwilljustwritethatassumofP.Sohere'showwewriteitinStructured Query Language.|WehaveourbasecasewhichisthatthetuplesinParealsoinR.AndthenwedoourUNIONoftherecursivepartwhichsays,andalsoinRIwanttohavethesumofthetuplesinR.Solet'ssaythatPstartsoutwithtwotuples,thevaluesoneandtwo.|SowhatdoesthequerycomputeforR?|WellcertainlyoneandtwoareinRbasedonthefirstparthere.|AndthenbasedonthesecondparttheninthefirstiterationRshouldalsocontainthesumofR,whichis3.|ExceptassoonasweputthreeinthesumofRisn'tthreeanymore,thesumofRissix.|Soshallwecrossoutthe3inandputsixthere?|ButthennowthesumofRhasbecomesix,seven,eight,nine.|Youcanseetheproblem.|There'snogooddefinitionforwhatRshouldcontainbasedonthisrecursion.|Andforthatreasonactually,recursionwithaggregationisdisallowedintheStructured Query Languagestandardandisn'tsupportedbyanysystem.|So,tosummarizeaboutbothofourvideosaboutrecursion,Structured Query LanguagehasintroducedrecursionintothestandardaspartoftheWITHstatement.|WhetherthekeywordRECURSIVEgoeswiththeWITH,orwithrecursivelydefinedrelationsisabinary digitinconsistent,butinanycase,thebasicideaisthesame.|Whenwehavethisstatement,wecanwritequeriesthatrefertotherelationthat'sbeingdefined.|Andwecanalsohavemutualrecursionsbetweenthequeriesthataredefinedinthewithstatement,andfinallytheresultisarunningofthefinalquerywhichmightinvolvetherecursivelydefinedrelations.|AddingrecursiontoStructured Query Languagedoesstrictlyextendit'sexpressiveness.|Therearequeriesthatcan'tbewrittenwithoutrecursion.|Theyusuallyinvolvesometypeofunboundedcomputation,forexample,computinganynumberofflightsoranydepthsofancestors.|Usuallythere'satransitiveclosureflavortothosequeries.|Withoutrecursiontheiterationinvolvedincomputingrecursivelydefinedrelationhastobewrittenoutsideofthedatabase,hastobewrittenincodeinsomefashion.|NowwesawthatthebasicfunctionalityofStructured Query Languagerecursionislinearrecursion,whereweonlyhaveoneinstanceoftherecursivelydefinedrelationinthequerydefiningtherelation.|Wecanwritealotwithlinearrecursion.|It'sveryexpressiveandcanexpressmostofthenaturalquerieswemightwanttodoinrecursiveStructured Query Language.|But,thereisextendedfunctionality,there'snon-linearrecursion.|Wesawthatnon-linearrecursioncanleadtonicerlookingqueriesandcanconvergefasterbutisactuallymoredifficulttoimplementefficiently.|Andthenthere'smutualrecursionwhereR1heremightbedefinedintermsofR2whichitselfisdefinedintermsofR1andwesawoneinterestingexamplewherewe'dliketousemutualrecursionwhereitwasappropriate.|Finallyintermsofwhatwasdisallowedrecursivesubqueries;bythatImeanreferencingrecursivelydefinedrelationinsubquery,isactuallyintheStructured Query Languagestandardnotsupportedbythepostgressystemthatwewereusing.|Whenareferenceinasubquerytoarecursivelydefinedrelationisnegative,sortoflikeanotexistornotandthatisdisallowedbytheStructured Query Languagestandardandwesawthatthatcanleadtosortof,non-obviousbehavior,non-deterministicfinalresults.|Andfinally,aggregationcausescomplicationaswellinrecursionandisdisallowed,too.|Thefeaturesthataredisallowedreallydon'tcomeupthatoftennaturallyandonceagain,andletmejustemphasizethatthebasicfunctionalityoflinearrecursiondoesallowonetoexpressalotofreallynicequeriesanddoesextendtheexpressivenessoftheStructured Query Languagelanguage.|ThisvideointroducesonlineanalyticalprocessingorOnline Analytical Processing.|AsubsequentvideowillhaveademoofOnline Analytical Processingqueriesinaction.|Overall,databaseactivitycanbedividedintotwobroadclasses.|Oneofthem,thetraditionalone,isknownasOnline Transaction Processing,oronlinetransactionprocessing.|Theotherone,thesubjectofthisvideo,cameaboutmorerecently,andit'sknownasOnline Analytical Processing,oronlineanalyticalprocessing.|Onlinetransactionprocessingistypicallycharacterizedbyshorttransactions,bothqueriesandupdates.|Thingslikeupdatinganaccountbalanceinabankdatabaseorloggingapageviewinawebapplication.|QueriesinOnline Transaction Processingdatabasesaregenerallyfairlysimple.|FindanaccountbalanceorfindtheGPAofastudent.|Theytypicallytouchsmallportionsofthedata.|Andupdatesinthisenvironmentcanbefrequent.|Wemightbemakingairlineseatreservationsorupdatingaonlineshoppingcart.|Online Analytical Processingisprettymuchtheoppositeinallrespects.|InOnline Analytical Processing,wehavelongtransactions,oftencomplexanalysisofthedataordataminingtypeoperations.|ThequeriesasIsaid,canbecomplexandespeciallytheyoftentouchlargeportionsofthedataratherthansmallportionsasinOnline Transaction Processing.|AndupdatesintheOnline Analytical Processingenvironmenttendtobeinfrequent,infact,sometimesintheOnline Analytical Processingenvironmenttherearenoupdatestothedataatall.|Now,thesetwoareextremesandreallythereisaspectrumbetweenthosetwoextremes.|Wemighthaveasortof,moderateamountofupdateandqueriesthattouchamoderateportionofthedata.|Butthefactisthatdatabasesystemstraditionallyweredesignedforthefirstextreme.|Andthenspecialtechniquesweredevelopedfortheotherextreme.|Sothesystemsaretunedforthetwoextremes.|Anddependingononesworkloadonemightchoosetousedifferentoptionsinadatabasesystemjustalittlebinary digitmoreterminologyintheOnline Analytical Processingworld.|There'saconceptcalleddatawarehousing.|It'sreallyasoftwarearchitecture.|Theideaisthatofteninenterprizesorotheroperation,therearelotsofoperationalsources.|Soyoucanthinkofapointofsale,forexample,mighthavemany,manyOnline Transaction Processingdatabasepiecesrelatedtoanenterprise,anddatawarehousingistheprocessofbringingthedatafromallofthosedistributedOnline Transaction Processingsourcesintoasingle,giganticwarehousewherethepointthenistodoanalysesofthedata,andthatwouldfallundertheOnline Analytical Processingcamp.|AnothertermyoumightencounterisdecisionsupportsystemsalsoknownasDSS.|Thisisn'treallyanexactterm.|It'sgenerallyusedtotalkaboutinfrastructureforagainlargescaledataanalyses.|So,ifyouthinkofadatawarehouse,wherewe'rebringinginalotofdatafromoperationalsources,andthatwarehouseistunedforOnline Analytical Processingqueriesthatwouldbethoughtofasadecisionsupportsystem.|And,ofcourse,thissystemisdesignedtosupportdecisionsthataremade,again,basedondataanalysis.|Now,let'sgetintosometechnicaldetailsofOnline Analytical Processing.|Frequentlyapplicationsthataredoingonlineanalyticalprocessingaredesignedbasedaroundastarschema,soit'sacertaintypeofrelationalschema.|Inastarschema,there'susuallyonefacttable.|Thatwillbeatypicallyverylargetable,itwillbeupdatedfrequently.|Oftenit'sactuallyappendonly,sothereareonlyinsertsintothefacttable.|Andthentherearemaybemanydimensiontables.|Thoseareupdatedinfrequentlyanddon'ttendtobeaslarge.|Soexamplesofafacttablemightbesalestransactionsinasalesdatabaseorinauniversitydatabase,maybestudentsenrollingincoursesorinawebapplicationloggingthepageviews.|Inallofthesecaseswecanseethatthefacttablecanbeverylargeandcanbeappendonly,soinsertsonly.|Examplesofdimensiontablesmightbeinasalesdatabasestore'sitemsandcustomersinacollegeenrollmentdatabase.|Maybestudentsandcoursesinawebapplication.|Maybewebpageshisusersandadvertisers.|So,youcansee,thatthesearegenerallysmallertables,they'remorestable,they'renotupdatedasfrequently.|Youcansortofthinkofdimensiontablesasthingsintherealworldandthenfacttablesasloggingthingsthathappened.|It'snotalwaysdividedthiswaybut,it'snotabadapproximation.|Now,youmightbewonderingwhyisitcalledastarschemaandit'scalledthatbecausewehavethefacttablesortof,centrallyreferencingdimensiontablesaroundit.|So,I'lldrawthepicture.|Let'stakeaparticularexampleandlet'slookatthesalesdomain.|So,we'llhaveourfacttablehere,whichwillbethesalestableandthatwilllogsalestransactionsactions.|Itwillincludethestorewherethesalewasmade,theitemthatwassold,thecustomer,howmanyweresold,andthepricethatwaspaid.|Andthentheotherthreetablesarethedimensiontables.|Sothosethosearegivingusinformationaboutthestoresandtheitemsandthecustomers.|So,I'vedrawnapictureofourschemahere.|Wehaveourcentralfacttable,thesalestable.|AndwecanseethatthesalestablecontainsthesethreecolumnsI'veabbreviatedtheminthepicture:theStoreID,ItemID,andtheCustomerID.|ThestoreIDvaluesinthiscolumnwillbeforeignkeyattributestotheprimarykeyofthestoretableifyourememberourconstraintsvideo.|Sowecanthinkoftheseaspointersintothestoretable,leastspecificallymatchingstoreIDsoverhere.|Andwe'llhavesimilarlyouritemIDswillbeforeignkeystotheitemtable.|Iwon'tactuallypointtothevalueshere.|AndthenourcostumerIDsoverherewillbepointingtothecustomertable.|Soifyoulookatthissquinting,youwillseethatitiskindofastarschemawiththecentralfacttablepointingtothedimensiontablesaroundit,andthat'swherethenamecomesfrom.|Justalittlemoreterminology.|Thefirstthreeattributeshereinthefactfacttable.|Thesethreearewhatareknownasdimensionattributes.|Sothosearetheattributesthatareforeignkeysintothedimensiontables.|Thentheremainingattributesinthiscasethequantityandthepricearecalleddependentattributes.|Sothey'reIguessdependentonthevaluesforthedimensionattributesandtypically,querieswilltendtoaggregateonthedependentattributes.|We'llseeexamplesofthatinamoment.|So,nowthatweknownwhatastarschemalookslike,let'slookatthetypeofqueriesthataregenerallyissuedoverthisschema,andthey'recalledOnline Analytical Processingqueries.|Typicallyaqueryoverastarschemawillfirstjoinsomeoralloftherelations.|Andwhenyou'rejoiningthesaleasthefacttablewiththedimensiontables,youcanalmostthinkofitasexpandingthefactsinthesalestabletoincludemoreinformationaboutthesales.|Sincewehavetheforeignkeyswe'llbeadding,forexample,totheinformationaboutasale.|Moreaboutthestore.|Thecityandstateofthestore.|Forasaleitemwillbeaddingthecategorybrandandsoon.|Sothat'sthejoinprocessandthequerywilljoinasmuchasitneedsinordertodotherestofit'swork.|Itmightthenfilterthedata.|ForexamplewemightdecidethatinourqueryweonlycareaboutstoresinCaliforniaorcustomersinCalifornia,we'reonlyinterestedinshirtsandsoon.|Sotheycanfilteronthedimensionattributesafterjoining,orcouldfilteronthepriceorquantityaswell.|Afterfilteringthere'softenagroupbyanaggregation.|Sowemightdecidethatwe'reinterestedinfiguringoutourtotalsalesdividedbycustomerorbyitemorbystateorallofthose.|Andthentheaggregationmightsumupthesalesoritmightdeterminetheaveragepricethat'ssold.|We'llbedoinganumberofthistypeofqueryinourdemolateron.|Soifyouthinkaboutexecutingqueriesofthistype,theycanbequitecomplexandtheycantouchlargeportionsofthedatabase.|Sowe'reworriedaboutperformance,andourdataislarge,wedohaveaworry.|Runningthistypeofqueryonagiganticdatabaseoverastandarddatabasesystemcanbeveryslow,butoverthepastdecadeorso,specialindexingtechniqueshavebeenintroducedandspecialqueryprocessingtechniquesspecificallytohandlethistypeofqueryonstarschemasonlargedatabases.|Andagain,bylarge,justthinkaboutthenumberofsales,forexample,inalargeretailchain,oranumberofwebviews,orevenshoppingcartadditionsinalargeonlinevendor.|So,inallofthoseapplications,peopleareinterestedindoingOnline Analytical Processingqueriesandtheytendtouseasystemthatsupportsthesespecialtechniques.|Anothercomponentofgettinggoodperformanceinthesesystemsistheuseofmaterializedviews.|Youmightrememberthatmaterializedviewsareusefulwhenwehaveaworkloadthatconsistsoflotsofqueriesandnotsomanyupdates.|Andthat'sexactlythetypeofworkloadwehaveinOnline Analytical Processing.|furthermore,wehavemanyqueriesthattakeroughlythesamestructuresomaterialwiseweuseareusefulinthatsettingaswell.|NowletmeswitchgearsandintroduceadifferentwayoflookingatthedataintheseOnline Analytical Processingapplicationswithstarschemas,andit'swhat'sknownasadatacube.|SometimesthisisalsocalledmultidimensionalOnline Analytical Processingandthebasicideaisthatwhenwehavedatawithdimensions,wecanthinkofthosedimensionsasformingtheaxisofacube.|It'skindoflikeanNdimensionalspreadsheet.|Nowwecanhaveanynumberofdimensions,butfortheexamplesI'mgonnagive,thebestIcandrawisuptothreedimensions,andthat'swhypeoplecallacute.|Becausetheyknowhowtodrawthreedimensions.|Butagain,anynumberofdimensionsarepossibleinthisviewofthedata.|Sowehaveourdimensionsformingtheaxisofourcube.|Andthenthecellsofthecube,again,youcanthinkofitsortoflikecellsofaspreadsheet.|Arethefactofdata.|Orthedependentdata.|It'slikeinthepreviousexamplethatwouldbeourquantityandprice.|Andfinallywehaveaggregateddataonthesides,edgesandcornersofcornerofthecube.|Againsimilartohowyoumightaggregatecolumnsinaspreadsheet.|Solet'sgoaheadandI'lldomybesttodrawapicturetoexplainwhat'sgoingon.|Sohere'smycubewiththesethreeaxesthatI'vedrawninblack.|AndI'vedrawnthesedashlinesaswelltosortofgiveyouavisualideaofthecube.|ButI'mgoingtoactuallygetridofthesedashlinesrightnowjustsowedon'thavetoomuchclutter.|Soforoursalesexample,we'restickingwiththesameexample,wehave3dimensions.|Andthosewilllabelthethreethethreeaxisesofarecubeandinonedimensionwewillhavethestoresandanotherdimensionwewillhavethecustomershere,andinanotherdimensionwehavetheitems.|Thenwecanthinkofthepointsalongtheseaxesasbeingthedifferentelementsineachofthosedomains,orthedifferenttuplesineachofthosedimensiontables.|Soforexample,inthestoredomain,we'llhave,youknow,store1store2,store3andsoon.|I'mnotgivingthemanyfancynameshere.|Andso,eachofthoseisapointonthatdimensionandsimilarlyfortheitemswillhaveitem1item2item3andsoon.|Andforthecustomersalongthebottom,we'llhavecustomer1customernumber2,customer3andsoon.|Nowherecomesthetrickypart,especiallyfordrawing.|TheideaisIsthateverycellinthecube,soeverycombinationofitemcostumerinstorehasacellinthecube,sothiswouldbesortofafreefloatingcellhere.|AndThiswillhaveforourschemathequantityandthepriceforthatitem,thatcustomer,andthatstore.|Sothismightbethefloatingthingherethat's,youknow,ItemI32,Costumer4,andStore17,somethinglikethat.|Andthenfloatinginthereisthiscellwiththequantityandtheprice.|Nowweareassumingthatthere'sjustonequantityandpriceforthecombinationofthosethreeattributes.|AndI'llcomebacktothatinamoment,butlet'sassumethatfornow.|Sothat'swhatwehaveinthewholecentralareaofthecube.|Sonowonthefaces,edges,andcornerofthecubearegoingtohaveaggregateddata.|Andtheredoesneedtobewitheachdatacubeapredefinedaggregate.|Soforthisonelet'ssaythatwhatwewantasouraggregateisthesumofthequantitytimesthepricesowe'regoingtofigureoutthetotalamountthatwe'remakingfordifferentcombinationsofstores,items,andcustomers.|Sonowlet'sconsideracellonthefaceofthecube.|Soagain,I'mnotdrawingthisverywell.|Butlet'sassumethisisonthebottomfaceofthecube.|So,thisisforaparticularcustomer.|Saycustomer10,inaparticularstore,saystore7,andthen,sinceit'sonthebottomofthecube,sowedidn'tgoupthisdimensionhere,itconsidersallitemsforcustomer10andstore7.|Sothiswillbetheaggregateoverallitemsforthatparticularstoreandcustomer.|Andwe'dhavesimilarvaluesontheotherfacesofthecube.|Sothisfaceoverhere,forexample,wouldbeforaparticularitemandcustomeroverallstores.|Andthenonthefrontfaceofthecube,ifyoucouldimaginethat,wouldbeforaparticularitemandstoreoverallcustomers.|Nowlet'stalkaboutwhat'sontheedgeofthecube.|Soherewehave,sayforstore3,we'llhavetheaggregatevalueoverallcustomersanditemsinthispointforstore3.|SothatwillbethetotalsalesthatweconductedatstoreS3.|Overhereonthisedgewe'dhavethetotalforaspecificcostumerandoverhereforspecificitems.|Andthenfinally,wehaveatthecornerofthecubethefullaggregation.|Sothat'sgoingtobeinthiscasethesumofthequantitytimespriceforeverystore,customeranditem.|So,I'mnotagreatartist,butIhopethisgivesyousomeunderstandingofhowthedatacubeworks.|Soaswesawinthecube,wehaveonecellinthecubeforeachcombinationofstoreID,itemID,andcustomerID.|Soifthosethreetogetherformakey,thenit'sverystraightforward.|Ifthedimensionattributestogetherdon'tformakeythenwemightbepre-aggregatingalreadyinsidethedatacube.|So,wemightdecidetoalreadyhavesaythesumofquantitytimespriceforeachcombinationofstoreitemandcustomer.|Anotherpossibilityandit'sdonequitecommonlyistoaddtothefacttabletheattributedate,oreventhetime.|Andthatcanbeusedtocreateakey.|Typically,wewon'thavetwotransactionsatexactlythesametime.|Nowifwedohaveanattributeherecalleddate,onemightwonderisthatadimensionattributeoradependentattribute.|Actually,it'sprettymuchadimensionattributebecausewe'regonnauseitasanotherdimensioninourdatacube,butthedifferencebeingthatwewouldnothaveanactualdimensiontablelistingthedates.|Nowlet'smoveontoacoupleotherconceptsintheolapworldcalleddrilldownandrollup.|Theideaofdrilldown,isthatwemaybeexaminingsummarydataandthenwewanttogetmoreinformation.|Drilldownintothedetailsofthatdata.|And,actually,wecanthinkofthatveryspecificallyinaStructured Query Languagecontextasfollows.|Let'ssupposethatwehavethisqueryandStructured Query LanguagewhichfollowsbythewaythedescriptionofthequeryIhadearlierwherewe'lldoajoinandthenaselectionandthenitgroupedby,andfinallywehaveanaggregationhere.|Sothisqueryspecificallyislookingatourtotalsalesbrokenoutbystateandbrand.|Maybewe'lllookatthatandwe'lljustsaythat'snotenoughdetail.|Ineedmoreinformation.|So,todrilldownwhatwedoisaddagroupingattribute.|Soifweadded,forexample,category,whenweaddanothergroupingattribute,thatgetsusmoredataintheanswer-moredetailinourdata.|Rollupisexactlytheopposite.|Rollupsayswe'relookingatdataandwedecidewehavetoomuchdetailandwewanttosummarize.|Andsummarizeissimplyamatterofremovingagroupbyattributes.|Soifwetookoutstate,thennowwe'llonlyseeourdatasummarizedbybrandratherthanbrokenoutintostateandbrand.|Andlastly,IwanttoaddintroducesomeStructured Query Languageconstructs.|Theseareconstructsthathavebeenadded,fairlyrecently,totheStructured Query LanguagestandardinordertoperformOnline Analytical Processingqueries.|Andwe'llbeseeingtheseinourdemo.|Theconstructsarecalledwithcubeandwithrollupandthey'readdedtothegroupbyclause.|Whenweaddwithcubetoaquerywithagroupbywhathappensisthat,basically,we'readdingtotheresultofourquery,thefaces,edges,andcornerofthecube.|Usingnovaluesfortheattributesthatwe'renotconstraining.|We'llseethisclearlyinthedemo.|WithRollupissimilartoWithCube,exceptit'ssmaller.|Itactuallyisaportionofthedatacube,andthatmakessensewhenwehavedimensionsthatareinherentlyhierarchical.|Andagainwe'llseethatinthedemoaswell.|So,wecanconcludetherearetwobroadtypesofdatabaseactivity,onlinetransactionprocessing.|Short,simpletransactionstouchingsmallportionsofthedata,lotsofupdatingandOnline Analytical Processing,oronlineanalyticalprocessing,wherewehavecomplexqueries,longtransactions,mighttouchalargeportionofthedataandmightnotupdatethedataatall.|ForonlineanalyticalprocessingOnline Analytical Processingwesawthatstarschemasarefrequentlyused.|Wesawhowtoviewthedataasadatacube.|Ofcourse,thatcanbeinanynumberofdimensions.|Wejustusethreeforvisualization.|TherearetwonewconstructsinStructured Query Language:WithCubeandWithRollup.|Andfinallythistypeofquerycanbeverystressfulonadatabasesystemwhenwehaveverylargedatabases.|Sospecialtechniqueshavebeenintroducedintosystemstohelpperformthesequeriesefficiently.|Inthisvideowe'llbedoingalivedemonstrationofOnline Analytical Processing.|We'llcreateastarschemasimilartotheoneweusedinourpreviousexamples.|Itwillbesalesdatawithafacttableandseveraldimensiontablesandthenwe'lldoseveraldifferenttypesofOnline Analytical Processingqueries.|We'llshowafullstar-joinoverthestarschema.|We'llshowsomeexamplesofdrill-downandroll-up.|We'llalsoshowwhat'sknownasslicinganddicingwhichwehaven'texplainedyet,we'lljustdowhenwegettothosequeries.|Andfinallywe'llshowtheWithCubeandWithRollupclausesthathavebeenaddedtotheStructured Query LanguagestandardforOnline Analytical Processingqueries.|Forthosewe'llbeusingMySQL,actuallyforthewholedemowe'llbeusingMySQL.|MySQLsupportswithroll-up.|Neitheroftheothersystemsthatwe'vebeenusing,SequelLiteorpostgressupportswithrollupyet.|AndMySQLdoesnotyetsupportWithCube,butwe'llseethatwecansimulatethebehaviorWithCube,usingWithRollupcommandofMySQL.|Solet'smovetothedemo.|Hereweareinthedemo,wehaveafacttablethatcontainsinformationaboutstores,itemsandcustomers.|Wedon'tseemuchhereexcepttheirIDvalues.|Andwehavesixtytuplesloadedupinourfacttable.|Ourdimensiontablesarethecustomertable.|Wehavefourcustomerswithagenderandanage.|Wehaveouritemtable:fiveitems,acategoryoftheitem,justt-shirtsandjackets,justinblueandred,andfinallywehaveourstores.|AndwehavesixstoresthatareinvariouscitiesinSantaClara,SanMateoCountyinCaliforniaandKingCountyinWashington.|Ourfirstqueryissimplythecompletestarjoin.|So,we'rejoiningallfourtablesusingtheforeignkeyreferencesinthefacttable,tothekeysandthedimensiontables.|Nowsincetheseareforeignkeyreferences,youcanthinkofthisstarjoinassimplyextendingthetuplesinthesalestablewithfurtherinformationaboutthestoreitemandcustomermentionedineachone.|So,herewego.|Andweshouldexpectagainsixtytuplesintheresults,oneforeachtupleinthefacttable,andwecanseethatwehavetheinformationfromthefacttable,butthenwealsohavemoreinformationthatwe'vejoinedinfromthedimensiontables.|Nowit'snottypicaltodothecompletestarjoin,usuallywewouldhaveatleastconstrainedthestarjoininsomeway.|So,ournextquerywilldoselectionsandprojectionsontheJOIN.|We'regoingtolimitourselvestosaleswherethestateofthesaleisCalifornia,thecategoryist-shirt,theageofthecustomerislessthan22,andthelastconditionisactuallyoverthefacttable,sayingthepriceofthepurchasewaslessthan25.|Andnowwe'llreturnthecity,color,customername,andpriceoftheitem.|Werunthequeryandweseenowthatwehavejust5salesthatmeetourcriteria.|So,we'veseentheJOINwithconstraintsontheJOIN,butwhat'sevenmorecommoninOnline Analytical Processingapplications,istodogroupingandaggregationinordertoanalyzethedata.|Andwe'regoingtostartbylookingatgroupingitintheaggregationinvolvingthedimensionattributesinthegroupby,andthenthedependentattributebeingaggregated.|Thisisaverycommonformofquery.|Soherewe'llsaywewanttoanalyzeourdatabasedoncombinationsofstoresandcustomers.|So,we'llgroupbystoreIDandcustomerID.|Andthen,we'llsumuptoseethetotalsalesforeachcombinationofstoreandcustomer.|So,here'sourresult.|Now,maybenotthatmeaningfultousrightnow,justlookingatthestoreIDsandcustomerIDs,butforananalyst,itmightbemeaningful.|We'llseeinamomentdoinggroupbyanaggregationonotherattributesthatlookalittlemoreinteresting.|SonowI'lldemonstratetheconceptofdrillingdown.|Soyoumightrememberdrillingdownsaysthatwe'relookingatdatathat'saggregatedinsomefashion,andwedecidewewantmoredetail.|Wegetmoredetailbyaddingmoreattributestothegroupby,so,let'ssayinthiscaseIwanttobreakout,notonlybystoreandcustomer,butalsobyitem.|So,I'lladditemIDtothegroupby,andalsototheselect,andwhenIrunthisquery,IseethatIgetmoreresults,andInowhavemoredetailintheanalysisofthedata.|NowIdon'thave60tumblesinmyresulteventhoughI'mgroupingbyallthreedimensionattributes,becauseIdohaveinmyfacttablemorethanonetupleforsomecombinationsofstore,item,andcustomer.|Next,I'mgonnaintroduceaquerythatshowstheconceptcalledslicing.|Slicingofcourseevokesthedatacube.|We'vetalkedaboutthedatacubeinthepreviousvideo,andwespecificallyusedthisexampletodemonstrateathree-dimensionaldatacube.|So,theideaofaslicingqueryisaquerythatanalyzesasliceofthecubeanditdoesthatbyconstrainingoneofthedimensions.|SowhatIamgoingtodo,isaddtothisqueryaconstraintthatsayslet'sonlyconsidersalesthatarefromthestateofWashington.|AndwhenIaddthatwe'llcontinuetodothegroupbyanaggregation,butonlyonthatsliceofthecuberepresentingWashingtonstores,thesalesthatarefromWashingtonstores.|Soitmadeafewchangestothequery.|ThefirstthingweseeisthatIaddedthestorerelationtothefromclauseinordertoconstrainthestateofthesale,IhavetojoinwiththestoretablethatdimensiontablesothatIcanaccessthevalueofstatewhichisnotpresentinthesalestable.|SoIalsohadtoaddvariables,andIaddthejoinconditionforthesalestabletojoinwiththedimensiontable,andthenIaddtheconstraintthatthestateisWashington.|ThelastsmallchangeistoaddavariabletothestoreID,sothatIdon'tgetanambiguouserror.|Sonowlet'sgoaheadandrunthequeryandweseethatwedogetasubsetofwhatwehadbefore.|Andthatsubsetisthesliceofthedatacube,ifyouwanttothinkofitthatway,representingthesalesinWashingtonState.|Nowinadditiontoslicing,thereisalsoanotionofdicing,andagainifyouimaginethedatacube,whatadicedoesissliceintwodimensionsanditgivesyouachunkofthecube.|SoIamgoingtoaddaconditionontheitembeingsold.|Iamgoingtoaddthattheitemmustbered.|SothenI'mgoingtobelookingatthechunkofthedatacubethatidentifiesreditemspurchasedinthestateofWashington.|Sohere'sthequery;I'veaddedathirdrelationtothe"from"clause.|IaddedtheitemdimensiontablessothatIcanconstrainthecolortobered.|Ihaveaddeda"join"condition,joiningthefacttabletotheitemdimensiontable.|Ihaveaddedtheconditionthatthecolorisred.|Andfinally,IhadtoaddagainthevariablenamestomakesureIdidn'tgetambiguousattributereferences.|Sowe'llrunthisquery.|Andweseethatwegetanevensmallerportionofthedatacube.|Againadicewherewehaveconstrainedtwodimensions.|Sowehaveseendrillingdownandslicinganddicing,nowlet'stakealookatrollingup.|Rollingupsaysthatwe'relookingatourdataanalysis,andwedecidethatit'stoodetailed.|Wewanttohavelessdetail,inotherwords,moreaggregation.|Todothat,wetakeattributesoutofthegroupbyclause.|Solet'ssaythisisway,waytoomuchdetailandwejustwantoursalesbrokendownonitem.|Sowetakealloftheattributesoutofourgroupbyclauseexceptforitem.|Herewego.|Andthen,whenwerunthequery,we'llseemuchmoresummarizeddata.|Andhereitis,brokendownagain,justbyseparateitems.|Sofar,ourgroupingandaggregationhasbeenonthedimensionattributes,specificallytheIDattributesidentifyingthetuplesinthedimensiontable.|Andthatmaybemeaningfulforanalyses,butforthisdemonstration,it'smorefuntolookatattributesthatactuallymeansomethingtous.|So,let'stryafewqueriesthatgroupinsteadbasedonattributesinthedimensiontables.|We'llstillbeusingthefacttable.|We'llbejoiningitwithdimensiontables.|Andherewe'regoingtostartbygroupingonthestateandthecategoryofthesales.|Again,summingupthetotalsalesforthedifferentgroups.|So,hereweseethatwehavefourcombinationsofstateandcategoryCaliforniaorWashingtonjacketsandt-shirts,andthenwehavethetotalsalesineachofthosesowecanseeinbothstatesthesalesforjacketsaccountforconsiderablymorethanthesalesfort-shirts,butwedoalsonoticethatinCaliforniathere'salotmoresalesoft-shirtsthanthereareinWashington,andIguessthat'snotsurprisinggiventheweather.|Nowlet'sdemonstratedrilldownonthisquery.|Solet'ssaywewantalittlemoreinformation.|Maybewewantabreakdownbycountyinadditiontostate.|Sotodothat,weaddcountytothegroupbyclauseandtheselectclause,andwhenwerunthequeryweseewedonowhavemoredetail.|Wecansee,forexample,thatwehadmorejacketsalesinSantaClaraCountythaninSanMateoCountyalthoughthet-shirtswereapproximatelyequal.|Alittle,actually,moret-shirtsinSanMateo.|Thisisalittlesurprising,becauseSantaClaraisgenerallywarmerthanSanMateo,butit'sfabricateddata.|Nowlet'ssee,wewantitdrilleditoutevenfurther,andwewanttobreakourdatadownbygenderaswellastheotherattributes.|Inordertodrilldownbasedongender,Ifirstneededtoaddthecustomertabletoourfromclause.|Priortothis,weweren'tdoinganyanalysisthatinvolvedanyattributesofthecustomertable.|AndsoIneedtoaddthejoinconditionhere.|Andthentodothedrilldown,Iaddthegenderattributetothegroupbyandtotheselect.|Werunthequery,andwhatdowefind?|Well,wecansee,forexamplethatnottoomanyfemalesinSanMateoCountyarebuyingt-shirts.|Mostofthoset-shirtsalesarecountedforbymales.|Theotherthingwenoticeisthatwedon'thaveeverysinglecombinationofcounty,categoryandgender.|VeryspecificallywelookandwecanseethatnomalesinKingCountyboughtanyt-shirts.|Soweonlyhaveinourresult,thosecombinationsofdimensionvaluesthatactuallyappearinthefacttable.|Orinthejoinofthefacttablewiththedimensiontables.|Nowlet'ssupposeafterI'vegottentothislevelofanalysis,I'vedecidedthatwhatmightbemostinterestingisthedatabrokendownjustbycombinationofstateandgender.|Sothatwouldbearoll-upoperation.|Andrememberforroll-upItakeattributesoutofthegroupbyclause.|SoItakeoutthecountyandcategoryandI'mjustinterestedinstate/gendercombinations.|BythewayatthispointifIwantedto,IcouldremovetheitemtablebecauseI'mnolongerconstrainingbasedonitemsorgroupingbasedonitems.|ButI'lljustleaveitinfornow,it'snotgoingtomakeadifferenceinourresult.|OfcourseforefficiencyImightjustprefertotakeitout.|Anywaylet'srunthequeryandnowweseethatrolledupdata.|AndwhenwelookatitIguessourmainconclusionherewouldbethatinourdatabase,theCalifornianmalesarethebigspenders.|Sofareverythingwe'veseenhasactuallyjustusedtheregularStructured Query Languageconstructsthatwealreadyknewabout.|Althoughweweredemonstratingthemoverastarschemaandwe'reshowingthetypesofqueriesthatonetendstorunoverstarschema'sinOnline Analytical Processingapplications.|Nowwe'regoingtomovetothespecificconstructsthathavebeenaddedtoStructured Query LanguageforOnline Analytical Processing.|AsyoumayrememberthetwoconstructsarecalledWithCubeandWithRollupandtheyarewritteninthegroupby-clause.|Soourfirstqueryistheabsolutebasiccubequery.|Westartwithoursalesfacttable,wegrouponallthreeofitsdimensions,andthenweaddWithCube.|Andwhatwe'regoingtogetis,basically,thedatainthedatacubethatwesawinourpreviousvideothatintroducedthecube.|Let'sgoaheadandrunthequery.|DisappointinglywegetanerrormessagethatthisversionofMySQLdoesn'tyetsupportcube.|ActuallynoversionofMySQLsupportscubeatthispointintimebutwe'rehopefulthatafutureonewill.|InfactofthethreeopensourcesystemsthatwehavebeenusingforourdemosonlyMySQLsupportsthewithrollupsowewillcontinuewithMySQLandinfactyoucangetthesameresultthatyouwouldgetifwithcubewassupported,usingwithrollup,althoughit'salittlebinary digitcontorted,butI'lldothatnow,todemonstratewhatyouwouldgetifyouwrotewithcube.|Sohere'sthequery,I'mnotgoingtoexplainit,ifyou'reparticularlyinterestedinit,youcandownloadourscriptandexamityourself.|AgainwhatI'mmostinterestedinislookingattheresults,andheretheyare.|SothisresultistheresultofaWithCubeonthegroupingandaggregationonalldimensionsofoursalestable,allthreedimensions.|Sosomeofourtupleslookverynormal.|Thisfirsttuple,second,andthirdtupleareallgivingusthetotalpriceforcombinationofstore,item,andcustomer,andtheseareexactlywhatwegotinouroriginalquerythatdidn'thavetheWith-Cubeoperator.|Butnowweseesometuplesthathaveblanksandasareminder,blanksinthisinterfacemeannull.|Sothistupleisstoreitemandnull.|Andwhatthiscorrespondstoisanelementonthefaceofthecube.|Sothisisthefaceofthecubethat'snotconstrainingthecustomerdimension.|Andwhatthevaluegivesusthenisthevaluewehaveonthefaceofthecube,whichisthetotalsalesforthecombinationofstoreoneanditemoneandanycustomer,andthat'sseventy.|Andwecancrosscheckthatbyseeingthatthefirstthreetuplesaddupto70,becausethosehappentobethethreecustomersthathavemadepurchasesatStore1andItem1.|AndwecansimilarlyseeforStore1andItem2thetotalsalesare150.|Ifwescrolldownabinary digitwe'llseecaseswherewehaveothersingle-nullvalues;I'llkeepgoinguntilIfindonehere.|Forexample,herewehavethenullvalueforthestoreandthatwouldbethefaceofthecubethat'snotconstrainingthestoredimension.|SothatwouldbethesumforItem1andCustomer1atanystore,Item1andCustomer2toatanystore.|Thenwealsohavetuplesthathavetwonullvalues,here'sanexample.|Sothisoneisgoingtobecorrespondingtotheedgeofthecube.|sothisistheedgeofthecubethatisalongthestoredimensionandispickingoutStore5alongthatdimensionandthengivingthetotalsalesforallitemsandallcustomersinStore5,andweseethat.|Andagainwe'llseeotherinstanceswherewe'remissingtwovalues,scrolldowntogethere.|We'vegotonewherewe'remissingthestoreintheitem,sothiswouldbeontheedgealongthecustomerdimension.|Sothisgivesusthetotalsalesforanystoreitemmadebycustomer3.|Andthenfinally,ifwefindit,we'llfindtheonethat'sallthreenullvalues,andthat'srighthere.|Sothatrepresentsthecornerofthecube.|Thatgivesusthetotalforallstores,allitemsandallcustomers.|So,whatwe'vedoneherebyaddingWithCube--andagain,thatwouldbetheresultifthisqueryhereweresupported--whatwe'regettingisthecontentsofthedatacube,whicharetheinnerpartsofthecube,whichiswhatwewouldgetwithoutaddinganythingtoourgroupbyandwhatwesawinoneofourveryfirstqueriesofthedemo,inadditiontothedataonthefaces,theedges,andthecornerofthecube.|Nowlet'sdoaquickcrosscheck.|Sothisdatatellsusthatthecornerofthecube,here,theonewithallnullvalues,is33.50totalprice.|So,thatshouldbeexactlywhatwegetifwesumupourpriceswithoutdoinganygroupingoraggregationsoletsgivethatatry.|Sowemerelytakeoursalestable,wesumupthetotalpricesandwerunitandindeedwegetthirty-threefifty.|Sonowwe'veseenhowStructured Query Languagecanbeusedtoeffectivelycreatethedatacube.|SometimesinOnline Analytical Processingapplicationsit'sconvenienttoquerythecubedirectly.|Sopeoplefrequentlycreatedatacubesay,inStructured Query Languageusingamaterializedview,orjustbycreatingatablethatcontainstheresultofthedatacubewhichiswhatwearegoingtodo.|Thereareevensomesystemsthatusethedatacubeastheirbasicnativedatamodel.|Solet'sgoaheadandtaketheresultofourcubequeryandputitinatable.|SoI'vejustadded"createtablecubeas"beforeourqueryandtheonetheotherthingIdidwasaddanametotheresultoftheaggregationattributesothatwecanrefertoitinthedatacube.|SoPthenwillthenbecontainingthesumofthepricefortheitemsinsidethedatacubeaswellasforthefaces,edges,andcorners.|So,let'sgoaheadandcreatethattableandnowlet'slookatqueryingthecubedirectly.|So,thefirstthingyouwillnoticeinthenextfewqueriesisthatwe'vereplacedthesalestablewiththecubedtablesowe'regonnarunourqueriesdirectlyonthecubeandwecanjointhecubewiththestoreanditemtablesandthecustomer,ifweneededit,justaswejoinedthesalestablebecauseitdoescontainthesamedimensionattributes.|Whatthecubegivesusispre-aggregateddata,bothforthestore,acustomeranditemcombinations.|Aswellasthedatathathasnullvaluesthatisalreadyaggregatedforthefacesedgesandcornerofthecubeaswe'lljustseeinamoment.|SowhatourqueryisgoingtodoisfindtotalsalesofblueitemsinthestateofCalifornia.|Anditwillstartbyshowingthetupplesthatareusedtogetthattotal.|Sowe'lljoinourcubetablewiththestoreandtheitemdimensiontablesinordertoconstrainthestateandthecolorandthenwewillconstrainthestateandthecolor.|Noticethelastthingwesayisthatcustomeridisnullandthat'sgoingtogiveusthedataonthefaceofthecubethatdoesn'tgoalongwiththecustomer'sdimension.|Thatmeansit'sgoingtobepre-aggregatedforallcustomersandthat'swhatwewantsincewedon'tcareaboutthecustomersandjustaboutthecolorandthestate.|So,let'sfirstrunthisqueryandweseewegetsixtuples,andthesetuplesareallfromtheportionoftheresultofthatcubequeryweranthathasanullvalueforcustomerIDandthatisallcombinationsofstoresofitems,andifwecheckedourdimensiontableswe'dseethatthesestoresareinCaliforniaandtheseitemsareblueandtheseareourtotalsalesbrokendownbystoreanditem.|Finally,togetthetotaltotalsales,we'lljustsumupourcolumn"p"whichrememberwasthesumofpriceinthedataqueue.|Sowereplacec.withsumofpandwerunthequeryandweseethatourtotalis13.65.|Nowletmeshowyousomethingthatmayseemnon-intuitiveatfirst,butifyouthinkaboutitormayberunthequeriesyourself,you'llstarttounderstandexactlywhat'shappening.|I'mgoingtogobacktoc.intheselectclause.|Andincidentally,Ididn'tmentionitbeforebutc.givesusintheselectclausealltheattributesfromthecubetable,andthatisshowingwhichtuplesarebeingusedfortheaggregation.|So,wehadbeforesixtuplesthatwerebeingused.|Now,I'mgoingtomakeonetinychangetothequery.|InsteadoffindingthecustomerIDsthatarenull,I'mgoingtofindthecustomerIDsthatarenotnull.|I'mgoingtorunthatquery,andIseethatwehavefourteentuplesnow.|Whatwe'veactuallydoneismovedawayfromthefaceofthecubeandintothecube,andI'vesaiddon'tgivemeanyofthesummarizeddata,justgivemetheoriginalvaluesthatarethestoreitemandcustomertogether.|So,I'vetakenawaythesummaries,butactuallythisshouldstillgivemethesameanswer.|Let'smakesurethat'sthecase.|IdosumofP,andIrunit,andIget1365.|So,whathappenedhereisIusedwhat'seffectivelythesamedata,butbrokendownbycustomer.|AndIaddeditup,thatwasalessefficientquery,butbothofthosequeriesdogivethecorrectresult,theydogiveyouthetotalsalesofCaliforniastores'blueitems.|Again,Iencourageyoutodownloadtheseandrunthemyourselftofigureoutexactlywhat'sgoingon.|Andasalastdemonstrationofthisverysamequery,wecanactuallygobacktothesalestable.|Let'ssaywedon'tevenhaveourdatacube.|So,we'regonnauseoursalestableinstead,anditshouldgiveusthesameresult,butevenlessefficientthanthethelastquerythatwedid.|So,youcanseehereI'vechangedthecubetobethesalesandalltheCdotstoFdots.|Itookawaytheconstraintsonbeingnullornotnull,sincethat'snotrelevantinthesalestable.|Otherwise,thequerylooksprettymuchthesame.|So,let'srunthismuchandseehowmanytuplesweareoperatingonnow.|Sonow,we'reoperatingon25tuples.|So,thisistheoriginalcompletelybrokendowndata.|Justasareminder,inthedatacube,eveninthecells,we'llbesummarizingorsummingforthecombinationofstoreitemandcustomer.|So,ifwehavethreetuplesthatarethesamestoreitemandcustomer,thosewillbebrokenoutinthesalestableandsummarizedinthecube,evenintheleastsummarizedportionofthecube,ifyougetwhatI'msaying.|Sonow,we'vegotour25tuples,andifwesumupthepriceofthosetwenty-fivetuples,weshouldgetthatsameresult,"$13.65",andwedo.|So,wesawthatwehadsixtuplesinthemostefficientqueryoverthedatacube.|Whenweusedjustacenterportionofthecube,wehadfourteenorsomething,Iactuallydon'tremembertheexactnumber,andthen25.|Allofthemgaveusthesameanswer.|Obviouslythesenumbersareverysmall,butifyouthinkabouthugedatathathasmillionsortensofmillionsofrows,thenwe'retalkingaboutdramaticdifferencesinhowmuchdataneedstobesummarizedoraggregatedinordertogettheanswer.|So,usingthesummarydatafromthecubecanbeordersofmagnitudefasterthangoingtotheoriginalfactdata.|Nowavariationonthewidthcubeistogivespecificattributeswiththecubeoperatoritself.|Andwhatthatsaysistoonlygivesummariesforthesedimensionattributesandnottheothers.|Inotherwords,we'llonlyseenullvaluesintheresultforthestoreIDandcustomerIDandwewon'tseeanynullvaluesfortheItemID.|So,insomesense,we'rematerializingjustsomeofthefaces,edges,andcornerofthecube,notallofthem.|Ifwerunthisquery,well,we'llgetthesameresultsthatMySQLdoesn'tyetsupportit,butthisistheStructured Query Languagestandardforthecubeoperatorwithsubsetsofattributes.|Asbefore,I'vecookedupanequivalentqueryusingaMySQL'swithroll-upcommand,andI'mcertainlynotgoingtoexplainit,butyou'rewelcometodownloaditandexamineit.|WhatIreallyliketolookatistheresult,andhereitis.|So,thislooksalotlikeouroriginaldatacubebutwhatwewillnoticeisthattherearenonullvaluesintheitemcolumn.|So,it'sasubsetoftheresultofthecubequery.|Andwewouldusethatwhenweknowwe'renevergoingtoberollinguponitems.|So,thatdimension,thesummariesbasedonthatdimensionaren'tgoingtobeusefultous.|Now,let'slookatwithroll-up,whichissupportednativelybytheMySQLsystem.|Withroll-up,again,givesusasubsetofthedata.|cube.|But,it'saveryspecificoneandit'sbasedontheorderingoftheattributesinthegroupbyclause.|So,letmejustgoaheadandrunitandexplainwhatweget.|Weagaingetnullvalues,andthosenullvaluesindicatethesummary.|Forexample,theStore1,Item1and70s.|ThesumofpricesforallcustomersforStore1andItem1.|AndweseeStore1,Item2,aswell.|Weagainseecaseswithtwonullvalues,sothisisthesummaryforStore1,alloftheitemsandcustomers,thetotalsales,andwealsohavethetriplenullsomewhere.|It'satthebottomthistime,withtotalsalesof$33.50.|Butwhatwe'llseeisthatwedon'thaveallcombinationsofnullvalues.|WehaveanullvalueforcustomerID,orwehavenullsforthecombinationofcustomerIDanditemID,orallthreenulls.|Soweonlyhavetheright-handattributeorthetwomost-rightattributesorallofthemandifwehadafourthdimension,we'dseethatwehavetheright-most,tworight-most,threeright-most.|Thisdoesn'treallymakeanyparticularsenseforthisquery,butit'susedwhenwehavedimensionsthatarehierarchical.|AndIactuallyintroducedahierarchicaldimensionsinouroriginalschemajustforthispurpose.|So,letsturntothatquery.|So,here'saquerythat'sgroupingbythestate,county,andcity.|Thesearethreedimensionattributes,theyallcomefromthestoredimensiontable.|Andtheyarehierarchical,meaningthatwedon'thaveeverycombinationofstate,countyandcity.|Wehavecitiesthatareinspecificcounties,andcountiesthatareinspecificstates.|So,whenwelookattheresultsofthequery,wesee,ofcourse,thatwe,whenwehaveSanMateoisalwaysinthestateofCalifornia.|KingCountyisalwaysinthestateofWashington.|Wedon'thavePaloAltocombinedwith,say,KingCountywithstateCalifornia.|So,wedon'thaveallthecombinationsofthethree.|Wehaveahierarchicalstructureonthem.|Andit'sthisstructurethatmakessensewhenweusearoll-up.|So,let'saddwithroll-uptothisqueryandseewhatweget.|So,hereinourresultweseeouroriginaltuplesforastate,county,citycombination.|Andthen,weseeforexample,thistuplehere,whichistakingthestateofCaliforniaandthecountyofSanMateoandaddingupallofthesalesthere.|AndweseesimilarlythatwehaveallofthesalesforSantaClaraCounty.|Thenwecanseethatwehaveallofthesalesforeachstate,sothisistheCaliforniasalesandtheWashingtonsales.|Andfinally,thetriplenullisthecornerthecube,it'sallofoursalesand,asusual,wegetthetotalof33.50.|Now,whatdon'tweseeinherecomparedwiththedatacube?|Well,wedon'tsee,forexample,atuplethathasCaliforniaandPaloAltoandthecountyasnull.|Whyisthat?|Well,PaloAltoisalwaysinSantaClaraCounty.|Sorollingupthecounty,orsayingIwantCaliforniaandPaloAltosalesforeverycounty,isexactlythesameassayingIwantCaliforniaandPaloAltosalesinSantaClaraCounty.|Wealsodon'tsee,forexample,thestateandcountybothbeingnull.|Forexample,ifwehadSeattleasacityandthestateandcountybeingnull.|Well,SeattleisalwaysinKingCountyandalwaysinWashington,sowe'renotaggregatinganythingthere,wegettheexactsameresultsashavingSeattleKinginWashington.|SoifweranWITHCUBEonthishierarchically-structureddata,we'dactuallynotgetanymoreinformation,we'dhaveabiggerresult,butitwouldn'tbegivingusmoreinformation.|Itwouldjustbelessefficientforgettingthesamedata.|SothatconcludesourOnline Analytical Processingdemonstration.|WesawStarSchemaandwesawplainStructured Query Languagequeriesoverthatschema.|Wesawtheconceptofdrillingdownandrollingup;alsoslicinganddicing.|WeintroducedaWITHCUBEextensiontoStructured Query Language,whichisnotyetimplementedinMySQL,butwewereabletowriteaquerythat'sequivalenttoWITHCUBE.|WealsosawputtingaWITHCUBEqueryintoatableandthenqueryingthattabledirectlyandthatcanbemuchmoreefficientthanrunningtheequivalentqueryinStructured Query Languagedirectlyoverthefacttable.|WealsosawWITHROLLUP,whichisimplemented.|Wedidn'tdemonstrateputtingtheresultofWITHROLLUPinatable,butwecouldcertainlydothattoo.|Allofthesefeaturesareusefulprimarilyinapplicationsthatareperforminganalysesoververylargedatasetsthatexhibitthisdimensionaltypestructure,butthisisactuallyquiteacommonstructureinanalysisapplications.|ThispairofvideoscoversNoSQLsystems.|Thefirstvideoisgoingtogiveahistoryandmotivationforthetopic,andthesecondvideowillgiveanoverviewofsomespecificNoSQLsolutions.|Butletmewarnyourightaway,thattheareaofNoSQLsystemsischangingrapidly,soI'mgoingtoavoidgivingtoomanydetailssothatthevideosdon'tgetoutofdatetooquickly.|Let'sstartbytalkingabouttheNoSQLnameitself.|It'sactuallyalittlebinary digitconfusingandmisleading,hasabinary digitofahistorytoitalready,whichwe'llgothrough,andthosewhoinventeditmightberegrettingitabinary digit.|Butlet'spullitapart,andlet'sfirstlookatStructured Query Language.|InthetermNoSQL,Structured Query LanguageisactuallynottalkingabouttheStructured Query Languagelanguage.|Whatit'stalkingaboutmoregenerallyistraditionalrelationaldatabasemanagementsystems,whichdohavetheStructured Query Languagelanguage,buthaveawholebunchofotheraspectstothemaswell.|Overthepastdecadeorso,therehavebeenanumberofnewdatamanagementandanalysisproblemsthathavecroppedup,andwe'lltalkaboutsomeofthose.|Whereatraditionalrelationaldatabasemanagementsystemmightnotbethebestsolutionforthoseproblems,andagainwe'lltalkaboutthataswell.|So,NoSQLtermedwhenyoutakeitaparttomeanNoSQL,issayingthatforsomeproblems,wemightnotwanttouseatraditionalrelationaldatabasesystem.|It'snottalkingaboutthisSequellanguageitself,notpickingonthatbutagainTalkingaboutthewholetrappingsofthetraditionalsystem.|Nowwhileprettymucheveryoneagreesthatforsomeproblems,atraditionalrelationaldatabasemanagementsystemisn'tthebestsolution,therearestillawholelotofproblemsforwhichitis,andsopeoplenowliketosay,wellProblemsaren'texclusivelysolvedbytraditionalrelationaldatabasesystems.|Theymightbesolvedbytraditionaldatabasesystemsforsomeportionofthem.|Andbysomeothersolutionforotherportionsoftheproblem.|Andforthatreason,NoSQLhasactuallycometomean,andthisisnowtheaccepteddefinition,notonlyStructured Query Language,butagain,withStructured Query Languageitselfactuallyreferringtotraditionalrelationaldatabasemanagementsystems.|Sowhat'swrongwithatraditionalrelationaldatabasesystem?|Well,theprimaryissueisthatit'sabigpackagewithallkindsoffeatures.|Andinmanycases,thoughhavingallthosefeaturesinoneplaceisagreatthing,butsometimeswedon'tneedallofthefeaturesanditcanactuallybeadvantageoustodropsomeofthose.|Now,whatarethosefeatures?|I'mgoingtowindallthewaybacktotheintroductoryvideotothesematerials,wherewetalkedaboutdatabasemanagementsystemsandallthegreatthingstheyprovide.|AndactuallyI'vecopiedthisdirectlyfrommyveryfirstsetofslides.|Thattellsusthatadatabasemanagementsystemprovidesgreatthings,efficiency,reliability,convenience,asafetymulti-user,accesstomassiveamountsofpersistentdata.|Solet'sanalyzetheseadjectivesalittlebinary digitmore.|Let'sstartbytalkingaboutconvenience,andletmegive3aspectsofatraditionaldatabasesystemthatleadtoitsconveniencetouseforanapplication.|Soheretheyare.|Asimpledatamodel,declarativequerylanguageandtransactionguarantees.|Andthese3componentsofadatabasesystemareoneofthereasonsthattheyarereallygoodforcertainapplications.|Becauseyoucanputyourdatainanunderstandableway,youcanqueryitusingalanguagethat'seasytowriteyetverypowerful.|Andyougetguaranteesaboutwhathappensifthesystemcrashesorifmultipleusersareusingitatthesametime.|Sotherelationaldatamodelisgreatbecausethedataisorganizedintotables.|Wehaveanunderstandablealgebraoverrelations,andthatalgebraformsthebasisofthequerylanguage,andeverythingfitsneatlyintoapackage.|Theproblemcomeswhenourdatadoesn'tfitsoneatlyintothatpackage.|Andifweinsistonusingtherelationalmodel,andourdataisn'tveryrelational,thentherehastobesomeprocessoforganizingthedatabeforewecansay,loaditintothetablesofoursystem.|TheStructured Query Languagelanguageisgreatbecauseit'sverypowerful.|Itincludesselections,projections,joinsaggregation,allkindsofsetoperators.|usefulpredicatesandsoon,butwhatifthatquerylanguageismuchmorethanwhatweneed?|Maybeweonlyneedtodosimplefetchesofrecordsbasedon,keyvalues,forexample.|Inthatcase,usingasystemthatsupportsthecomplicatedlanguage,maybe,again,morethanweactuallyneed.|Andsimilarly,transactionguaranteesare,terrificwhenwehavelotsofusershittingasystematthesametime.|Andwehaveverystrictrequirementsonconsistency,butifourrequirementsarealotless,eventheweakestguarantees,thataremadebythetraditionaldatabasesystemsmightnotbeappropriateforapplication.|Andwe'regoingtoseeexamplesofallofthesethings.|Sothenextattribute,multi-user,tiesrightintoourdiscussionoftransactionguarantees.|Again,forsomeapplications,wemightnotneedtomaintainthelevelofconsistencywhenmultipleusersareoperatingonthedatabaseatthesametime,thattraditionalsystemsaredesignedfor.|Nextattribute,safety.|safetyisbothfroma,anauthorizationstandpointandfromanattacker'sstandpoint.|AndyouknowsafetyisnotthatdifferentaconcernintheseNoSQLtypeapplicationsthanintraditionalapplications.|Althoughinsomecases,theNoSQLsolutionswe'regoingtodiscussareusedmoretoprocessdataofflineandinabatchmode,inwhichcasesafetyintermsofauthorizationorevenattackismuchlessofanissuethansay,adatabasesystemthat'ssittingbehindadeployedwebsite.|Persistenceissomethingthat'sprovidedbydatabasesystems,andpersistenceiscertainlysomethingimportantinNoSQLtypeapplicationsaswell.|Although,forNoSQL,we'llseethatfilesareoftenokay,asastoragemechanismratherthanspecializedstructuresthataretypicallyimplementedinadatabasesystem.|Reliability,againissomethingwe'recertainlygoingtowantinanydatamanagementapplication,butagaintheconsiderationsarealittledifferentincertaintypesofapplications,saythebatchdataanalysisapplications.|Oritmightbejustokaytocompletelyredotheentire,say,processingofthedata,wherethatwouldn'tbethecaseifyouhadanoperationaldatabasesittingbehindawebsite.|Nowthelasttwoadjectives,ontheotherhand,areontheotherendofspectrum.|OneofthereasonsforNoSQLsolutionsisthatthedatabeinghandledthesedaysismuch,muchmoremassivethantheamountofdatathatthetraditionalrelationaldatabasesystemsweredesignedfor.|partofthereasonisthatthecostofhardware'sgonedownandsopeoplearejustsavingmuchmoredata.|andthenagainanotherreasonofcoursearewebsitessuchasFacebookandtweeterandsoonthatarejustcollectingdatafromenormousnumbersofusersatenormousrates.|Andthosesamewebsites,bytheway,haveefficiencyrequirementsthataremuch,muchhigherthanwe'veseeninthepast.|Sowehavethesemillionsbillionsof,ofrecords,andweexpectaresponsetimeofunderasecondforfairlycomplexoperationsoverloads.|Soagain,theseareareaswhereNoSQLsystemswanttoincreasetheadjectiveswherethe,earlierones,wewanttosortofdecreasewhatthey'reoffering.|So,insomesense,youcanalmostthinkofNoSQLsystemsascompromisingonsomeoftheseearlierones,inordertoboostsomeofthelaterones.|Sowiththatmotivation,nowlet'stalkabouttheNoSQLsystems.|Sotheyare,asI'vesaid,analternativetoatraditionalrelationaldatabasesystemformanagingandanalyzinglargeamountsofdata.|Atthehighestlevel,herearetheattributesthatareprovidedinNoSQLsystems.|Sofirstofall,amoreflexibleschemathantherigidrelationalmodel.|Secondofall,andIreallyhesitatetosaythis,buttheytendtobeabinary digitquickerandabinary digitcheapertosetupforaparticularapplication.|Nowthatmaychangeovertime,butthat'sthewordonthestreetasofthismoment.|Third,asIalreadymotivated,theyaredesignedformassivescalabilityandthatmeansmassivebothintheamountofdataandalsowiththeefficiencyoftheoperationsonthatdata.|Andlastly,theydon'tnecessarilyhavetransactionalguarentees.|Ingeneralwhattheydoisrelaxtheconsistencythat'sofferedbythesystemAnd,inturn,gainhigherperformanceandhigheravailabilityofthesystem.|Sothesesystemsdotendtobeusedforapplicationsthathavestrictrequirements,bothinhowfasttheycandothingsandinbeingupallthetime.|Now,ofcourse,there'sadownside,andagainthisisjustattheveryhighestlevel.|Different,NoSQLsystemsaddressthingsindifferentways.|Onthedownside,theytendnottohaveadec,declarativequerylanguage.|Sooneofthebenefitsofatraditionalsystemisbeingabletowrite.|Addhotqueriesinaverynicehighlevellanguage,changeyourmindaboutwhatyouwanttowriteandmakechangeseasily,explorethedatabaseinlotsofdifferentwaysjustwiththesesimplequeries,sointhoseStructured Query Languagesystems,thelackofdeclarativequerylanguagedoesmeanthatthere'smoredirectprogrammigInvolvedinmanipulatingthedataandanotherdownsideistherelaxedconsistencydoesmeantherearefewerguarantees,soforapplicationsthathaveverystrictthatneedverystrictguaranteesabouttheconsistencyofthedataorsaytheserializedabilityofoperationsonthedata,nosequalsystemsareprobablynotagoodidea.|Sotheremainderofthevideoisjustgoingtogothroughasetofexamplestomotivate,thecaseswherewemightwanttouseaNoSQLsystemandthereasonsthatitmightbedifficulttouseatraditionalsystem.|They'reallsortofsimplifiedmade-upexamples,butIdothinktheygivetheoverallidea.|Sothefirstexampleisanapplicationwherewehavealargenumberoflogsofwebactivityandwewanttoanalyzethoselogsinvariousways.|Let'sassumethatwhenaweblogiswrittenthere'sasetofrecordsforeachaccess,andthatrecordisgoingtoreportthataparticularuserwithagivenuserIDaccessedaparticularUniform Resource Locatorataparticulartime.|Andthenwemighthavesomeadditionalinformationassociatedwiththataccess,maybesomethingabouttheuserorwhetheritwasconvertedintoapurchaseorwheretheuserwentnext.|Allkindsofpossiblethingswemightwanttoincludeinthere,andactually,thatadditionalinfomightchangeovertime.|Solet'ssupposethatwe'regoingtoworkwithourweblogdatainatraditionaldatabasesystem.|Thefirsttestthenwouldbetogetthedataloadedintothesystem.|Andthisisoneofthefirstproblemswithrelationalsystemsisthattheremightbequiteabinary digitofworkinvolvedintakingdatalikethisthatmightnotbeperfectlyorganizedandgettingitintoarelationalsystem.|Forexample,wemightwanttodosomeamountofdatacleaning.|datacleaningreferstofindingsayerrors,oris,inconsistenciesinthedata,andresolvingthose.|Forexample,maybeourtimestampsareinmultipleformatsandweneedtoresolvethem.|MaybesomeofourURLsareinvalid.|So,wegothroughadatacleaningprocess.|Thenextthingwemightwanttodoissomeamountofdataextraction.|Solet'stakealookatthisadditionalinformation.|Sothismightbeinastructured,semi-structured,orfreetextformat,butifwe'regoingtoloadintoadatabasesystemthenwe'reprobablygoingtoneedtoextracttherelevantfieldsfromthatinformationandgetthatformattedsowecanloaditintoatable.|Wemightalsodosomeamountofverification,maybecheckingthatalltheURLsarevalid,.|Andthenfinallywehavetodevise,designsomekindofschema,orspecifyaschema,andthengetthedataloadedin.|NowproponentsofNoSQLsystemswilltellyou"Hey,youdon'thavetodoanyofthat.|Youcanjustdonothingandimmediatelystartoperatingonthedatadirectlyoutofsaythefilewhereit'sstored.|AndthatsortofcomesbacktotheideathatyoucangetupandrunningmorequicklyonaNoSQLsystem.|Nowofcourse,there'snofreelunchorpaymenowpaymelater.|Therealityisofcoursewhenyouactuallystartprocessingthedata,youaregoingtohavetoembedsomewhereintherethesesamebasicoperationstogetthedatacleanedupandusable.|Butthosewouldoccurduringtheprocessingofthedata.|Andifthere'ssomeportionsofthedatathatyou'renotoperatingon,youcanjustleavethoseinplacewithoutdoingthecleanupofthatportionofthedata.|Now,let'slookatthetypeofoperationswemightwanttopreformoverthisdata.|Itmightbeverysimplethings.|Wemightsayjustwanttofindallrecordsthatcorrespondtoagivenuser.|OrmaybewewanttofindallaccessesofagivenUniform Resource Locator,oreverythingthathappenedataparticularpointintime.|Now,noneofthesethingsrequireStructured Query Language,ooh,NoSQL,butofcourse,that'snotwhatNoSQLstandsfor.|Butthesealljustrequirefindingyouknow,asetofrecordsbasedonasinglevalue.|Orwemightwanttolookforsomespecialconstructthatappearsinsidetheadditionalinformation,whichtheStructured Query Languagelanguage,again,isnotparticularlydesignedtodo.|Theotherthingtonoticeaboutalloftheseoperationsisthattheyarehighlyparallelizable.|Eachoneofthem,infact,isjustlookingattheindividualrecords.|Wecoulddoeverythinginparallel.|Andexploitingparallelismwhenyouhavesimpleoperationsisoneofthe,importantaspectsofmostNoSQLsolutions.|Here'sanoperationIcameupwithbecauseitdoeslooklikeitrequiresarelationaljoint.|Let'ssaythatwewanttofindallpairsofusersthathaveacessedthesameUniform Resource Locator.|Infact,backintheStructured Query Languagevideos,Igaveseveralexampleslikethis.|Thisisessentiallyaself-joinovertwoinstancesofatableor,twoinstancesoftheweblogs.|SothislookslikemaybeweactuallydoneedaSQL-likesolution,butI'mgoingtoarguethatthisisactuallykindofaweirdquery,andit'sfairlyunlikelythatwewouldbedoingthisoneonaregularbasis.|Now,let'smakeourdatascenarioslightlymorecomplicated.|Inadditiontotheweblog,let'ssupposethatwehaveseparaterecordswithinformationaboutusers.|SowehavetheuserID,maybethename,age,gender,andsomeotherattributesoftheusers.|Andnow,supposeourtaskistotakeagivenUniform Resource LocatoranddeterminetheaverageageoftheuserswhohaveaccessedthatUniform Resource Locator.|Okay,wellthisisavery,Iwouldargue,SQL-likequery.|Soit'sniceinthiscasetohavealanguagesomewhatlikeStructured Query Language.|ButI'llstillsaythatsomeaspectsofNoSQLsolutionsmayberelevanttothistask,andinparticular,it'sthequestionofconsistency.|Ifwe'reusing,ifwe'reanalyzingahugeamountofdataandwe'rejustlookingforsometypeofaverage,sometypeofstatisticalinformationoverthatdataitmightnotberequiredthatwehaveabsoluteconsistency.|InfactitmightevenbeokayifwecountsomeaccessestoURL'sthatwereatacertaintime,andwecompletelymissedsomefromanearliertimejustbecausethedatabasemightbefragmentedand,andinconsistent.|And,that's,that'sagainprobablyokayforthisapplication,sotosummarizetheweblogapplication,itmightbesomewhatdifficulttogetwebaccessrecordsintoarelationaldatabasesystem.|Itmightbeeasiertousethemintheirfiledformatandextracttheinformationwhenweneedit.|manyoftheoperationsthatweperform,maybeextremelysimply,justfetchingasetofrecordsbasedonavalue,andalsohighlyparallelizable.|Andevenforthemorecomplicatedanalysesthatwemightdo,wemaynotneedstrictconsistencyaccessingsay,averyspecificsnapshotofthedata.|Nowlet'stakealookatanotherapplication,let'ssaythefriendsrelationshipinasocialnetwork,whichgeneratesagraphwhenauserisrepresentedbynodes,andsaythefriendrelationisrepresentedbyedges.|Soeachrecordisgoingtohave2userID's.|Thatsaysthatoneuserisfriendswithanother,andthenwe'llhaveseparaterecordswithinformationaboutusers,theuserID,maybeagaintheirname,ageandgenderandsoforth.|Andlet'simaginethisisanextremelylargesocialgraph.|Whatkindofoperationsmightwewanttoperform?|Well,oneofthemistofindallthefriendsofthegivenuser,andsothat'sprettystraightforward.|Again,wearejustfetchingthesetofuser2'sthatareassociatedwithagivenuser1.|Sonotanoperationthatrequiresacomplicatedquerylanguage.|Ontheotherhandwhatifwearelookingforallfriendsoffriendsofagivenuser.|Actuallynow,wedorequireajointoperationinordertodothat.|Andfurthermore,whatifwewanttofindallwomenfriendsofmenfriendsofagivenuser?|Inthatcase,we'regoingtoneedacoupleinstancesofthefriendrelationship,andwe'regoingtoneedtojointhatwithacoupleinstancesactuallyoftheuserinformationaswell.|So,thisisstartingtolookmore,alittlebinary digitmoreSQL-like.|But,maybewedon'tneedthefullpowerofthelanguage,becausewecanseethatthere'sacertainsortofpatterntothetypesofoperationswe'redoing.|Andofcourse,theproblemcomeswhenwewantfriends,offriends,offriends,ofagivenuser.|Inthatcase,we'redoinglargenumberofjoins,andlargenumbersofjoinstendnottobenotthatefficientinrelationaldatabasesystems,evenwhenyouuserecursiveStructured Query Language.|So,inadditiontothistypeofoperationbeingnotnecessarilysuitableforStructured Query Language,asecondattributethatweprobablydon'tneedagaininthisenvironmentisconsistency.|becauseweprobablydon'tcarethatmuchwhetherwegetanexactsnapshotofthedatabase,ifthingsarechanging.|Typically,forthesetypesofanalyses,approximatesolutionsareacceptable.|Sothesetypesofoperationssuggestthatwemightwanttohaveaspecialtypeofdatabasesystemthat'ssuitableforgraphoperationsonverylargescale,andinfactgraphdatabasesareonetypeofNoSQLsolutionthatwewilltalkaboutinthenextvideo.|Andfinally,mylastexampleisWikipediapages.|IfyouthinkofWikipedia,it'salargecollectionofdocuments,extremelylarge.|Andinsideeachdocument,there'stypicallyacombinationofsomestructureddatainsideboxesthathassay,keyvaluedpairs.|Andthenonthestructureddata,whichmightbefairlylargevolumesoftext,atypeoftaskwemightwanttodoissayretrievethefirstparagraph,thetextparagraph,inallpageswherewelookinthestructuredataandfindoutthatthepageisaboutaUnitedStatespresident,saybefore1900.clearlythisisnotverysuitableforloadingintoarelationaldatabaseandqueryinginthatfashion,againbecauseofthemixofstructuredandunstructuredinformation.|Andoncemore,consistencyisprobablynotcriticalinthisenvironmentaswell.|Aswe'llsee,anothertypeofNoSQLsolutioniscalledthedocumentdatabasesystemwhichcanbemoreappropriateforthistypeofapplication.|Sotosummarize,NoSQLsystemsprovideanalternativetousingatraditionaldatabasemanagementsystemforcertaintypesofapplications.|NoSQLsystemsprovideaflexibleschemawhichcanbeusefulwhenitsnoteasytogetthedataintoastructuredtableformat.|Theycanbequickerandcheapertosetup.|Soyoumightbeabletogetgoingfasteronactuallyanalyzingyourdataandmaybeforlesscost.|abinary digitdebatable,butthat'sthewordonthestreetrightnow.|Theydoprovidemassivescalability.|Sothey'regenerallyusedforvery,verylargeapplications.|Oftenapplicationsthatdon'trequiretheamountofconsistencythatatraditionalsystemprovides,andbyrelaxingtheamountofconsistency,they'llgiveyoubetterperformance,higheravailability.|Thedownsidesofthethissystemtendtobethelackofadeclarativequerylanguage.|Thatmeansmoreprogrammingisgenerallyinvolvedwhenusingthesystems,andfewerguaranteesareprovidedaboutconsistency.|Inthenextvideowe'llspecificNoSQLsolutionsandhowtheyembodytheadjectivesthatI'veincludedhere.|ThisvideoprovidesanoverviewofsomeNoSQLsystems.|Iwanttosayrightupfrontthatit'sbeingmadeinNovember,2011.|Thisisafieldthat'schangingveryfast,sothisisanoverviewofwhat'sgoingonrightnow.|Asareminderfromthepreviousvideo,NoSQLsystemshavearisenbecauseitwasrecognizedthatnoteveryprobleminvolvinglargescalemanagementoranalysisofdatawasbestsolvedbyusingarelationaldatabasesystem.|Someproblemsstillare,butthereareothersthataremoresuitableforadifferenttypeofsystemthatwe'regoingtotalkabout.|NoSQLasatermhasevolvedtomeannotonlyStructured Query Language,whereStructured Query Languagedoesn'treallymeantheStructured Query Languagelanguage,butitmeansatraditionaldatabasemanagementsystem.|Again,asareminderfromthepreviousvideo,theNoSQLsystemsaredifferentfromtraditionalsystemsinthattheytendtoprovideaflexibleschemaratherthanarigidstructure.|Theytendtobequickerorcheaper,orboth,tosetup.|They'regearedtowardsreallymassivescalability,andtheytendtouserelaxedconsistencymodelsinordertogivehigherperformanceandhigheravailability.|Thedownsideisbeingthatthere'snodeclarativequerylanguage,somoreprogrammingistypicallyinvolvedinmanipulatingthedata,andbecauseoftherelaxedconsistencymodels,theplusisabetterperformance,thedownsideisfewerguaranteesabouttheconsistencyofthedata.|SothereareanumberofincarnationsofNoSQLsystems,andI'vechosen,asofNovember2011todivideintofourcategories,theMapReduceframework,keyvaluestores,documentstores,andgraphdatabasesystems.|Intermsofthefirsttwo,onewayyoucanthinkaboutitsortofroughlyisthattheMapReduceframeworkistypicallyusedforapplicationsthatwouldhaveusedrelationalOnline Analytical Processingoronlineanalyticalprocessing.|Theytendtobeanalysisapplicationsthattouchlargeamountsofthedatatodocomplexanalyses.|WhereaskeyvaluestorestendtobemoreintheOnline Transaction Processingworldasareminderthat'sonlinetransactionprocessingandthattendstobealotofsmalloperationstouchingverysmallpartsofthedata.|Theothertwodocumentstoresandgraphdatabasesystemsareself-explanatory.|Theyinvolvedocumentsandgraphs.|NowyoumightwonderwhyIdidn'tmentioncolumnstores,becausecolumnstoresareoftendiscussedintermsofNoSQL.|So,columnstoresareinonesensejustawayoforganizingrelationaldatabasesystemsforhigherperformanceforcertaintypesofapplicationsbutwe'llalsoseethatkeyvaluesstoresdotendtohave,sometimes,notallofthem,haveamodelthat'salsobasedoncolumnsbeinganimportantconcept.|So,nowI'lldiscusseachoftheseinturn,althoughI'mgoingtospendthemostamountoftimeonMapReduce.|SowecanthinkofMapReduceasaframework.|ItcameoriginallyfromGoogle.|TheyinventedthetermMapReduce,andnowthere'sanopensourcesystemwidelyusedcalledHadoopwhichdoesimplementtheMapReduceframeworksothefirstaspectofMapReduceisthatthereisnodatamodelatall.|ThedataintheMapReduceframeworkisstoredinfilesbothasinputandoutput.|IntheGoogleMapReduceimplementation,it'stheGoogleFileSystem,GFS.|IntheHadoopopensourceimplementation,it'stheHadoopDistributedFileSystem,HDFS.|WhattheuserprovidestoprocessdatausingtheMapReduceframework,isasetofspecificfunctions.|Notsurprisingly,oneofthosefunctionsiscalledmap,andoneofthemiscalledreduce.|Otherfunctionsthattheuserneedstoprovideisareaderfunctionwhichwillreaddatafromfilesandprovideitasrecords.|Awriterfunctionthatwilltaketheoutputrecordsandwritethemintofiles,andfinallythere'sanoptionalfunctioncalledthecombiner,thatwe'lldiscuss.|So,theuserjustprovidesthissetoffunctions,andthenwhatthesystemprovides,isthegluethatprocessesthedatathroughthefunctions.|Thesystemalsoprovidesfaulttoleranceoftheprocessing,so,ifthereisacrashoranodegoesdownduringtheexecution,itwillbeguaranteedtobeasifthatdidn'thappen.|AndfinallythesystemalsoprovidesscalabilitysothattheMapReduceframeworkcanbeusedforveryverylargedataanalysis.|Solet'stalkaboutthetwomostimportantfunctions,themapfunctionandthereducefunction.|Themapfunctionisusedtotakethedataanalysisproblemanddivideitintosub-problems.|Veryspecificallythefunctionthattheuserprovidescalledmapisgoingtotakeadataitemasinputandit'sgoingtoproduceasoutputzeroormorekeyvaluepairs.|NowwhatImeanbyasub-problemhereisthatwe'regoingtoseparatelydealwiththesetofrecordsassociatedwitheachkey,andthat'sthejobofthereducefunction.|Sothereducefunction,whichwe'llwrite,takesasitsparametersakeyandthenalistofvaluesforthatkeyanditproducesasoutput,zeroormorerecords.|Nowwe'llshortlyseeaconcreteexamplethatwill,hopefully,makethismoreunderstandablebutbeforewedothat,let'slookattheoverallarchitectureofhowthesefunctionsareusedtoprocessdata.|Sowe'llstartwithourmapfunction,which,let'sputinsideabox,andthenwewillhaveinputrecordsgoingintothemapfunction.|Asareminder,whatthemapfunctionproducesfromeachinputrecordisanoutputrecordthat'sakeyvaluepairandwe'regoingtohavetheserecordssortofdirectedinadifferentwayforeachkey.|Solet'ssaythisisthewaythattherecordsaregonnagoforkey1,key2,anduptokeyn.Andofcoursetherecordswillhavevaluesassociatedwiththemaswell.|Sowe'llsendeachbatchofrecordsforagivenkeyintoourreducefunction,soletmejustdrawafewreduceboxeshere,there'soneforeachsetofrecordsforagivenkey.|Andthenaswementionedbeforethereducefunctionproducesoutputrecords.|Atthehighestlevel,that'sit.|That'sourdataprocessing.|Westartwithabunchofinput.|Wedivideitupintosub-problems,basedonakey,whichwillextractfromtheinputrecordsomehow,we'llseeanexample,andtheneachsub-problem,associatedwithaparticularkeyissetthroughthereducefunction,whichproducestheoutput.|Andthat'stheendofourprocessing.|Nowthingsare,ofcourse,abinary digitmorecomplexthanthat.|Firstofall,there'snoreasontohaveonemapbox,becausethemapfunctiontakeseachinputrecordandprocessesitseparately,sowecanparallelizethemappingasmuchaswewant.|Solet'schangethepicturehere,tohaveawholesetofmapboxes.|Sonow,eachMapBoxisgoingtotakeitsrecordsandit'sgoingtoproducerecordswithgivenkeyssowe'llstillsendk1overtothefirstreducer.|Ifwehavek2it'llgohereanddownhere.|Andofcourse.|thismapwillsendthingstoreduce,reduce,reduce,andsoon.|Now,youmightwonderwhathappenedtothosereaderandwriterfunctionsthatItalkedabout.|Therealityisthatwedon'tactuallystartwithinputrecords,westartwithourdatainfiles.|Sohere'stherealoriginaldata.|We'lldrawthispicturehereforfiles,andlet'seraseourinputrecordsherebecausethejobofthereaderistotakethefiles,extracttherecordsfromthefiles,andprovidethemtothemapfunctions.|Sohereisthatsideofthing,it'sabinary digitsloppybutIthinkgettheidea.|Andwehaveasimilarthingontheotherend,theoutputmethodscomeoutofthereducers,butthentheirprovidedtothewriterfunctionsthatwhichwritetheoutputtoafinalfile.|Sohereitis,ouroriginalinputinfileshere,ourfinaloutputinfilesthere.|Ok,butletmeremindyouwhattheuserprovidewhatthesystemprovides.|Sotheusercreatesasinglemapfunctionthattakesrecordsandemitsakeyvaluepairforeachrecord.|TheuserprovidesasinglereducefunctionthattakesasetofvaluesforagivenkeyandproduceszeroormoreoutputsandIshouldmentionthatthemapcanproducezeroormoreoutputsfromeachrecordaswell.|Itdoesn'thavetobeaone-to-onemapping.|Theuseralsoprovidesthereaderfunction,toextractdatafromfilesandthewriterfunction,towritedatatotheoutput.|Andthere'sonemoreoptionalfunctionImentionedcalledthecombiner.|Thecombiner,actually,issortofattachedtothemapper,sowecankindofputithere.|Andwhatthecombinerdoesis,itactually,insortof,inthemapper,willtakeasetofrecordsforagivenkey,so,say,forK1andthenwe'llsendacombinedversionofthatrecordtothereducer.|Inaway,youcanthinkofitasasortofpre-reducephase,andwe'llseeexamplesofthisthatoccurswiththemapper,tomakethingsmoreefficientandsendlessdatatothereducer.|So,theuserhasprovidedthesepieces,thesesysteminfrastructuretakesthepieces,anddistributesthemtomultiplemachines,becausealotofthiscangooninparallel.|Allofthiscangooninparallel,thistoo,andthistoo.|Hereyouhavetoexchangedata,maybefromonemachinetoanother,butonceyoudo,parallelismcanoccurandhereaswell.|Sothesystemdistributesthemtomachines,andyoucanaddmoremachinestomakeitallallrunfaster.|Thesystemalsoprovidesfaulttolerance,soifsomethinggoesbadlyhere,itwillredothatreducerfunctionandhereaswell,andfinally,asImentionedbefore,itprovidesscalability.|ButIshouldadd,Ithinkoneofthemostimportantthingsthemassproducearchitectureprovides,isthegluethatputsthisalltogether.|Becauseagain,theuserisonlyprovidingthesefunctions,andthesystemwilltakecareofalloftheexecution,movingthedataaroundandcallingthefunctionoverthelargeamountsofdatathatarebeingprocessed.|Well,allofthatisprettyabstract,solet'slookataconcreteexample,andlet'sgobacktothedomainthatIintroducedinthepreviousvideoofanalyzingaweblog,wherewehave,ineachrecord,auserID,Uniform Resource Locator,thetimeoftheaccess,andmaybesomeadditionalinformation.|Andlet'sstartoutwithafairlysimpletask,whichisthatwewanttocountthenumberofaccessesforeachdomain,wherethedomainisinsidetheUniform Resource Locator.|So,forexample,thedomainmightbethestanford.edudomain,wherewehaveaccessestomanydifferentURLswiththatdomainandwe'rejustgoingtocounthowmanyaccessestherehavebeentoStanford.|Sotoperformthistask,theuserhastoprovideamapfunctionandareducefunction.|Let'slookatwhattheydo.|Themapfunctionisgoingtotakearecord.|We'llassumethatthereaderhasalreadyextractedtherecordfromthefileanditprovidesitinthisformatwiththesefourfields.|AndwhatthemapfunctionisgoingtodoissimplylookinsidetherecordandextractthedomainfromtheUniform Resource Locator,andit'sgoingtoproduceasoutputfromthatrecordthedomainasthekey,sothisisthekey,andthenforthis,wecanjusthaveanullvalueasthevalue,we'renotgoingtoactuallyneedtouseavalue.|Andsothat'sthejobofthemapper,prettysimple.|Nowwhatdoesthereducefunctiondo?|Thereducefunctionisgoingtotakeadomain,becausethat'sthekeyandthat'sthefirstargument,andthenit'sgoingtotakealistofvalues,inthiscase,it'sgoingtobealistofnullvalues,andwhat'sinterestingisthateachoneofthesenullvaluesrepresentsoneaccesstothatdomain.|Soallthereducefunctionneedstodo,iscountuphowmanynullsthereareforeachdomain,soit'sgoingtoproduceasitsresult,thedomainandthecount.|Andbelieveitornot,we'vesolvedtheirproblemwithjustalittlebinary digitofcode,justacodetofindthedomaininsidetheUniform Resource Locatorfromourrecord,andthenthissimplecodetocountupthenumberofNULLs.|Thesystemwilltakecareofshippingtherecordstotherightnodestoperformthetasksinparallelandthenre-shippingthem,soalloftherecords,foralloftheoutputsforaparticulardomain,areinthesameplaceandcanbecounted.|Nowletmegiveanexampleofhowthatcombinerfunctionwillbeused.|Thecombinerfunctionasareminderwilloperateatthesamenodeasamapperanddosomesortofpre-aggregationofthedata.|Soforexample,wecoulduseacombiner,we'llputthatrighthereafterthemapperandthecombinedfunctionisgoingtotakethedomainandthelistofNULLs,actuallyit'sgoingtodoexactlywhatthereducefunctionwasdoingandit'sgoingtoproducethedomainandaccount.|Andsothatateachindividualnodewe'llcountuphowmanyaccessesthereweretothatdomaininthedatathat'sbeingprocessedatthatnode,butthenwhenwegettothereducefunctionwemaygetabunchofthoserecords,sothislistofNULLherenowbecomesacountthat'swhatarrivesatthereducefunction,theoutputofthecombine,andtheninsteadofdoingacountherewedoasumandthatwillgiveustherightansweraswellandthatwillbemoreefficientagainbecauseofthepre-aggregationthatoccursrightinthesamenodethat'sprocessingthemapfunction.|Whoops,Imadeonemistakethere.|Sorryaboutthat.|Actuallythiscountherethatgoestothereducefunctionisalistofcounts,right,becausewe'regoingtogetoneofthesefromeachofthemappers,andthenweaddthoselistofcounts.|That'sthesumthatweperformhere,sorryaboutthatsmallmistake.|Nowlet'smodifytheproblem.|We'lltakethesamedatabutinsteadofjustcountinghowmanyaccesseswehavetoeachdomain,let'scomputesometotalvalueoftheaccessesforeachdomain.|Andwemightdothatbasedonsomethingthatweseeintheadditionalinformation,forexample,howvaluabletheuseris,whethertheuserwentoffandboughtsomething,somethinglikethat.|Solet'smodifyourmapandreducefunctionsforthisslightlyenhancedproblem.|Nowourmapfunctionagainisgoingtotakearecord,andthistimeit'snotgoingtolookonlyattheUniform Resource Locator,butit'salsogoingtolookinsidetheadditionalinformation,andwhatitwillproduce,isthedomainthatitextractedfromtheUniform Resource Locatorandthenlet'ssaysomekindofscoreonhowvaluablethataccesswas,basedonwhateveritseesinsideadditionalinformation.|Thereducedfunction,then,isgoingtotakeadomain,andit'sgoingtotakealistofscoresforthatdomainandthen,similartowhatwehadpreviously,theoutputisgoingtobethedomainandthesumofthosescores.|Now,oneoftheinterestingthingshereis,howthemapfunctioninteractswiththisadditionalinformation,becausethemapfunctionisgoingtohavecode,thatisgoingtolookintheinformationandit'sgoingtodetermineascorebasedonwhatitsees.|Ifwechangewhat'savailableinadditionalinformation,thenwecanmodifythemapfunction,buteverythingelsecanstaythesame,orifwesaywerefinehowweextractthescore.|Sothatisonebenefit,tosomeextent,ofthetheMapReduceframework,becausethecomputationofthescoreisjustembeddedinthisonepieceofcode.|Nowlet'smodifyourexamplefurther,similartothemodificationwemadeintheearliervideo,let'ssupposethatinadditiontothewebblogwehaveseparateinformationabouttheuser.|So,separatelyfromwhatmightbeanadditionalinfo,wehaveinadifferentdataset,theuserID,thename,theage,thegenderandsoforth.|Andnowlet'ssaythatweagainwanttofindthetotalvalueoftheaccessesforeachdomain,butnowthevalueiscomputedusingtheuserattributesthatwegetfromtheseparatedataset.|Well,thisfrankly,inmapreduce,ishardtodo.|Iteffectivelyinvolvesjoiningthesetwodatasets,notsomethingthat'ssupportednativelyinMapReduce.|Sonowwe'vekindofhitthelimitofwhat'sveryconvenienttodointhemapreduceframework,butwewillmomentarilyseethattherearesolutionstothataswell.|So,tosummarize,theMapReduceframeworkhasnobuilt-indatamodel.|Thedatajuststartsandfilesanditendsinfiles.|Theuserjustneedstoprovidespecificfunctions,themapfunction,reducefunction,readerandwriterandoptionally,acombiner.|Andthesystemwillprovidealloftheexecutionglue,itwillguaranteethetolerancetosystemfailuresanditprovidesscalabilitybydoingtheassignmentoftheprocessingtasks,tosayanincreasingnumberofcomputingnodes.|SowhentheMapReduceframeworkcameoutofGoogleandtheHadoopopensourceimplementationwasreleased,there'salotofexcitement.|Itwasprettyexcitingbecauseyoucouldjustwriteacoupleofsimplefunctionsandthenthesystemwouldprovidetheprocessingofmassiveamountsofdatathroughthosefunctions,anditwouldbescalable,itwouldbeefficient,anditwouldbefaulttolerant.|Butovertime,peoplerealizedthattheydon'talwayswantthatlowlevelprogramming,andourfavoritetraditionalnotionsofdatabaseschemasanddeclarativequeriesstartedtobemissed.|AndsowhatwasdevelopedissomelanguagesthatactuallysitontopofHadooportheMapReduceframework.|OneofthemiscalledHive,andHiveoffersschemasandalanguagethatlooksverymuchlikeStructured Query Language.|AnotherlanguageiscalledPig.|Pigisalittlebinary digitmoreimperative.|Inotherwords,it'sabinary digitmoreofastatementlanguage,butthefundamentalconstructsinPigarestillrelationaloperators,andyoucouldalmostthinkofaPigscriptasbeingalittlebinary digitlikethosestatementsofrelationalalgebrathatwesawwaybackwhen,withtheadditionofloopsandsoforth.|Bothoftheselanguagesarewhattheusersees,andtheycompiletoaworkfloworyouthinkofthatasagraph-ofHadoopjobs.|Hadoop,again,beingtheopensourceimplementationofmapandreduce,anyjobbeingoneinstanceofmapandreducelikethatbigpictureIshowedbefore.|AndonethingIshouldmention,asofNovember,2011,whichitisnow,areallysignificantportionofHadoopjobsareactuallygeneratedbyHiveandPig,orHiveorPig.|SomoreandmoreusersareactuallychoosingtouseahigherlevellanguageratherthanprogramtheMapReduceframeworkdirectly.|NowI'dberemissifIdidn'talsomentiononeothersystem.|There'sasystemcalledDriadthatallowsuserstospecifyaworkflow,sortofsimilartotheworkflowthatmightbegeneratedbyHiveandPig,soit'smoregeneralthanjustoneMapReducejob.|Andthere'salsoalanguagecalledDriadlinkthatsitsontopofDriadandcompilestoDriad,sortofinthesamewaythatHiveandPigcompiletoaworkflowofMapReducejobs.|Nowlet'smoveontotalkaboutkeyvaluestores.|Asareminder,theHadooporMapReduceframeworkisdesignedformoreOLAP-typeoperations,oranalyticaloperationsthatinvolvescanningmostofthedata,andIthinkthatwasveryclearfromwhattheMapReduceframeworkdoes.|WherekeyvaluestoresaredesignedmorefortheseOnline Transaction Processingstyleapplications,whereyou'redoingsmalloperations,maybeoverasinglerecord,inamassivedatabase.|Andsothekeyvaluestoresareextremelysimple.|Thedatamodelforkeyvaluestoresarejustpairsofkeysandvalues,notsurprisingly.|Andthebasicoperationsaresimplytoinsertanewrecord,soyouprovideakeyandvalue,tofetcharecordbyit'skey,toupdatethecontents,thevalueintherecordforagivenkey,ortodeletetherecordwiththegivenkey.|So,that'sitandwiththatsimplesetofoperationsasyoucanimagine,theimplementationisfocusingondoingthesesimpleoperationsovermassivedatabasesvery,veryquickly.|So,againlikeHadoop,efficiency,scalability,andfaulttolerancearethemostimportantthingsbecausewe'relookingatapplicationswithmassiveamountsofdataandverystringentperformancerequirements.|Sothewaytheimplementationworksatavery,veryhighlevel,it'sactuallyquitecomplicatedtomakeitworkverywell,isthattherecordsaredistributedtothenodes,thecomputingnodesbasedonthekey,probablyahashvalueoverthekey.|Sotofindtherecordforagivenkeycanbeveryquick.|Yougostraighttothenode.|Infact,therecordsmaybereplicatedacrossmultiplenodesandthatgivesyoubothefficiency,youcangotomaybealightlyloadednode,itgivesyoufaulttoleranceifanodefails.|Thenotionoftheactionsandkeyvaluestoresareverysimple.|Oneoperationitselfisatransaction,sowedon'thavetheideaofgroupingabunchofoperationsintotransactions.|Andfurthermore,theyimplementsomethingcalledeventualconsistency.|Andthatsaysthatthereplicasofasinglerecordcanactuallydivergeintheirvalueforsomepointoftime.|Whateventualconsistencyspecifiesisthatifalloperationsstop,thenthesystemwillbecomeconsistentwithallcopiesofeachrecordbeingthesame.|Now,unfortunately,asissometimesthecase,theseverysimpleoperationsandthissimpledatamodelweren'talwaysquiteenough,andsosomekeyvaluestores,butnotallIwouldsay,haveaconceptcalledcolumnsthatoccurwithinthevalue.|Sothevalueherehasalittlebinary digitmorestructuretoitthanjustablobofbits.|Andthecolumnswilltypicallybekindoflikeanembeddedkeyvaluestores.|Onethingthat'simportantistheydon'trequireuniformcolumn.|Sononeofthekeyvaluestoresareasstrictintheirstructureasarelationaldatabasesystemwouldbe.|Theotheradditionthatsomeallowisafetchonarangeofkeys.|SothismightsayIwanttogetallkeyssaybetweentwoandten,andsothatrequiresadifferenttypeofimplementationasyoucanimagine,butitdoesallowthatoperationtobeperformedefficientlyifthatissomethingthattheapplicationneeds.|Justafewexamplesofkeyvaluestores.|Thisisnotanexhaustivelist,therearemanymoreandthisisonlyNovember2011,sothingswillchangeovertime.|Butsomeofthemoreprominentkeyvaluestoresarelistedhere-Google'sBigTable,Amazon,Dynamo,Cassandra,whichisanopensource,Voldemort,H-base,andagaintherearemanyothers.|Thesearejustafewexample.|Nowlet'stalkaboutdocumentstores.|Actuallydocumentstoresareverymuchlikekeyvaluestores,exceptthevalueitselfisadocument.|Sothedatamodelisakeydocumentpairsandwhat'sinterestingnowisthatthedocumentindocumentstoresistypicallyaknowntypeofstructuresothedocumentmightcontainJavaScript Object Notationformatteddatajavascriptobjectnotation.|ItmightcontaineXtensible Markup Language,whichwehavelearnedabout,orothersemi-structuredformats.|Thebasicoperationsareverysimilarthoughtowhatwesayinkeyvaluestores.|Youcaninsertanewdocumentbasedonakey.|Wecanfetchbasedonakey.|Modifythecontentsassociatedwithkeyanddeletetherecordassociatedwithaspecifickey.|Butalsoveryimportantisthatthereisafetchoperationbasedonthedocumentcontents,andthisisverysystem/formatspecific,whattheoperationswouldbe.|Sothereisnotastandardizedfetchedquerylanguageatthispointintime.|Againafewexamplesystems,anotexhaustivelist,arethesystemsCouch-DB,MongoDatabase,SimpleDatabase.|TheyallseemtohaveDatabaseintheirname.|Andagain,thisisNovember2011,thingsthatwillundoubtedlychange.|OneStructured Query LanguagesystemI'dliketocoverisgraphdatabasesystems.|Graphdatabasesystem,asthenameimplies,aredesignedforstoringandrunningqueriesorotheroperationsoververylargegraphs,thedatamodelisthateveryobjectiseitheranodeorit'sanedgebetweennodes.|Nodesmayhaveproperties,veryoftenIDisarequiredpropertyofa,andedgesmayhavelabelssoyoucanthinkofthemasrolls.|SoIthinkwhat'sbesttounderstand,thisisjusttoseeanexample.|Myexampleisgoingtobeaverysmallsocialnetwork,atinyoneactually.|AsimilaronetowhatwasusedforsomeofourStructured Query Languageexercises.|Solet'sstartwiththreenodes,andthenodesaregonnarepresentpeople,andthepropertiesofthenodesaregoingtobeID,name,andgrade.|AndsoeachnodeisgoingtohaveavaluefortheID,name,andgrade.|Forthisone,we'llmakeitone,Amyingradenine,andwe'llhavetwomore.|Soherearethethreenodesrepresentingthreepeopleinoursocialgraph.|WealsohaveID2,whichisBeningradenine,andID3,whichisCarolingradeten.|Dependingonthesystem,thenodesmayormaynothavetohaveuniformkeyvaluepairswithinthemostsystemwon'tbethatstringent.|Theninadditiontothenodes,wehavetheedgesbetweenthenodes.|Typicallytheywouldbedirectededges.|So,let'smaketwodifferenttypesofedges.|Let'smakefriendedgesandlet'smakelikesedges.|So,let'ssay,forexample,AmylikesBen.|Sothatwouldbeadirectededgeherewiththepropertylikes,andmaybeBenlikesCarol,let'ssayhere.|AndmaybethenwehavethatAmyandCarolarebothfriendswitheachothersowe'llhaveadifferenttypeofedgecalledfriend.|Now,onemightwonderhowlongthosefriendshipswilllastwiththiscomplicatedlikesrelationship.|But,inanycase,thisgivesyouanideaofthetypeofdatathat'sstoredinagraphdatabase.|Thedatamodelisveryspecificallyaboutstoringnodeswithpropertiesinsidethem,likekeyvaluepairsandedgestypicallywithlabelsorrollsonthem,ofcoursethat'snotrequired.|Soingraphdatabasesystems,currently,theinterfacestothesystemsandthequerylanguagesvaryalot.|There'snostandardizationatallandthequeriesmightjustbesingle-stepquerieslikeaskingforfriends.|Theymightbepathexpressionslike,askforthewomenfriends,ofthemenfriendsofsomeone.|Wesawthatexampleintheearliervideo.|Ortheymighthavefullrecursion,whereyoucantraversetoarbitrarydepthsthroughthegraph.|Afewexamplesystems,again,asofNovember,2011,youknowIwasgoingtosaythat,areaNeo4J,FlatDatabaseandPrego.|Andthesesystemsactuallydifferquitealotfromeachother.|IalsowantedtomentionResource Description Framework.|Resource Description Frameworkistheresourcedescriptionframework,andthere'ssomethingknownastheResource Description Frameworktriplestores.|Resource Description Frameworkisbasedonobjectshavingrelationshipstootherobjects.|Soyoucanalmostthinkofthoseastwonodeswithedgesbetweenthem,soyoucanimaginehowResource Description Frameworkcanbemappedtographdatabases.|So,thosewerefourexamplesofNoSQLsystems.|Ifthemostprominentcategoriesatthispointintime,theMapReduceframework,againwithlanguagessittingontopofMapReducesuchasHiveandPig,keyvaluestoresformoresmalltransactionsovermassivedatabasesbutjustoperatingsmallbitsofthematonce.|Documentstores,andgraphdatabasesystems.|NoSQLstandsfornotonlysql,recognizingthatforsomeapplicationstheseframeworksworkbetterthantraditionaldatabasesystems,butformanyapplications-avastnumberofapplications-traditionaldatabasesarestillused.|